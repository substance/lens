!function t(e,i,n){function s(o,a){if(!i[o]){if(!e[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(r)return r(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[o]={exports:{}};e[o][0].call(c.exports,function(t){var i=e[o][1][t];return s(i?i:t)},c,c.exports,t,e,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t,e,i){"use strict";function n(t,e){o.call(this,t,e),this.toc=new h(this),this.contentHighlights=new p(this.getDocument()),this.handleApplicationKeyCombos=this.handleApplicationKeyCombos.bind(this),this.handleActions({switchState:this.switchState,switchTab:this.switchContext,switchContext:this.switchContext,toggleBibItem:this.toggleBibItem,tocEntrySelected:this.tocEntrySelected,closeDialog:this.closeDialog})}var s=t("substance/util/helpers"),r=t("lodash/object/omit"),o=t("substance/ui/Controller"),a=t("substance/ui/Component"),l=a.$$,u=t("./packages/bibliography/CrossrefSearch"),c=t("substance/util/jquery"),h=t("substance/ui/TOC"),p=t("substance/ui/Highlights"),d=t("substance/ui/TabbedPane"),f=t("substance/ui/i18n");f.instance.load(t("substance/i18n/en")),f.instance.load(t("./i18n/en")),n.Prototype=function(){this.closeDialog=function(){this.setState({contextId:"toc"})},this.didMount=function(){this.state.nodeId&&"toc"===this.state.contextId&&this.refs.contentPanel.scrollTo(this.state.nodeId)},this.didUpdateState=function(){this.state.nodeId&&"toc"===this.state.contextId&&this.refs.contentPanel.scrollTo(this.state.nodeId)},this.tocEntrySelected=function(t){this.extendState({nodeId:t})},this._panelPropsFromState=function(){var t=r(this.state,"contextId");return t.doc=this.getDocument(),t},this._renderContextSection=function(){var t=this.getConfig(),e=this._panelPropsFromState(),i=this.state.contextId,n=t.panels||{},s=n[this.state.contextId]||{},r=t.tabOrder,o=this.componentRegistry.get(i),a=r.map(function(t){return{id:t,name:this.i18n.t(t)}}.bind(this)),u=l("div").addClass("se-context-section").ref("contextSection"),c=l(o,e).ref(i);return s.isDialog?u.append(c):u.append(l(d,{activeTab:i,tabs:a}).ref(this.state.contextId).append(c)),u},this.toggleBibItem=function(t){this.state.bibItemId===t.id?this.setState({contextId:"bib-items"}):this.setState({contextId:"bib-items",bibItemId:t.id})},this.getChildContext=function(){var t=o.prototype.getChildContext.call(this);return s.extend(t,{toc:this.toc,bibSearchEngines:[new u],i18n:f.instance,embedResolver:function(t,e){c.get("http://iframe.ly/api/iframely?url="+encodeURIComponent(t)+"&api_key=712fe98e864c79e054e2da").success(function(t){e(null,t.html)}).error(function(t){e(t)})}})},this.getInitialState=function(){return{contextId:"toc"}},this.switchState=function(t,e){e=e||{},this.setState(t),e.restoreSelection&&this.restoreSelection()},this.switchContext=function(t,e){e=e||{},this.setState({contextId:t}),e.restoreSelection&&this.restoreSelection()},this.restoreSelection=function(){var t=this.getSurface("body");t.rerenderDomSelection()},this.uploadFile=function(t,e){if(this.props.onUploadFile)return this.props.onUploadFile(t,e);var i=window.URL.createObjectURL(t);e(null,i)},this.handleStateUpdate=function(t){function e(t){if(t.citationId){var e=n.get(t.citationId);if(e&&["image-figure","table-figure"].indexOf(e.getItemType())>=0)return[t.citationId].concat(e.targets)}return[]}function i(t){if(t.bibItemId){var e=Object.keys(n.citationsIndex.get(t.bibItemId));return e}if(t.citationId){var i=n.get(t.citationId);if(i&&"bib-item"===i.getItemType())return[t.citationId].concat(i.targets)}return[]}var n=this.getDocument(),s=i(t),r=e(t);setTimeout(function(){this.contentHighlights.set({"bib-item":s,figure:r})}.bind(this),0)}},o.extend(n),e.exports=n},{"./i18n/en":6,"./packages/bibliography/CrossrefSearch":432,"lodash/object/omit":76,"substance/i18n/en":80,"substance/ui/Component":365,"substance/ui/Controller":369,"substance/ui/Highlights":376,"substance/ui/TOC":391,"substance/ui/TabbedPane":393,"substance/ui/i18n":404,"substance/util/helpers":410,"substance/util/jquery":412}],2:[function(t,e,i){"use strict";function n(t,e){s.call(this,t,e),this.connect(this,{"citation:selected":this.onCitationSelected})}var s=t("./LensController"),r=(t("substance/ui/StatusBar"),t("./packages/bibliography/BibliographyComponent")),o=t("substance/ui/ContainerAnnotator"),a=t("substance/ui/SplitPane"),l=t("substance/ui/ScrollPane"),u=t("./packages/reader/Cover"),c=t("substance/ui/Component"),h=c.$$,p={controller:{commands:[t("substance/ui/UndoCommand"),t("substance/ui/RedoCommand"),t("substance/ui/SaveCommand")],components:{paragraph:t("substance/packages/paragraph/ParagraphComponent"),heading:t("substance/packages/heading/HeadingComponent"),blockquote:t("substance/packages/blockquote/BlockquoteComponent"),codeblock:t("substance/packages/codeblock/CodeblockComponent"),embed:t("substance/packages/embed/EmbedComponent"),image:t("substance/packages/image/ImageComponent"),table:t("substance/packages/table/TableComponent"),"image-figure":t("substance/packages/figure/FigureComponent"),"table-figure":t("substance/packages/figure/FigureComponent"),"bib-item-citation":t("./packages/citations/CitationComponent"),"image-figure-citation":t("./packages/citations/CitationComponent"),"table-figure-citation":t("./packages/citations/CitationComponent"),toc:t("substance/ui/TOCPanel"),cite:t("./packages/citations/CitePanel"),"bib-items":t("./packages/bibliography/BibItemsPanel"),"cite-bib-item":t("./packages/citations/CitePanel"),"cite-image-figure":t("./packages/citations/CitePanel"),"cite-table-figure":t("./packages/citations/CitePanel"),"bib-item-entry":t("./packages/bibliography/BibItemEntry"),"image-figure-entry":t("./packages/figures/ImageFigureEntry")}},main:{commands:[]},cover:{commands:[]},panels:{toc:{},"bib-items":{}},tabOrder:["toc","bib-items"],containerId:"main",isEditable:!1};n.Prototype=function(){this.onCitationSelected=function(t){return this.state.citationId===t.id?void this.setState({contextId:"toc"}):void("bib-item-citation"===t.type?this.setState({contextId:"bib-items",citationId:t.id}):this.setState({contextId:"toc",citationId:t.id}))},this.dispose=function(){s.prototype.dispose.call(this),this.disconnect(this)},this._renderMainSection=function(){var t=this.getConfig();return h("div").ref("main").addClass("se-main-section").append(h(l,{scrollbarType:"substance",scrollbarPosition:"left",toc:this.toc,highlights:this.contentHighlights}).ref("contentPanel").append(h(u,{name:"cover",commands:t.cover.commands}).ref("coverView"),h("div").ref("main").addClass("document-content").append(h(o,{name:"main",editable:!1,containerId:t.containerId,commands:t.main.commands}).ref("mainEditor")),h(r).ref("bib")))},this.render=function(){return h("div").addClass("sc-lens sc-lens-reader sc-controller").append(h(a,{splitType:"vertical",sizeA:"60%"}).append(this._renderMainSection(),this._renderContextSection()).ref("splitPane"))}},s.extend(n),n["static"].config=p,e.exports=n},{"./LensController":1,"./packages/bibliography/BibItemEntry":424,"./packages/bibliography/BibItemsPanel":426,"./packages/bibliography/BibliographyComponent":428,"./packages/citations/CitationComponent":439,"./packages/citations/CitePanel":441,"./packages/figures/ImageFigureEntry":447,"./packages/reader/Cover":452,"substance/packages/blockquote/BlockquoteComponent":293,"substance/packages/codeblock/CodeblockComponent":300,"substance/packages/embed/EmbedComponent":304,"substance/packages/figure/FigureComponent":311,"substance/packages/heading/HeadingComponent":316,"substance/packages/image/ImageComponent":319,"substance/packages/paragraph/ParagraphComponent":330,"substance/packages/table/TableComponent":348,"substance/ui/Component":365,"substance/ui/ContainerAnnotator":366,"substance/ui/RedoCommand":378,"substance/ui/SaveCommand":381,"substance/ui/ScrollPane":383,"substance/ui/SplitPane":385,"substance/ui/StatusBar":386,"substance/ui/TOCPanel":392,"substance/ui/UndoCommand":400}],3:[function(t,e,i){"use strict";function n(t,e){s.call(this,t,e)}var s=t("./LensController"),r=t("substance/ui/SplitPane"),o=t("substance/ui/ScrollPane"),a=t("substance/ui/StatusBar"),l=t("./packages/bibliography/BibliographyComponent"),u=t("./packages/writer/CoverEditor"),c=t("substance/ui/Toolbar"),h=t("./packages/writer/WriterTools"),p=t("substance/ui/ContainerEditor"),d=t("substance/model/documentHelpers"),f=t("substance/ui/Component"),m=f.$$,g={controller:{commands:[t("substance/ui/UndoCommand"),t("substance/ui/RedoCommand"),t("substance/ui/SaveCommand")],components:{paragraph:t("substance/packages/paragraph/ParagraphComponent"),heading:t("substance/packages/heading/HeadingComponent"),blockquote:t("substance/packages/blockquote/BlockquoteComponent"),codeblock:t("substance/packages/codeblock/CodeblockComponent"),embed:t("substance/packages/embed/EmbedComponent"),image:t("substance/packages/image/ImageComponent"),table:t("substance/packages/table/TableComponent"),"image-figure":t("substance/packages/figure/FigureComponent"),"table-figure":t("substance/packages/figure/FigureComponent"),"bib-item-citation":t("./packages/citations/CitationComponent"),"image-figure-citation":t("./packages/citations/CitationComponent"),"table-figure-citation":t("./packages/citations/CitationComponent"),toc:t("substance/ui/TOCPanel"),cite:t("./packages/citations/CitePanel"),"bib-items":t("./packages/bibliography/BibItemsPanel"),"add-bib-items":t("./packages/bibliography/AddBibItemsPanel"),"cite-bib-item":t("./packages/citations/CitePanel"),"cite-image-figure":t("./packages/citations/CitePanel"),"cite-table-figure":t("./packages/citations/CitePanel"),"bib-item-entry":t("./packages/bibliography/BibItemEntry"),"image-figure-entry":t("./packages/figures/ImageFigureEntry")}},main:{commands:[t("substance/packages/embed/EmbedCommand"),t("substance/packages/text/SwitchTextTypeCommand"),t("substance/packages/strong/StrongCommand"),t("substance/packages/emphasis/EmphasisCommand"),t("substance/packages/link/LinkCommand"),t("substance/packages/subscript/SubscriptCommand"),t("substance/packages/superscript/SuperscriptCommand"),t("substance/packages/code/CodeCommand"),t("substance/packages/figure/InsertFigureCommand"),t("./packages/bibliography/BibItemCitationCommand"),t("./packages/figures/ImageFigureCitationCommand")],textTypes:[{name:"paragraph",data:{type:"paragraph"}},{name:"heading1",data:{type:"heading",level:1}},{name:"heading2",data:{type:"heading",level:2}},{name:"heading3",data:{type:"heading",level:3}},{name:"codeblock",data:{type:"codeblock"}},{name:"blockquote",data:{type:"blockquote"}}]},title:{commands:[t("substance/packages/emphasis/EmphasisCommand"),t("substance/packages/text/SwitchTextTypeCommand"),t("substance/packages/subscript/SubscriptCommand"),t("substance/packages/superscript/SuperscriptCommand")]},"abstract":{commands:[t("substance/packages/text/SwitchTextTypeCommand"),t("substance/packages/emphasis/EmphasisCommand"),t("substance/packages/strong/StrongCommand"),t("substance/packages/subscript/SubscriptCommand"),t("substance/packages/superscript/SuperscriptCommand"),t("substance/packages/link/LinkCommand")]},panels:{toc:{},"bib-items":{},"cite-bib-item":{isDialog:!0},"cite-image-figure":{idDialog:!0},"add-bib-items":{isDialog:!0}},tabOrder:["toc","bib-items"],containerId:"main",isEditable:!0};n.Prototype=function(){this._renderMainSection=function(){var t=this.getConfig();return m("div").ref("main").addClass("se-main-section").append(m(r,{splitType:"horizontal"}).append(m(c).ref("toolbar").append(m(h)),m(o,{scrollbarType:"substance",scrollbarPosition:"left",toc:this.toc,highlights:this.contentHighlights}).ref("contentPanel").append(m(u).ref("coverEditor"),m("div").ref("main").addClass("document-content").append(m(p,{name:"main",containerId:t.containerId,commands:t.main.commands,textTypes:t.main.textTypes}).ref("mainEditor")),m(l).ref("bib"))).ref("mainSectionSplitPane"))},this.render=function(){var t=this.props.doc;return m("div").addClass("sc-lens sc-lens-writer sc-controller").append(m(r,{splitType:"horizontal",sizeB:"inherit"}).append(m(r,{splitType:"vertical",sizeA:"60%"}).append(this._renderMainSection(),this._renderContextSection()).ref("splitPane"),m(a,{doc:t}).ref("statusBar")).ref("workspaceSplitPane"))},this.onSelectionChanged=function(t,e){function i(e){return d.getAnnotationsForSelection(n,t,e,"main")[0]}if("main"===e.name&&!t.isNull()&&t.isPropertySelection()&&!t.equals(this.prevSelection)){this.prevSelection=t;var n=e.getDocument(),s=i("citation");if(s&&s.getSelection().equals(t)){var r=s.type.replace("-citation","").replace("_","-");this.setState({contextId:"cite-"+r,citationType:r,citationId:s.id})}else"toc"!==this.state.contextId&&this.setState({contextId:"toc"})}}},s.extend(n),n["static"].config=g,e.exports=n},{"./LensController":1,"./packages/bibliography/AddBibItemsPanel":417,"./packages/bibliography/BibItemCitationCommand":420,"./packages/bibliography/BibItemEntry":424,"./packages/bibliography/BibItemsPanel":426,"./packages/bibliography/BibliographyComponent":428,"./packages/citations/CitationComponent":439,"./packages/citations/CitePanel":441,"./packages/figures/ImageFigureCitationCommand":444,"./packages/figures/ImageFigureEntry":447,"./packages/writer/CoverEditor":453,"./packages/writer/WriterTools":454,"substance/model/documentHelpers":131,"substance/packages/blockquote/BlockquoteComponent":293,"substance/packages/code/CodeCommand":296,"substance/packages/codeblock/CodeblockComponent":300,"substance/packages/embed/EmbedCommand":303,"substance/packages/embed/EmbedComponent":304,"substance/packages/emphasis/EmphasisCommand":307,"substance/packages/figure/FigureComponent":311,"substance/packages/figure/InsertFigureCommand":313,"substance/packages/heading/HeadingComponent":316,"substance/packages/image/ImageComponent":319,"substance/packages/link/LinkCommand":322,"substance/packages/paragraph/ParagraphComponent":330,"substance/packages/strong/StrongCommand":333,"substance/packages/subscript/SubscriptCommand":337,"substance/packages/superscript/SuperscriptCommand":341,"substance/packages/table/TableComponent":348,"substance/packages/text/SwitchTextTypeCommand":355,"substance/ui/Component":365,"substance/ui/ContainerEditor":367,"substance/ui/RedoCommand":378,"substance/ui/SaveCommand":381,"substance/ui/ScrollPane":383,"substance/ui/SplitPane":385,"substance/ui/StatusBar":386,"substance/ui/TOCPanel":392,"substance/ui/Toolbar":399,"substance/ui/UndoCommand":400}],4:[function(t,e,i){"use strict";function n(){s.apply(this,arguments),this.backend=new o}var s=t("substance/ui/Component"),r=s.$$,o=t("./backend"),a=window.$=t("substance/util/jquery"),l=t("../LensWriter"),u=t("../LensReader"),c=t("substance/ui/Router");n.Prototype=function(){this.getInitialContext=function(){return{router:new c(this)}},this.getInitialState=function(){return{mode:"write"}},this.openReader=function(){this.extendState({mode:"read"})},this.openWriter=function(){this.extendState({mode:"write"})},this.render=function(){var t=r("div").addClass("app");if(t.append(r("div").addClass("menu").append(r("button").addClass("write"===this.state.mode?"active":"").on("click",this.openWriter).append("Write"),r("button").addClass("read"===this.state.mode?"active":"").on("click",this.openReader).append("Read"))),this.doc){var e;e="write"===this.state.mode?r(l,{doc:this.doc,onUploadFile:function(t,e){console.log("custom file upload handler in action...");var i=window.URL.createObjectURL(t);e(null,i)},onSave:function(t,e,i){console.log("custom save handler in action..."),i(null)}}).ref("writer").route():r(u,{doc:this.doc}).ref("reader").route(),t.append(r("div").addClass("context").append(e))}return t},this.didMount=function(){this.backend.getDocument("sample",function(t,e){this.doc=e,this.rerender()}.bind(this))}},s.extend(n),a(function(){window.app=s.mount(n,a("#container"))})},{"../LensReader":2,"../LensWriter":3,"./backend":5,"substance/ui/Component":365,"substance/ui/Router":380,"substance/util/jquery":412}],5:[function(t,e,i){var n=t("substance/util/oo"),s=t("substance/util/jquery"),r=t("../model/LensArticleImporter"),o=new r,a=function(){};a.Prototype=function(){this._request=function(t,e,i,n){var r={type:t,url:e,contentType:"application/json; charset=UTF-8",dataType:"text",success:function(t){n(null,t)},error:function(t){console.error(t),n(t.responseText)}};i&&(r.data=JSON.stringify(i)),s.ajax(r)},this.getDocument=function(t,e){this._request("GET","data/example-doc.xml",null,function(t,i){t&&(console.error(t),e(t));var n=o.importDocument(i);window.doc=n,n.updateCollections(),e(null,n)})},this.saveDocument=function(t,e){e("Not supported in dev version")},this.uploadFigure=function(t,e){var i=window.URL.createObjectURL(t);e(null,i)}},n.initClass(a),e.exports=a},{"../model/LensArticleImporter":9,"substance/util/jquery":412,"substance/util/oo":413}],6:[function(t,e,i){e.exports={enter_search_term:"Enter search term",choose_referenced_items:"Choose referenced items",no_items_found:"No items found.",add_references:"Add references",figure:"Figure",insert:"Insert",cite:"Cite",focus:"Focus",bib_item:"Reference",manage:"Manage",add_reference:"Add References","bib-items":"References","embed-src":"Embed URL",paragraph:"Paragraph",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",codeblock:"Codeblock",blockquote:"Blockquote","article-meta.title":"Title","article-meta.abstract":"Abstract","image-figure.title":"Figure Title","image-figure.caption":"Figure Caption","container-selection":"Multiple Elements","add-bib-entries":"Add new references",bibItemCitation:"Bibliographic Citation",imageFigureCitation:"Figure Citation"}},{}],7:[function(t,e,i){function n(t,e,i,n){this.doc=t,this.containerId=e,this.itemType=i,this.labelPrefix=n,this.doc.connect(this,{"document:changed":this.onDocumentChanged})}var s=t("substance/util/helpers"),r=t("substance/util/oo");n.Prototype=function(){this.dispose=function(){this.doc.disconnect(this)},this.getDocument=function(){return this.doc},this.determineItems=function(){var t=this.doc,e=t.get(this.containerId),i=t.getIndex("type").get(this.itemType),n=[];s.each(i,function(t){var i,s=e.getPosition(t.id);s>=0?i=!0:(i=!1,s=Number.MAX_VALUE),n.push({pos:s,item:t,isShown:i})}),n=s.sortBy(n,"pos");var r=0;return s.each(n,function(t){t.isShown?t.index=r++:t.index=-1}),n},this.createItemLabel=function(t){return t.index<0?this.labelPrefix+" ?":[this.labelPrefix,t.index+1].join(" ")},this.createCitationLabel=function(t){var e,i=t.citation,n=i.targets,r=[],o=this.doc;s.each(n,function(t){var i=o.get(t),n=this.items.indexOf(i);if(0>n)return console.error("citation target not found: ",t),void(e=t);var s=this._items[n];if(s.index<0)return console.error("citation target does not have a label: ",t),void(e=t);var a=s.index+1;r.push(a)},this),r.sort();var a;return a=0===r.length?this.labelPrefix+" ???":[this.labelPrefix,r.join(", ")].join(" ")},this.updateItemLabels=function(){s.each(this._items,function(t){var e=this.createItemLabel(t);t.item.setLabel(e)},this)},this.updateCitationLabels=function(){s.each(this._citations,function(t){var e=this.createCitationLabel(t);t.citation.setLabel(e)},this)},this.determineCitations=function(){var t=this.doc,e=t.getIndex("type").get(this.itemType+"-citation"),i=t.get(this.containerId),n=s.map(e,function(t){var e=i.getAddress(t.path);return{citation:t,address:e}});return n.sort(function(t,e){return e>t?-1:t>e?1:t.citation.startOffset-e.citation.startOffset}),n},this.update=function(){this._items=this.determineItems(),this.items=s.pluck(this._items,"item"),this._citations=this.determineCitations(),this.citations=s.pluck(this._citations,"citation"),this.updateItemLabels(),this.updateCitationLabels()},this.getItems=function(){return this.items},this.onDocumentChanged=function(t){var e=this.doc,i=!1;s.each(t.ops,function(t){if(t.isCreate()||t.isSet()||t.isUpdate()){var n=t.path[0],s=e.get(n);if(!s)return;t.isCreate()?("image-figure-citation"===s.type||"table-figure-citation"===s.type)&&(i=!0):("image-figure-citation"===s.type||"table-figure-citation"===s.type)&&"targets"===t.path[1]&&(i=!0)}else if(t.isDelete()){var r=t.val;("image-figure-citation"===r.type||"table-figure-citation"===r.type)&&(i=!0)}if(!i&&t.path[0]===this.containerId&&("set"===t.type&&(i=!0),"update"===t.type)){var o=t.diff.val,s=e.get(o);if(!s)return;s.type===this.itemType&&(i=!0)}if(t.isDelete()){var r=t.val;r.type===this.itemType&&(i=!0)}}.bind(this)),i&&this.update()}},r.initClass(n),e.exports=n},{"substance/util/helpers":410,"substance/util/oo":413}],8:[function(t,e,i){var n=t("./articleSchema"),s=t("substance/util/helpers"),r=t("substance/model/Document"),o=t("substance/model/DocumentIndex"),a=t("../packages/bibliography/CiteprocCompiler"),l=t("../packages/bibliography/Bibliography"),u=t("./Collection"),c=t("lodash/array/without"),h=function(){h["super"].call(this,n),this.create({type:"container",id:"main",nodes:[]}),this.citeprocCompiler=new a,this.collections={"bib-item":new l(this,"main"),"image-figure":new u(this,"main","image-figure","Figure"),"table-figure":new u(this,"main","table-figure","Table")},this.includesIndex=this.addIndex("includes",o.create({type:"include",property:"nodeId"})),this.citationsIndex=this.addIndex("citations",o.create({type:"citation",property:"targets"})),this.connect(this,{"document:changed":this.onDocumentChanged})};h.Prototype=function(){this.onDocumentChanged=function(t){s.each(t.ops,function(t){if(t.isDelete()){var e=t.val;if("image-figure"===e.type||"table-figure"===e.type||"bib-item"===e.type){var i=this.getIndex("citations").get(e.id);s.each(i,function(t){t.targets=c(t.targets,e.id)})}}}.bind(this))},this.updateCollections=function(){s.each(this.collections,function(t){t.update()})},this.getDocumentMeta=function(){return this.get("article-meta")},this.getCiteprocCompiler=function(){return this.citeprocCompiler},this.getBibliography=function(){return this.collections["bib-item"]},this.getFiguresCollection=function(){return this.collections["image-figure"]},this.getTablesCollection=function(){return this.collections["table-figure"]},this.getCollection=function(t){return this.collections[t]},this.getTitle=function(){return this.get("article-meta").title},this.deleteFigure=function(t){this.transaction(function(e,i){var n=s.map(this.citationsIndex.get(t));s.each(n,function(t){e["delete"](t.id)});var r=s.map(e.getIndex("includes").get(t));return s.each(r,function(t){e.get("main").hide(t.id),e["delete"](t.id)}),e["delete"](t),i})},this.deleteBibItem=function(t){this.transaction(function(e,i){var n=s.map(e.getIndex("citations").get(t));return s.each(n,function(t){e["delete"](t.id)}),e["delete"](t),i})}},r.extend(h),h.XML_TEMPLATE=['<article xmlns="http://substance.io/science-article/0.1.0" lang="en">',"<metadata>","<title>Enter title</title>","<abstract>Enter abstract</abstract>","</metadata>","<resources></resources>","<body>",'<p id="p1">Enter your article here.</p>',"</body>","</article>"].join(""),e.exports=h},{"../packages/bibliography/Bibliography":427,"../packages/bibliography/CiteprocCompiler":430,"./Collection":7,"./articleSchema":10,"lodash/array/without":14,"substance/model/Document":92,"substance/model/DocumentIndex":95,"substance/util/helpers":410}],9:[function(t,e,i){"use strict";function n(){s.call(this,{schema:r,converters:a,DocumentClass:o})}var s=t("substance/model/XMLImporter"),r=t("./articleSchema"),o=t("./LensArticle"),a=[t("substance/packages/paragraph/ParagraphHTMLConverter"),t("substance/packages/blockquote/BlockquoteHTMLConverter"),t("substance/packages/codeblock/CodeblockHTMLConverter"),t("substance/packages/heading/HeadingHTMLConverter"),t("substance/packages/image/ImageXMLConverter"),t("substance/packages/strong/StrongHTMLConverter"),t("substance/packages/emphasis/EmphasisHTMLConverter"),t("substance/packages/link/LinkHTMLConverter"),t("../packages/metadata/MetadataXMLConverter"),t("../packages/bibliography/BibItemXMLConverter"),t("../packages/figures/ImageFigureXMLConverter"),t("../packages/figures/ImageFigureCitationXMLConverter"),t("../packages/bibliography/BibItemCitationXMLConverter")];n.Prototype=function(){this.convertDocument=function(t){var e=t.find("meta");this.convertElement(e);var i=t.find("resources");i.children.forEach(function(t){this.convertElement(t)}.bind(this));var n=t.find("body").children;this.convertContainer(n,"main")}},n.converters=a,s.extend(n),e.exports=n},{"../packages/bibliography/BibItemCitationXMLConverter":422,"../packages/bibliography/BibItemXMLConverter":425,"../packages/figures/ImageFigureCitationXMLConverter":446,"../packages/figures/ImageFigureXMLConverter":448,"../packages/metadata/MetadataXMLConverter":451,"./LensArticle":8,"./articleSchema":10,"substance/model/XMLImporter":117,"substance/packages/blockquote/BlockquoteHTMLConverter":294,"substance/packages/codeblock/CodeblockHTMLConverter":301,"substance/packages/emphasis/EmphasisHTMLConverter":308,"substance/packages/heading/HeadingHTMLConverter":317,"substance/packages/image/ImageXMLConverter":320,"substance/packages/link/LinkHTMLConverter":323,"substance/packages/paragraph/ParagraphHTMLConverter":331,"substance/packages/strong/StrongHTMLConverter":334}],10:[function(t,e,i){var n=t("substance/model/DocumentSchema"),s=t("substance/packages/paragraph/Paragraph"),r=t("substance/packages/heading/Heading"),o=t("substance/packages/codeblock/Codeblock"),a=t("substance/packages/blockquote/Blockquote"),l=t("substance/packages/embed/Embed"),u=t("substance/packages/image/Image"),c=t("substance/packages/list/List"),h=t("substance/packages/list/ListItem"),p=t("substance/packages/table/Table"),d=t("substance/packages/table/TableSection"),f=t("substance/packages/table/TableRow"),m=t("substance/packages/table/TableCell"),g=t("substance/packages/emphasis/Emphasis"),b=t("substance/packages/strong/Strong"),y=t("substance/packages/subscript/Subscript"),v=t("substance/packages/superscript/Superscript"),_=t("substance/packages/code/Code"),x=t("substance/packages/link/Link"),C=t("substance/packages/figure/Figure"),w=t("../packages/figures/ImageFigure"),S=t("../packages/figures/ImageFigureCitation"),T=t("../packages/bibliography/BibItem"),E=t("../packages/bibliography/BibItemCitation"),I=t("../packages/metadata/Author"),A=t("../packages/metadata/ArticleMeta"),O=new n("lens-article","3.0.0");O.getDefaultTextType=function(){return"paragraph"},O.addNodes([A,s,r,o,a,l,_,g,b,y,v,x,u,I,C,w,p,d,f,m,S,E,c,h,T]),e.exports=O},{"../packages/bibliography/BibItem":418,"../packages/bibliography/BibItemCitation":419,"../packages/figures/ImageFigure":442,"../packages/figures/ImageFigureCitation":443,"../packages/metadata/ArticleMeta":449,"../packages/metadata/Author":450,"substance/model/DocumentSchema":98,"substance/packages/blockquote/Blockquote":292,"substance/packages/code/Code":295,"substance/packages/codeblock/Codeblock":299,"substance/packages/embed/Embed":302,"substance/packages/emphasis/Emphasis":306,"substance/packages/figure/Figure":310,"substance/packages/heading/Heading":315,"substance/packages/image/Image":318,"substance/packages/link/Link":321,"substance/packages/list/List":325,"substance/packages/list/ListItem":327,"substance/packages/paragraph/Paragraph":329,"substance/packages/strong/Strong":332,"substance/packages/subscript/Subscript":336,"substance/packages/superscript/Superscript":340,"substance/packages/table/Table":344,"substance/packages/table/TableCell":345,"substance/packages/table/TableRow":351,"substance/packages/table/TableSection":353}],11:[function(t,e,i){},{}],12:[function(t,e,i){function n(t){for(var e=-1,i=t?t.length:0,n=-1,s=[];++e<i;){var r=t[e];r&&(s[++n]=r)}return s}e.exports=n},{}],13:[function(t,e,i){function n(t){var e=t?t.length:0;return e?t[e-1]:void 0}e.exports=n},{}],14:[function(t,e,i){var n=t("../internal/baseDifference"),s=t("../internal/isArrayLike"),r=t("../function/restParam"),o=r(function(t,e){return s(t)?n(t,e):[]});e.exports=o},{"../function/restParam":16,"../internal/baseDifference":23,"../internal/isArrayLike":56}],15:[function(t,e,i){function n(t,e,i){if(null==t)return[];i&&l(t,e,i)&&(e=void 0);var n=-1;e=s(e,i,3);var u=r(t,function(t,i,s){return{criteria:e(t,i,s),index:++n,value:t}});return o(u,a)}var s=t("../internal/baseCallback"),r=t("../internal/baseMap"),o=t("../internal/baseSortBy"),a=t("../internal/compareAscending"),l=t("../internal/isIterateeCall");e.exports=n},{"../internal/baseCallback":21,"../internal/baseMap":34,"../internal/baseSortBy":40,"../internal/compareAscending":45,"../internal/isIterateeCall":58}],16:[function(t,e,i){function n(t,e){if("function"!=typeof t)throw new TypeError(s);return e=r(void 0===e?t.length-1:+e||0,0),function(){for(var i=arguments,n=-1,s=r(i.length-e,0),o=Array(s);++n<s;)o[n]=i[e+n];switch(e){case 0:return t.call(this,o);case 1:return t.call(this,i[0],o);case 2:return t.call(this,i[0],i[1],o)}var a=Array(e+1);for(n=-1;++n<e;)a[n]=i[n];return a[e]=o,t.apply(this,a)}}var s="Expected a function",r=Math.max;e.exports=n},{}],17:[function(t,e,i){(function(i){function n(t){var e=t?t.length:0;for(this.data={hash:a(null),set:new o};e--;)this.push(t[e])}var s=t("./cachePush"),r=t("./getNative"),o=r(i,"Set"),a=r(Object,"create");n.prototype.push=s,e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./cachePush":44,"./getNative":54}],18:[function(t,e,i){function n(t,e){for(var i=-1,n=t.length,s=Array(n);++i<n;)s[i]=e(t[i],i,t);return s}e.exports=n},{}],19:[function(t,e,i){function n(t,e){for(var i=-1,n=e.length,s=t.length;++i<n;)t[s+i]=e[i];return t}e.exports=n},{}],20:[function(t,e,i){function n(t,e){for(var i=-1,n=t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}e.exports=n},{}],21:[function(t,e,i){function n(t,e,i){var n=typeof t;return"function"==n?void 0===e?t:o(t,e,i):null==t?a:"object"==n?s(t):void 0===e?l(t):r(t,e)}var s=t("./baseMatches"),r=t("./baseMatchesProperty"),o=t("./bindCallback"),a=t("../utility/identity"),l=t("../utility/property");e.exports=n},{"../utility/identity":78,"../utility/property":79,"./baseMatches":35,"./baseMatchesProperty":36,"./bindCallback":42}],22:[function(t,e,i){function n(t,e){if(t!==e){var i=null===t,n=void 0===t,s=t===t,r=null===e,o=void 0===e,a=e===e;if(t>e&&!r||!s||i&&!o&&a||n&&a)return 1;if(e>t&&!i||!a||r&&!n&&s||o&&s)return-1}return 0}e.exports=n},{}],23:[function(t,e,i){function n(t,e){var i=t?t.length:0,n=[];if(!i)return n;var l=-1,u=s,c=!0,h=c&&e.length>=a?o(e):null,p=e.length;h&&(u=r,c=!1,e=h);t:for(;++l<i;){var d=t[l];if(c&&d===d){for(var f=p;f--;)if(e[f]===d)continue t;n.push(d)}else u(e,d,0)<0&&n.push(d)}return n}var s=t("./baseIndexOf"),r=t("./cacheIndexOf"),o=t("./createCache"),a=200;e.exports=n},{"./baseIndexOf":30,"./cacheIndexOf":43,"./createCache":48}],24:[function(t,e,i){var n=t("./baseForOwn"),s=t("./createBaseEach"),r=s(n);e.exports=r},{"./baseForOwn":28,"./createBaseEach":46}],25:[function(t,e,i){function n(t,e,i,u){u||(u=[]);for(var c=-1,h=t.length;++c<h;){var p=t[c];l(p)&&a(p)&&(i||o(p)||r(p))?e?n(p,e,i,u):s(u,p):i||(u[u.length]=p)}return u}var s=t("./arrayPush"),r=t("../lang/isArguments"),o=t("../lang/isArray"),a=t("./isArrayLike"),l=t("./isObjectLike");e.exports=n},{"../lang/isArguments":68,"../lang/isArray":69,"./arrayPush":19,"./isArrayLike":56,"./isObjectLike":61}],26:[function(t,e,i){var n=t("./createBaseFor"),s=n();e.exports=s},{"./createBaseFor":47}],27:[function(t,e,i){function n(t,e){return s(t,e,r)}var s=t("./baseFor"),r=t("../object/keysIn");e.exports=n},{"../object/keysIn":75,"./baseFor":26}],28:[function(t,e,i){function n(t,e){return s(t,e,r)}var s=t("./baseFor"),r=t("../object/keys");e.exports=n},{"../object/keys":74,"./baseFor":26}],29:[function(t,e,i){function n(t,e,i){if(null!=t){void 0!==i&&i in s(t)&&(e=[i]);for(var n=0,r=e.length;null!=t&&r>n;)t=t[e[n++]];return n&&n==r?t:void 0}}var s=t("./toObject");e.exports=n},{"./toObject":66}],30:[function(t,e,i){function n(t,e,i){
if(e!==e)return s(t,i);for(var n=i-1,r=t.length;++n<r;)if(t[n]===e)return n;return-1}var s=t("./indexOfNaN");e.exports=n},{"./indexOfNaN":55}],31:[function(t,e,i){function n(t,e,i,a,l,u){return t===e?!0:null==t||null==e||!r(t)&&!o(e)?t!==t&&e!==e:s(t,e,n,i,a,l,u)}var s=t("./baseIsEqualDeep"),r=t("../lang/isObject"),o=t("./isObjectLike");e.exports=n},{"../lang/isObject":72,"./baseIsEqualDeep":32,"./isObjectLike":61}],32:[function(t,e,i){function n(t,e,i,n,p,m,g){var b=a(t),y=a(e),v=c,_=c;b||(v=f.call(t),v==u?v=h:v!=h&&(b=l(t))),y||(_=f.call(e),_==u?_=h:_!=h&&(y=l(e)));var x=v==h,C=_==h,w=v==_;if(w&&!b&&!x)return r(t,e,v);if(!p){var S=x&&d.call(t,"__wrapped__"),T=C&&d.call(e,"__wrapped__");if(S||T)return i(S?t.value():t,T?e.value():e,n,p,m,g)}if(!w)return!1;m||(m=[]),g||(g=[]);for(var E=m.length;E--;)if(m[E]==t)return g[E]==e;m.push(t),g.push(e);var I=(b?s:o)(t,e,i,n,p,m,g);return m.pop(),g.pop(),I}var s=t("./equalArrays"),r=t("./equalByTag"),o=t("./equalObjects"),a=t("../lang/isArray"),l=t("../lang/isTypedArray"),u="[object Arguments]",c="[object Array]",h="[object Object]",p=Object.prototype,d=p.hasOwnProperty,f=p.toString;e.exports=n},{"../lang/isArray":69,"../lang/isTypedArray":73,"./equalArrays":49,"./equalByTag":50,"./equalObjects":51}],33:[function(t,e,i){function n(t,e,i){var n=e.length,o=n,a=!i;if(null==t)return!o;for(t=r(t);n--;){var l=e[n];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++n<o;){l=e[n];var u=l[0],c=t[u],h=l[1];if(a&&l[2]){if(void 0===c&&!(u in t))return!1}else{var p=i?i(c,h,u):void 0;if(!(void 0===p?s(h,c,i,!0):p))return!1}}return!0}var s=t("./baseIsEqual"),r=t("./toObject");e.exports=n},{"./baseIsEqual":31,"./toObject":66}],34:[function(t,e,i){function n(t,e){var i=-1,n=r(t)?Array(t.length):[];return s(t,function(t,s,r){n[++i]=e(t,s,r)}),n}var s=t("./baseEach"),r=t("./isArrayLike");e.exports=n},{"./baseEach":24,"./isArrayLike":56}],35:[function(t,e,i){function n(t){var e=r(t);if(1==e.length&&e[0][2]){var i=e[0][0],n=e[0][1];return function(t){return null==t?!1:t[i]===n&&(void 0!==n||i in o(t))}}return function(t){return s(t,e)}}var s=t("./baseIsMatch"),r=t("./getMatchData"),o=t("./toObject");e.exports=n},{"./baseIsMatch":33,"./getMatchData":53,"./toObject":66}],36:[function(t,e,i){function n(t,e){var i=a(t),n=l(t)&&u(e),d=t+"";return t=p(t),function(a){if(null==a)return!1;var l=d;if(a=h(a),(i||!n)&&!(l in a)){if(a=1==t.length?a:s(a,o(t,0,-1)),null==a)return!1;l=c(t),a=h(a)}return a[l]===e?void 0!==e||l in a:r(e,a[l],void 0,!0)}}var s=t("./baseGet"),r=t("./baseIsEqual"),o=t("./baseSlice"),a=t("../lang/isArray"),l=t("./isKey"),u=t("./isStrictComparable"),c=t("../array/last"),h=t("./toObject"),p=t("./toPath");e.exports=n},{"../array/last":13,"../lang/isArray":69,"./baseGet":29,"./baseIsEqual":31,"./baseSlice":39,"./isKey":59,"./isStrictComparable":62,"./toObject":66,"./toPath":67}],37:[function(t,e,i){function n(t){return function(e){return null==e?void 0:e[t]}}e.exports=n},{}],38:[function(t,e,i){function n(t){var e=t+"";return t=r(t),function(i){return s(i,t,e)}}var s=t("./baseGet"),r=t("./toPath");e.exports=n},{"./baseGet":29,"./toPath":67}],39:[function(t,e,i){function n(t,e,i){var n=-1,s=t.length;e=null==e?0:+e||0,0>e&&(e=-e>s?0:s+e),i=void 0===i||i>s?s:+i||0,0>i&&(i+=s),s=e>i?0:i-e>>>0,e>>>=0;for(var r=Array(s);++n<s;)r[n]=t[n+e];return r}e.exports=n},{}],40:[function(t,e,i){function n(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}e.exports=n},{}],41:[function(t,e,i){function n(t){return null==t?"":t+""}e.exports=n},{}],42:[function(t,e,i){function n(t,e,i){if("function"!=typeof t)return s;if(void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 3:return function(i,n,s){return t.call(e,i,n,s)};case 4:return function(i,n,s,r){return t.call(e,i,n,s,r)};case 5:return function(i,n,s,r,o){return t.call(e,i,n,s,r,o)}}return function(){return t.apply(e,arguments)}}var s=t("../utility/identity");e.exports=n},{"../utility/identity":78}],43:[function(t,e,i){function n(t,e){var i=t.data,n="string"==typeof e||s(e)?i.set.has(e):i.hash[e];return n?0:-1}var s=t("../lang/isObject");e.exports=n},{"../lang/isObject":72}],44:[function(t,e,i){function n(t){var e=this.data;"string"==typeof t||s(t)?e.set.add(t):e.hash[t]=!0}var s=t("../lang/isObject");e.exports=n},{"../lang/isObject":72}],45:[function(t,e,i){function n(t,e){return s(t.criteria,e.criteria)||t.index-e.index}var s=t("./baseCompareAscending");e.exports=n},{"./baseCompareAscending":22}],46:[function(t,e,i){function n(t,e){return function(i,n){var a=i?s(i):0;if(!r(a))return t(i,n);for(var l=e?a:-1,u=o(i);(e?l--:++l<a)&&n(u[l],l,u)!==!1;);return i}}var s=t("./getLength"),r=t("./isLength"),o=t("./toObject");e.exports=n},{"./getLength":52,"./isLength":60,"./toObject":66}],47:[function(t,e,i){function n(t){return function(e,i,n){for(var r=s(e),o=n(e),a=o.length,l=t?a:-1;t?l--:++l<a;){var u=o[l];if(i(r[u],u,r)===!1)break}return e}}var s=t("./toObject");e.exports=n},{"./toObject":66}],48:[function(t,e,i){(function(i){function n(t){return a&&o?new s(t):null}var s=t("./SetCache"),r=t("./getNative"),o=r(i,"Set"),a=r(Object,"create");e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./SetCache":17,"./getNative":54}],49:[function(t,e,i){function n(t,e,i,n,r,o,a){var l=-1,u=t.length,c=e.length;if(u!=c&&!(r&&c>u))return!1;for(;++l<u;){var h=t[l],p=e[l],d=n?n(r?p:h,r?h:p,l):void 0;if(void 0!==d){if(d)continue;return!1}if(r){if(!s(e,function(t){return h===t||i(h,t,n,r,o,a)}))return!1}else if(h!==p&&!i(h,p,n,r,o,a))return!1}return!0}var s=t("./arraySome");e.exports=n},{"./arraySome":20}],50:[function(t,e,i){function n(t,e,i){switch(i){case s:case r:return+t==+e;case o:return t.name==e.name&&t.message==e.message;case a:return t!=+t?e!=+e:t==+e;case l:case u:return t==e+""}return!1}var s="[object Boolean]",r="[object Date]",o="[object Error]",a="[object Number]",l="[object RegExp]",u="[object String]";e.exports=n},{}],51:[function(t,e,i){function n(t,e,i,n,r,a,l){var u=s(t),c=u.length,h=s(e),p=h.length;if(c!=p&&!r)return!1;for(var d=c;d--;){var f=u[d];if(!(r?f in e:o.call(e,f)))return!1}for(var m=r;++d<c;){f=u[d];var g=t[f],b=e[f],y=n?n(r?b:g,r?g:b,f):void 0;if(!(void 0===y?i(g,b,n,r,a,l):y))return!1;m||(m="constructor"==f)}if(!m){var v=t.constructor,_=e.constructor;if(v!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof v&&v instanceof v&&"function"==typeof _&&_ instanceof _))return!1}return!0}var s=t("../object/keys"),r=Object.prototype,o=r.hasOwnProperty;e.exports=n},{"../object/keys":74}],52:[function(t,e,i){var n=t("./baseProperty"),s=n("length");e.exports=s},{"./baseProperty":37}],53:[function(t,e,i){function n(t){for(var e=r(t),i=e.length;i--;)e[i][2]=s(e[i][1]);return e}var s=t("./isStrictComparable"),r=t("../object/pairs");e.exports=n},{"../object/pairs":77,"./isStrictComparable":62}],54:[function(t,e,i){function n(t,e){var i=null==t?void 0:t[e];return s(i)?i:void 0}var s=t("../lang/isNative");e.exports=n},{"../lang/isNative":71}],55:[function(t,e,i){function n(t,e,i){for(var n=t.length,s=e+(i?0:-1);i?s--:++s<n;){var r=t[s];if(r!==r)return s}return-1}e.exports=n},{}],56:[function(t,e,i){function n(t){return null!=t&&r(s(t))}var s=t("./getLength"),r=t("./isLength");e.exports=n},{"./getLength":52,"./isLength":60}],57:[function(t,e,i){function n(t,e){return t="number"==typeof t||s.test(t)?+t:-1,e=null==e?r:e,t>-1&&t%1==0&&e>t}var s=/^\d+$/,r=9007199254740991;e.exports=n},{}],58:[function(t,e,i){function n(t,e,i){if(!o(i))return!1;var n=typeof e;if("number"==n?s(i)&&r(e,i.length):"string"==n&&e in i){var a=i[e];return t===t?t===a:a!==a}return!1}var s=t("./isArrayLike"),r=t("./isIndex"),o=t("../lang/isObject");e.exports=n},{"../lang/isObject":72,"./isArrayLike":56,"./isIndex":57}],59:[function(t,e,i){function n(t,e){var i=typeof t;if("string"==i&&a.test(t)||"number"==i)return!0;if(s(t))return!1;var n=!o.test(t);return n||null!=e&&t in r(e)}var s=t("../lang/isArray"),r=t("./toObject"),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=n},{"../lang/isArray":69,"./toObject":66}],60:[function(t,e,i){function n(t){return"number"==typeof t&&t>-1&&t%1==0&&s>=t}var s=9007199254740991;e.exports=n},{}],61:[function(t,e,i){function n(t){return!!t&&"object"==typeof t}e.exports=n},{}],62:[function(t,e,i){function n(t){return t===t&&!s(t)}var s=t("../lang/isObject");e.exports=n},{"../lang/isObject":72}],63:[function(t,e,i){function n(t,e){t=s(t);for(var i=-1,n=e.length,r={};++i<n;){var o=e[i];o in t&&(r[o]=t[o])}return r}var s=t("./toObject");e.exports=n},{"./toObject":66}],64:[function(t,e,i){function n(t,e){var i={};return s(t,function(t,n,s){e(t,n,s)&&(i[n]=t)}),i}var s=t("./baseForIn");e.exports=n},{"./baseForIn":27}],65:[function(t,e,i){function n(t){for(var e=l(t),i=e.length,n=i&&t.length,u=!!n&&a(n)&&(r(t)||s(t)),h=-1,p=[];++h<i;){var d=e[h];(u&&o(d,n)||c.call(t,d))&&p.push(d)}return p}var s=t("../lang/isArguments"),r=t("../lang/isArray"),o=t("./isIndex"),a=t("./isLength"),l=t("../object/keysIn"),u=Object.prototype,c=u.hasOwnProperty;e.exports=n},{"../lang/isArguments":68,"../lang/isArray":69,"../object/keysIn":75,"./isIndex":57,"./isLength":60}],66:[function(t,e,i){function n(t){return s(t)?t:Object(t)}var s=t("../lang/isObject");e.exports=n},{"../lang/isObject":72}],67:[function(t,e,i){function n(t){if(r(t))return t;var e=[];return s(t).replace(o,function(t,i,n,s){e.push(n?s.replace(a,"$1"):i||t)}),e}var s=t("./baseToString"),r=t("../lang/isArray"),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,a=/\\(\\)?/g;e.exports=n},{"../lang/isArray":69,"./baseToString":41}],68:[function(t,e,i){function n(t){return r(t)&&s(t)&&a.call(t,"callee")&&!l.call(t,"callee")}var s=t("../internal/isArrayLike"),r=t("../internal/isObjectLike"),o=Object.prototype,a=o.hasOwnProperty,l=o.propertyIsEnumerable;e.exports=n},{"../internal/isArrayLike":56,"../internal/isObjectLike":61}],69:[function(t,e,i){var n=t("../internal/getNative"),s=t("../internal/isLength"),r=t("../internal/isObjectLike"),o="[object Array]",a=Object.prototype,l=a.toString,u=n(Array,"isArray"),c=u||function(t){return r(t)&&s(t.length)&&l.call(t)==o};e.exports=c},{"../internal/getNative":54,"../internal/isLength":60,"../internal/isObjectLike":61}],70:[function(t,e,i){function n(t){return s(t)&&a.call(t)==r}var s=t("./isObject"),r="[object Function]",o=Object.prototype,a=o.toString;e.exports=n},{"./isObject":72}],71:[function(t,e,i){function n(t){return null==t?!1:s(t)?c.test(l.call(t)):r(t)&&o.test(t)}var s=t("./isFunction"),r=t("../internal/isObjectLike"),o=/^\[object .+?Constructor\]$/,a=Object.prototype,l=Function.prototype.toString,u=a.hasOwnProperty,c=RegExp("^"+l.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=n},{"../internal/isObjectLike":61,"./isFunction":70}],72:[function(t,e,i){function n(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}e.exports=n},{}],73:[function(t,e,i){function n(t){return r(t)&&s(t.length)&&!!O[k.call(t)]}var s=t("../internal/isLength"),r=t("../internal/isObjectLike"),o="[object Arguments]",a="[object Array]",l="[object Boolean]",u="[object Date]",c="[object Error]",h="[object Function]",p="[object Map]",d="[object Number]",f="[object Object]",m="[object RegExp]",g="[object Set]",b="[object String]",y="[object WeakMap]",v="[object ArrayBuffer]",_="[object Float32Array]",x="[object Float64Array]",C="[object Int8Array]",w="[object Int16Array]",S="[object Int32Array]",T="[object Uint8Array]",E="[object Uint8ClampedArray]",I="[object Uint16Array]",A="[object Uint32Array]",O={};O[_]=O[x]=O[C]=O[w]=O[S]=O[T]=O[E]=O[I]=O[A]=!0,O[o]=O[a]=O[v]=O[l]=O[u]=O[c]=O[h]=O[p]=O[d]=O[f]=O[m]=O[g]=O[b]=O[y]=!1;var N=Object.prototype,k=N.toString;e.exports=n},{"../internal/isLength":60,"../internal/isObjectLike":61}],74:[function(t,e,i){var n=t("../internal/getNative"),s=t("../internal/isArrayLike"),r=t("../lang/isObject"),o=t("../internal/shimKeys"),a=n(Object,"keys"),l=a?function(t){var e=null==t?void 0:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&s(t)?o(t):r(t)?a(t):[]}:o;e.exports=l},{"../internal/getNative":54,"../internal/isArrayLike":56,"../internal/shimKeys":65,"../lang/isObject":72}],75:[function(t,e,i){function n(t){if(null==t)return[];l(t)||(t=Object(t));var e=t.length;e=e&&a(e)&&(r(t)||s(t))&&e||0;for(var i=t.constructor,n=-1,u="function"==typeof i&&i.prototype===t,h=Array(e),p=e>0;++n<e;)h[n]=n+"";for(var d in t)p&&o(d,e)||"constructor"==d&&(u||!c.call(t,d))||h.push(d);return h}var s=t("../lang/isArguments"),r=t("../lang/isArray"),o=t("../internal/isIndex"),a=t("../internal/isLength"),l=t("../lang/isObject"),u=Object.prototype,c=u.hasOwnProperty;e.exports=n},{"../internal/isIndex":57,"../internal/isLength":60,"../lang/isArguments":68,"../lang/isArray":69,"../lang/isObject":72}],76:[function(t,e,i){var n=t("../internal/arrayMap"),s=t("../internal/baseDifference"),r=t("../internal/baseFlatten"),o=t("../internal/bindCallback"),a=t("./keysIn"),l=t("../internal/pickByArray"),u=t("../internal/pickByCallback"),c=t("../function/restParam"),h=c(function(t,e){if(null==t)return{};if("function"!=typeof e[0]){var e=n(r(e),String);return l(t,s(a(t),e))}var i=o(e[0],e[1],3);return u(t,function(t,e,n){return!i(t,e,n)})});e.exports=h},{"../function/restParam":16,"../internal/arrayMap":18,"../internal/baseDifference":23,"../internal/baseFlatten":25,"../internal/bindCallback":42,"../internal/pickByArray":63,"../internal/pickByCallback":64,"./keysIn":75}],77:[function(t,e,i){function n(t){t=r(t);for(var e=-1,i=s(t),n=i.length,o=Array(n);++e<n;){var a=i[e];o[e]=[a,t[a]]}return o}var s=t("./keys"),r=t("../internal/toObject");e.exports=n},{"../internal/toObject":66,"./keys":74}],78:[function(t,e,i){function n(t){return t}e.exports=n},{}],79:[function(t,e,i){function n(t){return o(t)?s(t):r(t)}var s=t("../internal/baseProperty"),r=t("../internal/basePropertyDeep"),o=t("../internal/isKey");e.exports=n},{"../internal/baseProperty":37,"../internal/basePropertyDeep":38,"../internal/isKey":59}],80:[function(t,e,i){e.exports={switch_text:"Switch text",hyperlink:"Hyperlink",subscript:"Subscript",superscript:"Superscript",code:"Code","delete":"Delete",emphasis:"Emphasis",strong:"Strong",redo:"Redo",undo:"Undo",save:"Save",untitled:"Untitled",manage:"Manage",toc:"Contents","embed-src":"Embed URL",paragraph:"Paragraph",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",codeblock:"Codeblock",blockquote:"Blockquote","container-selection":"Multiple Elements"}},{}],81:[function(t,e,i){"use strict";function n(t,e){this.path=t,this.offset=e}var s=t("../util/oo");n.Prototype=function(){this.isAnchor=function(){return!0},this.getPath=function(){return this.path},this.getOffset=function(){return this.offset}},s.initClass(n),e.exports=n},{"../util/oo":413}],82:[function(t,e,i){"use strict";var n=t("lodash/lang/isArray"),s=t("lodash/collection/filter"),r=t("../util/PathAdapter"),o=t("./ContainerAnnotation"),a=t("./DocumentIndex"),l=function(t){this.doc=t,this.byPath=new r.Arrays,this.byId={}};a.extend(l,function(){this.select=function(t){return t instanceof o},this.reset=function(t){this.byPath.clear(),this.byId={},this._initialize(t)},this.get=function(t,e){var i=this.byPath.get(t)||[];if(!n(i)){var r=[];this.byPath._traverse(i,[],function(t,e){r=r.concat(e)}),i=r}return e?s(i,function(t){return t.container===e}):i.slice(0)},this.create=function(t){var e=t.getStartAnchor(),i=t.getEndAnchor();this.byPath.add(e.path,e),this.byPath.add(i.path,i),this.byId[t.id]=t},this["delete"]=function(t){var e=t.getStartAnchor(),i=t.getEndAnchor();this.byPath.remove(e.path,e),this.byPath.remove(i.path,i),delete this.byId[t.id]},this.update=function(t,e,i,n){if(this.select(t)){var s=null;if("startPath"===e[1])s=t.getStartAnchor();else{if("endPath"!==e[1])return;s=t.getEndAnchor()}this.byPath.remove(n,s),this.byPath.add(s.path,s)}}}),e.exports=l},{"../util/PathAdapter":407,"./ContainerAnnotation":86,"./DocumentIndex":95,"lodash/collection/filter":159,"lodash/lang/isArray":270}],83:[function(t,e,i){"use strict";var n=t("lodash/lang/isString"),s=t("lodash/collection/each"),r=t("lodash/collection/map"),o=t("lodash/collection/filter"),a=t("../util/PathAdapter"),l=t("./PropertyAnnotation"),u=t("./DocumentIndex"),c=function(){this.byPath=new a,this.byType=new a};c.Prototype=function(){this.property="path",this.select=function(t){return t instanceof l},this.reset=function(t){this.byPath.clear(),this.byType.clear(),this._initialize(t)},this.get=function(t,e,i,a){var l=this.byPath.get(t)||{};if(n(t)||1===t.length){var u=l;l=[],s(u,function(t){l=l.concat(r(t,function(t){return t}))})}else l=r(l,function(t){return t});return null!=e&&(l=o(l,c.filterByRange(e,i))),a&&(l=o(l,c.filterByType(a))),l},this.create=function(t){this.byType.set([t.type,t.id],t),this.byPath.set(t.path.concat([t.id]),t)},this["delete"]=function(t){this.byType["delete"]([t.type,t.id]),this.byPath["delete"](t.path.concat([t.id]))},this.update=function(t,e,i,n){this.select(t)&&e[1]===this.property&&(this["delete"]({id:t.id,type:t.type,path:n}),this.create(t))}},u.extend(c),c.filterByRange=function(t,e){return function(i){var n=i.startOffset,s=i.endOffset,r=s>=t;return null!=e&&(r=r&&e>=n),r}},c.filterByType=function(t){return function(e){return e.isInstanceOf(t)}},e.exports=c},{"../util/PathAdapter":407,"./DocumentIndex":95,"./PropertyAnnotation":108,"lodash/collection/each":158,"lodash/collection/filter":159,"lodash/collection/map":164,"lodash/lang/isString":279}],84:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("./DocumentNode");s.extend(n),n["static"].isBlock=!0,e.exports=n},{"./DocumentNode":96}],85:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("lodash/array/last"),r=t("lodash/collection/map"),o=t("./DocumentNode"),a=t("./ParentNodeMixin"),l=t("./DocumentAddress");o.extend(n,a,function(){this.getChildrenProperty=function(){return"nodes"},this.getPosition=function(t){var e=this.nodes.indexOf(t);return e},this.getLength=function(){return this.nodes.length},this.show=function(t,e){var i=this.getDocument();null==e&&(e=this.nodes.length),i.update([this.id,"nodes"],{insert:{offset:e,value:t}})},this.hide=function(t){var e=this.getDocument(),i=this.nodes.indexOf(t);i>=0&&e.update([this.id,"nodes"],{"delete":{offset:i}})},this.getAddress=function(t){var e=this.getDocument(),i=t[0],n=t[1],s=e.get(i);if(!s)throw new Error("Can not find node "+i);var r=s.getAddressablePropertyNames().indexOf(n);if(0>r)throw new Error("Can not resolve index for property "+n);for(var o,a,u=(new l).push(r);s.hasParent();){if(o=s.getParent(),a=o.getChildIndex(s),0>a)throw new Error("Can not resolve index for child node "+s.id+" and parent "+o.id);u.unshift(a),s=o}var c=this.getPosition(s.id);return 0>c?null:(u.unshift(c),u)},this.getPath=function(t){return this.getPathForAddress(t)},this._getNodeChain=function(t){var e=this.getDocument();if(t.length<2)throw new Error("Property addresses have a length of >= 2");var i,n=[],s=this.nodes[t[0]];if(2===t.length){if(i=e.get(s),!i)throw new Error("Can not find node "+s);n.push(i)}else{if(i=e.get(s),!i)throw new Error("Can not find node "+s);n.push(i);for(var r=1;i&&r<t.length-1;r++)i=i.getChildAt(t[r]),n.push(i)}if(0===n.length)throw new Error("Could not resolve address: "+t.toString());return n},this._getNodeForAddress=function(t){if(0===t.length)throw new Error("Illegal argument.");if(t.length<3){var e=this.nodes[t[0]],i=this.getDocument();return i.get(e)}return s(this._getNodeChain(t))},this.getPathForAddress=function(t){var e=this._getNodeForAddress(t),i=e.getAddressablePropertyNames();if(0===i.length)return null;var n=i[s(t)];if(!n)throw new Error("No property with index "+s(t)+" in node "+JSON.stringify(e.toJSON()));var r=[e.id,n];return r},this._getNextAddress=function(t){var e,i,n,r=this.getDocument();if(2===t.length)return e=this.nodes[t[0]],i=r.get(e),n=i.getAddressablePropertyNames(),n.length>1&&t[1]<n.length-1?(new l).push(t[0],t[1]+1):t[0]<this.nodes.length-1?(e=this.nodes[t[0]+1],i=r.get(e),i.hasAddressableProperties()?new l(t[0]+1).append(this._getFirstAddress(r.get(e))):new l(t[0]+1,-1)):null;var o=this._getNodeChain(t);i=s(o),n=i.getAddressablePropertyNames();var a;if(n.length>1&&s(t)<n.length-1)return a=t.clone(),a[a.length-1]++,a;var u,c;o.unshift(this);for(var h=o.length-2;h>=0&&(u=o[h],c=t[h],!(c<u.getChildCount()-1));h--)i=u;if(0>h)return null;var p=c+1,d=u.getChildAt(p),f=this._getFirstAddress(d);return a=t.slice(0,h).push(p).append(f)},this.getNextAddress=this._getNextAddress,this._getPreviousAddress=function(t){var e,i,n=this.getDocument();if(2===t.length)return t[1]>0?(new l).push(t[0],t[1]-1):t[0]>0?(e=this.nodes[t[0]-1],i=n.get(e),i.hasAddressableProperties()?new l(t[0]-1).append(this._getLastAddress(i)):new l(t[0]-1,-1)):null;var r=this._getNodeChain(t);i=s(r);var o;if(s(t)>0)return o=t.clone(),o[o.length-1]--,o;r.unshift(this);for(var a=r.length-2;a>=0&&!(t[a]>0);a--);if(0>a)return null;var u=r[a],c=t[a]-1,h=u.getChildAt(c),p=this._getLastAddress(h);return o=t.slice(0,a).push(c).append(p)},this.getPreviousAddress=this._getPreviousAddress,this._getFirstAddress=function(t){if(!t.hasAddressableProperties())return null;for(var e=new l;t.hasChildren();)e.push(0),t=t.getChildAt(0);return e.push(0),e},this._getLastAddress=function(t){if(!t.hasAddressableProperties())return null;for(var e=new l;t.hasChildren();){var i=t.getChildCount()-1;e.push(i),t=t.getChildAt(i)}return e.push(t.getAddressablePropertyNames().length-1),e},this.getFirstAddress=function(t){t||(t=this.getChildAt(0));var e=this.getChildIndex(t);return 0>e?(console.warn("Container.getLastAddress(): Illegal argument. Could not find node position."),null):(new l).push(e).append(this._getFirstAddress(t))},this.getFirstPath=function(t){var e=this.getFirstAddress(t);return e?this.getPath(e):null},this.getLastAddress=function(t){t||(t=this.getChildAt(this.length-1));var e=this.getChildIndex(t);return 0>e?(console.warn("Container.getLastAddress(): Illegal argument. Could not find node position."),null):(new l).push(e).append(this._getLastAddress(t))},this.getLastPath=function(t){var e=this.getLastAddress(t);return e?this.getPath(e):null},this.getAddressRange=function(t,e){if(!t||!e)return[];if(e.isBefore(t)){var i=t;t=e,e=i}for(var n=[t],s=t;s.isBefore(e);)s=this._getNextAddress(s),n.push(s);return n},this.getPathRange=function(t,e){var i=this.getAddress(t),n=this.getAddress(e),s=this.getAddressRange(i,n);return r(s,this.getPathForAddress,this)},this.getNextPath=function(t){var e=this.getAddress(t),i=this.getNextAddress(e);return i?this.getPath(i):null},this.getPreviousPath=function(t){var e=this.getAddress(t),i=this.getPreviousAddress(e);return i?this.getPath(i):null},this.getAddressesForNode=function(t){if(t.hasAddressableProperties()){var e=this.getChildIndex(t),i=(new l).push(e).append(this._getFirstAddress(t)),n=(new l).push(e).append(this._getLastAddress(t));return this.getAddressRange(i,n)}return[]},this.getPathsForNode=function(t){var e=this.getAddressesForNode(t);return r(e,this.getPathForAddress,this)}}),n["static"].name="container",n["static"].defineSchema({nodes:{type:["id"],"default":[]}}),Object.defineProperty(n.prototype,"length",{get:function(){return console.warn("DEPRECATED: want to get rid of unnecessary properties. Use this.getLength() instead."),this.nodes.length}}),e.exports=n},{"./DocumentAddress":93,"./DocumentNode":96,"./ParentNodeMixin":106,"lodash/array/last":153,"lodash/collection/map":164}],86:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("lodash/lang/isEqual"),r=t("lodash/collection/each"),o=t("lodash/array/last"),a=t("../util/EventEmitter"),l=t("./DocumentNode"),u=t("./Selection"),c=t("./Anchor"),h=t("./documentHelpers");n.Prototype=function(){this.getText=function(){var t=this.getDocument();return t?h.getTextForSelection(t,this.getSelection()):(console.warn("Trying to use a ContainerAnnotation which is not attached to the document."),"")},this.getSelection=function(){var t=this.getDocument();return t?t.createSelection({type:"container",containerId:this.container,startPath:this.startPath,startOffset:this.startOffset,endPath:this.endPath,endOffset:this.endOffset}):(console.warn("Trying to use a ContainerAnnotation which is not attached to the document."),u.nullSelection())},this.setHighlighted=function(t,e){this.highlighted!==t&&(this.highlighted=t,this.highlightedScope=e,this.emit("highlighted",t,e),r(this.fragments,function(i){i.emit("highlighted",t,e)}))},this.updateRange=function(t,e){if(!e.isContainerSelection())throw new Error("Cannot change to ContainerAnnotation.");s(this.startPath,e.start.path)||t.set([this.id,"startPath"],e.start.path),this.startOffset!==e.start.offset&&t.set([this.id,"startOffset"],e.start.offset),s(this.endPath,e.end.path)||t.set([this.id,"endPath"],e.end.path),this.endOffset!==e.end.offset&&t.set([this.id,"endOffset"],e.end.offset)},this.getFragments=function(){var t=[],e=this.getDocument(),i=e.get(this.container),s=i.getPathRange(this.startPath,this.endPath);if(1===s.length)t.push(new n.Fragment(this,s[0],"property"));else if(s.length>1){t.push(new n.Fragment(this,s[0],"start")),t.push(new n.Fragment(this,o(s),"end"));for(var r=1;r<s.length-1;r++)t.push(new n.Fragment(this,s[r],"inner"))}return t},this.getStartAnchor=function(){return this._startAnchor||(this._startAnchor=new n.Anchor(this,"isStart")),this._startAnchor},this.getEndAnchor=function(){return this._endAnchor||(this._endAnchor=new n.Anchor(this)),this._endAnchor}},l.extend(n),n["static"].name="container-annotation",n["static"].defineSchema({container:"container",startPath:["string"],startOffset:"number",endPath:["string"],endOffset:"number"}),n["static"].isContainerAnnotation=!0,n.Anchor=function(t,e){a.call(this),this.type="container-annotation-anchor",this.anno=t,this.node=t,this.id=t.id,this.container=t.container,this.isStart=!!e,Object.freeze(this)},n.Anchor.Prototype=function(){this.getTypeNames=function(){return[this.type]},this.getPath=function(){return this.isStart?this.node.startPath:this.node.endPath},this.getOffset=function(){return this.isStart?this.node.startOffset:this.node.endOffset}},c.extend(n.Anchor,a.prototype),Object.defineProperties(n.Anchor.prototype,{path:{get:function(){return this.getPath()}},offset:{get:function(){return this.getOffset()}}}),n.Fragment=function(t,e,i){a.call(this),this.type="container-annotation-fragment",this.anno=t,this.id=t.id,this.path=e,this.mode=i},n.Fragment.Prototype=function(){this.getTypeNames=function(){return[this.type]},this.getStartOffset=function(){return"start"===this.mode||"property"===this.mode?this.anno.startOffset:0},this.getEndOffset=function(){var t=this.anno.getDocument(),e=t.get(this.path),i=e.length;return"end"===this.mode||"property"===this.mode?this.anno.endOffset:i}},a.extend(n.Fragment),n.Fragment["static"].fragmentation=Number.MAX_VALUE,Object.defineProperties(n.Fragment.prototype,{startOffset:{get:function(){return this.getStartOffset()}},endOffset:{get:function(){return this.getEndOffset()}},highlighted:{get:function(){return this.anno.highlighted},set:function(){throw new Error("Immutable!")}}}),e.exports=n},{"../util/EventEmitter":405,"./Anchor":81,"./DocumentNode":96,"./Selection":111,"./documentHelpers":131,"lodash/array/last":153,"lodash/collection/each":158,"lodash/lang/isEqual":273}],87:[function(t,e,i){"use strict";function n(t){var e=t.containerId,i=t.startPath,n=t.endPath||t.startPath,r=t.startOffset,o=t.endOffset;if(s(o)||(o=t.startOffset),!e||!i||!s(r))throw new Error("Invalid arguments: `containerId`, `startPath` and `startOffset` are mandatory");this.containerId=e,this.range=new l(new u(i,r),new u(n,o)),this.reverse=t.reverse,this._internal={},Object.freeze(this)}var s=t("lodash/lang/isNumber"),r=t("lodash/collection/map"),o=t("./PropertySelection"),a=t("./Selection"),l=t("./Range"),u=t("./Coordinate");n.Prototype=function(){this.toJSON=function(){return{type:"container",containerId:this.containerId,startPath:this.startPath,startOffset:this.startOffset,endPath:this.endPath,endOffset:this.endOffset,reverse:this.reverse}},this.attach=function(t){return this._internal.doc=t,this},this.isPropertySelection=function(){return!1},this.isContainerSelection=function(){return!0},this.toString=function(){return"ContainerSelection("+JSON.stringify(this.range.start.path)+":"+this.range.start.offset+" -> "+JSON.stringify(this.range.end.path)+":"+this.range.end.offset+(this.reverse?", reverse":"")+")"},this.getContainer=function(){return this.getDocument().get(this.containerId)},this.expand=function(t){var e=this._coordinates(this),n=this._coordinates(t),s=e.start,r=n.start,o=e.end,a=n.end,l={start:{address:s.address,offset:s.offset},end:{address:o.address,offset:o.offset}};return s.address.equals(r.address)?l.start.offset=Math.min(s.offset,r.offset):s.address.isAfter(r.address)&&(l.start.address=r.address,l.start.offset=r.offset),o.address.equals(a.address)?l.end.offset=Math.max(o.offset,a.offset):o.address.isBefore(a.address)&&(l.end.address=a.address,l.end.offset=a.offset),i(this,l)},this.truncate=function(n){var s=this._coordinates(this),r=this._coordinates(n),o={};if(t(r.start,s.start,"strict"))o.start=s.start,o.end=r.end;else if(t(s.end,r.end,"strict"))o.start=r.start,o.end=s.end;else if(e(s.start,r.start)){if(e(s.end,r.end))return a.nullSelection;o.start=r.end,o.end=s.end}else{if(!e(s.end,r.end))throw new Error("Could not determine coordinates for truncate. Check input");o.start=s.start,o.end=r.start}return i(this,o)},this.isInsideOf=function(e,i){if(e.isNull())return!1;var n=this._coordinates(this),s=this._coordinates(e);return t(s.start,n.start,i)&&t(n.end,s.end,i)},this.contains=function(e){var i=this._coordinates(this),n=this._coordinates(e);return t(i.start,n.start)&&t(n.end,i.end)},this.includesWithOneBoundary=function(i){var n=this._coordinates(this),s=this._coordinates(i);return e(n.start,s.start)&&t(s.end,n.end)||e(n.end,s.end)&&t(n.start,s.start)},this.overlaps=function(e){var i=this._coordinates(this),n=this._coordinates(e);return!(t(i.end,n.start)||t(n.end,i.start))},this.isLeftAlignedWith=function(t){var i=this._coordinates(this),n=this._coordinates(t);return e(i.start,n.start)},this.isRightAlignedWith=function(t){var i=this._coordinates(this),n=this._coordinates(t);return e(i.end,n.end)},this.splitIntoPropertySelections=function(){for(var t=[],e=this.getContainer(),i=this.range,n=e.getPathRange(i.start.path,i.end.path),s=e.getDocument(),r=0;r<n.length;r++){var o,a,l=n[r];o=0===r?this.startOffset:0,a=r===n.length-1?this.endOffset:s.get(l).length,t.push(s.createSelection({type:"property",path:l,startOffset:o,endOffset:a}))}return t},this.getFragments=function(){var t=this.splitIntoPropertySelections(),e=r(t,function(t){return new a.Fragment(t.path,t.startOffset,t.endOffset)});return e},this._coordinates=function(t){if(t._internal.containerRange)return t._internal.containerRange;var e,i=this.getContainer(),s=t.getRange(),r=i.getAddress(s.start.path);e=t.isCollapsed()?r:i.getAddress(s.end.path);var o={start:{address:r,offset:s.start.offset},end:{address:e,offset:s.end.offset}};return t instanceof n&&(t._internal.containerRange=o),o};var t=function(t,e,i){return t.address.isBefore(e.address)?!0:t.address.isAfter(e.address)?!1:t.offset>e.offset?!1:i&&t.offset===e.offset?!1:!0},e=function(t,e){return t.address.equals(e.address)&&t.offset===e.offset},i=function(t,e){var i=t.getContainer();e.start.path=i.getPathForAddress(e.start.address),e.end.path=i.getPathForAddress(e.end.address);var s=new n({containerId:t.containerId,startPath:e.start.path,startOffset:e.start.offset,endPath:e.end.path,endOffset:e.end.offset}),r=t._internal.doc;return r?s.attach(r):console.warn("No document attached to selection"),s}},o.extend(n),Object.defineProperties(n.prototype,{
path:{get:function(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead")},set:function(){throw new Error("immutable.")}},startPath:{get:function(){return this.range.start.path},set:function(){throw new Error("immutable.")}},endPath:{get:function(){return this.range.end.path},set:function(){throw new Error("immutable.")}}}),e.exports=n},{"./Coordinate":88,"./PropertySelection":109,"./Range":110,"./Selection":111,"lodash/collection/map":164,"lodash/lang/isNumber":277}],88:[function(t,e,i){"use strict";function n(t,e,i){if(this.path=t,this.offset=e,this.after=i,!s(t))throw new Error("Invalid arguments: path should be an array.");if(!r(e)||0>e)throw new Error("Invalid arguments: offset must be a positive number.");Object.isFrozen(t)||Object.freeze(t),Object.freeze(this)}var s=t("lodash/lang/isArray"),r=t("lodash/lang/isNumber"),o=t("../util/isArrayEqual"),a=t("../util/oo");n.Prototype=function(){this.equals=function(t){return t===this||o(t.path,this.path)&&t.offset===this.offset},this.withCharPos=function(t){return new n(this.path,t)},this.getNodeId=function(){return this.path[0]},this.getPath=function(){return this.path},this.getOffset=function(){return this.offset}},a.initClass(n),e.exports=n},{"../util/isArrayEqual":411,"../util/oo":413,"lodash/lang/isArray":270,"lodash/lang/isNumber":277}],89:[function(t,e,i){"use strict";function n(t){if(!t.converters)throw new Error("config.converters is mandatory");this.converters=new a,this.state={doc:null},this.config=r({idAttribute:"id"},t),t.converters.forEach(function(t){return t.type?void this.converters.add(t.type,t):void console.error("Converter must provide the type of the associated node.",t)}.bind(this)),this._el=null,this.$$=this.createElement.bind(this)}var s=t("../util/oo"),r=t("lodash/object/extend"),o=t("./Fragmenter"),a=t("../util/Registry");n.Prototype=function(){this.exportDocument=function(t){return this.convertDocument(t)},this.convertDocument=function(t){throw new Error("This method is abstract")},this.convertContainer=function(t){if(!t)throw new Error("Illegal arguments: container is mandatory.");var e=t.getDocument();this.state.doc=e;var i=[];return t.nodes.forEach(function(t){var n=e.get(t),s=this.convertNode(n);i.push(s)}.bind(this)),i},this.convertNode=function(t){this.state.doc=t.getDocument();var e=this.getNodeConverter(t);e||(e=this.getDefaultBlockConverter());var i;return i=e.tagName?this.$$(e.tagName):this.$$("div"),i.attr(this.config.idAttribute,t.id),i=e["export"]?e["export"](t,i,this)||i:this.getDefaultBlockConverter()["export"](t,i,this)||i},this.convertProperty=function(t,e,i){this.initialize(t,i);var n=this.$$("div").append(this.annotatedText(e));return n.innerHTML},this.annotatedText=function(t){var e=this,i=this.state.doc,n=i.getIndex("annotations").get(t),s=i.get(t),r=new o;r.onText=function(t,e){t.children.push(e)},r.onEnter=function(t){var e=t.node;return{annotation:e,children:[]}},r.onExit=function(t,i,n){var s=i.annotation,r=e.getNodeConverter(s);r||(r=e.getDefaultPropertyAnnotationConverter());var o;o=r.tagName?this.$$(r.tagName):this.$$("span"),o.attr(this.config.idAttribute,s.id),o.append(i.children),r["export"]&&r["export"](s,o,e),n.children.push(o)}.bind(this);var a={children:[]};return r.start(a,s,n),a.children},this.getNodeConverter=function(t){return this.converters.get(t.type)},this.getDefaultBlockConverter=function(){throw new Error("This method is abstract.")},this.getDefaultPropertyAnnotationConverter=function(){throw new Error("This method is abstract.")},this.getDocument=function(){return this.state.doc},this.createElement=function(t){return this._el.createElement(t)}},s.initClass(n),e.exports=n},{"../util/Registry":408,"../util/oo":413,"./Fragmenter":101,"lodash/object/extend":282}],90:[function(t,e,i){"use strict";function n(t){if(!t.converters)throw new Error("config.converters is mandatory");this.config=a({idAttribute:"id"},t),this.schema=t.schema,this.state=null,this._defaultBlockConverter=null,this._allConverters=[],this._blockConverters=[],this._propertyAnnotationConverters=[];var e=this.schema,i=e.getDefaultTextType();t.converters.forEach(function(t){var n;if("function"==typeof t?(console.log("installing converter",t),n=new t):n=t,!n.type)return void console.error("Converter must provide the type of the associated node.",n);if(!n.matchElement&&!n.tagName)return void console.error("Converter must provide a matchElement function or a tagName property.",n);n.matchElement||(n.matchElement=this._defaultElementMatcher.bind(n));var s=e.getNodeClass(n.type);s&&(i===n.type&&(this._defaultBlockConverter=n),this._allConverters.push(n),s["static"].isPropertyAnnotation?this._propertyAnnotationConverters.push(n):this._blockConverters.push(n))}.bind(this)),this._initState()}var s=t("../util/oo"),r=t("lodash/collection/each"),o=t("lodash/array/last"),a=t("lodash/object/extend"),l=t("../util/uuid"),u=t("../ui/DefaultDOMElement");n.Prototype=function(){this._initState=function(){var t={preserveWhitespace:!1};return this.state=t,this.reset(),t},this.reset=function(){this.state=a(this.state,{nodes:[],inlineNodes:[],containerId:null,container:[],ids:{},stack:[],lastChar:"",skipTypes:{},ignoreAnnotations:!1})},this.createDocument=function(){var t=this._createDocument();return t},this.generateDocument=function(){var t=this.createDocument();return r(this.state.nodes,function(e){t.get(e.id)&&t["delete"](e.id),t.create(e)}),r(this.state.inlineNodes,function(e){t.get(e.id)&&t["delete"](e.id),t.create(e)}),t},this._createDocument=function(){var t=new this.config.DocumentClass;return t},this.convertContainer=function(t,e){var i=this.state;i.container=[],i.containerId=e;for(var n=new u.NodeIterator(t);n.hasNext();){var s,r=n.next(),o=this._getConverterForElement(r,"block");if(o)s=this._nodeData(r,o.type),s=o["import"](r,s,this)||s,this._createAndShow(s);else if(r.isCommentNode());else if(r.isTextNode()){var a=r.textContent;if(/^\s*$/.exec(a))continue;n.back(),this._wrapInlineElementsIntoBlockElement(n)}else r.isElementNode()&&(n.back(),this._wrapInlineElementsIntoBlockElement(n))}var l={type:"container",id:e,nodes:this.state.container.slice(0)};return this.createNode(l),l},this.convertElement=function(t){return this._convertElement(t)},this._convertElement=function(t,e){var i,n=this._getConverterForElement(t,e);if(!n)throw new Error("No converter found for "+t.tagName);return i=this._nodeData(t,n.type),i=n["import"](t,i,this)||i,this.createNode(i),i},this.createNode=function(t){if(this.state.ids[t.id])throw new Error("Node with id alread exists:"+t.id);this.state.ids[t.id]=!0,this.state.nodes.push(t)},this.show=function(t){this.state.container.push(t.id)},this._createAndShow=function(t){this.createNode(t),this.show(t)},this._nodeData=function(t,e){return{type:e,id:this.getIdForElement(t)}},this.annotatedText=function(t,e,i){var n=this.state;if(e){if(n.stack.length>0)throw new Error("Contract: it is not allowed to bind a new call annotatedText to a path while the previous has not been completed.",t.outerHTML);i&&i.preserveWhitespace&&(n.preserveWhitespace=!0),n.stack=[{path:e,offset:0,text:""}]}else if(0===n.stack.length)throw new Error("Contract: DOMImporter.annotatedText() requires 'path' for non-reentrant call.",t.outerHTML);this.state.lastChar="";var s=t.getChildNodeIterator(),r=this._annotatedText(s);return e&&(n.stack.pop(),n.preserveWhitespace=!1),r},this.plainText=function(t){var e=this.state,i=t.textContent;if(e.stack.length>0){var n=o(e.stack);n.offset+=i.length,n.text+=n.text.concat(i)}return i},this.customText=function(t){var e=this.state;if(e.stack.length>0){var i=o(e.stack);i.offset+=t.length,i.text+=i.text.concat(t)}return t},this.nextId=function(t){return l(t)},this.getIdForElement=function(t,e){for(var i=t.getAttribute(this.config.idAttribute)||this.nextId(e);this.state.ids[i];)i=this.nextId(e);return i},this.defaultConverter=function(t,e){this.IGNORE_DEFAULT_WARNINGS||console.warn("This element is not handled by the converters you provided. This is the default implementation which just skips conversion. Override DOMImporter.defaultConverter(el, converter) to change this behavior.",t.outerHTML);var i=this.schema.getDefaultTextType(),n=this._defaultBlockConverter;if(!n)throw new Error("Could not find converter for default type ",i);var s=this._nodeData(t,i);return s=n["import"](t,s,e)||s},this._defaultElementMatcher=function(t){return t.is(this.tagName)},this._annotatedText=function(t){var e=this.state,i=o(e.stack);if(!i)throw new Error("Illegal state: context is null.");for(;t.hasNext();){var n=t.next(),s="";if(n.isTextNode())s=this._prepareText(e,n.textContent),s.length&&(i.text=i.text.concat(s),i.offset+=s.length);else{if(n.isCommentNode())continue;if(n.isElementNode()){var r=this._getConverterForElement(n,"inline");if(!r){this.IGNORE_DEFAULT_WARNINGS||console.warn("Unsupported inline element. We will not create an annotation for it, but process its children to extract annotated text.",n.outerHTML),this.annotatedText(n);continue}var a=i.offset,l=r.type,u=this._nodeData(n,l);if(r["import"]){e.stack.push({path:i.path,offset:a,text:""}),u=r["import"](n,u,this)||u;var c=this.schema.getNodeClass(l);c["static"].isInline?this.customText(""):this.annotatedText(n);var h=e.stack.pop();i.offset=h.offset,i.text=i.text.concat(h.text)}else this.annotatedText(n);var p=i.offset;u.startOffset=a,u.endOffset=p,u.path=i.path.slice(0),e.inlineNodes.push(u)}else console.warn("Unknown element type. Taking plain text.",n.outerHTML),s=this._prepareText(e,n.textContent),i.text=i.text.concat(s),i.offset+=s.length}}return i.text},this._getConverterForElement=function(t,e){var i;if("block"===e){if(!t.tagName)return null;i=this._blockConverters}else i="inline"===e?this._propertyAnnotationConverters:this._allConverters;for(var n=0;n<i.length;n++)if(i[n].matchElement(t))return i[n]},this._createElement=function(t){return this._el.createElement(t)},this._wrapInlineElementsIntoBlockElement=function(t){for(var e=this._createElement("div");t.hasNext();){var i=t.next(),n=this._getConverterForElement(i,"block");if(n){t.back();break}e.append(i.clone())}var s=this.defaultConverter(e,this);if(s){if(!s.type)throw new Error("Contract: DOMImporter.defaultConverter() must return a node with type.");this._createAndShow(s)}return s},this._createDefaultBlockElement=function(t){var e=this.defaultConverter(t,this);if(e){if(!e.type)throw new Error("Contract: Html.defaultConverter() must return a node with type.",t.outerHTML);e.id=e.id||this.defaultId(t,e.type),this._createAndShow(e)}};var t=/^\s+/g,e=/^\s*/g,i=/\s+$/g,n=/\s+/g,s=" ",c=/[\t\n\r]+/g;this._prepareText=function(r,o){if(r.preserveWhitespace)return o;var a=s;return o=o.replace(c,""),o=r.lastChar===s?o.replace(e,a):o.replace(t,a),o=o.replace(i,a),(this.config.REMOVE_INNER_WS||r.removeInnerWhitespace)&&(o=o.replace(n,s)),r.lastChar=o[o.length-1]||r.lastChar,o},this._trimTextContent=function(t){var e,i,n=t[0].childNodes,s=n[0],r=r(n);return s&&"text"===this._getDomNodeType(s)&&(e=s.textContent,i=this.trimLeft(e),s.textContent=i),r&&"text"===this._getDomNodeType(r)&&(e=r.textContent,i=this.trimRight(e),r.textContent=i),t},this._trimLeft=function(e){return e.replace(t,"")},this._trimRight=function(t){return t.replace(i,"")}},s.initClass(n),e.exports=n},{"../ui/DefaultDOMElement":373,"../util/oo":413,"../util/uuid":416,"lodash/array/last":153,"lodash/collection/each":158,"lodash/object/extend":282}],91:[function(t,e,i){"use strict";function n(){}var s=t("lodash/lang/isEqual"),r=t("lodash/function/delay"),o=t("../util/oo"),a=t("./data/ObjectOperation"),l=1500;n.Prototype=function(){this.shouldMerge=function(t,e){var i=Date.now(),n=i-t.timestamp<l;n||r(function(t){t.isFinal()||t.makeFinal()}.bind(this,e),l)},this.merge=function(t,e){var i=t.ops[0],n=e.ops[0],r=i.diff,o=n.diff;if(i.isUpdate("string")&&n.isUpdate("string")&&1===o.getLength()&&r.type===o.type&&s(i.path,n.path)){var l=!1;if(r.isInsert()?r.pos+r.getLength()===o.pos&&(l=i.toJSON(),l.diff.str+=o.str):r.isDelete()&&(r.pos===o.pos?(l=i.toJSON(),l.diff.str+=o.str):o.pos+o.getLength()===r.pos&&(l=i.toJSON(),l.diff=o,l.diff.str+=r.str)),l)return t.ops[0]=a.fromJSON(l),t.ops.length>1&&(t.ops=t.ops.concat(e.ops.slice(1)),t.after=e.after),!0}return!1}},o.initClass(n),e.exports=n},{"../util/oo":413,"./data/ObjectOperation":126,"lodash/function/delay":170,"lodash/lang/isEqual":273}],92:[function(t,e,i){"use strict";function n(t){n["super"].apply(this),this.__id__=y++,this.schema=t,this.nodeFactory=new p(this),this.data=new h(t,{nodeFactory:this.nodeFactory}),this.addIndex("type",r.create({property:"type"})),this.addIndex("annotations",new o),this.addIndex("container-annotation-anchors",new a),this.eventProxies={path:new u(this)},this.connect(this,{"document:changed":this._updateEventProxies})}var s=t("lodash/collection/each"),r=t("./DocumentIndex"),o=t("./AnnotationIndex"),a=t("./AnchorIndex"),l=t("./DocumentChange"),u=t("./PathEventProxy"),c=t("../util/EventEmitter"),h=t("./data/IncrementalData"),p=t("./DocumentNodeFactory"),d=t("./Selection"),f=t("./PropertySelection"),m=t("./ContainerSelection"),g=t("./TableSelection"),b=t("./documentHelpers"),y=0;n.Prototype=function(){this.addIndex=function(t,e){return this.data.addIndex(t,e)},this.getIndex=function(t){return this.data.getIndex(t)},this.getNodes=function(){return this.data.nodes},this.getSchema=function(){return this.schema},this.contains=function(t){this.data.contains(t)},this.get=function(t){return this.data.get(t)},this.getNodes=function(){return this.data.getNodes()},this["import"]=function(t){try{this.data._stopIndexing(),t(this),this.data._startIndexing()}finally{this.data.queue=[],this.data._startIndexing()}},this.create=function(t){var e=this._create(t);return this._notifyChangeListeners(new l([e],{},{})),this.data.get(t.id)},this["delete"]=function(t){var e=this.get(t),i=this._delete(t);return this._notifyChangeListeners(new l([i],{},{})),e},this.set=function(t,e){var i=this.get(t),n=this._set(t,e);return this._notifyChangeListeners(new l([n],{},{})),i},this.update=function(t,e){var i=this._update(t,e);return this._notifyChangeListeners(new l([i],{},{})),i},this.addIndex=function(t,e){return this.data.addIndex(t,e)},this.getIndex=function(t){return this.data.getIndex(t)},this.createSelection=function(t){if(!t)return d.nullSelection;switch(t.type){case"property":return new f(t).attach(this);case"container":return new m(t).attach(this);case"table":return new g(t).attach(this);default:throw new Error("Unsupported selection type",t.type)}},this.getEventProxy=function(t){return this.eventProxies[t]},this.newInstance=function(){var t=this.constructor;return new t(this.schema)},this.fromSnapshot=function(t){var e=this.newInstance();return e.loadSeed(t),e},this.getDocumentMeta=function(){return this.get("document")},this._apply=function(t){s(t.ops,function(t){this.data.apply(t),this.emit("operation:applied",t)}.bind(this))},this._notifyChangeListeners=function(t,e){e=e||{},this.emit("document:changed",t,e,this)},this._updateEventProxies=function(t,e){s(this.eventProxies,function(i){i.onDocumentChanged(t,e,this)}.bind(this))},this.loadSeed=function(t){s(this.data.nodes,function(t){this["delete"](t.id)},this),s(t.nodes,function(t){this.create(t)},this)},this.toJSON=function(){var t={};return s(this.getNodes(),function(e){t[e.id]=e.toJSON()}),{schema:[this.schema.name,this.schema.version],nodes:t}},this.getTextForSelection=function(t){return console.warn("DEPRECATED: use docHelpers.getTextForSelection() instead."),b.getTextForSelection(this,t)},this.setText=function(t,e,i){var n,s=this.getIndex("annotations").get(t);for(n=0;n<s.length;n++)this["delete"](s[n].id);for(this.set(t,e),n=0;n<i.length;n++)this.create(i[n])},this._create=function(t){var e=this.data.create(t);return e},this._delete=function(t){var e=this.data["delete"](t);return e},this._update=function(t,e){var i=this.data.update(t,e);return i},this._set=function(t,e){var i=this.data.set(t,e);return i}},c.extend(n),e.exports=n},{"../util/EventEmitter":405,"./AnchorIndex":82,"./AnnotationIndex":83,"./ContainerSelection":87,"./DocumentChange":94,"./DocumentIndex":95,"./DocumentNodeFactory":97,"./PathEventProxy":107,"./PropertySelection":109,"./Selection":111,"./TableSelection":112,"./data/IncrementalData":122,"./documentHelpers":131,"lodash/collection/each":158}],93:[function(t,e,i){"use strict";function n(){Array.apply(this),arguments.length>0&&this._pushVals(arguments)}n.Prototype=function(){this.isBefore=function(t){if(0===this.length)return!1;if(0===t.length)return!1;for(var e=this.length<t.length,i=0;;i++){var n=this[i],s=t[i];if(void 0===n)return e?!0:!1;if(void 0===s)return!1;if(n!==s)return s>n}},this.isAfter=function(t){return t.isBefore(this)},this.isEqual=function(t){return n.equal(this,t)},this.equals=this.isEqual,this.append=function(t){return this._pushVals(t)},this.clone=function(){return(new n).append(this)},this.slice=function(){return(new n)._pushVals(Array.prototype.slice.apply(this,arguments))},this.push=function(){return Array.prototype.push.apply(this,arguments),this},this._pushVals=function(t){return Array.prototype.push.apply(this,t),this}},n.Prototype.prototype=Array.prototype,n.prototype=new n.Prototype,n.prototype.constructor=n,n.equal=function(t,e){var i=t.length;if(i!==e.length)return!1;for(var n=0;i>n;n++)if(t[n]!==e[n])return!1;return!0},e.exports=n},{}],94:[function(t,e,i){"use strict";function n(t,e,i){if(1===arguments.length&&s(arguments[0])){var n=arguments[0];this.sha=n.sha,this.version=n.version,this.timestamp=n.timestamp,n.userId&&(this.userId=n.userId),this.before=n.before,this.ops=n.ops,this.after=n.after,this.state=n.state||f}else{if(3!==arguments.length)throw new Error("Illegal arguments.");this.sha=l(),this.timestamp=Date.now(),this.state=p,this.ops=t.slice(0),this.before=e,this.after=i}this.updated=null,this.created=null,this.deleted=null,this._init()}var s=t("lodash/lang/isObject"),r=t("lodash/lang/isArray"),o=t("lodash/collection/map"),a=t("../util/oo"),l=t("../util/uuid"),u=t("../util/PathAdapter"),c=t("./data/OperationSerializer"),h=t("./data/ObjectOperation"),p=1,d=2,f=3;n.Prototype=function(){this.freeze=function(){Object.freeze(this),Object.freeze(this.ops),Object.freeze(this.before),Object.freeze(this.after)},this._init=function(){var t,e=this.ops,i={},n={},s=new u.Arrays;for(t=0;t<e.length;t++){var r=e[t];"create"===r.type&&(i[r.val.id]=r.val,delete n[r.val.id]),"delete"===r.type&&(delete i[r.val.id],delete s[r.val.id],n[r.val.id]=r.val),("set"===r.type||"update"===r.type)&&s.add(r.path,r)}this.created=i,this.deleted=n,this.updated=s},this.invert=function(){for(var t=[],e=this.ops.length-1;e>=0;e--)t.push(this.ops[e].invert());var i=this.after,s=this.before;return new n(t,i,s)},this.isPending=function(){return this.state===d},this.makePending=function(){this.state=d},this.isFinal=function(){return this.state>=f},this.makeFinal=function(){this.state=f},this.isAffected=function(t){return!!this.updated.get(t)},this.isUpdated=this.isAffected,this.serialize=function(){var t=new c,e={sha:this.sha,version:this.version,timestamp:this.timestamp,before:{selection:this.before.selection},ops:this.ops.map(function(e){return t.serialize(e)}),after:{selection:this.after.selection}};return JSON.stringify(e)},this.toJSON=function(){return{sha:this.sha,version:this.version,state:this.state,before:this.before,ops:o(this.ops,function(t){return t.toJSON()}),after:this.after}}},a.initClass(n),n.deserialize=function(t){var e=new c,i=JSON.parse(t);return i.ops=i.ops.map(function(t){return e.deserialize(t)}),new n(i)},n.fromJSON=function(t){return new n(t)},n.transform=function(t,e){var i,n=[],s=[];for(r(t)||(t=[t]),r(e)||(e=[e]),i=0;i<t.length;i++)n=n.concat(t[i].ops);for(i=0;i<e.length;i++)s=s.concat(e[i].ops);for(i=0;i<s.length;i++){var o=s[i];o=o.clone();for(var a=0;a<n.length;a++){var l=n[a];h.transform(o,l,{inplace:!0})}}},e.exports=n},{"../util/PathAdapter":407,"../util/oo":413,"../util/uuid":416,"./data/ObjectOperation":126,"./data/OperationSerializer":128,"lodash/collection/map":164,"lodash/lang/isArray":270,"lodash/lang/isObject":278}],95:[function(t,e,i){"use strict";function n(){}var s=t("./data/NodeIndex");s.extend(n),e.exports=s},{"./data/NodeIndex":124}],96:[function(t,e,i){"use strict";function n(t,e){if(r.call(this,e),!t)throw new Error("Document instance is mandatory.");this.document=t}var s=t("lodash/collection/each"),r=t("./data/Node");n.Prototype=function(){this.getDocument=function(){return this.document},this.hasParent=function(){return!!this.parent},this.getParent=function(){return this.document.get(this.parent)},this.hasChildren=function(){return!1},this.getChildIndex=function(t){return-1},this.getChildAt=function(t){return null},this.getChildCount=function(){return 0},this.getRoot=function(){for(var t=this;t.hasParent();)t=t.getParent();return t},this.getAddressablePropertyNames=function(){var t=this.constructor["static"].addressablePropertyNames;return t||[]},this.hasAddressableProperties=function(){return this.getAddressablePropertyNames().length>0},this.getPropertyNameAt=function(t){var e=this.constructor["static"].addressablePropertyNames||[];return e[t]},this.setHighlighted=function(t,e){this.highlighted!==t&&(this.highlightedScope=e,this.highlighted=t,this.emit("highlighted",t))},this.connect=function(t,e){s(e,function(t,e){var i=/([a-zA-Z_0-9]+):changed/.exec(e);if(i){var n=i[1];this.constructor["static"].schema[n]&&this.getDocument().getEventProxy("path").add([this.id,n],this,this._onPropertyChange.bind(this,n))}},this),r.prototype.connect.apply(this,arguments)},this.disconnect=function(){r.prototype.disconnect.apply(this,arguments)},this._onPropertyChange=function(t){var e=[t+":changed"].concat(Array.prototype.slice.call(arguments,1));this.emit.apply(this,e)},this.isBlock=function(){return this.constructor["static"].isBlock},this.isText=function(){return this.constructor["static"].isText},this.isPropertyAnnotation=function(){return this.constructor["static"].isPropertyAnnotation},this.isInline=function(){return this.constructor["static"].isInline},this.isContainerAnnotation=function(){return this.constructor["static"].isContainerAnnotation}},r.extend(n),n["static"].name="node",n["static"].isBlock=!1,n["static"].isText=!1,n["static"].isPropertyAnnotation=!1,n["static"].isContainerAnnotation=!1,n["static"].isInline=!1,e.exports=n},{"./data/Node":123,"lodash/collection/each":158}],97:[function(t,e,i){"use strict";function n(t){n["super"].call(this),this.doc=t,t.schema.each(function(t){this.register(t)}.bind(this))}var s=t("./data/NodeRegistry");n.Prototype=function(){this.create=function(t,e){var i=this.get(t);if(!i)throw new Error("No Node registered by that name: "+t);return new i(this.doc,e)}},s.extend(n),e.exports=n},{"./data/NodeRegistry":125}],98:[function(t,e,i){"use strict";function n(t,e){n["super"].call(this,t,e)}var s=t("./data/Schema"),r=t("./DocumentNode"),o=t("./Container"),a=t("./PropertyAnnotation"),l=t("./ContainerAnnotation");n.Prototype=function(){this.getDefaultTextType=function(){throw new Error("DocumentSchema.getDefaultTextType() is abstract and must be overridden.")},this.isAnnotationType=function(t){var e=this.getNodeClass(t);return e&&e.prototype instanceof a},this.getBuiltIns=function(){return[r,a,o,l]}},s.extend(n),e.exports=n},{"./Container":85,"./ContainerAnnotation":86,"./DocumentNode":96,"./PropertyAnnotation":108,"./data/Schema":129}],99:[function(t,e,i){"use strict";function n(t,e){n["super"].apply(this),e=e||{},this.doc=t,this.selection=u.nullSelection,this.stage=new a(this.doc,this),this.isTransacting=!1,this.doneChanges=[],this.undoneChanges=[],this.compressor=e.compressor||new l,this.doc.connect(this,{"document:changed":this.onDocumentChange})}var s=t("lodash/object/extend"),r=t("../util/oo"),o=t("../util/EventEmitter"),a=t("./TransactionDocument"),l=t("./DefaultChangeCompressor"),u=t("./Selection"),c=t("./DocumentChange");n.Prototype=function(){this.getSelection=function(){return this.selection},this.setSelection=function(t){this.selection=t},this.canUndo=function(){return this.doneChanges.length>0},this.canRedo=function(){return this.undoneChanges.length>0},this.undo=function(){var t=this.doneChanges.pop();t?(this.stage._apply(t),this.doc._apply(t),this.undoneChanges.push(t.invert()),this._notifyChangeListeners(t,{replay:!0})):console.error("No change can be undone.")},this.redo=function(){var t=this.undoneChanges.pop();t?(this.stage._apply(t),this.doc._apply(t),this.doneChanges.push(t.invert()),this._notifyChangeListeners(t,{replay:!0})):console.error("No change can be redone.")},this.transaction=function(t,e){if(this.isTransacting)throw new Error("Nested transactions are not supported.");this.isTransacting=!0,this.stage.reset();var i=this.selection;e=e||{};var n=this.stage._transaction(function(n){n.before.selection=i;var r={selection:i},o=t(n,r)||{};n.after.selection=o.selection||i,s(e,n.info)});return this.selection=n.after.selection,this.isTransacting=!1,this._commit(n,e),this.emit("selection:changed",this.selection,this),n},this.onDocumentChange=function(t,e){e.session!==this&&(this.stage._apply(t),c.transform(this.doneChanges,t),c.transform(this.undoneChanges,t))},this._commit=function(t,e){t.timestamp=Date.now(),this.doc._apply(t);var i=this._getLastChange(),n=!1;i&&!i.isFinal()&&this.compressor.shouldMerge(i,t)&&(n=this.compressor.merge(i,t)),n||this.doneChanges.push(t.invert()),this.undoneChanges=[],this._notifyChangeListeners(t,e)},this._notifyChangeListeners=function(t,e){e=e||{},e.session=this,this.doc._notifyChangeListeners(t,e)},this._getLastChange=function(){return this.doneChanges[this.doneChanges.length-1]}},r.inherit(n,o),e.exports=n},{"../util/EventEmitter":405,"../util/oo":413,"./DefaultChangeCompressor":91,"./DocumentChange":94,"./Selection":111,"./TransactionDocument":116,"lodash/object/extend":282}],100:[function(t,e,i){"use strict";function n(){this._merge={},this._mergeComponents={},this._break={}}var s=t("../util/oo");n.Prototype=function(){this.defineMerge=function(t,e,i){return this._merge[t]||(this._merge[t]={}),this._merge[t][e]=i,this},this.canMerge=function(t,e){return this._merge[t]&&this._merge[t][e]},this.getMerger=function(t,e){return this._merge[t][e]},this.defineComponentMerge=function(t,e){this._mergeComponents[t]=e},this.canMergeComponents=function(t){return this._mergeComponents[t]},this.getComponentMerger=function(t){return this._mergeComponents[t]},this.defineBreak=function(t,e){return this._break[t]=e,this},this.canBreak=function(t){return this._break[t]},this.getBreaker=function(t){return this._break[t]}},s.initClass(n),e.exports=n},{"../util/oo":413}],101:[function(t,e,i){"use strict";var n=t("../util/oo"),s=t("lodash/object/extend"),r=t("lodash/collection/each"),o=1,a=-1,l=-2,u=function(t){s(this,t)};u.Prototype=function(){function t(t,e){if(t.pos<e.pos)return-1;if(t.pos>e.pos)return 1;if(t.mode<e.mode)return-1;if(t.mode>e.mode)return 1;if(t.mode===e.mode){if(t.level<e.level)return-1;if(t.level>e.level)return 1}return 0}function e(t,e){return t.pos<e.pos?-1:t.pos>e.pos?1:t.opener.idx>e.opener.idx?-1:t.opener.idx<e.opener.idx?1:0}var i=function(i){var n=[],s=[];r(i,function(t){var e=t.isAnchor?t.isAnchor():!1;if(e)n.push({pos:t.offset,mode:l,id:t.id,level:0,type:"anchor",node:t});else{var i=u.NORMAL,r=t.isInline?t.isInline():!1;r?i=Number.MAX_VALUE:t.constructor["static"]&&t.constructor["static"].hasOwnProperty("fragmentation")?i=t.constructor["static"].fragmentation:t.hasOwnProperty("fragmentationHint")&&(i=t.fragmentationHint);var c=Math.min(t.startOffset,t.endOffset),h=Math.max(t.startOffset,t.endOffset),p={pos:c,mode:o,level:i,id:t.id,type:t.type,node:t};n.push(p),s.push({pos:h,mode:a,level:i,id:t.id,type:t.type,node:t,opener:p})}}),n.sort(t);for(var c=n.length-1;c>=0;c--)n[c].idx=c;s.sort(e);for(var h=[],p=0,d=0,f=0;;){var m=n[d],g=s[f];if(m&&g)g.pos<=m.pos?(h[p]=g,p++,f++):(h[p]=m,p++,d++);else if(m)h[p++]=m,d++;else{if(!g)break;h[p++]=g,f++}}return h};this.onText=function(){},this.onEnter=function(){return null},this.onExit=function(){},this.enter=function(t,e){return this.onEnter(t,e)},this.exit=function(t,e,i){this.onExit(t,e,i)},this.createText=function(t,e){e.length>0&&this.onText(t,e)},this.start=function(t,e,n){for(var s=this,r=i.call(this,n),u=[{context:t,entry:null}],c=0,h=0;h<r.length;h++){var p=r[h];this.createText(u[u.length-1].context,e.substring(c,p.pos)),c=p.pos;var d,f;if(p.mode===o||p.mode===l){for(d=1;d<u.length&&!(p.level<u[d].entry.level);d++);for(f=u.length-1;f>=d;f--)this.exit(u[f].entry,u[f].context,u[f-1].context);for(u.splice(d,0,{entry:p}),f=d;f<u.length;f++)u[f].context=s.enter(u[f].entry,u[f-1].context)}if(p.mode===a||p.mode===l){for(d=1;d<u.length&&u[d].entry.node!==p.node;d++);for(f=u.length-1;f>=d;f--)this.exit(u[f].entry,u[f].context,u[f-1].context);for(u.splice(d,1),f=d;f<u.length;f++)u[f].context=s.enter(u[f].entry,u[f-1].context)}}this.createText(t,e.substring(c))}},n.initClass(u),u.SHOULD_NOT_SPLIT=0,u.NORMAL=10,u.ANY=100,u.ALWAYS_ON_TOP=Number.MAX_VALUE,e.exports=u},{"../util/oo":413,"lodash/collection/each":158,"lodash/object/extend":282}],102:[function(t,e,i){"use strict";function n(t){t=o({idAttribute:"data-id"},t),s.call(this,t),this._el=r.parseHTML("<html></html>")}var s=t("./DOMExporter"),r=t("../ui/DefaultDOMElement"),o=t("lodash/object/extend"),a=t("lodash/collection/each"),l=t("lodash/lang/isBoolean"),u=t("lodash/lang/isNumber"),c=t("lodash/lang/isString");n.Prototype=function(){this.exportDocument=function(t){var e=r.parseHTML("<html><head></head><body></body></html>");return this.convertDocument(t,e)};var t={tagName:"span","export":function(t,e){e=e.withTagName("span"),e.attr("data-type",t.type);var i=t.toJSON();a(i,function(t,i){"id"!==i&&"type"!==i&&(c(t)||u(t)||l(t))&&e.attr("data-"+i,t)})}},e={"export":function(t,e,i){e.attr("data-type",t.type);var n=t.toJSON();a(n,function(n,s){if("id"!==s&&"type"!==s){var r=i.$$("div").attr("property",s);"string"===t.getPropertyType(s)?r.append(i.annotatedText([t.id,s])):r.text(n),e.append(r)}})}};this.getDefaultBlockConverter=function(){return e},this.getDefaultPropertyAnnotationConverter=function(){return t}},s.extend(n),e.exports=n},{"../ui/DefaultDOMElement":373,"./DOMExporter":89,"lodash/collection/each":158,"lodash/lang/isBoolean":271,"lodash/lang/isNumber":277,"lodash/lang/isString":279,"lodash/object/extend":282}],103:[function(t,e,i){"use strict";function n(t){t=o({idAttribute:"data-id"},t),s.call(this,t),this._el=r.parseHTML("<html></html>")}var s=t("./DOMImporter"),r=t("../ui/DefaultDOMElement"),o=t("lodash/object/extend");n.Prototype=function(){this.importDocument=function(t){this.reset();var e=r.parseHTML(t);this.convertDocument(e);var i=this.generateDocument();return i},this.convertDocument=function(t){throw new Error("This method is abstract")}},s.extend(n),e.exports=n},{"../ui/DefaultDOMElement":373,"./DOMImporter":90,"lodash/object/extend":282}],104:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("./PropertyAnnotation");s.extend(n),n["static"].isInline=!0,e.exports=n},{"./PropertyAnnotation":108}],105:[function(t,e,i){"use strict";function n(){}var s=t("../util/oo"),r=t("lodash/lang/isArray"),o=t("lodash/collection/each");n.Prototype=function(){this.importDocument=function(t,e){if(!e.schema||!r(e.nodes))throw new Error("Invalid JSON format.");var i=t.getSchema();if(i.name!==e.schema.name)throw new Error("Incompatible schema.");i.version!==e.schema.version&&console.error("Different schema version. Conversion might be problematic.");var n=e.nodes;return t["import"](function(t){o(n,function(e){t.get(e.id)&&t["delete"](e.id),t.create(e)})}),t},this.exportDocument=function(t){var e=t.getSchema(),i={schema:{name:e.name,version:e.version},nodes:[]};return o(t.getNodes(),function(t){i.nodes.push(t.toJSON())}),i}},s.initClass(n),e.exports=n},{"../util/oo":413,"lodash/collection/each":158,"lodash/lang/isArray":270
}],106:[function(t,e,i){"use strict";var n={hasChildren:function(){return!0},getChildrenProperty:function(){throw new Error("ParentNodeMixin.getChildrenProperty is abstract and must be implemented in "+this.constructor.name+".")},getChildIndex:function(t){return this[this.getChildrenProperty()].indexOf(t.id)},getChildren:function(){var t=this.getDocument(),e=this[this.getChildrenProperty()];return e.map(function(e){return t.get(e)}.bind(this))},getChildAt:function(t){var e=this[this.getChildrenProperty()];if(0>t||t>=e.length)throw new Error("Array index out of bounds: "+t+", "+e.length);return this.getDocument().get(e[t])},getChildCount:function(){return this[this.getChildrenProperty()].length},getAddressablePropertyNames:function(){return[this.getChildrenProperty()]}};e.exports=n},{}],107:[function(t,e,i){"use strict";var n=t("../util/oo"),s=t("lodash/collection/each"),r=t("../util/PathAdapter"),o=t("../util/deleteFromArray"),a=function(t){this.listeners=new r,this._list=[],this.doc=t};a.Prototype=function(){this.onDocumentChanged=function(t,e,i){function n(e,i){t.deleted[e[0]]||a.add(e,i)}function r(t,e,s,r){for(var o=i.get(t),a=o.getPathRange(e,s),l=0;l<a.length;l++)n(a[l],r)}if(0!==this._list.length){var o=this.listeners,a=t.updated;t.ops.forEach(function(t){if("create"!==t.type&&"delete"!==t.type||!t.val.path&&!t.val.startPath)if("set"!==t.type||"path"!==t.path[1]&&"startPath"!==t.path[1]&&"endPath"!==t.path[1]){if("set"===t.type&&("startOffset"===t.path[1]||"endOffset"===t.path[1])){var e=this.doc.get(t.path[0]);e&&(e.path?n(e.path,t):r(e.container,e.startPath,e.endPath,t))}}else n(t.val,t),n(t.original,t);else t.val.path?n(t.val.path,t):t.val.startPath&&r(t.val.container,t.val.startPath,t.val.endPath,t)}.bind(this)),t.updated.traverse(function(n){var r=n.concat(["listeners"]),a=o.get(r);s(a,function(n){n.method.call(n.listener,t,e,i)})}.bind(this))}},this._add=function(t,e,i){var n=t.concat(["listeners"]),s=this.listeners.get(n);if(s||(s=[],this.listeners.set(n,s)),!i)throw new Error("Invalid argument: expected function but got "+i);var r={path:t,method:i,listener:e};s.push(r),this._list.push(r)},this.connect=function(t,e,i){this._add(e,t,i)},this.disconnect=function(t){for(var e=0;e<this._list.length;e++)if(this._list[e].listener===t){var i=this._list[e];this._list.splice(e,1);var n=i.concat(["listeners"]),s=this.listeners.get(n);o(s,i)}},this.add=function(t,e,i){return console.warn("DEPRECATED: use PathEventProxy#connect(this, path, method) instead."),this._add(t,e,i)},this.remove=function(t,e){console.warn("DEPRECATED: use PathEventProxy#disconnect(this) instead."),this.disconnect(e)}},n.initClass(a),e.exports=a},{"../util/PathAdapter":407,"../util/deleteFromArray":409,"../util/oo":413,"lodash/collection/each":158}],108:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("lodash/lang/isEqual"),r=t("./DocumentNode");n.Prototype=function(){this.getText=function(){var t=this.getDocument();if(!t)return console.warn("Trying to use an PropertyAnnotation which is not attached to the document."),"";var e=t.get(this.path);return e.substring(this.startOffset,this.endOffset)},this.canSplit=function(){return!0},this.isAnchor=function(){return!1},this.getSelection=function(){return this.getDocument().createSelection({type:"property",path:this.path,startOffset:this.startOffset,endOffset:this.endOffset})},this.updateRange=function(t,e){if(!e.isPropertySelection())throw new Error("Cannot change to ContainerAnnotation.");s(this.startPath,e.start.path)||t.set([this.id,"path"],e.start.path),this.startOffset!==e.start.offset&&t.set([this.id,"startOffset"],e.start.offset),this.endOffset!==e.end.offset&&t.set([this.id,"endOffset"],e.end.offset)}},r.extend(n),n["static"].name="annotation",n["static"].defineSchema({path:["string"],startOffset:"number",endOffset:"number"}),n["static"].isPropertyAnnotation=!0,Object.defineProperties(n.prototype,{startPath:{get:function(){return this.path}},endPath:{get:function(){return this.path}}}),e.exports=n},{"./DocumentNode":96,"lodash/lang/isEqual":273}],109:[function(t,e,i){"use strict";function n(t){n["super"].apply(this);var e=t.path,i=t.startOffset,s=t.endOffset||t.startOffset;if(!e||!r(i))throw new Error("Invalid arguments: `path` and `startOffset` are mandatory");this.range=new l(new a(e,i),new a(e,s)),this.reverse=t.reverse,this._internal={},Object.freeze(this)}var s=t("lodash/lang/isEqual"),r=t("lodash/lang/isNumber"),o=t("./Selection"),a=t("./Coordinate"),l=t("./Range");n.Prototype=function(){this.toJSON=function(){return{type:"property",path:this.path,startOffset:this.startOffset,endOffset:this.endOffset,reverse:this.reverse}},this.getDocument=function(){var t=this._internal.doc;if(!t)throw new Error("Selection is not attached to a document.");return t},this.attach=function(t){return this._internal.doc=t,this},this.isNull=function(){return!1},this.getRanges=function(){return[this.range]},this.getRange=function(){return this.range},this.isCollapsed=function(){return this.range.isCollapsed()},this.isReverse=function(){return this.reverse},this.isPropertySelection=function(){return!0},this.isMultiSeletion=function(){return!1},this.equals=function(t){return o.prototype.equals.call(this,t)&&!t.isTableSelection()&&this.range.equals(t.range)},this.collapse=function(t){var e;return e="left"===t?this.range.start:this.range.end,this.createWithNewRange(e.offset,e.offset)},this.getPath=function(){return this.range.start.path},this.getStartOffset=function(){return this.range.start.offset},this.getEndOffset=function(){return this.range.end.offset},this.toString=function(){return["PropertySelection(",JSON.stringify(this.range.start.path),", ",this.range.start.offset," -> ",this.range.end.offset,this.reverse?", reverse":"",this.range.start.after?", after":"",")"].join("")},this.isInsideOf=function(t,e){return t.isNull()?!1:t.isContainerSelection()?t.contains(this):e?s(this.path,t.path)&&this.start.offset>t.start.offset&&this.end.offset<t.end.offset:s(this.path,t.path)&&this.start.offset>=t.start.offset&&this.end.offset<=t.end.offset},this.contains=function(t,e){return t.isNull()?!1:t.isContainerSelection()?t.isInsideOf(this):e?s(this.path,t.path)&&this.start.offset<t.start.offset&&this.end.offset>t.end.offset:s(this.path,t.path)&&this.start.offset<=t.start.offset&&this.end.offset>=t.end.offset},this.overlaps=function(t,e){return t.isNull()?!1:t.isContainerSelection()?t.overlaps(this):s(this.getPath(),t.getPath())?e?!(this.startOffset>=t.endOffset||this.endOffset<=t.startOffset):!(this.startOffset>t.endOffset||this.endOffset<t.startOffset):!1},this.isRightAlignedWith=function(t){return t.isNull()?!1:t.isContainerSelection()?t.isRightAlignedWith(this):s(this.getPath(),t.getPath())&&this.getEndOffset()===t.getEndOffset()},this.isLeftAlignedWith=function(t){return t.isNull()?!1:t.isContainerSelection()?t.isLeftAlignedWith(this):s(this.getPath(),t.getPath())&&this.getStartOffset()===t.getStartOffset()},this.expand=function(t){if(t.isNull())return this;if(t.isContainerSelection())return t.expand(this);if(!s(this.path,t.path))throw new Error("Can not expand PropertySelection to a different property.");var e=Math.min(this.startOffset,t.startOffset),i=Math.max(this.endOffset,t.endOffset);return this.createWithNewRange(e,i)},this.createWithNewRange=function(t,e){return new n({path:this.path,startOffset:t,endOffset:e})},this.truncate=function(t){if(t.isNull())return this;if(!s(this.start.path,t.start.path)||!s(this.end.path,t.end.path))throw new Error("Can not expand PropertySelection to a different property.");var e,i;return this.startOffset===t.startOffset?(e=t.endOffset,i=this.endOffset):this.endOffset===t.endOffset&&(e=this.startOffset,i=t.startOffset),this.createWithNewRange(e,i)},this._coordinates=function(){return this},this.getFragments=function(){return this.isCollapsed()?[new o.Cursor(this.path,this.startOffset)]:[new o.Fragment(this.path,this.startOffset,this.endOffset)]}},o.extend(n),Object.defineProperties(n.prototype,{start:{get:function(){return this.range.start},set:function(){throw new Error("immutable.")}},end:{get:function(){return this.range.end},set:function(){throw new Error("immutable.")}},path:{get:function(){return this.range.start.path},set:function(){throw new Error("immutable.")}},startOffset:{get:function(){return this.range.start.offset},set:function(){throw new Error("immutable.")}},endOffset:{get:function(){return this.range.end.offset},set:function(){throw new Error("immutable.")}},collapsed:{get:function(){return this.isCollapsed()},set:function(){throw new Error("immutable.")}}}),e.exports=n},{"./Coordinate":88,"./Range":110,"./Selection":111,"lodash/lang/isEqual":273,"lodash/lang/isNumber":277}],110:[function(t,e,i){"use strict";var n=t("../util/oo"),s=function(t,e){this.start=t,this.end=e,Object.freeze(this)};s.Prototype=function(){this.isCollapsed=function(){return this.start.equals(this.end)},this.equals=function(t){return this===t?!0:this.start.equals(t.start)&&this.end.equals(t.end)}},n.initClass(s),e.exports=s},{"../util/oo":413}],111:[function(t,e,i){"use strict";function n(){}var s=t("../util/oo"),r=t("../util/EventEmitter"),o=t("./Anchor");n.Prototype=function(){this.isNull=function(){return!1},this.isPropertySelection=function(){return!1},this.isContainerSelection=function(){return!1},this.isTableSelection=function(){return!1},this.isCollapsed=function(){return!0},this.isReverse=function(){return!1},this.equals=function(t){return this===t?!0:t?this.isNull()!==t.isNull()?!1:!0:!1},this.toString=function(){return"null"},this.getRanges=function(){return[]},this.attach=function(t){throw new Error("This method is abstract.")},this.toJSON=function(){throw new Error("This method is abstract.")}},s.initClass(n),n.NullSelection=function(){},n.NullSelection.Prototype=function(){this.isNull=function(){return!0}},n.extend(n.NullSelection),n.nullSelection=Object.freeze(new n.NullSelection),n.Fragment=function(t,e,i){r.call(this),this.type="selection-fragment",this.path=t,this.startOffset=e,this.endOffset=i||e},n.Fragment.Prototype=function(){this.isAnchor=function(){return!1},this.isInline=function(){return!1}},r.extend(n.Fragment),n.Cursor=function(t,e){o.call(this,t,e),this.type="cursor"},o.extend(n.Cursor),e.exports=n},{"../util/EventEmitter":405,"../util/oo":413,"./Anchor":81}],112:[function(t,e,i){"use strict";function n(t){if(n["super"].apply(this,arguments),this.tableId=t.tableId,t.rectangle?this.rectangle=t.rectangle:this.rectangle=new n.Rectangle(t.startRow,t.startCol,t.endRow,t.endCol),!this.tableId)throw new Error("Invalid arguments. `tableId` is mandatory.");this._internal={},Object.freeze(this)}var s=t("./Selection");n.Prototype=function(){this.isPropertySelection=function(){return!1},this.isTableSelection=function(){return!0},this.isSingleCell=function(){return this.rectangle.isSingleCell()},this.getTableId=function(){return this.tableId},this.getRectangle=function(){return this.rectangle},this.equals=function(t){return s.prototype.equals.call(this,t)&&!t.isTableSelection()&&this.startRow===t.startRow&&this.endRow===t.endRow&&this.startCol===t.startCol&&this.ednCol===t.endCol},this.toString=function(){var t=this.rectangle;return"T[("+t.start.row+","+t.start.col+"), ("+t.end.row+", "+t.end.col+")]"},this.attach=function(t){return this._internal.doc=t,this}},s.extend(n),Object.defineProperties(n.prototype,{startRow:{get:function(){return this.rectangle.start.row}},endRow:{get:function(){return this.rectangle.end.row}},startCol:{get:function(){return this.rectangle.start.col}},endCol:{get:function(){return this.rectangle.end.col}}}),n.Rectangle=function(t,e,i,n){var s=Math.min(t,i),r=Math.max(t,i),o=Math.min(e,n),a=Math.max(e,n);this.start={row:s,col:o},this.end={row:r,col:a},Object.freeze(this.start),Object.freeze(this.end),Object.freeze(this)},n.Rectangle.prototype.isSingleCell=function(){return this.start.row===this.end.row&&this.start.col===this.end.col},e.exports=n},{"./Selection":111}],113:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("./TextNode");s.extend(n),n["static"].isBlock=!0,e.exports=n},{"./TextNode":114}],114:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("./DocumentNode");n.Prototype=function(){this.getTextPath=function(){return[this.id,"content"]},this.getText=function(){return this.content}},s.extend(n),n["static"].name="text",n["static"].isText=!0,n["static"].defineSchema({content:"text"}),e.exports=n},{"./DocumentNode":96}],115:[function(t,e,i){"use strict";function n(t,e){if(!t)throw new Error("Illegal arguments: doc is mandatory.");this.doc=t,this.containerId=e,this.records={},this.fragments={},this.selectionFragments=[],this.doc.connect(this,{"document:changed":this.onDocumentChange},{priority:-1}),this._initialize()}var s,r,o=t("../util/oo"),a=t("lodash/lang/isString"),l=t("lodash/collection/each"),u=t("lodash/object/values"),c=t("lodash/object/extend"),h=t("./ContainerAnnotation"),p=t("./data/TextOperation");n.Prototype=function(){function t(){var t=Object.create({get:function(e){var i=t[e];return i||(i=new r(e),t[e]=i),i}});return t}this.dispose=function(){this.doc.disconnect(this)},this._initializeFragment=function(t){var e=t.path,i=this.records[e];i||(i=new s(e),this.records[e]=i),i.fragments[t.id]=t},this._initialize=function(){this.hasContainer()&&l(this.doc.getNodes(),function(t){if(t.isInstanceOf("container-annotation")&&t.container===this.containerId){var e=t;l(e.getFragments(),this._initializeFragment,this)}},this)},this.hasContainer=function(){return!!this.containerId},this.renderSelection=function(t){if(!t||t.isNull())return void this.removeSelection();var e=t.getFragments();l(e,function(t){var e=this.records[t.path];e&&(e.fragments[t.type]=t,e.property&&e.property.setFragments(u(e.fragments)))},this),this.selectionFragments=e},this.hasSelection=function(){return this.selectionFragments.length>0},this.removeSelection=function(){this.hasSelection()&&(l(this.selectionFragments,function(t){var e=this.records[t.path];e&&(delete e.fragments[t.type],e.property&&e.property.setFragments(u(e.fragments)))},this),this.selectionFragments=[])},this.registerProperty=function(t){var e=t.getPath(),i=this.records[e];if(i&&i.property&&i.property!==t)throw new Error("Property already registered.");i||(i=new s(e),this.records[e]=i),i.property=t},this.unregisterProperty=function(t){var e=t.getPath(),i=this.records[e];if(!i)return void console.warn("No property registered for path "+e.toString());if(i.property!==t)throw new Error("Registered property is different for path "+e.toString());i.property=null},this.getFragments=function(t){var e=this.records[t];return e?u(e.fragments):[]},this.onDocumentChange=function(t){var e=this._record(t);this._dispatch(e,t)},this._record=function(e){for(var i=t(),n=0;n<e.ops.length;n++){var s=e.ops[n];"update"===s.type&&s.diff instanceof p||"set"===s.type&&a(s.val)?this._recordTextChange(i,s):("create"!==s.type&&"delete"!==s.type||!s.val.path)&&("set"!==s.type||"path"!==s.path[1])?("create"!==s.type&&"delete"!==s.type||!s.val.startPath)&&("update"!==s.type&&"set"!==s.type||"startPath"!==s.path[1]&&"endPath"!==s.path[1])?"update"!==s.type&&"set"!==s.type||"startOffset"!==s.path[1]&&"endOffset"!==s.path[1]||this._recordMixedAnnoChange(i,s):this._recordContainerAnnoChange(i,s):this._recordAnnoChange(i,s)}return i},this._recordTextChange=function(t,e){t.get(e.path).rerender=!0},this._recordMixedAnnoChange=function(t,e){var i=this.doc,n=i.get(e.path[0]);n&&(n instanceof h?this._recordContainerAnnoChange(t,e):this._recordAnnoChange(t,e))},this._recordAnnoChange=function(t,e){var i=this.doc;if("create"===e.type||"delete"===e.type)t.get(e.val.path).rerender=!0;else if("set"===e.type&&"path"===e.path[1])t.get(e.original).rerender=!0,t.get(e.val).rerender=!0;else if("set"===e.type&&("startOffset"===e.path[1]||"endOffset"===e.path[1])){var n=i.get(e.path[0]);n&&(t.get(n.path).rerender=!0)}},this._recordContainerAnnoChange=function(t,e){var i,n,s,r,o=this.doc;if("create"===e.type)for(s=o.get(e.val.id),n=s.getFragments(),r=0;r<n.length;r++)i=t.get(n[r].path),i.didAddFragment(n[r]);else if("delete"===e.type)for(n=this.fragments[e.val.id],r=0;r<n.length;r++)i=t.get(n[r].path),i.didRemoveFragment(n[r]);else if("set"===e.type)if("startPath"===e.path[1],0)"startOffset"===e.path[1]?(s=o.get(e.path[0]),t.get(s.startPath).rerender=!0):"endOffset"===e.path[1]&&(s=o.get(e.path[0]),t.get(s.endPath).rerender=!0);else{for(s=o.get(e.path[0]),n=this.fragments[s.id]||[],r=0;r<n.length;r++)i=t.get(n[r].path),i.didRemoveFragment(n[r]);for(n=s.getFragments(),r=0;r<n.length;r++)i=t.get(n[r].path),i.didAddFragment(n[r])}},this._dispatch=function(t,e){for(var i in t)if(t.hasOwnProperty(i)&&this.records[i]){var n=t[i];if(!e.deleted[n.path[0]]){var s=this.records[i];if(s){var r=!1,o=s.fragments,a=c({},o);if(n.removedFragments){for(var l in n.removedFragments)delete a[l];s.fragments=a,r=!0}n.addedFragments&&(c(a,n.addedFragments),s.fragments=a,r=!0),r?s.property.setFragments(u(s.fragments)):n.rerender&&s.property.update()}else console.warn("TextPropertyManager: something is fishy here. Saw a change, but don't know property:",i)}}}},o.initClass(n);var s=function(t){this.path=t,this.property=null,this.fragments={}};o.initClass(s);var r=function(t){this.path=t,this.rerender=!1,this.addedFragments=null,this.removedFragments=null};r.Prototype=function(){this.didAddFragment=function(t){this.addedFragments||(this.addedFragments={}),this.addedFragments[t.id]=t},this.didRemoveFragment=function(t){this.removedFragments||(this.removedFragments={}),this.removedFragments[t.id]=t}},o.initClass(r),e.exports=n},{"../util/oo":413,"./ContainerAnnotation":86,"./data/TextOperation":130,"lodash/collection/each":158,"lodash/lang/isString":279,"lodash/object/extend":282,"lodash/object/values":287}],116:[function(t,e,i){"use strict";function n(t,e){this.__id__="TX_"+h++,this.schema=t.schema,this.nodeFactory=new c(this),this.data=new u(this.schema,{nodeFactory:this.nodeFactory}),this.document=t,this.session=e,this.ops=[],this.before={},o(t.data.indexes,function(t,e){this.data.addIndex(e,t.clone())},this),this.loadSeed(t.toJSON())}var s=t("lodash/lang/isFunction"),r=t("lodash/object/extend"),o=t("lodash/collection/each"),a=t("./Document"),l=t("./DocumentChange"),u=t("./data/IncrementalData"),c=t("./DocumentNodeFactory"),h=0;n.Prototype=function(){this.reset=function(){this.ops=[],this.before={}},this.create=function(t){var e=this.data.create(t);if(e)return this.ops.push(e),this.data.get(t.id)},this["delete"]=function(t){var e=this.data["delete"](t);if(e)return this.ops.push(e),e},this.set=function(t,e){var i=this.data.set(t,e);if(i)return this.ops.push(i),i},this.update=function(t,e){var i=this.data.update(t,e);if(i)return this.ops.push(i),i},this.cancel=function(){this._cancelTransaction()},this.getOperations=function(){return this.ops},this._apply=function(t){o(t.ops,function(t){this.data.apply(t)},this)},this._transaction=function(t){if(!s(t))throw new Error("Document.transaction() requires a transformation function.");this._startTransaction();try{if(t(this,{}),!this._isCancelled)return this._saveTransaction()}finally{this._isSaved||this.cancel(),this.session.isTransacting=!1}},this._startTransaction=function(){this.before={},this.after={},this.info={},this._isCancelled=!1,this._isSaved=!1,this.document.emit("transaction:started",this)},this._saveTransaction=function(){if(!this._isCancelled){var t,e=this.before,i=r({},e,this.after),n=this.ops;return n.length>0&&(t=new l(n,e,i)),this._isSaved=!0,this.reset(),t}},this._cancelTransaction=function(){for(var t=this.ops.length-1;t>=0;t--)this.data.apply(this.ops[t].invert());this._isCancelled=!0,this.reset()},this.newInstance=function(){return this.document.newInstance()}},a.extend(n),e.exports=n},{"./Document":92,"./DocumentChange":94,"./DocumentNodeFactory":97,"./data/IncrementalData":122,"lodash/collection/each":158,"lodash/lang/isFunction":274,"lodash/object/extend":282}],117:[function(t,e,i){"use strict";function n(t){t=o({idAttribute:"id"},t),s.call(this,t),this._el=r.parseXML("<dummy></dummy>")}var s=t("./DOMImporter"),r=t("../ui/DefaultDOMElement"),o=t("lodash/object/extend");n.Prototype=function(){this.importDocument=function(t){this.reset();var e=r.parseXML(t);this.convertDocument(e);var i=this.generateDocument();return i}},s.extend(n),e.exports=n},{"../ui/DefaultDOMElement":373,"./DOMImporter":90,"lodash/object/extend":282}],118:[function(t,e,i){"use strict";var n=t("lodash/collection/each"),s=t("lodash/array/uniq"),r=t("../util/uuid"),o=function(t,e,i){if(i){var s=t.getIndex("annotations"),r=s.get(e.path);n(r,function(n){var s=e.offset,r=n.startOffset,o=n.endOffset,a=r,l=o;(r>s||s===r)&&(a+=i),(o>s||s===o&&!n.isInline())&&(l+=i),a!==r&&t.set([n.id,"startOffset"],a),l!==o&&t.set([n.id,"endOffset"],l)}),s=t.getIndex("container-annotation-anchors");var o=s.get(e.path);n(o,function(n){var s=e.offset,r=n.offset,o=!1;if((r>s||s===r&&!e.after)&&(r+=i,o=!0),o){var a=n.isStart?"startOffset":"endOffset";t.set([n.id,a],r)}})}},a=function(t,e,i,r){if(i!==r){var o=t.getIndex("annotations"),a=o.get(e),l=r-i;n(a,function(e){var n=i,s=r,o=e.startOffset,a=e.endOffset,u=o,c=a;o>=s?(u-=l,c-=l,t.set([e.id,"startOffset"],u),t.set([e.id,"endOffset"],c)):(o>=n&&(u=o-Math.min(s-n,o-n)),a>=n&&(c=a-Math.min(s-n,a-n)),o!==a&&u===c?t["delete"](e.id):(o!==u&&t.set([e.id,"startOffset"],u),a!==c&&t.set([e.id,"endOffset"],c)))}),o=t.getIndex("container-annotation-anchors");var u=o.get(e),c=[];n(u,function(e){c.push(e.id);var n=i,s=r,o=e.offset,a=!1;if(o>=s)o-=l,a=!0;else if(o>=n){var u=o-Math.min(s-n,o-n);o!==u&&(o=u,a=!0)}if(a){var h=e.isStart?"startOffset":"endOffset";t.set([e.id,h],o)}}),n(s(c),function(e){var i=t.get(e),n=i.getSelection();n.isCollapsed()&&(console.log("...deleting container annotation because it has collapsed"+e),t["delete"](e))})}},l=function(t,e,i,o,a){var l=t.getIndex("annotations"),u=l.get(e,i);n(u,function(e){var n,s,l=i>e.startOffset&&i<e.endOffset,u=e.startOffset,c=e.endOffset;if(l){if(e.canSplit()){var h=e.toJSON();h.id=r(e.type+"_"),h.startOffset=a,h.endOffset=a+e.endOffset-i,h.path=o,t.create(h)}n=e.startOffset,s=i,s===n?t["delete"](e.id):(n!==u&&t.set([e.id,"startOffset"],n),s!==c&&t.set([e.id,"endOffset"],s))}else e.startOffset>=i&&(n=a+e.startOffset-i,s=a+e.endOffset-i,t.set([e.id,"path"],o),t.set([e.id,"startOffset"],n),t.set([e.id,"endOffset"],s))}),l=t.getIndex("container-annotation-anchors");var c=l.get(e),h=[];n(c,function(e){h.push(e.id);var n=e.offset;if(n>=i){var s=e.isStart?"startPath":"endPath",r=e.isStart?"startOffset":"endOffset";t.set([e.id,s],o),t.set([e.id,r],a+e.offset-i)}}),n(s(h),function(e){var i=t.get(e),n=i.getSelection();n.isCollapsed()&&(console.log("...deleting container annotation because it has collapsed"+e),t["delete"](e))})};e.exports={insertedText:o,deletedText:a,transferAnnotations:l}},{"../util/uuid":416,"lodash/array/uniq":155,"lodash/collection/each":158}],119:[function(t,e,i){"use strict";function n(t,e){t.pos===e.pos?e.pos+=1:t.pos<e.pos?e.pos+=1:t.pos+=1}function s(t,e){return t.pos===e.pos?(e.type=h,void(t.type=h)):void(t.pos<e.pos?e.pos-=1:t.pos-=1)}function r(t,e){if(t.type===p){var i=t;t=e,e=i}t.pos<=e.pos?e.pos+=1:t.pos-=1}var o=t("lodash/lang/isNumber"),a=t("lodash/lang/isEqual"),l=t("lodash/lang/cloneDeep"),u=t("./Operation"),c=t("./Conflict"),h="NOP",p="delete",d="insert",f=function(t){if(u.call(this),!t||null==t.type)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.type!==h){if(this.type!==d&&this.type!==p)throw new Error("Illegal type.");if(this.pos=t.pos,this.val=t.val,!o(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}};f.fromJSON=function(t){return new f(t)},f.Prototype=function(){this.apply=function(t){if(this.type===h)return t;if(this.type===d){if(t.length<this.pos)throw new Error("Provided array is too small.");return t.splice(this.pos,0,this.val),t}if(t.length<this.pos)throw new Error("Provided array is too small.");if(!a(t[this.pos],this.val))throw Error("Unexpected value at position "+this.pos+". Expected "+this.val+", found "+t[this.pos]);return t.splice(this.pos,1),t},this.clone=function(){var t={type:this.type,pos:this.pos,val:l(this.val)};return new f(t)},this.invert=function(){var t=this.toJSON();return this.type===h?t.type=h:this.type===d?t.type=p:t.type=d,new f(t)},this.hasConflict=function(t){return f.hasConflict(this,t)},this.toJSON=function(){var t={type:this.type};return this.type===h?t:(t.pos=this.pos,t.val=l(this.val),t)},this.isInsert=function(){return this.type===d},this.isDelete=function(){return this.type===p},this.getOffset=function(){return this.pos},this.getValue=function(){return this.val},this.isNOP=function(){return this.type===h},this.toString=function(){return["(",this.isInsert()?d:p,",",this.getOffset(),",'",this.getValue(),"')"].join("")}},u.extend(f);var m=function(t,e){return t.type===h||e.type===h?!1:t.type===d&&e.type===d?t.pos===e.pos:!1},g=function(t,e,i){if(i=i||{},i["no-conflict"]&&m(t,e))throw new c(t,e);return i.inplace||(t=t.clone(),e=e.clone()),t.type===h||e.type===h||(t.type===d&&e.type===d?n(t,e):t.type===p&&e.type===p?s(t,e):r(t,e)),[t,e]};f.transform=g,f.hasConflict=m,f.Insert=function(t,e){return new f({type:d,pos:t,val:e})},f.Delete=function(t,e){return new f({type:p,pos:t,val:e})},f.NOP=h,f.DELETE=p,f.INSERT=d,e.exports=f},{"./Conflict":120,"./Operation":127,"lodash/lang/cloneDeep":268,"lodash/lang/isEqual":273,"lodash/lang/isNumber":277}],120:[function(t,e,i){"use strict";function n(t,e){Error.call(this,"Conflict: "+JSON.stringify(t)+" vs "+JSON.stringify(e)),this.a=t,this.b=e}n.prototype=Error.prototype,e.exports=n},{}],121:[function(t,e,i){"use strict";function n(t,e){u.call(this),this.schema=t,this.nodes=new l,this.indexes={},this.options=e||{},this.nodeFactory=e.nodeFactory||t.getNodeFactory(),this.__QUEUE_INDEXING__=!1,this.queue=[]}var s=t("lodash/lang/isString"),r=t("lodash/lang/isArray"),o=t("lodash/lang/cloneDeep"),a=t("lodash/collection/each"),l=t("../../util/PathAdapter"),u=t("../../util/EventEmitter");n.Prototype=function(){this.contains=function(t){return!!this.nodes[t]},this.get=function(t){if(!t)throw new Error("Path or id required");return this.nodes.get(t)},this.getNodes=function(){return this.nodes},this.create=function(t){var e=this.nodeFactory.create(t.type,t);if(!e)throw new Error("Illegal argument: could not create node for data:",t);if(this.contains(e.id))throw new Error("Node already exists: "+e.id);if(!e.id||!e.type)throw new Error("Node id and type are mandatory.");this.nodes[e.id]=e;var i={type:"create",node:e};return this.__QUEUE_INDEXING__?this.queue.push(i):this._updateIndexes(i),e},this["delete"]=function(t){var e=this.nodes[t];delete this.nodes[t];var i={type:"delete",node:e};return this.__QUEUE_INDEXING__?this.queue.push(i):this._updateIndexes(i),e},this.set=function(t,e){var i=this.get(t[0]),n=this.nodes.get(t);this.nodes.set(t,e);var s={type:"set",node:i,path:t,newValue:e,oldValue:n};return this.__QUEUE_INDEXING__?this.queue.push(s):this._updateIndexes(s),n},this.update=function(t,e){var i,n=this.nodes.get(t);if(e.isOperation)i=e.apply(n);else{var o,a,l,u;if(s(n))if(e["delete"])o=e["delete"].start,a=e["delete"].end,i=n.split("").splice(o,a-o).join("");else{if(!e.insert)throw new Error("Diff is not supported:",JSON.stringify(e));l=e.insert.offset,u=e.insert.value,i=[n.substring(0,l),u,n.substring(l)].join("")}else{if(!r(n))throw new Error("Diff is not supported:",JSON.stringify(e));if(i=n.slice(0),e["delete"])l=e["delete"].offset,i.splice(l,1);else{if(!e.insert)throw new Error("Diff is not supported:",JSON.stringify(e));l=e.insert.offset,u=e.insert.value,i.splice(l,0,u)}}}this.nodes.set(t,i);var c=this.get(t[0]),h={type:"update",node:c,path:t,newValue:i,oldValue:n};return this.__QUEUE_INDEXING__?this.queue.push(h):this._updateIndexes(h),n},this.toJSON=function(){return{schema:[this.schema.id,this.schema.version],nodes:o(this.nodes)}},this.reset=function(){this.nodes=new l},this.addIndex=function(t,e){return this.indexes[t]&&console.error("Index with name %s already exists.",t),e.reset(this),this.indexes[t]=e,e},this.getIndex=function(t){return this.indexes[t]},this._updateIndexes=function(t){t&&!this.__QUEUE_INDEXING__&&a(this.indexes,function(e){e.select(t.node)&&(e[t.type]||console.error("Contract: every NodeIndex must implement "+t.type),e[t.type](t.node,t.path,t.newValue,t.oldValue))})},this._stopIndexing=function(){this.__QUEUE_INDEXING__=!0},this._startIndexing=function(){for(this.__QUEUE_INDEXING__=!1;this.queue.length>0;){var t=this.queue.shift();this._updateIndexes(t)}}},u.extend(n),e.exports=n},{"../../util/EventEmitter":405,"../../util/PathAdapter":407,"lodash/collection/each":158,"lodash/lang/cloneDeep":268,"lodash/lang/isArray":270,"lodash/lang/isString":279}],122:[function(t,e,i){"use strict";var n=t("lodash/lang/isString"),s=t("lodash/lang/isArray"),r=t("lodash/lang/cloneDeep"),o=t("./Data"),a=t("./ObjectOperation"),l=t("./ArrayOperation"),u=t("./TextOperation"),c=function(t,e){c["super"].call(this,t,e)};c.Prototype=function(){this.create=function(t){var e=a.Create([t.id],t);return this.apply(e),e},this["delete"]=function(t){var e=null,i=this.get(t);if(i){var n=i.toJSON();e=a.Delete([t],n),this.apply(e)}return e},this.update=function(t,e){var i=this._getDiffOp(t,e),n=a.Update(t,i);return this.apply(n),n},this.set=function(t,e){var i=this.get(t),n=a.Set(t,i,e);return this.apply(n),n},this.apply=function(t){if(t.type!==a.NOP){if(t.type===a.CREATE)this["super"].create.call(this,r(t.val));else if(t.type===a.DELETE)this["super"]["delete"].call(this,t.val.id);else if(t.type===a.UPDATE){var e=this.get(t.path),i=t.diff;if("array"===t.propertyType)i instanceof l||(i=l.fromJSON(i)),i.apply(e);else{if("string"!==t.propertyType)throw new Error("Unsupported type for operational update.");i instanceof u||(i=u.fromJSON(i));var n=i.apply(e);this["super"].set.call(this,t.path,n)}}else{if(t.type!==a.SET)throw new Error("Illegal state.");this["super"].set.call(this,t.path,t.val)}this.emit("operation:applied",t,this)}},this._getDiffOp=function(t,e){var i=null;if(e.isOperation)i=e;else{var r,o,a,c,h=this.get(t);if(null===h||void 0===h)throw new Error("Property has not been initialized: "+JSON.stringify(t));n(h)?e["delete"]?(r=e["delete"].start,o=e["delete"].end,i=u.Delete(r,h.substring(r,o))):e.insert&&(a=e.insert.offset,c=e.insert.value,i=u.Insert(a,c)):s(h)&&(e["delete"]?(a=e["delete"].offset,i=l.Delete(a,h[a])):e.insert&&(a=e.insert.offset,c=e.insert.value,i=l.Insert(a,c)))}if(!i)throw new Error("Unsupported diff: "+JSON.stringify(e));return i}},o.extend(c),e.exports=c},{"./ArrayOperation":119,"./Data":121,"./ObjectOperation":126,"./TextOperation":130,"lodash/lang/cloneDeep":268,"lodash/lang/isArray":270,"lodash/lang/isString":279}],123:[function(t,e,i){"use strict";function n(t){y.call(this);var e=this.constructor;if(!e["static"].name)throw new Error('Every NodeClass must provide a static property "name".');g(e["static"].schema,function(e,i){var n=void 0!==t[i],s=e.hasOwnProperty("default"),r=e.optional;if(!r&&!s&&!n)throw new Error("Property "+i+" is mandatory for node type "+this.type);n?this[i]=u(e,t[i]):s&&(this[i]=m(u(e,e["default"])))},this)}function s(t,e){var i=r(e);if(t["static"].schema=a(t,i),t["static"].defaultProps=l(t),!t["static"].hasOwnProperty("addressablePropertyNames")){var n=[];g(t["static"].schema,function(t,e){"string"===t.type&&t.addressable===!0&&n.push(e)}),t["static"].addressablePropertyNames=n}}function r(t){var e={};return g(t,function(t,i){(p(t)||d(t))&&(t={type:t}),t=o(t),t.name=i,e[i]=t}),e}function o(t){var e=t;return d(t.type)&&"array"!==t[0]?t.type=["array",t.type[0]]:"text"===t.type&&(e={type:"string",addressable:!0,"default":""}),e}function a(t,e){for(var i=[e],n=t;n;){var s=Object.getPrototypeOf(n.prototype);if(!s)break;n=s.constructor,n&&n["static"]&&n["static"].schema&&i.unshift(n["static"].schema);
}return i.unshift({}),b.apply(null,i)}function l(t){var e=t["static"].unfoldedSchema,i={};return g(e,function(t,e){t.hasOwnProperty("default")&&(i[e]=t["default"])}),i}function u(t,e){var i;if(i=d(t.type)?"array":t.type,null===e){if(t.notNull)throw new Error("Value for property "+t.name+" is null.");return e}if(void 0===e)throw new Error("Value for property "+t.name+" is undefined.");if("string"===i&&!p(e)||"boolean"===i&&!c(e)||"number"===i&&!h(e)||"array"===i&&!d(e)||"id"===i&&!p(e)||"object"===i&&!f(e))throw new Error("Illegal value type for property "+t.name+": expected "+i+", was "+typeof e);return e}var c=t("lodash/lang/isBoolean"),h=t("lodash/lang/isNumber"),p=t("lodash/lang/isString"),d=t("lodash/lang/isArray"),f=t("lodash/lang/isObject"),m=t("lodash/lang/cloneDeep"),g=t("lodash/collection/each"),b=t("lodash/object/extend"),y=t("../../util/EventEmitter");n.Prototype=function(){this.isInstanceOf=function(t){return n.isInstanceOf(this.constructor,t)},this.getTypeNames=function(){for(var t=[],e=this.constructor["static"];e&&"node"!==e.name;)t.push(e.name),e=Object.getPrototypeOf(e);return t},this.getPropertyType=function(t){var e=this.constructor["static"].schema;return e[t].type},this.toJSON=function(){var t={type:this.constructor["static"].name};return g(this.constructor["static"].schema,function(e,i){t[e.name]=this[i]},this),t}},y.extend(n),n["static"].name="node",n["static"].defineSchema=function(t){var e=this.__class__;s(e,t)},n["static"].defineSchema({id:"string"}),Object.defineProperty(n.prototype,"type",{configurable:!1,get:function(){return this.constructor["static"].name},set:function(){throw new Error('Property "type" is read-only.')}}),n.isInstanceOf=function(t,e){for(var i=t["static"];i&&"node"!==i.name;){if(i&&i.name===e)return!0;i=Object.getPrototypeOf(i)}return!1},n["static"].isInstanceOf=n.isInstanceOf,e.exports=n},{"../../util/EventEmitter":405,"lodash/collection/each":158,"lodash/lang/cloneDeep":268,"lodash/lang/isArray":270,"lodash/lang/isBoolean":271,"lodash/lang/isNumber":277,"lodash/lang/isObject":278,"lodash/lang/isString":279,"lodash/object/extend":282}],124:[function(t,e,i){"use strict";var n=t("../../util/oo"),s=t("lodash/lang/isArray"),r=t("lodash/collection/each"),o=t("lodash/object/extend"),a=t("../../util/PathAdapter"),l=function(){this.index=new a};l.Prototype=function(){this.get=function(t){return t?this.index.get(t)||{}:this.getAll()},this.getAll=function(){var t={};return r(this.index,function(e){o(t,e)}),t},this.property="id",this.select=function(t){return this.type?t.isInstanceOf(this.type):!0},this.create=function(t){var e=t[this.property];s(e)||(e=[e]),r(e,function(e){this.index.set([e,t.id],t)},this)},this["delete"]=function(t){var e=t[this.property];s(e)||(e=[e]),r(e,function(e){this.index["delete"]([e,t.id])},this)},this.update=function(t,e,i,n){if(this.select(t)&&e[1]===this.property){var o=n;s(o)||(o=[o]),r(o,function(e){this.index["delete"]([e,t.id])},this),o=i,s(o)||(o=[o]),r(o,function(e){this.index.set([e,t.id],t)},this)}},this.set=function(t,e,i,n){this.update(t,e,i,n)},this.reset=function(t){this.index.clear(),this._initialize(t)},this.clone=function(){var t=this.constructor,e=new t;return e},this._initialize=function(t){r(t.getNodes(),function(t){this.select(t)&&this.create(t)},this)}},n.initClass(l),l.create=function(t){var e=o(new l,t);return e.clone=function(){return l.create(t)},e},e.exports=l},{"../../util/PathAdapter":407,"../../util/oo":413,"lodash/collection/each":158,"lodash/lang/isArray":270,"lodash/object/extend":282}],125:[function(t,e,i){"use strict";function n(){s.call(this)}var s=t("../../util/Registry"),r=t("./Node");n.Prototype=function(){this.register=function(t){var e=t["static"]&&t["static"].name;if("string"!=typeof e||""===e)throw new Error("Node names must be strings and must not be empty");if(!(t.prototype instanceof r))throw new Error("Nodes must be subclasses of Substance.Data.Node");if(this.contains(e))throw new Error("Node class is already registered: "+e);this.add(e,t)}},s.extend(n),e.exports=n},{"../../util/Registry":408,"./Node":123}],126:[function(t,e,i){"use strict";var n=t("lodash/lang/isString"),s=t("lodash/lang/isEqual"),r=t("lodash/lang/cloneDeep"),o=t("../../util/PathAdapter"),a=t("./Operation"),l=t("./TextOperation"),u=t("./ArrayOperation"),c=t("./Conflict"),h="NOP",p="create",d="delete",f="update",m="set",g=function(t){if(a.call(this),!t)throw new Error("Data of ObjectOperation is missing.");if(!t.type)throw new Error("Invalid data: type is mandatory.");if(this.type=t.type,t.type!==h){if(this.path=t.path,!t.path)throw new Error("Invalid data: path is mandatory.");if(this.type===p||this.type===d){if(!t.val)throw new Error("Invalid data: value is missing.");this.val=t.val}else if(this.type===f){if(!t.diff)throw new Error("Invalid data: diff is mandatory for update operation.");if(this.diff=t.diff,t.diff instanceof l)this.propertyType="string";else{if(!(t.diff instanceof u))throw new Error("Invalid data: diff must be a TextOperation or an ArrayOperation.");this.propertyType="array"}}else{if(this.type!==m)throw new Error("Invalid type: "+t.type);this.val=t.val,this.original=t.original}}};g.fromJSON=function(t){if(t=r(t),"update"===t.type)switch(t.propertyType){case"string":t.diff=l.fromJSON(t.diff);break;case"array":t.diff=u.fromJSON(t.diff);break;default:throw new Error("Unsupported update diff:"+JSON.stringify(t.diff))}var e=new g(t);return e},g.Prototype=function(){this.apply=function(t){if(this.type===h)return t;var e;if(e=t instanceof o?t:new o(t),this.type===p)return e.set(this.path,r(this.val)),t;if(this.type===d)e["delete"](this.path,"strict");else if(this.type===f){var i,n=this.diff,s=e.get(this.path);i=n instanceof u?n.apply(s):n.apply(s),e.set(this.path,i)}else e.set(this.path,r(this.val));return t},this.clone=function(){var t={type:this.type,path:this.path};return this.val&&(t.val=r(this.val)),this.diff&&(t.diff=this.diff.clone()),new g(t)},this.isNOP=function(){return this.type===h?!0:this.type===f?this.diff.isNOP():void 0},this.isCreate=function(){return this.type===p},this.isDelete=function(){return this.type===d},this.isUpdate=function(t){return t?this.type===f&&this.propertyType===t:this.type===f},this.isSet=function(){return this.type===m},this.invert=function(){if(this.type===h)return new g({type:h});var t=new g(this);if(this.type===p)t.type=d;else if(this.type===d)t.type=p;else if(this.type===f){var e;e=this.diff instanceof l?l.fromJSON(this.diff.toJSON()).invert():u.fromJSON(this.diff.toJSON()).invert(),t.diff=e}else t.val=this.original,t.original=this.val;return t},this.hasConflict=function(t){return g.hasConflict(this,t)},this.toJSON=function(){if(this.type===h)return{type:h};var t={type:this.type,path:this.path};return this.type===p||this.type===d?t.val=this.val:this.type===f?(this.diff instanceof u?t.propertyType="array":t.propertyType="string",t.diff=this.diff.toJSON()):(t.val=this.val,t.original=this.original),t},this.getType=function(){return this.type},this.getPath=function(){return this.path},this.getValue=function(){return this.val},this.getOldValue=function(){return this.original},this.getValueOp=function(){return this.diff},this.toString=function(){switch(this.type){case p:return["(+,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case d:return["(-,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case f:return["(>>,",JSON.stringify(this.path),this.propertyType,this.diff.toString(),")"].join("");case m:return["(=,",JSON.stringify(this.path),this.val,this.original,")"].join("")}}},a.extend(g);var b=function(t,e){return t.type===h||e.type===h?!1:s(t.path,e.path)},y=function(t,e){t.type=h,e.type=h},v=function(){throw new Error("Can not transform two concurring creates of the same property")},_=function(){throw new Error("Illegal state: can not create and delete a value at the same time.")},x=function(t,e,i){if(t.type!==d)return x(e,t,!0);var n;n="string"===e.propertyType?l.fromJSON(e.diff):u.fromJSON(e.diff),i?(t.val=n.apply(t.val),e.type=h):(t.type=h,e.type=p,e.val=n.apply(t.val))},C=function(){throw new Error("Can not transform a concurring create and update of the same property")},w=function(t,e){var i,n,s;"string"===e.propertyType?(i=l.fromJSON(t.diff),n=l.fromJSON(e.diff),s=l.transform(i,n,{inplace:!0})):(i=u.fromJSON(t.diff),n=u.fromJSON(e.diff),s=u.transform(i,n,{inplace:!0})),t.diff=s[0],e.diff=s[1]},S=function(){throw new Error("Illegal state: can not create and set a value at the same time.")},T=function(t,e,i){return t.type!==d?T(e,t,!0):void(i?(t.val=e.val,e.type=h):(t.type=h,e.type=p,e.original=void 0))},E=function(){throw new Error("Unresolvable conflict: update + set.")},I=function(t,e){t.type=h,e.original=t.val},A=0,O=1,N=2,k=4,P=8,D={};D[h]=A,D[p]=O,D[d]=N,D[f]=k,D[m]=P;var L=[];L[N|N]=y,L[N|O]=_,L[N|k]=x,L[O|O]=v,L[O|k]=C,L[k|k]=w,L[O|P]=S,L[N|P]=T,L[k|P]=E,L[P|P]=I;var R=function(t,e,i){if(i=i||{},i["no-conflict"]&&b(t,e))throw new c(t,e);if(i.inplace||(t=t.clone(),e=e.clone()),t.isNOP()||e.isNOP())return[t,e];var n=s(t.path,e.path);return n&&L[D[t.type]|D[e.type]](t,e),[t,e]};g.transform=R,g.hasConflict=b,g.Create=function(t,e){var i;return i=n(t)?[t]:t,new g({type:p,path:i,val:e})},g.Delete=function(t,e){var i;return i=n(t)?[t]:t,new g({type:d,path:i,val:e})},g.Update=function(t,e){var i;if(e instanceof l)i="string";else{if(!(e instanceof u))throw new Error("Unsupported type for operational changes");i="array"}return new g({type:f,path:t,diff:e})},g.Set=function(t,e,i){return new g({type:m,path:t,val:r(i),original:r(e)})},g.NOP=h,g.CREATE=p,g.DELETE=d,g.UPDATE=f,g.SET=m,e.exports=g},{"../../util/PathAdapter":407,"./ArrayOperation":119,"./Conflict":120,"./Operation":127,"./TextOperation":130,"lodash/lang/cloneDeep":268,"lodash/lang/isEqual":273,"lodash/lang/isString":279}],127:[function(t,e,i){"use strict";function n(){}var s=t("../../util/oo");n.Prototype=function(){this.isOperation=!0},s.initClass(n),e.exports=n},{"../../util/oo":413}],128:[function(t,e,i){"use strict";function n(){this.SEPARATOR="	"}function s(t,e){r(arguments[0])?this.tokens=arguments[0]:this.tokens=t.split(e),this.pos=-1}var r=t("lodash/lang/isArray"),o=t("lodash/lang/isNumber"),a=t("lodash/lang/isObject"),l=t("../../util/oo"),u=t("./ObjectOperation"),c=t("./TextOperation"),h=t("./ArrayOperation");n.Prototype=function(){this.serialize=function(t){var e=[];switch(t.type){case"create":e.push("c"),e.push(t.val.id),e.push(t.val);break;case"delete":e.push("d"),e.push(t.val.id),e.push(t.val);break;case"set":e.push("s"),e.push(t.path.join(".")),e.push(t.val),e.push(t.original);break;case"update":e.push("u"),e.push(t.path.join(".")),Array.prototype.push.apply(e,this.serializePrimitiveOp(t.diff));break;default:throw new Error("Unsupported operation type.")}return e},this.serializePrimitiveOp=function(t){var e=[];if(t instanceof c)t.isInsert()?e.push("t+"):t.isDelete()&&e.push("t-"),e.push(t.pos),e.push(t.str);else{if(!(t instanceof h))throw new Error("Unsupported operation type.");t.isInsert()?e.push("a+"):t.isDelete()&&e.push("a-"),e.push(t.pos),e.push(t.val)}return e},this.deserialize=function(t,e){e||(e=new s(t,this.SEPARATOR));var i,n,r,o,a,l=e.getString();switch(l){case"c":n=e.getPath(),r=e.getObject(),i=u.Create(n,r);break;case"d":n=e.getPath(),r=e.getObject(),i=u.Delete(n,r);break;case"s":n=e.getPath(),r=e.getAny(),o=e.getAny(),i=u.Set(n,o,r);break;case"u":n=e.getPath(),a=this.deserializePrimitiveOp(t,e),i=u.Update(n,a)}return i},this.deserializePrimitiveOp=function(t,e){e||(e=new s(t,this.SEPARATOR));var i,n,r,o=e.getString();switch(o){case"t+":n=e.getNumber(),r=e.getString(),i=c.Insert(n,r);break;case"t-":n=e.getNumber(),r=e.getString(),i=c.Delete(n,r);break;case"a+":n=e.getNumber(),r=e.getAny(),i=h.Insert(n,r);break;case"a-":n=e.getNumber(),r=e.getAny(),i=h.Delete(n,r);break;default:throw new Error("Unsupported operation type: "+o)}return i}},l.initClass(n),s.Prototype=function(){this.error=function(t){throw new Error("Parsing error: "+t+"\n"+this.tokens[this.pos])},this.getString=function(){this.pos++;var t=this.tokens[this.pos];return'"'===t[0]&&(t=t.slice(1,-1)),t},this.getNumber=function(){this.pos++;var t,e=this.tokens[this.pos];try{return t=o(e)?e:parseInt(this.tokens[this.pos])}catch(i){this.error("expected number")}},this.getObject=function(){this.pos++;var t,e=this.tokens[this.pos];try{return t=a(e)?e:JSON.parse(this.tokens[this.pos])}catch(i){this.error("expected object")}},this.getAny=function(){this.pos++;var t=this.tokens[this.pos];return t},this.getPath=function(){var t=this.getString();return t.split(".")}},l.initClass(s),n.Tokenizer=s,e.exports=n},{"../../util/oo":413,"./ArrayOperation":119,"./ObjectOperation":126,"./TextOperation":130,"lodash/lang/isArray":270,"lodash/lang/isNumber":277,"lodash/lang/isObject":278}],129:[function(t,e,i){"use strict";function n(t,e){this.name=t,this.version=e,this.nodeRegistry=new r,this.tocTypes=[],this.addNodes(this.getBuiltIns())}var s=t("../../util/oo"),r=t("./NodeRegistry"),o=t("./Node");n.Prototype=function(){this.addNodes=function(t){if(t)for(var e=0;e<t.length;e++){var i=t[e];i["static"]?this.addNode(i):console.log("AAAAAAA",i)}},this.addNode=function(t){this.nodeRegistry.register(t),t["static"].tocType&&this.tocTypes.push(t["static"].name)},this.getNodeClass=function(t){return this.nodeRegistry.get(t)},this.getBuiltIns=function(){return[o]},this.isInstanceOf=function(t,e){var i=this.getNodeClass(t);return i?o["static"].isInstanceOf(i,e):!1},this.each=function(){this.nodeRegistry.each.apply(this.nodeRegistry,arguments)},this.getTocTypes=function(){return this.tocTypes},this.getDefaultTextType=function(){throw new Error("Schmema.prototype.getDefaultTextType() must be overridden.")},this.getNodeSchema=function(e){var i=this.getNodeClass(e);return i?t(i):(console.error("Unknown node type ",e),null)};var t=function(t){return t["static"].schema}},s.initClass(n),e.exports=n},{"../../util/oo":413,"./Node":123,"./NodeRegistry":125}],130:[function(t,e,i){"use strict";function n(t){if(c.call(this),!t||void 0===t.type||void 0===t.pos||void 0===t.str)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.pos=t.pos,this.str=t.str,!this.isInsert()&&!this.isDelete())throw new Error("Illegal type.");if(!l(this.str))throw new Error("Illegal argument: expecting string.");if(!u(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}function s(t,e){t.pos===e.pos?e.pos+=t.str.length:t.pos<e.pos?e.pos+=t.str.length:t.pos+=e.str.length}function r(t,e,i){if(t.pos>e.pos)return r(e,t,!i);if(t.pos===e.pos&&t.str.length>e.str.length)return r(e,t,!i);if(e.pos<t.pos+t.str.length){var n=e.pos-t.pos,s=t.str.length-n,o=n+e.str.length;t.str=t.str.slice(0,n)+t.str.slice(o),e.str=e.str.slice(s),e.pos-=n}else e.pos-=t.str.length}function o(t,e){if(t.type===d)return o(e,t);if(t.pos<=e.pos)e.pos+=t.str.length;else if(t.pos>=e.pos+e.str.length)t.pos-=e.str.length;else{var i=t.pos-e.pos;e.str=e.str.slice(0,i)+t.str+e.str.slice(i),t.str=""}}var a,l=t("lodash/lang/isString"),u=t("lodash/lang/isNumber"),c=t("./Operation"),h=t("./Conflict"),p="insert",d="delete";n.fromJSON=function(t){return new n(t)},n.Prototype=function(){this.apply=function(t){if(this.isEmpty())return t;if(this.type===p){if(t.length<this.pos)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,0,this.str):t.slice(0,this.pos).concat(this.str).concat(t.slice(this.pos))}if(t.length<this.pos+this.str.length)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,this.str.length):t.slice(0,this.pos).concat(t.slice(this.pos+this.str.length))},this.clone=function(){return new n(this)},this.isNOP=function(){return"NOP"===this.type||0===this.str.length},this.isInsert=function(){return this.type===p},this.isDelete=function(){return this.type===d},this.getLength=function(){return this.str.length},this.invert=function(){var t={type:this.isInsert()?d:p,pos:this.pos,str:this.str};return new n(t)},this.hasConflict=function(t){return a(this,t)},this.isEmpty=function(){return 0===this.str.length},this.toJSON=function(){return{type:this.type,pos:this.pos,str:this.str}},this.toString=function(){return["(",this.isInsert()?p:d,",",this.pos,",'",this.str,"')"].join("")}},c.extend(n),a=function(t,e){if(t.type===p&&e.type===p)return t.pos===e.pos;if(t.type===d&&e.type===d)return!(t.pos>=e.pos+e.str.length||e.pos>=t.pos+t.str.length);var i,n;return t.type===d?(i=t,n=e):(i=e,n=t),n.pos>=i.pos&&n.pos<i.pos+i.str.length};var f=function(t,e,i){if(i=i||{},i["no-conflict"]&&a(t,e))throw new h(t,e);return i.inplace||(t=t.clone(),e=e.clone()),t.type===p&&e.type===p?s(t,e):t.type===d&&e.type===d?r(t,e,!0):o(t,e),[t,e]};n.transform=function(){return f.apply(null,arguments)},n.Insert=function(t,e){return new n({type:p,pos:t,str:e})},n.Delete=function(t,e){return new n({type:d,pos:t,str:e})},n.INSERT=p,n.DELETE=d,e.exports=n},{"./Conflict":120,"./Operation":127,"lodash/lang/isNumber":277,"lodash/lang/isString":279}],131:[function(t,e,i){"use strict";var n=t("lodash/collection/filter"),s=t("./AnnotationIndex"),r={};r.isContainerAnnotation=function(t,e){var i=t.getSchema();return i.isInstanceOf(e,"container-annotation")},r.getPropertyAnnotationsForSelection=function(t,e,i){i=i||{};var r,o,a,l;return e.isPropertySelection()?(o=e.getPath(),a=e.getStartOffset(),l=e.getEndOffset(),r=t.getIndex("annotations").get(o,a,l),i.type&&(r=n(r,s.filterByType(i.type))),r):[]},r.getContainerAnnotationsForSelection=function(t,e,i,s){if(!i)return[];var r;return r=s.type?t.getIndex("type").get(s.type):t.getIndex("container-annotation-anchors").byId,r=n(r,function(t){var i=t.getSelection();return e.overlaps(i)})},r.getAnnotationsForSelection=function(t,e,i,n){var s,o=r.isContainerAnnotation(t,i);if(o){var a=t.get(n);s=r.getContainerAnnotationsForSelection(t,e,a,{type:i})}else s=r.getPropertyAnnotationsForSelection(t,e,{type:i});return s},r.getTextForSelection=function(t,e){var i;if(!e||e.isNull())return"";if(e.isPropertySelection())return i=t.get(e.start.path),i.substring(e.start.offset,e.end.offset);if(e.isContainerSelection()){for(var n=[],s=t.get(e.containerId),r=e.range,o=s.getPathRange(r.start.path,r.end.path),a=0;a<o.length;a++){var l=o[a];i=t.get(l),1===o.length?n.push(i.substring(e.start.offset,e.end.offset)):0===a?n.push(i.substring(e.start.offset)):a===o.length-1?n.push(i.substring(0,e.end.offset)):n.push(i)}return n.join("\n")}},e.exports=r},{"./AnnotationIndex":83,"lodash/collection/filter":159}],132:[function(t,e,i){"use strict";function n(t,e){if(!e.selection)throw new Error("Argument 'selection' is mandatory.");if(!e.containerId)throw new Error("Argument 'containerId' is mandatory.");e.selection.isCollapsed()||(e=o(t,e));var i=e.selection.getRange(),n=t.get(i.start.path[0]),r=e.editingBehavior;if(n.isInstanceOf("text"))return s(t,e);if(r&&r.canBreak(n.type)){var a=r.getBreaker(n.type);return a.call(a,t,e)}return console.info("Breaking is not supported for node type %s.",n.type),e}function s(t,e){var i=e.selection,n=e.containerId;if(!i.isPropertySelection())throw new Error("Expected property selection.");var s,o=i.getRange(),l=o.start.path,u=o.start.offset,c=t.get(l[0]),h=c.content,p=t.get(n),d=p.getChildIndex(c),f=r(c.type),m=[f,"content"];return 0===u?(s=t.create({id:f,type:c.type,content:""}),p.show(f,d),i=t.createSelection({type:"property",path:l,startOffset:0})):(s=t.create({id:f,type:t.getSchema().getDefaultTextType(),content:h.substring(u)}),u<h.length&&(a.transferAnnotations(t,l,u,[f,"content"],0),t.update(l,{"delete":{start:u,end:h.length}})),p.show(f,d+1),i=t.createSelection({type:"property",path:m,startOffset:0})),e.selection=i,e.node=s,e}var r=t("../../util/uuid"),o=t("./deleteSelection"),a=t("../annotationHelpers");e.exports=n},{"../../util/uuid":416,"../annotationHelpers":118,"./deleteSelection":138}],133:[function(t,e,i){"use strict";function n(t,e){var i=e.selection;return i.isNull()?e.doc=null:i.isPropertySelection()||o(i.start.path,i.end.path)?e.doc=s(t,i):i.isContainerSelection()?e.doc=r(t,i):(console.error("Copy is not yet supported for selection type."),e.doc=null),e}function s(t,e){var i=t.newInstance(),n=e.start.path,s=e.start.offset,r=e.end.offset,o=t.get(n),u=i.get(c);u||(u=i.create({type:"container",id:c,nodes:[]})),i.create({type:t.schema.getDefaultTextType(),id:h,content:o.substring(s,r)}),u.show(h);var p=t.getIndex("annotations").get(n,s,r);return l(p,function(t){var e=a(t.toJSON());e.path=[h,"content"],e.startOffset=Math.max(s,t.startOffset)-s,e.endOffset=Math.min(r,t.endOffset)-s,i.create(e)}),i}function r(t,e){var i,n,s=t.newInstance(),r=t.getIndex("annotations"),o=t.get(e.containerId),l=s.create({type:"container",id:c,nodes:[]}),h={},p=o.getAddress(e.start.path),d=o.getAddress(e.end.path);for(i=p[0];i<=d[0];i++){n=o.getChildAt(i);var f=n.id;h[f]||(h[f]=s.create(n.toJSON()),l.show(f)),n.hasChildren();for(var m=o.getPathsForNode(n),g=0;g<m.length;g++)for(var b=r.get(m[g]),y=0;y<b.length;y++)s.create(a(b[y].toJSON()))}var v,_;n=o.getChildAt(p[0]);var x=o.getAddressesForNode(n);for(i=0;i<x.length;i++){if(!x[i].isBefore(p)){e.start.offset>0&&(_=o.getPathForAddress(x[i]),v=t.get(_),s.update(_,{"delete":{start:0,end:e.start.offset}}),u.deletedText(s,_,0,e.start.offset));break}_=o.getPathForAddress(x[i]),s.set(_,"")}for(n=o.getChildAt(d[0]),x=o.getAddressesForNode(n),i=x.length-1;i>=0;i--){if(_=o.getPathForAddress(x[i]),!x[i].isAfter(d)){v=t.get(_),e.end.offset<v.length&&(s.update(_,{"delete":{start:e.end.offset,end:v.length}}),u.deletedText(s,_,e.end.offset,v.length));break}s.set(_,"")}return s}var o=t("lodash/lang/isEqual"),a=t("lodash/lang/cloneDeep"),l=t("lodash/collection/each"),u=t("../annotationHelpers"),c="clipboard_content",h="clipboard_property";n.CLIPBOARD_CONTAINER_ID=c,n.CLIPBOARD_PROPERTY_ID=h,e.exports=n},{"../annotationHelpers":118,"lodash/collection/each":158,"lodash/lang/cloneDeep":268,"lodash/lang/isEqual":273}],134:[function(t,e,i){"use strict";function n(t,e){var i=e.selection,n=e.annotationType,l=e.annotationData,u=e.containerId;if(!i)throw new Error("selection is required.");if(!n)throw new Error("annotationType is required");if(i.isContainerSelection()&&!u)throw new Error("containerId must be provided for container selections");if(e.splitContainerSelections&&i.isContainerSelection())return s(t,e);var c={id:o(n),type:n};if(r(c,l),a.isContainerAnnotation(t,n))c.startPath=i.start.path,c.endPath=i.end.path,c.container=u;else{if(!i.isPropertySelection())throw new Error("Illegal state: can not apply ContainerSelection");c.path=i.getPath()}return c.startOffset=i.getStartOffset(),c.endOffset=i.getEndOffset(),e.result=t.create(c),e}function s(t,e){var i,n=e.selection,s=e.annotationType,a=e.annotationData;n.isPropertySelection()?i=[]:n.isContainerSelection()&&(i=n.splitIntoPropertySelections());for(var l=0;l<i.length;l++){var u={id:o(s),type:s};r(u,a),u.path=i[l].getPath(),u.startOffset=i[l].getStartOffset(),u.endOffset=i[l].getEndOffset(),t.create(u)}}var r=t("lodash/object/extend"),o=t("../../util/uuid"),a=t("../documentHelpers");e.exports=n},{"../../util/uuid":416,"../documentHelpers":131,"lodash/object/extend":282}],135:[function(t,e,i){"use strict";function n(t,e){var i=e.selection;if(!i)throw new Error("selection is required.");if(i.isContainerSelection()&&!e.containerId)throw new Error("containerId must be provided for container selections");var n=s.getAnnotationsForSelection(t,i,e.annotationType,e.containerId),r=n[0].id;return t["delete"](r),e.result=r,e}var s=t("../documentHelpers");e.exports=n},{"../documentHelpers":131}],136:[function(t,e,i){"use strict";var n=t("lodash/object/extend"),s=t("./merge"),r=t("./updateAnnotations"),o=function(t,e){var i,o,a=e.selection,l=e.direction,u=a.getRange();if(!a.isCollapsed())throw new Error('Selection must be collapsed for transformation "deleteCharacter"');var c=t.get(u.start.path);if(0===u.start.offset&&"left"===l||u.start.offset===c.length&&"right"===l){var h=s(t,n({},e,{selection:a,containerId:e.containerId,path:u.start.path,direction:l}));a=h.selection}else{i="left"===l?u.start.offset-1:u.start.offset,o=i+1;var p=t.update(u.start.path,{"delete":{start:i,end:o}});r(t,{op:p}),a=t.createSelection({type:"property",path:u.start.path,startOffset:i})}return e.selection=a,e};e.exports=o},{"./merge":143,"./updateAnnotations":148,"lodash/object/extend":282}],137:[function(t,e,i){"use strict";function n(t,e){if(!e.nodeId)throw new Error("Parameter `nodeId` is mandatory.");var i,n=e.nodeId,r=t.getIndex("annotations").get(n);for(i=0;i<r.length;i++)t["delete"](r[i].id);var o=t.getIndex("container-annotation-anchors").get(n);for(i=0;i<o.length;i++){var a=o[i],l=t.get(a.container);if(t.get(a.id)){var u=l.getAddress(a.path),c=u[0];if(a.isStart)if(c<l.getLength()-1){var h=l.getChildAt(c+1),p=l.getFirstAddress(h);t.set([a.id,"startPath"],l.getPath(p)),t.set([a.id,"startOffset"],0)}else t["delete"](a.id);else if(c>0){var d=l.getChildAt(c-1),f=l.getLastAddress(d),m=l.getPath(f),g=t.get(m).length;t.set([a.id,"endPath"],m),t.set([a.id,"endOffset"],g)}else t["delete"](a.id)}}return s(t.getIndex("type").get("container"),function(t){t.hide(n)}),t["delete"](n),e}var s=t("lodash/collection/each");e.exports=n},{"lodash/collection/each":158}],138:[function(t,e,i){"use strict";function n(t,e){var i=e.selection;return e=i.isCollapsed()?h(t,e):i.isPropertySelection()?s(t,e):r(t,e)}function s(t,e){var i=e.selection.getRange(),n=i.start.path,s=i.start.offset,r=i.end.offset,o=t.update(n,{"delete":{start:s,end:r}});return f(t,{op:o}),e.selection=t.createSelection({type:"property",path:n,startOffset:s}),e}function r(t,e){var i,n,s,r=e.selection,h=r.containerId,f=r.getRange(),m=a(t,r);e.selection=null;for(var g=t.get(h),b=g.getPosition(m[0].node.id),y=m.length-1;y>=0;y--)i=m[y],n=i.node,i.isFully?p(t,l({},e,{nodeId:n.id})):o(t,l({},e,{nodeSel:i}));if(m[0].isFully){e.selection=null;for(var v=1;v<m.length;v++)if(i=m[v],!i.isFully){e.selection=t.createSelection({type:"property",path:i.paths[0],startOffset:0});break}null===e.selection&&(s=t.getSchema().getDefaultTextType(),n={type:s,id:c(s),content:""},t.create(n),g.show(n.id,b),e.selection=t.createSelection({type:"property",path:[n.id,"content"],startOffset:0}))}else e.selection=t.createSelection({type:"property",path:f.start.path,startOffset:f.start.offset});if(m.length>1){var _=m[0],x=m[m.length-1];if(_.isFully||x.isFully);else{var C=u(x.paths),w=d(t,l({},e,{selection:e.selection,containerId:h,path:C,direction:"left"}));e.selection=w.selection}}return g=t.get(h),0===g.nodes.length&&(s=t.getSchema().getDefaultTextType(),n={type:s,id:c(s),content:""},t.create(n),g.show(n.id,0),e.selection=t.createSelection({type:"property",path:[n.id,"content"],startOffset:0})),e}function o(t,e){for(var i=e.nodeSel,n=i.paths,r=n.length,o=0;r>o;o++){var a=n[o],u=0,c=t.get(a).length;0===o&&(u=i.startOffset),o===r-1&&(c=i.endOffset),s(t,l({},e,{selection:t.createSelection({type:"property",path:a,startOffset:u,endOffset:c})}))}}function a(t,e){for(var i=[],n={},s=e.getRange(),r=t.get(e.containerId),o=r.getAddressRange(r.getAddress(s.start.path),r.getAddress(s.end.path)),a=0;a<o.length;a++){var l=o[a],u=r.getChildAt(l[0]);if(!u)throw new Error("Illegal state: expecting a component to have a proper root node id set.");var c,h=u.id;n[h]||(c={node:u,isFully:!0,addresses:[],paths:[]},n[h]=c,i.push(c)),c=n[h],c.addresses.push(l),c.paths.push(r.getPath(l))}var p=o[0],d=o[o.length-1],f=r.getPreviousAddress(p),m=r.getPreviousAddress(d),g=i[0],b=i[i.length-1],y=t.get(r.getPath(p)).length,v=t.get(r.getPath(d)).length;return(s.start.offset>0||f&&f[0]===p[0])&&(g.isFully=!1,g.startOffset=s.start.offset,1===i.length?g.endOffset=s.end.offset:g.endOffset=y),i.length>1&&(s.end.offset<v||m&&m[0]===d[0])&&(b.isFully=!1,b.startOffset=0,b.endOffset=s.end.offset),i}var l=t("lodash/object/extend"),u=t("lodash/array/last"),c=t("../../util/uuid"),h=t("./deleteCharacter"),p=t("./deleteNode"),d=t("./merge"),f=t("./updateAnnotations");e.exports=n},{"../../util/uuid":416,"./deleteCharacter":136,"./deleteNode":137,"./merge":143,"./updateAnnotations":148,"lodash/array/last":153,"lodash/object/extend":282}],139:[function(t,e,i){"use strict";function n(t,e){var i=e.selection;if(!i)throw new Error("selection is required.");if(!e.annotationType)throw new Error("annotationType is required");if(i.isContainerSelection()&&!e.containerId)throw new Error("containerId must be provided for container selections");var n=s.getAnnotationsForSelection(t,i,e.annotationType,e.containerId),r=n[0],o=r.getSelection(),a=o.expand(i);return r.updateRange(t,a),e.result=r,e}var s=t("../documentHelpers");e.exports=n},{"../documentHelpers":131}],140:[function(t,e,i){"use strict";function n(t,e){var i=e.selection;if(!i)throw new Error("selection is required.");if(!e.annotationType)throw new Error("annotationType is required");if(i.isContainerSelection()&&!e.containerId)throw new Error("containerId must be provided for container selections");var n=r.getAnnotationsForSelection(t,i,e.annotationType,e.containerId);return s(n,function(t){i=i.expand(t.getSelection())}),s(n,function(e){t["delete"](e.id)}),e.selection=i,o(t,e)}var s=t("lodash/collection/each"),r=t("../documentHelpers"),o=t("./createAnnotation");e.exports=n},{"../documentHelpers":131,"./createAnnotation":134,"lodash/collection/each":158}],141:[function(t,e,i){"use strict";function n(t,e){var i=e.selection,n=e.node;if(!e.containerId)throw new Error("containerId is mandatory");if(!e.selection)throw new Error("selection is mandatory");if(!e.node)throw new Error("node is mandatory");var o,a=e.containerId,l=t.get(a);i.isCollapsed()||(o=s(t,e),i=o.selection),o=r(t,e),i=o.selection,t.get(n.id)||(n=t.create(n)),n=t.get(n.id);var u=l.getAddress(i.start.path),c=u[0];l.show(n.id,c);var h=l.getFirstPath(n);return h&&(e.selection=t.createSelection({type:"property",path:h,startOffset:0})),e}var s=t("./deleteSelection"),r=t("./breakNode");e.exports=n},{"./breakNode":132,"./deleteSelection":138}],142:[function(t,e,i){"use strict";var n=t("./replaceText"),s=t("./updateAnnotations"),r=function(t,e){var i=e.selection,r=e.text;if(!i)throw new Error("Argument `selection` is mandatory for transformation `insertText`.");if(!r)throw new Error("Argument `text` is mandatory for transformation `insertText`.");if(!i.isPropertySelection()&&!i.isContainerSelection())throw new Error("Selection must be property or container selection.");if(!i.isCollapsed())return n(t,e);var o=i.getRange();void 0===t.get(o.start.path)&&t.set(o.start.path,"");var a=t.update(o.start.path,{insert:{offset:o.start.offset,value:r}});return s(t,{op:a}),e.selection=t.createSelection({type:"property",path:o.start.path,startOffset:o.start.offset+r.length}),e};e.exports=r},{"./replaceText":145,"./updateAnnotations":148}],143:[function(t,e,i){"use strict";function n(t,e,i){if(t){if(t.canMerge(e.type,i.type))return t.getMerger(e.type,i.type);if(e.isInstanceOf("text")&&t.canMerge("textish",i.type))return t.getMerger("textish",i.type);if(i.isInstanceOf("text")&&t.canMerge(e.type,"textish"))return t.getMerger(e.type,"textish")}return e.isInstanceOf("text")&&i.isInstanceOf("text")?l:(console.info("No merge behavior defined for %s <- %s",e.type,i.type),null)}var s=t("lodash/object/extend"),r=t("../annotationHelpers"),o=function(t,e){var i=e.containerId,n=e.path,r=e.direction;if(!i||!n||!r)throw new Error("Insufficient arguments! mandatory fields: `containerId`, `path`, `direction`");var o,l=t.get(i),u=l.getAddress(n);if("right"===r){var c=l.getNextAddress(u);c&&(o=a(t,s({},e,{containerId:i,firstAddress:u,secondAddress:c})),e.selection=o.selection)}else if("left"===r){var h=l.getPreviousAddress(u);h&&(o=a(t,s({},e,{containerId:i,firstAddress:h,secondAddress:u})),e.selection=o.selection)}return e},a=function(t,e){var i,r=t.get(e.containerId),o=e.firstAddress,a=e.secondAddress,l=r.getChildAt(o[0]),u=r.getChildAt(a[0]),c=e.editingBehavior;if(l===u){if(c&&c.canMergeComponents(l.type))return i=c.getComponentMerger(l.type),
i.call(this,t,s({},e,{node:l,firstAddress:o,secondAddress:a}))}else if(i=n(e.editingBehavior,l,u))return i.call(this,t,s({},e,{containerId:e.containerId,first:l,second:u}));return e},l=function(t,e){var i,n=e.containerId,s=e.first,o=e.second,a=t.get(n),l=s.getTextPath(),u=s.getText(),c=u.length,h=o.getTextPath(),p=o.getText();return 0===c?(a.hide(l[0]),t["delete"](l[0]),i=t.createSelection({type:"property",path:h,startOffset:0})):(t.update(l,{insert:{offset:c,value:p}}),r.transferAnnotations(t,h,0,l,c),a.hide(h[0]),t["delete"](h[0]),i=t.createSelection({type:"property",path:l,startOffset:c})),e.selection=i,e};e.exports=o},{"../annotationHelpers":118,"lodash/object/extend":282}],144:[function(t,e,i){"use strict";function n(t,e){var i,n=t.getSchema().getDefaultTextType(),s=e.text.split(/\s*\n\s*\n/),r=t.newInstance(),o=r.create({type:"container",id:d,nodes:[]});if(1===s.length)i=r.create({id:f,type:n,content:s[0]}),o.show(i.id);else for(var a=0;a<s.length;a++)i=r.create({id:l(n),type:n,content:s[a]}),o.show(i.id);return r}function s(t,e){var i=e.doc,n=e.selection,s=i.get(d).nodes,r=[s[0],"content"],o=i.get(r),c=i.getIndex("annotations").get(r),h=n.start.path,p=n.start.offset;return t.update(h,{insert:{offset:p,value:o}}),u.insertedText(t,n.start,o.length),n=t.createSelection({type:"property",path:n.start.path,startOffset:n.start.offset+o.length}),a(c,function(e){var i=e.toJSON();i.path=h.slice(0),i.startOffset+=p,i.endOffset+=p,t.get(i.id)&&(i.id=l(i.type)),t.create(i)}),e.selection=n,e}function r(t,e){var i,n=e.doc,s=e.containerId,r=e.selection,a=t.get(s),u=r.start.path,c=a.getAddress(u),h=a.getNextAddress(c);if(h&&h[0]===c[0]||t.get(u).length!==r.start.offset){var f=p(t,e);r=f.selection,i=c[0]+1}else i=c[0]+1;0>i&&console.error("Could not find insertion position in ContainerNode.");for(var m=n.get(d).nodes,g=n.getIndex("annotations"),b=[],y=0;y<m.length;y++){var v=m[y],_=n.get(v).toJSON();t.get(v)&&(_.id=l(_.type)),_=t.create(_),a.show(_.id,i++),b.push(_);for(var x=g.get(v),C=0;C<x.length;C++){var w=x[C].toJSON();_.id!==v&&(w.path[0]=_.id),t.get(w.id)&&(w.id=l(w.type)),t.create(w)}}if(0===b.length)return e;var S=a.getLastPath(o(b)),T=t.get(S).length;return r=t.createSelection({type:"property",path:S,startOffset:T}),e.selection=r,e}var o=t("lodash/array/last"),a=t("lodash/collection/each"),l=t("../../util/uuid"),u=t("../annotationHelpers"),c=t("./deleteSelection"),h=t("./insertText"),p=t("./breakNode"),d=t("./copySelection").CLIPBOARD_CONTAINER_ID,f=t("./copySelection").CLIPBOARD_PROPERTY_ID,m=function(t,e){if(e.text=e.text||"",e.selection.isNull())return console.error("Can not paste, without selection."),e;var i=!!e.containerId,o=e.doc;if(!o){if(!i)return h(t,e);e.doc=o=n(t,e)}if(!e.selection.isCollapsed()){var a=c(t,e);e.selection=a.selection}var l=o.get(d).nodes,u=t.getSchema();if(l.length>0){var p=o.get(l[0]);u.isInstanceOf(p.type,"text")&&(e=s(t,e),l.shift()),l.length>0&&(e=r(t,e))}return e};e.exports=m},{"../../util/uuid":416,"../annotationHelpers":118,"./breakNode":132,"./copySelection":133,"./deleteSelection":138,"./insertText":142,"lodash/array/last":153,"lodash/collection/each":158}],145:[function(t,e,i){"use strict";function n(t,e){return s(t,e)}function s(t,e){var i=o(t,r({},e,{direction:"right"})),n=i.selection,s=n.getRange(),l=e.text,u=t.update(s.start.path,{insert:{offset:s.start.offset,value:l}});return a(t,{op:u}),e.selection=t.createSelection({type:"property",path:s.start.path,startOffset:s.start.offset+l.length}),e}var r=t("lodash/object/extend"),o=t("./deleteSelection"),a=t("./updateAnnotations");e.exports=n},{"./deleteSelection":138,"./updateAnnotations":148,"lodash/object/extend":282}],146:[function(t,e,i){"use strict";function n(t,e){var i=e.selection;if(!i.isPropertySelection())return console.error("Selection must be a PropertySelection."),e;var n=i.getPath()[0],l=e.data,u=t.get(n),c=i.path;if(!u.isInstanceOf("text"))return console.warn("Trying to use switchTextType on a non text node. Skipping."),e;var h=s({id:r(l.type),type:l.type,content:u.content},l),p=[h.id,"content"];t.create(h),o.transferAnnotations(t,c,0,p,0);var d=t.get(e.containerId),f=d.getPosition(n);return f>=0&&(d.hide(n),d.show(h.id,f)),a(t,{nodeId:u.id}),e.selection=t.createSelection({type:"property",path:p,startOffset:i.startOffset,endOffset:i.endOffset}),e}var s=t("lodash/object/extend"),r=t("../../util/uuid"),o=t("../annotationHelpers"),a=t("./deleteNode");e.exports=n},{"../../util/uuid":416,"../annotationHelpers":118,"./deleteNode":137,"lodash/object/extend":282}],147:[function(t,e,i){"use strict";function n(t,e){var i=e.selection;if(!i)throw new Error("selection is required.");if(!e.annotationType)throw new Error("annotationType is required");if(i.isContainerSelection()&&!e.containerId)throw new Error("containerId must be provided for container selections");var n=s.getAnnotationsForSelection(t,i,e.annotationType,e.containerId),r=n[0],o=r.getSelection(),a=o.truncate(i);return r.updateRange(t,a),e.result=r,e}var s=t("../documentHelpers");e.exports=n},{"../documentHelpers":131}],148:[function(t,e,i){"use strict";function n(t,e){var i=e.op;if(!i.isUpdate())throw new Error("Only text updates are supported.");var n=i.diff;return n.isInsert()?s(t,e):n.isDelete()?r(t,e):e}function s(t,e){var i=e.op,n=i.diff;return o.insertedText(t,new a(i.getPath(),n.pos),n.getLength(),e.ignoredAnnotations),e}function r(t,e){var i=e.op,n=i.diff;return o.deletedText(t,i.getPath(),n.pos,n.pos+n.getLength(),e.replaceTextSupport),e}var o=t("../annotationHelpers"),a=t("../Coordinate");e.exports=n},{"../Coordinate":88,"../annotationHelpers":118}],149:[function(t,e,i){!function(t,i){"object"==typeof e&&"object"==typeof e.exports?e.exports=t.document?i(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return i(t)}:i(t)}("undefined"!=typeof window?window:this,function(t,e){function i(t){var e="length"in t&&t.length,i=Z.type(t);return"function"===i||Z.isWindow(t)?!1:1===t.nodeType&&e?!0:"array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t}function n(t,e,i){if(Z.isFunction(e))return Z.grep(t,function(t,n){return!!e.call(t,n,t)!==i});if(e.nodeType)return Z.grep(t,function(t){return t===e!==i});if("string"==typeof e){if(at.test(e))return Z.filter(e,t,i);e=Z.filter(e,t)}return Z.grep(t,function(t){return G.call(e,t)>=0!==i})}function s(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function r(t){var e=ft[t]={};return Z.each(t.match(dt)||[],function(t,i){e[i]=!0}),e}function o(){Q.removeEventListener("DOMContentLoaded",o,!1),t.removeEventListener("load",o,!1),Z.ready()}function a(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=Z.expando+a.uid++}function l(t,e,i){var n;if(void 0===i&&1===t.nodeType)if(n="data-"+e.replace(_t,"-$1").toLowerCase(),i=t.getAttribute(n),"string"==typeof i){try{i="true"===i?!0:"false"===i?!1:"null"===i?null:+i+""===i?+i:vt.test(i)?Z.parseJSON(i):i}catch(s){}yt.set(t,e,i)}else i=void 0;return i}function u(){return!0}function c(){return!1}function h(){try{return Q.activeElement}catch(t){}}function p(t,e){return Z.nodeName(t,"table")&&Z.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function d(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function f(t){var e=jt.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function m(t,e){for(var i=0,n=t.length;n>i;i++)bt.set(t[i],"globalEval",!e||bt.get(e[i],"globalEval"))}function g(t,e){var i,n,s,r,o,a,l,u;if(1===e.nodeType){if(bt.hasData(t)&&(r=bt.access(t),o=bt.set(e,r),u=r.events)){delete o.handle,o.events={};for(s in u)for(i=0,n=u[s].length;n>i;i++)Z.event.add(e,s,u[s][i])}yt.hasData(t)&&(a=yt.access(t),l=Z.extend({},a),yt.set(e,l))}}function b(t,e){var i=t.getElementsByTagName?t.getElementsByTagName(e||"*"):t.querySelectorAll?t.querySelectorAll(e||"*"):[];return void 0===e||e&&Z.nodeName(t,e)?Z.merge([t],i):i}function y(t,e){var i=e.nodeName.toLowerCase();"input"===i&&St.test(t.type)?e.checked=t.checked:("input"===i||"textarea"===i)&&(e.defaultValue=t.defaultValue)}function v(e,i){var n,s=Z(i.createElement(e)).appendTo(i.body),r=t.getDefaultComputedStyle&&(n=t.getDefaultComputedStyle(s[0]))?n.display:Z.css(s[0],"display");return s.detach(),r}function _(t){var e=Q,i=qt[t];return i||(i=v(t,e),"none"!==i&&i||(Bt=(Bt||Z("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement),e=Bt[0].contentDocument,e.write(),e.close(),i=v(t,e),Bt.detach()),qt[t]=i),i}function x(t,e,i){var n,s,r,o,a=t.style;return i=i||$t(t),i&&(o=i.getPropertyValue(e)||i[e]),i&&(""!==o||Z.contains(t.ownerDocument,t)||(o=Z.style(t,e)),Ht.test(o)&&Ut.test(e)&&(n=a.width,s=a.minWidth,r=a.maxWidth,a.minWidth=a.maxWidth=a.width=o,o=i.width,a.width=n,a.minWidth=s,a.maxWidth=r)),void 0!==o?o+"":o}function C(t,e){return{get:function(){return t()?void delete this.get:(this.get=e).apply(this,arguments)}}}function w(t,e){if(e in t)return e;for(var i=e[0].toUpperCase()+e.slice(1),n=e,s=Kt.length;s--;)if(e=Kt[s]+i,e in t)return e;return n}function S(t,e,i){var n=Vt.exec(e);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):e}function T(t,e,i,n,s){for(var r=i===(n?"border":"content")?4:"width"===e?1:0,o=0;4>r;r+=2)"margin"===i&&(o+=Z.css(t,i+Ct[r],!0,s)),n?("content"===i&&(o-=Z.css(t,"padding"+Ct[r],!0,s)),"margin"!==i&&(o-=Z.css(t,"border"+Ct[r]+"Width",!0,s))):(o+=Z.css(t,"padding"+Ct[r],!0,s),"padding"!==i&&(o+=Z.css(t,"border"+Ct[r]+"Width",!0,s)));return o}function E(t,e,i){var n=!0,s="width"===e?t.offsetWidth:t.offsetHeight,r=$t(t),o="border-box"===Z.css(t,"boxSizing",!1,r);if(0>=s||null==s){if(s=x(t,e,r),(0>s||null==s)&&(s=t.style[e]),Ht.test(s))return s;n=o&&(J.boxSizingReliable()||s===t.style[e]),s=parseFloat(s)||0}return s+T(t,e,i||(o?"border":"content"),n,r)+"px"}function I(t,e){for(var i,n,s,r=[],o=0,a=t.length;a>o;o++)n=t[o],n.style&&(r[o]=bt.get(n,"olddisplay"),i=n.style.display,e?(r[o]||"none"!==i||(n.style.display=""),""===n.style.display&&wt(n)&&(r[o]=bt.access(n,"olddisplay",_(n.nodeName)))):(s=wt(n),"none"===i&&s||bt.set(n,"olddisplay",s?i:Z.css(n,"display"))));for(o=0;a>o;o++)n=t[o],n.style&&(e&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=e?r[o]||"":"none"));return t}function A(t,e,i,n,s){return new A.prototype.init(t,e,i,n,s)}function O(){return setTimeout(function(){Jt=void 0}),Jt=Z.now()}function N(t,e){var i,n=0,s={height:t};for(e=e?1:0;4>n;n+=2-e)i=Ct[n],s["margin"+i]=s["padding"+i]=t;return e&&(s.opacity=s.width=t),s}function k(t,e,i){for(var n,s=(ie[e]||[]).concat(ie["*"]),r=0,o=s.length;o>r;r++)if(n=s[r].call(i,e,t))return n}function P(t,e,i){var n,s,r,o,a,l,u,c,h=this,p={},d=t.style,f=t.nodeType&&wt(t),m=bt.get(t,"fxshow");i.queue||(a=Z._queueHooks(t,"fx"),null==a.unqueued&&(a.unqueued=0,l=a.empty.fire,a.empty.fire=function(){a.unqueued||l()}),a.unqueued++,h.always(function(){h.always(function(){a.unqueued--,Z.queue(t,"fx").length||a.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(i.overflow=[d.overflow,d.overflowX,d.overflowY],u=Z.css(t,"display"),c="none"===u?bt.get(t,"olddisplay")||_(t.nodeName):u,"inline"===c&&"none"===Z.css(t,"float")&&(d.display="inline-block")),i.overflow&&(d.overflow="hidden",h.always(function(){d.overflow=i.overflow[0],d.overflowX=i.overflow[1],d.overflowY=i.overflow[2]}));for(n in e)if(s=e[n],Yt.exec(s)){if(delete e[n],r=r||"toggle"===s,s===(f?"hide":"show")){if("show"!==s||!m||void 0===m[n])continue;f=!0}p[n]=m&&m[n]||Z.style(t,n)}else u=void 0;if(Z.isEmptyObject(p))"inline"===("none"===u?_(t.nodeName):u)&&(d.display=u);else{m?"hidden"in m&&(f=m.hidden):m=bt.access(t,"fxshow",{}),r&&(m.hidden=!f),f?Z(t).show():h.done(function(){Z(t).hide()}),h.done(function(){var e;bt.remove(t,"fxshow");for(e in p)Z.style(t,e,p[e])});for(n in p)o=k(f?m[n]:0,n,h),n in m||(m[n]=o.start,f&&(o.end=o.start,o.start="width"===n||"height"===n?1:0))}}function D(t,e){var i,n,s,r,o;for(i in t)if(n=Z.camelCase(i),s=e[n],r=t[i],Z.isArray(r)&&(s=r[1],r=t[i]=r[0]),i!==n&&(t[n]=r,delete t[i]),o=Z.cssHooks[n],o&&"expand"in o){r=o.expand(r),delete t[n];for(i in r)i in t||(t[i]=r[i],e[i]=s)}else e[n]=s}function L(t,e,i){var n,s,r=0,o=ee.length,a=Z.Deferred().always(function(){delete l.elem}),l=function(){if(s)return!1;for(var e=Jt||O(),i=Math.max(0,u.startTime+u.duration-e),n=i/u.duration||0,r=1-n,o=0,l=u.tweens.length;l>o;o++)u.tweens[o].run(r);return a.notifyWith(t,[u,r,i]),1>r&&l?i:(a.resolveWith(t,[u]),!1)},u=a.promise({elem:t,props:Z.extend({},e),opts:Z.extend(!0,{specialEasing:{}},i),originalProperties:e,originalOptions:i,startTime:Jt||O(),duration:i.duration,tweens:[],createTween:function(e,i){var n=Z.Tween(t,u.opts,e,i,u.opts.specialEasing[e]||u.opts.easing);return u.tweens.push(n),n},stop:function(e){var i=0,n=e?u.tweens.length:0;if(s)return this;for(s=!0;n>i;i++)u.tweens[i].run(1);return e?a.resolveWith(t,[u,e]):a.rejectWith(t,[u,e]),this}}),c=u.props;for(D(c,u.opts.specialEasing);o>r;r++)if(n=ee[r].call(u,t,c,u.opts))return n;return Z.map(c,k,u),Z.isFunction(u.opts.start)&&u.opts.start.call(t,u),Z.fx.timer(Z.extend(l,{elem:t,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function R(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,s=0,r=e.toLowerCase().match(dt)||[];if(Z.isFunction(i))for(;n=r[s++];)"+"===n[0]?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function j(t,e,i,n){function s(a){var l;return r[a]=!0,Z.each(t[a]||[],function(t,a){var u=a(e,i,n);return"string"!=typeof u||o||r[u]?o?!(l=u):void 0:(e.dataTypes.unshift(u),s(u),!1)}),l}var r={},o=t===ve;return s(e.dataTypes[0])||!r["*"]&&s("*")}function M(t,e){var i,n,s=Z.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((s[i]?t:n||(n={}))[i]=e[i]);return n&&Z.extend(!0,t,n),t}function F(t,e,i){for(var n,s,r,o,a=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=t.mimeType||e.getResponseHeader("Content-Type"));if(n)for(s in a)if(a[s]&&a[s].test(n)){l.unshift(s);break}if(l[0]in i)r=l[0];else{for(s in i){if(!l[0]||t.converters[s+" "+l[0]]){r=s;break}o||(o=s)}r=r||o}return r?(r!==l[0]&&l.unshift(r),i[r]):void 0}function B(t,e,i,n){var s,r,o,a,l,u={},c=t.dataTypes.slice();if(c[1])for(o in t.converters)u[o.toLowerCase()]=t.converters[o];for(r=c.shift();r;)if(t.responseFields[r]&&(i[t.responseFields[r]]=e),!l&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=r,r=c.shift())if("*"===r)r=l;else if("*"!==l&&l!==r){if(o=u[l+" "+r]||u["* "+r],!o)for(s in u)if(a=s.split(" "),a[1]===r&&(o=u[l+" "+a[0]]||u["* "+a[0]])){o===!0?o=u[s]:u[s]!==!0&&(r=a[0],c.unshift(a[1]));break}if(o!==!0)if(o&&t["throws"])e=o(e);else try{e=o(e)}catch(h){return{state:"parsererror",error:o?h:"No conversion from "+l+" to "+r}}}return{state:"success",data:e}}function q(t,e,i,n){var s;if(Z.isArray(e))Z.each(e,function(e,s){i||Se.test(t)?n(t,s):q(t+"["+("object"==typeof s?e:"")+"]",s,i,n)});else if(i||"object"!==Z.type(e))n(t,e);else for(s in e)q(t+"["+s+"]",e[s],i,n)}function U(t){return Z.isWindow(t)?t:9===t.nodeType&&t.defaultView}var H=[],$=H.slice,z=H.concat,V=H.push,G=H.indexOf,W={},X=W.toString,K=W.hasOwnProperty,J={},Q=t.document,Y="2.1.4",Z=function(t,e){return new Z.fn.init(t,e)},tt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,et=/^-ms-/,it=/-([\da-z])/gi,nt=function(t,e){return e.toUpperCase()};Z.fn=Z.prototype={jquery:Y,constructor:Z,selector:"",length:0,toArray:function(){return $.call(this)},get:function(t){return null!=t?0>t?this[t+this.length]:this[t]:$.call(this)},pushStack:function(t){var e=Z.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t,e){return Z.each(this,t,e)},map:function(t){return this.pushStack(Z.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack($.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(0>t?e:0);return this.pushStack(i>=0&&e>i?[this[i]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:V,sort:H.sort,splice:H.splice},Z.extend=Z.fn.extend=function(){var t,e,i,n,s,r,o=arguments[0]||{},a=1,l=arguments.length,u=!1;for("boolean"==typeof o&&(u=o,o=arguments[a]||{},a++),"object"==typeof o||Z.isFunction(o)||(o={}),a===l&&(o=this,a--);l>a;a++)if(null!=(t=arguments[a]))for(e in t)i=o[e],n=t[e],o!==n&&(u&&n&&(Z.isPlainObject(n)||(s=Z.isArray(n)))?(s?(s=!1,r=i&&Z.isArray(i)?i:[]):r=i&&Z.isPlainObject(i)?i:{},o[e]=Z.extend(u,r,n)):void 0!==n&&(o[e]=n));return o},Z.extend({expando:"jQuery"+(Y+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===Z.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){return!Z.isArray(t)&&t-parseFloat(t)+1>=0},isPlainObject:function(t){return"object"!==Z.type(t)||t.nodeType||Z.isWindow(t)?!1:t.constructor&&!K.call(t.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?W[X.call(t)]||"object":typeof t},globalEval:function(t){var e,i=eval;t=Z.trim(t),t&&(1===t.indexOf("use strict")?(e=Q.createElement("script"),e.text=t,Q.head.appendChild(e).parentNode.removeChild(e)):i(t))},camelCase:function(t){return t.replace(et,"ms-").replace(it,nt)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e,n){var s,r=0,o=t.length,a=i(t);if(n){if(a)for(;o>r&&(s=e.apply(t[r],n),s!==!1);r++);else for(r in t)if(s=e.apply(t[r],n),s===!1)break}else if(a)for(;o>r&&(s=e.call(t[r],r,t[r]),s!==!1);r++);else for(r in t)if(s=e.call(t[r],r,t[r]),s===!1)break;return t},trim:function(t){return null==t?"":(t+"").replace(tt,"")},makeArray:function(t,e){var n=e||[];return null!=t&&(i(Object(t))?Z.merge(n,"string"==typeof t?[t]:t):V.call(n,t)),n},inArray:function(t,e,i){return null==e?-1:G.call(e,t,i)},merge:function(t,e){for(var i=+e.length,n=0,s=t.length;i>n;n++)t[s++]=e[n];return t.length=s,t},grep:function(t,e,i){for(var n,s=[],r=0,o=t.length,a=!i;o>r;r++)n=!e(t[r],r),n!==a&&s.push(t[r]);return s},map:function(t,e,n){var s,r=0,o=t.length,a=i(t),l=[];if(a)for(;o>r;r++)s=e(t[r],r,n),null!=s&&l.push(s);else for(r in t)s=e(t[r],r,n),null!=s&&l.push(s);return z.apply([],l)},guid:1,proxy:function(t,e){var i,n,s;return"string"==typeof e&&(i=t[e],e=t,t=i),Z.isFunction(t)?(n=$.call(arguments,2),s=function(){return t.apply(e||this,n.concat($.call(arguments)))},s.guid=t.guid=t.guid||Z.guid++,s):void 0},now:Date.now,support:J}),Z.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){W["[object "+e+"]"]=e.toLowerCase()});var st=function(t){function e(t,e,i,n){var s,r,o,a,l,u,h,d,f,m;if((e?e.ownerDocument||e:q)!==P&&k(e),e=e||P,i=i||[],a=e.nodeType,"string"!=typeof t||!t||1!==a&&9!==a&&11!==a)return i;if(!n&&L){if(11!==a&&(s=yt.exec(t)))if(o=s[1]){if(9===a){if(r=e.getElementById(o),!r||!r.parentNode)return i;if(r.id===o)return i.push(r),i}else if(e.ownerDocument&&(r=e.ownerDocument.getElementById(o))&&F(e,r)&&r.id===o)return i.push(r),i}else{if(s[2])return Y.apply(i,e.getElementsByTagName(t)),i;if((o=s[3])&&x.getElementsByClassName)return Y.apply(i,e.getElementsByClassName(o)),i}if(x.qsa&&(!R||!R.test(t))){if(d=h=B,f=e,m=1!==a&&t,1===a&&"object"!==e.nodeName.toLowerCase()){for(u=T(t),(h=e.getAttribute("id"))?d=h.replace(_t,"\\$&"):e.setAttribute("id",d),d="[id='"+d+"'] ",l=u.length;l--;)u[l]=d+p(u[l]);f=vt.test(t)&&c(e.parentNode)||e,m=u.join(",")}if(m)try{return Y.apply(i,f.querySelectorAll(m)),i}catch(g){}finally{h||e.removeAttribute("id")}}}return I(t.replace(lt,"$1"),e,i,n)}function i(){function t(i,n){return e.push(i+" ")>C.cacheLength&&delete t[e.shift()],t[i+" "]=n}var e=[];return t}function n(t){return t[B]=!0,t}function s(t){var e=P.createElement("div");try{return!!t(e)}catch(i){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function r(t,e){for(var i=t.split("|"),n=t.length;n--;)C.attrHandle[i[n]]=e}function o(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||W)-(~t.sourceIndex||W);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function a(t){return function(e){var i=e.nodeName.toLowerCase();return"input"===i&&e.type===t}}function l(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function u(t){return n(function(e){return e=+e,n(function(i,n){for(var s,r=t([],i.length,e),o=r.length;o--;)i[s=r[o]]&&(i[s]=!(n[s]=i[s]))})})}function c(t){return t&&"undefined"!=typeof t.getElementsByTagName&&t}function h(){}function p(t){for(var e=0,i=t.length,n="";i>e;e++)n+=t[e].value;return n}function d(t,e,i){var n=e.dir,s=i&&"parentNode"===n,r=H++;return e.first?function(e,i,r){for(;e=e[n];)if(1===e.nodeType||s)return t(e,i,r)}:function(e,i,o){var a,l,u=[U,r];if(o){for(;e=e[n];)if((1===e.nodeType||s)&&t(e,i,o))return!0}else for(;e=e[n];)if(1===e.nodeType||s){if(l=e[B]||(e[B]={}),(a=l[n])&&a[0]===U&&a[1]===r)return u[2]=a[2];if(l[n]=u,u[2]=t(e,i,o))return!0}}}function f(t){return t.length>1?function(e,i,n){for(var s=t.length;s--;)if(!t[s](e,i,n))return!1;return!0}:t[0]}function m(t,i,n){for(var s=0,r=i.length;r>s;s++)e(t,i[s],n);return n}function g(t,e,i,n,s){for(var r,o=[],a=0,l=t.length,u=null!=e;l>a;a++)(r=t[a])&&(!i||i(r,n,s))&&(o.push(r),u&&e.push(a));return o}function b(t,e,i,s,r,o){return s&&!s[B]&&(s=b(s)),r&&!r[B]&&(r=b(r,o)),n(function(n,o,a,l){var u,c,h,p=[],d=[],f=o.length,b=n||m(e||"*",a.nodeType?[a]:a,[]),y=!t||!n&&e?b:g(b,p,t,a,l),v=i?r||(n?t:f||s)?[]:o:y;if(i&&i(y,v,a,l),s)for(u=g(v,d),s(u,[],a,l),c=u.length;c--;)(h=u[c])&&(v[d[c]]=!(y[d[c]]=h));if(n){if(r||t){if(r){for(u=[],c=v.length;c--;)(h=v[c])&&u.push(y[c]=h);r(null,v=[],u,l)}for(c=v.length;c--;)(h=v[c])&&(u=r?tt(n,h):p[c])>-1&&(n[u]=!(o[u]=h))}}else v=g(v===o?v.splice(f,v.length):v),r?r(null,o,v,l):Y.apply(o,v)})}function y(t){for(var e,i,n,s=t.length,r=C.relative[t[0].type],o=r||C.relative[" "],a=r?1:0,l=d(function(t){return t===e},o,!0),u=d(function(t){return tt(e,t)>-1},o,!0),c=[function(t,i,n){var s=!r&&(n||i!==A)||((e=i).nodeType?l(t,i,n):u(t,i,n));return e=null,s}];s>a;a++)if(i=C.relative[t[a].type])c=[d(f(c),i)];else{if(i=C.filter[t[a].type].apply(null,t[a].matches),i[B]){for(n=++a;s>n&&!C.relative[t[n].type];n++);return b(a>1&&f(c),a>1&&p(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(lt,"$1"),i,n>a&&y(t.slice(a,n)),s>n&&y(t=t.slice(n)),s>n&&p(t))}c.push(i)}return f(c)}function v(t,i){var s=i.length>0,r=t.length>0,o=function(n,o,a,l,u){var c,h,p,d=0,f="0",m=n&&[],b=[],y=A,v=n||r&&C.find.TAG("*",u),_=U+=null==y?1:Math.random()||.1,x=v.length;for(u&&(A=o!==P&&o);f!==x&&null!=(c=v[f]);f++){if(r&&c){for(h=0;p=t[h++];)if(p(c,o,a)){l.push(c);break}u&&(U=_)}s&&((c=!p&&c)&&d--,n&&m.push(c))}if(d+=f,s&&f!==d){for(h=0;p=i[h++];)p(m,b,o,a);if(n){if(d>0)for(;f--;)m[f]||b[f]||(b[f]=J.call(l));b=g(b)}Y.apply(l,b),u&&!n&&b.length>0&&d+i.length>1&&e.uniqueSort(l)}return u&&(U=_,A=y),m};return s?n(o):o}var _,x,C,w,S,T,E,I,A,O,N,k,P,D,L,R,j,M,F,B="sizzle"+1*new Date,q=t.document,U=0,H=0,$=i(),z=i(),V=i(),G=function(t,e){return t===e&&(N=!0),0},W=1<<31,X={}.hasOwnProperty,K=[],J=K.pop,Q=K.push,Y=K.push,Z=K.slice,tt=function(t,e){for(var i=0,n=t.length;n>i;i++)if(t[i]===e)return i;return-1},et="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",it="[\\x20\\t\\r\\n\\f]",nt="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",st=nt.replace("w","w#"),rt="\\["+it+"*("+nt+")(?:"+it+"*([*^$|!~]?=)"+it+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+st+"))|)"+it+"*\\]",ot=":("+nt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+rt+")*)|.*)\\)|)",at=new RegExp(it+"+","g"),lt=new RegExp("^"+it+"+|((?:^|[^\\\\])(?:\\\\.)*)"+it+"+$","g"),ut=new RegExp("^"+it+"*,"+it+"*"),ct=new RegExp("^"+it+"*([>+~]|"+it+")"+it+"*"),ht=new RegExp("="+it+"*([^\\]'\"]*?)"+it+"*\\]","g"),pt=new RegExp(ot),dt=new RegExp("^"+st+"$"),ft={ID:new RegExp("^#("+nt+")"),CLASS:new RegExp("^\\.("+nt+")"),TAG:new RegExp("^("+nt.replace("w","w*")+")"),ATTR:new RegExp("^"+rt),PSEUDO:new RegExp("^"+ot),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+it+"*(even|odd|(([+-]|)(\\d*)n|)"+it+"*(?:([+-]|)"+it+"*(\\d+)|))"+it+"*\\)|)","i"),bool:new RegExp("^(?:"+et+")$","i"),needsContext:new RegExp("^"+it+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+it+"*((?:-\\d)?\\d*)"+it+"*\\)|)(?=[^-]|$)","i")},mt=/^(?:input|select|textarea|button)$/i,gt=/^h\d$/i,bt=/^[^{]+\{\s*\[native \w/,yt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,vt=/[+~]/,_t=/'|\\/g,xt=new RegExp("\\\\([\\da-f]{1,6}"+it+"?|("+it+")|.)","ig"),Ct=function(t,e,i){var n="0x"+e-65536;return n!==n||i?e:0>n?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},wt=function(){k()};try{Y.apply(K=Z.call(q.childNodes),q.childNodes),K[q.childNodes.length].nodeType}catch(St){Y={apply:K.length?function(t,e){Q.apply(t,Z.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}x=e.support={},S=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return e?"HTML"!==e.nodeName:!1},k=e.setDocument=function(t){var e,i,n=t?t.ownerDocument||t:q;return n!==P&&9===n.nodeType&&n.documentElement?(P=n,D=n.documentElement,i=n.defaultView,i&&i!==i.top&&(i.addEventListener?i.addEventListener("unload",wt,!1):i.attachEvent&&i.attachEvent("onunload",wt)),L=!S(n),x.attributes=s(function(t){return t.className="i",!t.getAttribute("className")}),x.getElementsByTagName=s(function(t){return t.appendChild(n.createComment("")),!t.getElementsByTagName("*").length}),x.getElementsByClassName=bt.test(n.getElementsByClassName),x.getById=s(function(t){return D.appendChild(t).id=B,!n.getElementsByName||!n.getElementsByName(B).length}),x.getById?(C.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&L){var i=e.getElementById(t);return i&&i.parentNode?[i]:[]}},C.filter.ID=function(t){var e=t.replace(xt,Ct);return function(t){return t.getAttribute("id")===e}}):(delete C.find.ID,C.filter.ID=function(t){var e=t.replace(xt,Ct);return function(t){var i="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}}),C.find.TAG=x.getElementsByTagName?function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t):x.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],s=0,r=e.getElementsByTagName(t);if("*"===t){for(;i=r[s++];)1===i.nodeType&&n.push(i);return n}return r},C.find.CLASS=x.getElementsByClassName&&function(t,e){return L?e.getElementsByClassName(t):void 0},j=[],R=[],(x.qsa=bt.test(n.querySelectorAll))&&(s(function(t){D.appendChild(t).innerHTML="<a id='"+B+"'></a><select id='"+B+"-\f]' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&R.push("[*^$]="+it+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||R.push("\\["+it+"*(?:value|"+et+")"),t.querySelectorAll("[id~="+B+"-]").length||R.push("~="),t.querySelectorAll(":checked").length||R.push(":checked"),t.querySelectorAll("a#"+B+"+*").length||R.push(".#.+[+~]")}),s(function(t){var e=n.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&R.push("name"+it+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||R.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),R.push(",.*:")})),(x.matchesSelector=bt.test(M=D.matches||D.webkitMatchesSelector||D.mozMatchesSelector||D.oMatchesSelector||D.msMatchesSelector))&&s(function(t){x.disconnectedMatch=M.call(t,"div"),M.call(t,"[s!='']:x"),j.push("!=",ot)}),R=R.length&&new RegExp(R.join("|")),j=j.length&&new RegExp(j.join("|")),e=bt.test(D.compareDocumentPosition),F=e||bt.test(D.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},G=e?function(t,e){if(t===e)return N=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i?i:(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&i||!x.sortDetached&&e.compareDocumentPosition(t)===i?t===n||t.ownerDocument===q&&F(q,t)?-1:e===n||e.ownerDocument===q&&F(q,e)?1:O?tt(O,t)-tt(O,e):0:4&i?-1:1)}:function(t,e){if(t===e)return N=!0,0;var i,s=0,r=t.parentNode,a=e.parentNode,l=[t],u=[e];if(!r||!a)return t===n?-1:e===n?1:r?-1:a?1:O?tt(O,t)-tt(O,e):0;if(r===a)return o(t,e);for(i=t;i=i.parentNode;)l.unshift(i);for(i=e;i=i.parentNode;)u.unshift(i);for(;l[s]===u[s];)s++;return s?o(l[s],u[s]):l[s]===q?-1:u[s]===q?1:0},n):P},e.matches=function(t,i){return e(t,null,null,i)},e.matchesSelector=function(t,i){if((t.ownerDocument||t)!==P&&k(t),i=i.replace(ht,"='$1']"),x.matchesSelector&&L&&(!j||!j.test(i))&&(!R||!R.test(i)))try{var n=M.call(t,i);if(n||x.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(s){}return e(i,P,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==P&&k(t),F(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==P&&k(t);var i=C.attrHandle[e.toLowerCase()],n=i&&X.call(C.attrHandle,e.toLowerCase())?i(t,e,!L):void 0;return void 0!==n?n:x.attributes||!L?t.getAttribute(e):(n=t.getAttributeNode(e))&&n.specified?n.value:null},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,i=[],n=0,s=0;if(N=!x.detectDuplicates,O=!x.sortStable&&t.slice(0),t.sort(G),N){for(;e=t[s++];)e===t[s]&&(n=i.push(s));for(;n--;)t.splice(i[n],1)}return O=null,t},w=e.getText=function(t){var e,i="",n=0,s=t.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=w(t)}else if(3===s||4===s)return t.nodeValue}else for(;e=t[n++];)i+=w(e);return i},C=e.selectors={cacheLength:50,createPseudo:n,match:ft,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(xt,Ct),t[3]=(t[3]||t[4]||t[5]||"").replace(xt,Ct),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return ft.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&pt.test(i)&&(e=T(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(xt,Ct).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=$[t+" "];return e||(e=new RegExp("(^|"+it+")"+t+"("+it+"|$)"))&&$(t,function(t){return e.test("string"==typeof t.className&&t.className||"undefined"!=typeof t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,i,n){return function(s){var r=e.attr(s,t);return null==r?"!="===i:i?(r+="","="===i?r===n:"!="===i?r!==n:"^="===i?n&&0===r.indexOf(n):"*="===i?n&&r.indexOf(n)>-1:"$="===i?n&&r.slice(-n.length)===n:"~="===i?(" "+r.replace(at," ")+" ").indexOf(n)>-1:"|="===i?r===n||r.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(t,e,i,n,s){var r="nth"!==t.slice(0,3),o="last"!==t.slice(-4),a="of-type"===e;return 1===n&&0===s?function(t){return!!t.parentNode}:function(e,i,l){var u,c,h,p,d,f,m=r!==o?"nextSibling":"previousSibling",g=e.parentNode,b=a&&e.nodeName.toLowerCase(),y=!l&&!a;if(g){if(r){for(;m;){for(h=e;h=h[m];)if(a?h.nodeName.toLowerCase()===b:1===h.nodeType)return!1;f=m="only"===t&&!f&&"nextSibling";
}return!0}if(f=[o?g.firstChild:g.lastChild],o&&y){for(c=g[B]||(g[B]={}),u=c[t]||[],d=u[0]===U&&u[1],p=u[0]===U&&u[2],h=d&&g.childNodes[d];h=++d&&h&&h[m]||(p=d=0)||f.pop();)if(1===h.nodeType&&++p&&h===e){c[t]=[U,d,p];break}}else if(y&&(u=(e[B]||(e[B]={}))[t])&&u[0]===U)p=u[1];else for(;(h=++d&&h&&h[m]||(p=d=0)||f.pop())&&((a?h.nodeName.toLowerCase()!==b:1!==h.nodeType)||!++p||(y&&((h[B]||(h[B]={}))[t]=[U,p]),h!==e)););return p-=s,p===n||p%n===0&&p/n>=0}}},PSEUDO:function(t,i){var s,r=C.pseudos[t]||C.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return r[B]?r(i):r.length>1?(s=[t,t,"",i],C.setFilters.hasOwnProperty(t.toLowerCase())?n(function(t,e){for(var n,s=r(t,i),o=s.length;o--;)n=tt(t,s[o]),t[n]=!(e[n]=s[o])}):function(t){return r(t,0,s)}):r}},pseudos:{not:n(function(t){var e=[],i=[],s=E(t.replace(lt,"$1"));return s[B]?n(function(t,e,i,n){for(var r,o=s(t,null,n,[]),a=t.length;a--;)(r=o[a])&&(t[a]=!(e[a]=r))}):function(t,n,r){return e[0]=t,s(e,null,r,i),e[0]=null,!i.pop()}}),has:n(function(t){return function(i){return e(t,i).length>0}}),contains:n(function(t){return t=t.replace(xt,Ct),function(e){return(e.textContent||e.innerText||w(e)).indexOf(t)>-1}}),lang:n(function(t){return dt.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(xt,Ct).toLowerCase(),function(e){var i;do if(i=L?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return i=i.toLowerCase(),i===t||0===i.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===D},focus:function(t){return t===P.activeElement&&(!P.hasFocus||P.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return t.disabled===!1},disabled:function(t){return t.disabled===!0},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!C.pseudos.empty(t)},header:function(t){return gt.test(t.nodeName)},input:function(t){return mt.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:u(function(){return[0]}),last:u(function(t,e){return[e-1]}),eq:u(function(t,e,i){return[0>i?i+e:i]}),even:u(function(t,e){for(var i=0;e>i;i+=2)t.push(i);return t}),odd:u(function(t,e){for(var i=1;e>i;i+=2)t.push(i);return t}),lt:u(function(t,e,i){for(var n=0>i?i+e:i;--n>=0;)t.push(n);return t}),gt:u(function(t,e,i){for(var n=0>i?i+e:i;++n<e;)t.push(n);return t})}},C.pseudos.nth=C.pseudos.eq;for(_ in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C.pseudos[_]=a(_);for(_ in{submit:!0,reset:!0})C.pseudos[_]=l(_);return h.prototype=C.filters=C.pseudos,C.setFilters=new h,T=e.tokenize=function(t,i){var n,s,r,o,a,l,u,c=z[t+" "];if(c)return i?0:c.slice(0);for(a=t,l=[],u=C.preFilter;a;){(!n||(s=ut.exec(a)))&&(s&&(a=a.slice(s[0].length)||a),l.push(r=[])),n=!1,(s=ct.exec(a))&&(n=s.shift(),r.push({value:n,type:s[0].replace(lt," ")}),a=a.slice(n.length));for(o in C.filter)!(s=ft[o].exec(a))||u[o]&&!(s=u[o](s))||(n=s.shift(),r.push({value:n,type:o,matches:s}),a=a.slice(n.length));if(!n)break}return i?a.length:a?e.error(t):z(t,l).slice(0)},E=e.compile=function(t,e){var i,n=[],s=[],r=V[t+" "];if(!r){for(e||(e=T(t)),i=e.length;i--;)r=y(e[i]),r[B]?n.push(r):s.push(r);r=V(t,v(s,n)),r.selector=t}return r},I=e.select=function(t,e,i,n){var s,r,o,a,l,u="function"==typeof t&&t,h=!n&&T(t=u.selector||t);if(i=i||[],1===h.length){if(r=h[0]=h[0].slice(0),r.length>2&&"ID"===(o=r[0]).type&&x.getById&&9===e.nodeType&&L&&C.relative[r[1].type]){if(e=(C.find.ID(o.matches[0].replace(xt,Ct),e)||[])[0],!e)return i;u&&(e=e.parentNode),t=t.slice(r.shift().value.length)}for(s=ft.needsContext.test(t)?0:r.length;s--&&(o=r[s],!C.relative[a=o.type]);)if((l=C.find[a])&&(n=l(o.matches[0].replace(xt,Ct),vt.test(r[0].type)&&c(e.parentNode)||e))){if(r.splice(s,1),t=n.length&&p(r),!t)return Y.apply(i,n),i;break}}return(u||E(t,h))(n,e,!L,i,vt.test(t)&&c(e.parentNode)||e),i},x.sortStable=B.split("").sort(G).join("")===B,x.detectDuplicates=!!N,k(),x.sortDetached=s(function(t){return 1&t.compareDocumentPosition(P.createElement("div"))}),s(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||r("type|href|height|width",function(t,e,i){return i?void 0:t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),x.attributes&&s(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||r("value",function(t,e,i){return i||"input"!==t.nodeName.toLowerCase()?void 0:t.defaultValue}),s(function(t){return null==t.getAttribute("disabled")})||r(et,function(t,e,i){var n;return i?void 0:t[e]===!0?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null}),e}(t);Z.find=st,Z.expr=st.selectors,Z.expr[":"]=Z.expr.pseudos,Z.unique=st.uniqueSort,Z.text=st.getText,Z.isXMLDoc=st.isXML,Z.contains=st.contains;var rt=Z.expr.match.needsContext,ot=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,at=/^.[^:#\[\.,]*$/;Z.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?Z.find.matchesSelector(n,t)?[n]:[]:Z.find.matches(t,Z.grep(e,function(t){return 1===t.nodeType}))},Z.fn.extend({find:function(t){var e,i=this.length,n=[],s=this;if("string"!=typeof t)return this.pushStack(Z(t).filter(function(){for(e=0;i>e;e++)if(Z.contains(s[e],this))return!0}));for(e=0;i>e;e++)Z.find(t,s[e],n);return n=this.pushStack(i>1?Z.unique(n):n),n.selector=this.selector?this.selector+" "+t:t,n},filter:function(t){return this.pushStack(n(this,t||[],!1))},not:function(t){return this.pushStack(n(this,t||[],!0))},is:function(t){return!!n(this,"string"==typeof t&&rt.test(t)?Z(t):t||[],!1).length}});var lt,ut=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ct=Z.fn.init=function(t,e){var i,n;if(!t)return this;if("string"==typeof t){if(i="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:ut.exec(t),!i||!i[1]&&e)return!e||e.jquery?(e||lt).find(t):this.constructor(e).find(t);if(i[1]){if(e=e instanceof Z?e[0]:e,Z.merge(this,Z.parseHTML(i[1],e&&e.nodeType?e.ownerDocument||e:Q,!0)),ot.test(i[1])&&Z.isPlainObject(e))for(i in e)Z.isFunction(this[i])?this[i](e[i]):this.attr(i,e[i]);return this}return n=Q.getElementById(i[2]),n&&n.parentNode&&(this.length=1,this[0]=n),this.context=Q,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):Z.isFunction(t)?"undefined"!=typeof lt.ready?lt.ready(t):t(Z):(void 0!==t.selector&&(this.selector=t.selector,this.context=t.context),Z.makeArray(t,this))};ct.prototype=Z.fn,lt=Z(Q);var ht=/^(?:parents|prev(?:Until|All))/,pt={children:!0,contents:!0,next:!0,prev:!0};Z.extend({dir:function(t,e,i){for(var n=[],s=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(s&&Z(t).is(i))break;n.push(t)}return n},sibling:function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i}}),Z.fn.extend({has:function(t){var e=Z(t,this),i=e.length;return this.filter(function(){for(var t=0;i>t;t++)if(Z.contains(this,e[t]))return!0})},closest:function(t,e){for(var i,n=0,s=this.length,r=[],o=rt.test(t)||"string"!=typeof t?Z(t,e||this.context):0;s>n;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&Z.find.matchesSelector(i,t))){r.push(i);break}return this.pushStack(r.length>1?Z.unique(r):r)},index:function(t){return t?"string"==typeof t?G.call(Z(t),this[0]):G.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(Z.unique(Z.merge(this.get(),Z(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),Z.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return Z.dir(t,"parentNode")},parentsUntil:function(t,e,i){return Z.dir(t,"parentNode",i)},next:function(t){return s(t,"nextSibling")},prev:function(t){return s(t,"previousSibling")},nextAll:function(t){return Z.dir(t,"nextSibling")},prevAll:function(t){return Z.dir(t,"previousSibling")},nextUntil:function(t,e,i){return Z.dir(t,"nextSibling",i)},prevUntil:function(t,e,i){return Z.dir(t,"previousSibling",i)},siblings:function(t){return Z.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return Z.sibling(t.firstChild)},contents:function(t){return t.contentDocument||Z.merge([],t.childNodes)}},function(t,e){Z.fn[t]=function(i,n){var s=Z.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(s=Z.filter(n,s)),this.length>1&&(pt[t]||Z.unique(s),ht.test(t)&&s.reverse()),this.pushStack(s)}});var dt=/\S+/g,ft={};Z.Callbacks=function(t){t="string"==typeof t?ft[t]||r(t):Z.extend({},t);var e,i,n,s,o,a,l=[],u=!t.once&&[],c=function(r){for(e=t.memory&&r,i=!0,a=s||0,s=0,o=l.length,n=!0;l&&o>a;a++)if(l[a].apply(r[0],r[1])===!1&&t.stopOnFalse){e=!1;break}n=!1,l&&(u?u.length&&c(u.shift()):e?l=[]:h.disable())},h={add:function(){if(l){var i=l.length;!function r(e){Z.each(e,function(e,i){var n=Z.type(i);"function"===n?t.unique&&h.has(i)||l.push(i):i&&i.length&&"string"!==n&&r(i)})}(arguments),n?o=l.length:e&&(s=i,c(e))}return this},remove:function(){return l&&Z.each(arguments,function(t,e){for(var i;(i=Z.inArray(e,l,i))>-1;)l.splice(i,1),n&&(o>=i&&o--,a>=i&&a--)}),this},has:function(t){return t?Z.inArray(t,l)>-1:!(!l||!l.length)},empty:function(){return l=[],o=0,this},disable:function(){return l=u=e=void 0,this},disabled:function(){return!l},lock:function(){return u=void 0,e||h.disable(),this},locked:function(){return!u},fireWith:function(t,e){return!l||i&&!u||(e=e||[],e=[t,e.slice?e.slice():e],n?u.push(e):c(e)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!i}};return h},Z.extend({Deferred:function(t){var e=[["resolve","done",Z.Callbacks("once memory"),"resolved"],["reject","fail",Z.Callbacks("once memory"),"rejected"],["notify","progress",Z.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var t=arguments;return Z.Deferred(function(i){Z.each(e,function(e,r){var o=Z.isFunction(t[e])&&t[e];s[r[1]](function(){var t=o&&o.apply(this,arguments);t&&Z.isFunction(t.promise)?t.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[r[0]+"With"](this===n?i.promise():this,o?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?Z.extend(t,n):n}},s={};return n.pipe=n.then,Z.each(e,function(t,r){var o=r[2],a=r[3];n[r[1]]=o.add,a&&o.add(function(){i=a},e[1^t][2].disable,e[2][2].lock),s[r[0]]=function(){return s[r[0]+"With"](this===s?n:this,arguments),this},s[r[0]+"With"]=o.fireWith}),n.promise(s),t&&t.call(s,s),s},when:function(t){var e,i,n,s=0,r=$.call(arguments),o=r.length,a=1!==o||t&&Z.isFunction(t.promise)?o:0,l=1===a?t:Z.Deferred(),u=function(t,i,n){return function(s){i[t]=this,n[t]=arguments.length>1?$.call(arguments):s,n===e?l.notifyWith(i,n):--a||l.resolveWith(i,n)}};if(o>1)for(e=new Array(o),i=new Array(o),n=new Array(o);o>s;s++)r[s]&&Z.isFunction(r[s].promise)?r[s].promise().done(u(s,n,r)).fail(l.reject).progress(u(s,i,e)):--a;return a||l.resolveWith(n,r),l.promise()}});var mt;Z.fn.ready=function(t){return Z.ready.promise().done(t),this},Z.extend({isReady:!1,readyWait:1,holdReady:function(t){t?Z.readyWait++:Z.ready(!0)},ready:function(t){(t===!0?--Z.readyWait:Z.isReady)||(Z.isReady=!0,t!==!0&&--Z.readyWait>0||(mt.resolveWith(Q,[Z]),Z.fn.triggerHandler&&(Z(Q).triggerHandler("ready"),Z(Q).off("ready"))))}}),Z.ready.promise=function(e){return mt||(mt=Z.Deferred(),"complete"===Q.readyState?setTimeout(Z.ready):(Q.addEventListener("DOMContentLoaded",o,!1),t.addEventListener("load",o,!1))),mt.promise(e)},Z.ready.promise();var gt=Z.access=function(t,e,i,n,s,r,o){var a=0,l=t.length,u=null==i;if("object"===Z.type(i)){s=!0;for(a in i)Z.access(t,e,a,i[a],!0,r,o)}else if(void 0!==n&&(s=!0,Z.isFunction(n)||(o=!0),u&&(o?(e.call(t,n),e=null):(u=e,e=function(t,e,i){return u.call(Z(t),i)})),e))for(;l>a;a++)e(t[a],i,o?n:n.call(t[a],a,e(t[a],i)));return s?t:u?e.call(t):l?e(t[0],i):r};Z.acceptData=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType},a.uid=1,a.accepts=Z.acceptData,a.prototype={key:function(t){if(!a.accepts(t))return 0;var e={},i=t[this.expando];if(!i){i=a.uid++;try{e[this.expando]={value:i},Object.defineProperties(t,e)}catch(n){e[this.expando]=i,Z.extend(t,e)}}return this.cache[i]||(this.cache[i]={}),i},set:function(t,e,i){var n,s=this.key(t),r=this.cache[s];if("string"==typeof e)r[e]=i;else if(Z.isEmptyObject(r))Z.extend(this.cache[s],e);else for(n in e)r[n]=e[n];return r},get:function(t,e){var i=this.cache[this.key(t)];return void 0===e?i:i[e]},access:function(t,e,i){var n;return void 0===e||e&&"string"==typeof e&&void 0===i?(n=this.get(t,e),void 0!==n?n:this.get(t,Z.camelCase(e))):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,n,s,r=this.key(t),o=this.cache[r];if(void 0===e)this.cache[r]={};else{Z.isArray(e)?n=e.concat(e.map(Z.camelCase)):(s=Z.camelCase(e),e in o?n=[e,s]:(n=s,n=n in o?[n]:n.match(dt)||[])),i=n.length;for(;i--;)delete o[n[i]]}},hasData:function(t){return!Z.isEmptyObject(this.cache[t[this.expando]]||{})},discard:function(t){t[this.expando]&&delete this.cache[t[this.expando]]}};var bt=new a,yt=new a,vt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,_t=/([A-Z])/g;Z.extend({hasData:function(t){return yt.hasData(t)||bt.hasData(t)},data:function(t,e,i){return yt.access(t,e,i)},removeData:function(t,e){yt.remove(t,e)},_data:function(t,e,i){return bt.access(t,e,i)},_removeData:function(t,e){bt.remove(t,e)}}),Z.fn.extend({data:function(t,e){var i,n,s,r=this[0],o=r&&r.attributes;if(void 0===t){if(this.length&&(s=yt.get(r),1===r.nodeType&&!bt.get(r,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&(n=o[i].name,0===n.indexOf("data-")&&(n=Z.camelCase(n.slice(5)),l(r,n,s[n])));bt.set(r,"hasDataAttrs",!0)}return s}return"object"==typeof t?this.each(function(){yt.set(this,t)}):gt(this,function(e){var i,n=Z.camelCase(t);if(r&&void 0===e){if(i=yt.get(r,t),void 0!==i)return i;if(i=yt.get(r,n),void 0!==i)return i;if(i=l(r,n,void 0),void 0!==i)return i}else this.each(function(){var i=yt.get(this,n);yt.set(this,n,e),-1!==t.indexOf("-")&&void 0!==i&&yt.set(this,t,e)})},null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){yt.remove(this,t)})}}),Z.extend({queue:function(t,e,i){var n;return t?(e=(e||"fx")+"queue",n=bt.get(t,e),i&&(!n||Z.isArray(i)?n=bt.access(t,e,Z.makeArray(i)):n.push(i)),n||[]):void 0},dequeue:function(t,e){e=e||"fx";var i=Z.queue(t,e),n=i.length,s=i.shift(),r=Z._queueHooks(t,e),o=function(){Z.dequeue(t,e)};"inprogress"===s&&(s=i.shift(),n--),s&&("fx"===e&&i.unshift("inprogress"),delete r.stop,s.call(t,o,r)),!n&&r&&r.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return bt.get(t,i)||bt.access(t,i,{empty:Z.Callbacks("once memory").add(function(){bt.remove(t,[e+"queue",i])})})}}),Z.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?Z.queue(this[0],t):void 0===e?this:this.each(function(){var i=Z.queue(this,t,e);Z._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&Z.dequeue(this,t)})},dequeue:function(t){return this.each(function(){Z.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,s=Z.Deferred(),r=this,o=this.length,a=function(){--n||s.resolveWith(r,[r])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)i=bt.get(r[o],t+"queueHooks"),i&&i.empty&&(n++,i.empty.add(a));return a(),s.promise(e)}});var xt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ct=["Top","Right","Bottom","Left"],wt=function(t,e){return t=e||t,"none"===Z.css(t,"display")||!Z.contains(t.ownerDocument,t)},St=/^(?:checkbox|radio)$/i;!function(){var t=Q.createDocumentFragment(),e=t.appendChild(Q.createElement("div")),i=Q.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),e.appendChild(i),J.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",J.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var Tt="undefined";J.focusinBubbles="onfocusin"in t;var Et=/^key/,It=/^(?:mouse|pointer|contextmenu)|click/,At=/^(?:focusinfocus|focusoutblur)$/,Ot=/^([^.]*)(?:\.(.+)|)$/;Z.event={global:{},add:function(t,e,i,n,s){var r,o,a,l,u,c,h,p,d,f,m,g=bt.get(t);if(g)for(i.handler&&(r=i,i=r.handler,s=r.selector),i.guid||(i.guid=Z.guid++),(l=g.events)||(l=g.events={}),(o=g.handle)||(o=g.handle=function(e){return typeof Z!==Tt&&Z.event.triggered!==e.type?Z.event.dispatch.apply(t,arguments):void 0}),e=(e||"").match(dt)||[""],u=e.length;u--;)a=Ot.exec(e[u])||[],d=m=a[1],f=(a[2]||"").split(".").sort(),d&&(h=Z.event.special[d]||{},d=(s?h.delegateType:h.bindType)||d,h=Z.event.special[d]||{},c=Z.extend({type:d,origType:m,data:n,handler:i,guid:i.guid,selector:s,needsContext:s&&Z.expr.match.needsContext.test(s),namespace:f.join(".")},r),(p=l[d])||(p=l[d]=[],p.delegateCount=0,h.setup&&h.setup.call(t,n,f,o)!==!1||t.addEventListener&&t.addEventListener(d,o,!1)),h.add&&(h.add.call(t,c),c.handler.guid||(c.handler.guid=i.guid)),s?p.splice(p.delegateCount++,0,c):p.push(c),Z.event.global[d]=!0)},remove:function(t,e,i,n,s){var r,o,a,l,u,c,h,p,d,f,m,g=bt.hasData(t)&&bt.get(t);if(g&&(l=g.events)){for(e=(e||"").match(dt)||[""],u=e.length;u--;)if(a=Ot.exec(e[u])||[],d=m=a[1],f=(a[2]||"").split(".").sort(),d){for(h=Z.event.special[d]||{},d=(n?h.delegateType:h.bindType)||d,p=l[d]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=r=p.length;r--;)c=p[r],!s&&m!==c.origType||i&&i.guid!==c.guid||a&&!a.test(c.namespace)||n&&n!==c.selector&&("**"!==n||!c.selector)||(p.splice(r,1),c.selector&&p.delegateCount--,h.remove&&h.remove.call(t,c));o&&!p.length&&(h.teardown&&h.teardown.call(t,f,g.handle)!==!1||Z.removeEvent(t,d,g.handle),delete l[d])}else for(d in l)Z.event.remove(t,d+e[u],i,n,!0);Z.isEmptyObject(l)&&(delete g.handle,bt.remove(t,"events"))}},trigger:function(e,i,n,s){var r,o,a,l,u,c,h,p=[n||Q],d=K.call(e,"type")?e.type:e,f=K.call(e,"namespace")?e.namespace.split("."):[];if(o=a=n=n||Q,3!==n.nodeType&&8!==n.nodeType&&!At.test(d+Z.event.triggered)&&(d.indexOf(".")>=0&&(f=d.split("."),d=f.shift(),f.sort()),u=d.indexOf(":")<0&&"on"+d,e=e[Z.expando]?e:new Z.Event(d,"object"==typeof e&&e),e.isTrigger=s?2:3,e.namespace=f.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),i=null==i?[e]:Z.makeArray(i,[e]),h=Z.event.special[d]||{},s||!h.trigger||h.trigger.apply(n,i)!==!1)){if(!s&&!h.noBubble&&!Z.isWindow(n)){for(l=h.delegateType||d,At.test(l+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||Q)&&p.push(a.defaultView||a.parentWindow||t)}for(r=0;(o=p[r++])&&!e.isPropagationStopped();)e.type=r>1?l:h.bindType||d,c=(bt.get(o,"events")||{})[e.type]&&bt.get(o,"handle"),c&&c.apply(o,i),c=u&&o[u],c&&c.apply&&Z.acceptData(o)&&(e.result=c.apply(o,i),e.result===!1&&e.preventDefault());return e.type=d,s||e.isDefaultPrevented()||h._default&&h._default.apply(p.pop(),i)!==!1||!Z.acceptData(n)||u&&Z.isFunction(n[d])&&!Z.isWindow(n)&&(a=n[u],a&&(n[u]=null),Z.event.triggered=d,n[d](),Z.event.triggered=void 0,a&&(n[u]=a)),e.result}},dispatch:function(t){t=Z.event.fix(t);var e,i,n,s,r,o=[],a=$.call(arguments),l=(bt.get(this,"events")||{})[t.type]||[],u=Z.event.special[t.type]||{};if(a[0]=t,t.delegateTarget=this,!u.preDispatch||u.preDispatch.call(this,t)!==!1){for(o=Z.event.handlers.call(this,t,l),e=0;(s=o[e++])&&!t.isPropagationStopped();)for(t.currentTarget=s.elem,i=0;(r=s.handlers[i++])&&!t.isImmediatePropagationStopped();)(!t.namespace_re||t.namespace_re.test(r.namespace))&&(t.handleObj=r,t.data=r.data,n=((Z.event.special[r.origType]||{}).handle||r.handler).apply(s.elem,a),void 0!==n&&(t.result=n)===!1&&(t.preventDefault(),t.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,t),t.result}},handlers:function(t,e){var i,n,s,r,o=[],a=e.delegateCount,l=t.target;if(a&&l.nodeType&&(!t.button||"click"!==t.type))for(;l!==this;l=l.parentNode||this)if(l.disabled!==!0||"click"!==t.type){for(n=[],i=0;a>i;i++)r=e[i],s=r.selector+" ",void 0===n[s]&&(n[s]=r.needsContext?Z(s,this).index(l)>=0:Z.find(s,this,null,[l]).length),n[s]&&n.push(r);n.length&&o.push({elem:l,handlers:n})}return a<e.length&&o.push({elem:this,handlers:e.slice(a)}),o},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var i,n,s,r=e.button;return null==t.pageX&&null!=e.clientX&&(i=t.target.ownerDocument||Q,n=i.documentElement,s=i.body,t.pageX=e.clientX+(n&&n.scrollLeft||s&&s.scrollLeft||0)-(n&&n.clientLeft||s&&s.clientLeft||0),t.pageY=e.clientY+(n&&n.scrollTop||s&&s.scrollTop||0)-(n&&n.clientTop||s&&s.clientTop||0)),t.which||void 0===r||(t.which=1&r?1:2&r?3:4&r?2:0),t}},fix:function(t){if(t[Z.expando])return t;var e,i,n,s=t.type,r=t,o=this.fixHooks[s];for(o||(this.fixHooks[s]=o=It.test(s)?this.mouseHooks:Et.test(s)?this.keyHooks:{}),n=o.props?this.props.concat(o.props):this.props,t=new Z.Event(r),e=n.length;e--;)i=n[e],t[i]=r[i];return t.target||(t.target=Q),3===t.target.nodeType&&(t.target=t.target.parentNode),o.filter?o.filter(t,r):t},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==h()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===h()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&Z.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(t){return Z.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,i,n){var s=Z.extend(new Z.Event,i,{type:t,isSimulated:!0,originalEvent:{}});n?Z.event.trigger(s,null,e):Z.event.dispatch.call(e,s),s.isDefaultPrevented()&&i.preventDefault()}},Z.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i,!1)},Z.Event=function(t,e){return this instanceof Z.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&t.returnValue===!1?u:c):this.type=t,e&&Z.extend(this,e),this.timeStamp=t&&t.timeStamp||Z.now(),void(this[Z.expando]=!0)):new Z.Event(t,e)},Z.Event.prototype={isDefaultPrevented:c,isPropagationStopped:c,isImmediatePropagationStopped:c,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=u,t&&t.preventDefault&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=u,t&&t.stopPropagation&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=u,t&&t.stopImmediatePropagation&&t.stopImmediatePropagation(),this.stopPropagation()}},Z.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){Z.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=this,s=t.relatedTarget,r=t.handleObj;return(!s||s!==n&&!Z.contains(n,s))&&(t.type=r.origType,i=r.handler.apply(this,arguments),t.type=e),i}}}),J.focusinBubbles||Z.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){Z.event.simulate(e,t.target,Z.event.fix(t),!0)};Z.event.special[e]={setup:function(){var n=this.ownerDocument||this,s=bt.access(n,e);s||n.addEventListener(t,i,!0),bt.access(n,e,(s||0)+1)},teardown:function(){var n=this.ownerDocument||this,s=bt.access(n,e)-1;s?bt.access(n,e,s):(n.removeEventListener(t,i,!0),bt.remove(n,e))}}}),Z.fn.extend({on:function(t,e,i,n,s){var r,o;if("object"==typeof t){"string"!=typeof e&&(i=i||e,e=void 0);for(o in t)this.on(o,e,i,t[o],s);return this}if(null==i&&null==n?(n=e,i=e=void 0):null==n&&("string"==typeof e?(n=i,i=void 0):(n=i,i=e,e=void 0)),n===!1)n=c;else if(!n)return this;return 1===s&&(r=n,n=function(t){return Z().off(t),r.apply(this,arguments)},n.guid=r.guid||(r.guid=Z.guid++)),this.each(function(){Z.event.add(this,t,n,i,e)})},one:function(t,e,i,n){return this.on(t,e,i,n,1)},off:function(t,e,i){var n,s;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,Z(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(s in t)this.off(s,e,t[s]);return this}return(e===!1||"function"==typeof e)&&(i=e,e=void 0),i===!1&&(i=c),this.each(function(){Z.event.remove(this,t,i,e)})},trigger:function(t,e){return this.each(function(){Z.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];return i?Z.event.trigger(t,e,i,!0):void 0}});var Nt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,kt=/<([\w:]+)/,Pt=/<|&#?\w+;/,Dt=/<(?:script|style|link)/i,Lt=/checked\s*(?:[^=]|=\s*.checked.)/i,Rt=/^$|\/(?:java|ecma)script/i,jt=/^true\/(.*)/,Mt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ft={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ft.optgroup=Ft.option,Ft.tbody=Ft.tfoot=Ft.colgroup=Ft.caption=Ft.thead,Ft.th=Ft.td,Z.extend({clone:function(t,e,i){var n,s,r,o,a=t.cloneNode(!0),l=Z.contains(t.ownerDocument,t);if(!(J.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||Z.isXMLDoc(t)))for(o=b(a),r=b(t),n=0,s=r.length;s>n;n++)y(r[n],o[n]);if(e)if(i)for(r=r||b(t),o=o||b(a),n=0,s=r.length;s>n;n++)g(r[n],o[n]);else g(t,a);return o=b(a,"script"),o.length>0&&m(o,!l&&b(t,"script")),a},buildFragment:function(t,e,i,n){for(var s,r,o,a,l,u,c=e.createDocumentFragment(),h=[],p=0,d=t.length;d>p;p++)if(s=t[p],s||0===s)if("object"===Z.type(s))Z.merge(h,s.nodeType?[s]:s);else if(Pt.test(s)){for(r=r||c.appendChild(e.createElement("div")),o=(kt.exec(s)||["",""])[1].toLowerCase(),a=Ft[o]||Ft._default,r.innerHTML=a[1]+s.replace(Nt,"<$1></$2>")+a[2],u=a[0];u--;)r=r.lastChild;Z.merge(h,r.childNodes),r=c.firstChild,r.textContent=""}else h.push(e.createTextNode(s));for(c.textContent="",p=0;s=h[p++];)if((!n||-1===Z.inArray(s,n))&&(l=Z.contains(s.ownerDocument,s),r=b(c.appendChild(s),"script"),l&&m(r),i))for(u=0;s=r[u++];)Rt.test(s.type||"")&&i.push(s);return c},cleanData:function(t){for(var e,i,n,s,r=Z.event.special,o=0;void 0!==(i=t[o]);o++){if(Z.acceptData(i)&&(s=i[bt.expando],s&&(e=bt.cache[s]))){if(e.events)for(n in e.events)r[n]?Z.event.remove(i,n):Z.removeEvent(i,n,e.handle);bt.cache[s]&&delete bt.cache[s]}delete yt.cache[i[yt.expando]]}}}),Z.fn.extend({text:function(t){return gt(this,function(t){return void 0===t?Z.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=t)})},null,t,arguments.length)},append:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=p(this,t);e.appendChild(t)}})},prepend:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=p(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},remove:function(t,e){for(var i,n=t?Z.filter(t,this):this,s=0;null!=(i=n[s]);s++)e||1!==i.nodeType||Z.cleanData(b(i)),i.parentNode&&(e&&Z.contains(i.ownerDocument,i)&&m(b(i,"script")),i.parentNode.removeChild(i));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(Z.cleanData(b(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return Z.clone(this,t,e)})},html:function(t){return gt(this,function(t){var e=this[0]||{},i=0,n=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Dt.test(t)&&!Ft[(kt.exec(t)||["",""])[1].toLowerCase()]){t=t.replace(Nt,"<$1></$2>");try{for(;n>i;i++)e=this[i]||{},1===e.nodeType&&(Z.cleanData(b(e,!1)),e.innerHTML=t);e=0}catch(s){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=arguments[0];return this.domManip(arguments,function(e){t=this.parentNode,Z.cleanData(b(this)),t&&t.replaceChild(e,this)}),t&&(t.length||t.nodeType)?this:this.remove()},detach:function(t){return this.remove(t,!0)},domManip:function(t,e){t=z.apply([],t);var i,n,s,r,o,a,l=0,u=this.length,c=this,h=u-1,p=t[0],m=Z.isFunction(p);if(m||u>1&&"string"==typeof p&&!J.checkClone&&Lt.test(p))return this.each(function(i){var n=c.eq(i);m&&(t[0]=p.call(this,i,n.html())),n.domManip(t,e)});if(u&&(i=Z.buildFragment(t,this[0].ownerDocument,!1,this),n=i.firstChild,1===i.childNodes.length&&(i=n),n)){for(s=Z.map(b(i,"script"),d),r=s.length;u>l;l++)o=i,l!==h&&(o=Z.clone(o,!0,!0),r&&Z.merge(s,b(o,"script"))),e.call(this[l],o,l);if(r)for(a=s[s.length-1].ownerDocument,Z.map(s,f),l=0;r>l;l++)o=s[l],Rt.test(o.type||"")&&!bt.access(o,"globalEval")&&Z.contains(a,o)&&(o.src?Z._evalUrl&&Z._evalUrl(o.src):Z.globalEval(o.textContent.replace(Mt,"")))}return this}}),Z.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){Z.fn[t]=function(t){for(var i,n=[],s=Z(t),r=s.length-1,o=0;r>=o;o++)i=o===r?this:this.clone(!0),Z(s[o])[e](i),V.apply(n,i.get());return this.pushStack(n)}});var Bt,qt={},Ut=/^margin/,Ht=new RegExp("^("+xt+")(?!px)[a-z%]+$","i"),$t=function(e){return e.ownerDocument.defaultView.opener?e.ownerDocument.defaultView.getComputedStyle(e,null):t.getComputedStyle(e,null)};!function(){function e(){o.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",o.innerHTML="",s.appendChild(r);var e=t.getComputedStyle(o,null);i="1%"!==e.top,n="4px"===e.width,s.removeChild(r)}var i,n,s=Q.documentElement,r=Q.createElement("div"),o=Q.createElement("div");o.style&&(o.style.backgroundClip="content-box",o.cloneNode(!0).style.backgroundClip="",J.clearCloneStyle="content-box"===o.style.backgroundClip,r.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",r.appendChild(o),t.getComputedStyle&&Z.extend(J,{pixelPosition:function(){return e(),i},boxSizingReliable:function(){return null==n&&e(),n},reliableMarginRight:function(){var e,i=o.appendChild(Q.createElement("div"));return i.style.cssText=o.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",o.style.width="1px",s.appendChild(r),e=!parseFloat(t.getComputedStyle(i,null).marginRight),s.removeChild(r),o.removeChild(i),e}}))}(),Z.swap=function(t,e,i,n){var s,r,o={};for(r in e)o[r]=t.style[r],t.style[r]=e[r];s=i.apply(t,n||[]);for(r in e)t.style[r]=o[r];return s};var zt=/^(none|table(?!-c[ea]).+)/,Vt=new RegExp("^("+xt+")(.*)$","i"),Gt=new RegExp("^([+-])=("+xt+")","i"),Wt={position:"absolute",visibility:"hidden",display:"block"},Xt={letterSpacing:"0",fontWeight:"400"},Kt=["Webkit","O","Moz","ms"];Z.extend({cssHooks:{opacity:{get:function(t,e){if(e){
var i=x(t,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var s,r,o,a=Z.camelCase(e),l=t.style;return e=Z.cssProps[a]||(Z.cssProps[a]=w(l,a)),o=Z.cssHooks[e]||Z.cssHooks[a],void 0===i?o&&"get"in o&&void 0!==(s=o.get(t,!1,n))?s:l[e]:(r=typeof i,"string"===r&&(s=Gt.exec(i))&&(i=(s[1]+1)*s[2]+parseFloat(Z.css(t,e)),r="number"),null!=i&&i===i&&("number"!==r||Z.cssNumber[a]||(i+="px"),J.clearCloneStyle||""!==i||0!==e.indexOf("background")||(l[e]="inherit"),o&&"set"in o&&void 0===(i=o.set(t,i,n))||(l[e]=i)),void 0)}},css:function(t,e,i,n){var s,r,o,a=Z.camelCase(e);return e=Z.cssProps[a]||(Z.cssProps[a]=w(t.style,a)),o=Z.cssHooks[e]||Z.cssHooks[a],o&&"get"in o&&(s=o.get(t,!0,i)),void 0===s&&(s=x(t,e,n)),"normal"===s&&e in Xt&&(s=Xt[e]),""===i||i?(r=parseFloat(s),i===!0||Z.isNumeric(r)?r||0:s):s}}),Z.each(["height","width"],function(t,e){Z.cssHooks[e]={get:function(t,i,n){return i?zt.test(Z.css(t,"display"))&&0===t.offsetWidth?Z.swap(t,Wt,function(){return E(t,e,n)}):E(t,e,n):void 0},set:function(t,i,n){var s=n&&$t(t);return S(t,i,n?T(t,e,n,"border-box"===Z.css(t,"boxSizing",!1,s),s):0)}}}),Z.cssHooks.marginRight=C(J.reliableMarginRight,function(t,e){return e?Z.swap(t,{display:"inline-block"},x,[t,"marginRight"]):void 0}),Z.each({margin:"",padding:"",border:"Width"},function(t,e){Z.cssHooks[t+e]={expand:function(i){for(var n=0,s={},r="string"==typeof i?i.split(" "):[i];4>n;n++)s[t+Ct[n]+e]=r[n]||r[n-2]||r[0];return s}},Ut.test(t)||(Z.cssHooks[t+e].set=S)}),Z.fn.extend({css:function(t,e){return gt(this,function(t,e,i){var n,s,r={},o=0;if(Z.isArray(e)){for(n=$t(t),s=e.length;s>o;o++)r[e[o]]=Z.css(t,e[o],!1,n);return r}return void 0!==i?Z.style(t,e,i):Z.css(t,e)},t,e,arguments.length>1)},show:function(){return I(this,!0)},hide:function(){return I(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){wt(this)?Z(this).show():Z(this).hide()})}}),Z.Tween=A,A.prototype={constructor:A,init:function(t,e,i,n,s,r){this.elem=t,this.prop=i,this.easing=s||"swing",this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=r||(Z.cssNumber[i]?"":"px")},cur:function(){var t=A.propHooks[this.prop];return t&&t.get?t.get(this):A.propHooks._default.get(this)},run:function(t){var e,i=A.propHooks[this.prop];return this.options.duration?this.pos=e=Z.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):A.propHooks._default.set(this),this}},A.prototype.init.prototype=A.prototype,A.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=Z.css(t.elem,t.prop,""),e&&"auto"!==e?e:0):t.elem[t.prop]},set:function(t){Z.fx.step[t.prop]?Z.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[Z.cssProps[t.prop]]||Z.cssHooks[t.prop])?Z.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},A.propHooks.scrollTop=A.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},Z.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},Z.fx=A.prototype.init,Z.fx.step={};var Jt,Qt,Yt=/^(?:toggle|show|hide)$/,Zt=new RegExp("^(?:([+-])=|)("+xt+")([a-z%]*)$","i"),te=/queueHooks$/,ee=[P],ie={"*":[function(t,e){var i=this.createTween(t,e),n=i.cur(),s=Zt.exec(e),r=s&&s[3]||(Z.cssNumber[t]?"":"px"),o=(Z.cssNumber[t]||"px"!==r&&+n)&&Zt.exec(Z.css(i.elem,t)),a=1,l=20;if(o&&o[3]!==r){r=r||o[3],s=s||[],o=+n||1;do a=a||".5",o/=a,Z.style(i.elem,t,o+r);while(a!==(a=i.cur()/n)&&1!==a&&--l)}return s&&(o=i.start=+o||+n||0,i.unit=r,i.end=s[1]?o+(s[1]+1)*s[2]:+s[2]),i}]};Z.Animation=Z.extend(L,{tweener:function(t,e){Z.isFunction(t)?(e=t,t=["*"]):t=t.split(" ");for(var i,n=0,s=t.length;s>n;n++)i=t[n],ie[i]=ie[i]||[],ie[i].unshift(e)},prefilter:function(t,e){e?ee.unshift(t):ee.push(t)}}),Z.speed=function(t,e,i){var n=t&&"object"==typeof t?Z.extend({},t):{complete:i||!i&&e||Z.isFunction(t)&&t,duration:t,easing:i&&e||e&&!Z.isFunction(e)&&e};return n.duration=Z.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in Z.fx.speeds?Z.fx.speeds[n.duration]:Z.fx.speeds._default,(null==n.queue||n.queue===!0)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){Z.isFunction(n.old)&&n.old.call(this),n.queue&&Z.dequeue(this,n.queue)},n},Z.fn.extend({fadeTo:function(t,e,i,n){return this.filter(wt).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var s=Z.isEmptyObject(t),r=Z.speed(e,i,n),o=function(){var e=L(this,Z.extend({},t),r);(s||bt.get(this,"finish"))&&e.stop(!0)};return o.finish=o,s||r.queue===!1?this.each(o):this.queue(r.queue,o)},stop:function(t,e,i){var n=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,s=null!=t&&t+"queueHooks",r=Z.timers,o=bt.get(this);if(s)o[s]&&o[s].stop&&n(o[s]);else for(s in o)o[s]&&o[s].stop&&te.test(s)&&n(o[s]);for(s=r.length;s--;)r[s].elem!==this||null!=t&&r[s].queue!==t||(r[s].anim.stop(i),e=!1,r.splice(s,1));(e||!i)&&Z.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,i=bt.get(this),n=i[t+"queue"],s=i[t+"queueHooks"],r=Z.timers,o=n?n.length:0;for(i.finish=!0,Z.queue(this,t,[]),s&&s.stop&&s.stop.call(this,!0),e=r.length;e--;)r[e].elem===this&&r[e].queue===t&&(r[e].anim.stop(!0),r.splice(e,1));for(e=0;o>e;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish})}}),Z.each(["toggle","show","hide"],function(t,e){var i=Z.fn[e];Z.fn[e]=function(t,n,s){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(N(e,!0),t,n,s)}}),Z.each({slideDown:N("show"),slideUp:N("hide"),slideToggle:N("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){Z.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}}),Z.timers=[],Z.fx.tick=function(){var t,e=0,i=Z.timers;for(Jt=Z.now();e<i.length;e++)t=i[e],t()||i[e]!==t||i.splice(e--,1);i.length||Z.fx.stop(),Jt=void 0},Z.fx.timer=function(t){Z.timers.push(t),t()?Z.fx.start():Z.timers.pop()},Z.fx.interval=13,Z.fx.start=function(){Qt||(Qt=setInterval(Z.fx.tick,Z.fx.interval))},Z.fx.stop=function(){clearInterval(Qt),Qt=null},Z.fx.speeds={slow:600,fast:200,_default:400},Z.fn.delay=function(t,e){return t=Z.fx?Z.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,i){var n=setTimeout(e,t);i.stop=function(){clearTimeout(n)}})},function(){var t=Q.createElement("input"),e=Q.createElement("select"),i=e.appendChild(Q.createElement("option"));t.type="checkbox",J.checkOn=""!==t.value,J.optSelected=i.selected,e.disabled=!0,J.optDisabled=!i.disabled,t=Q.createElement("input"),t.value="t",t.type="radio",J.radioValue="t"===t.value}();var ne,se,re=Z.expr.attrHandle;Z.fn.extend({attr:function(t,e){return gt(this,Z.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){Z.removeAttr(this,t)})}}),Z.extend({attr:function(t,e,i){var n,s,r=t.nodeType;if(t&&3!==r&&8!==r&&2!==r)return typeof t.getAttribute===Tt?Z.prop(t,e,i):(1===r&&Z.isXMLDoc(t)||(e=e.toLowerCase(),n=Z.attrHooks[e]||(Z.expr.match.bool.test(e)?se:ne)),void 0===i?n&&"get"in n&&null!==(s=n.get(t,e))?s:(s=Z.find.attr(t,e),null==s?void 0:s):null!==i?n&&"set"in n&&void 0!==(s=n.set(t,i,e))?s:(t.setAttribute(e,i+""),i):void Z.removeAttr(t,e))},removeAttr:function(t,e){var i,n,s=0,r=e&&e.match(dt);if(r&&1===t.nodeType)for(;i=r[s++];)n=Z.propFix[i]||i,Z.expr.match.bool.test(i)&&(t[n]=!1),t.removeAttribute(i)},attrHooks:{type:{set:function(t,e){if(!J.radioValue&&"radio"===e&&Z.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}}}),se={set:function(t,e,i){return e===!1?Z.removeAttr(t,i):t.setAttribute(i,i),i}},Z.each(Z.expr.match.bool.source.match(/\w+/g),function(t,e){var i=re[e]||Z.find.attr;re[e]=function(t,e,n){var s,r;return n||(r=re[e],re[e]=s,s=null!=i(t,e,n)?e.toLowerCase():null,re[e]=r),s}});var oe=/^(?:input|select|textarea|button)$/i;Z.fn.extend({prop:function(t,e){return gt(this,Z.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[Z.propFix[t]||t]})}}),Z.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(t,e,i){var n,s,r,o=t.nodeType;if(t&&3!==o&&8!==o&&2!==o)return r=1!==o||!Z.isXMLDoc(t),r&&(e=Z.propFix[e]||e,s=Z.propHooks[e]),void 0!==i?s&&"set"in s&&void 0!==(n=s.set(t,i,e))?n:t[e]=i:s&&"get"in s&&null!==(n=s.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){return t.hasAttribute("tabindex")||oe.test(t.nodeName)||t.href?t.tabIndex:-1}}}}),J.optSelected||(Z.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null}}),Z.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){Z.propFix[this.toLowerCase()]=this});var ae=/[\t\r\n\f]/g;Z.fn.extend({addClass:function(t){var e,i,n,s,r,o,a="string"==typeof t&&t,l=0,u=this.length;if(Z.isFunction(t))return this.each(function(e){Z(this).addClass(t.call(this,e,this.className))});if(a)for(e=(t||"").match(dt)||[];u>l;l++)if(i=this[l],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(ae," "):" ")){for(r=0;s=e[r++];)n.indexOf(" "+s+" ")<0&&(n+=s+" ");o=Z.trim(n),i.className!==o&&(i.className=o)}return this},removeClass:function(t){var e,i,n,s,r,o,a=0===arguments.length||"string"==typeof t&&t,l=0,u=this.length;if(Z.isFunction(t))return this.each(function(e){Z(this).removeClass(t.call(this,e,this.className))});if(a)for(e=(t||"").match(dt)||[];u>l;l++)if(i=this[l],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(ae," "):"")){for(r=0;s=e[r++];)for(;n.indexOf(" "+s+" ")>=0;)n=n.replace(" "+s+" "," ");o=t?Z.trim(n):"",i.className!==o&&(i.className=o)}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):Z.isFunction(t)?this.each(function(i){Z(this).toggleClass(t.call(this,i,this.className,e),e)}):this.each(function(){if("string"===i)for(var e,n=0,s=Z(this),r=t.match(dt)||[];e=r[n++];)s.hasClass(e)?s.removeClass(e):s.addClass(e);else(i===Tt||"boolean"===i)&&(this.className&&bt.set(this,"__className__",this.className),this.className=this.className||t===!1?"":bt.get(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",i=0,n=this.length;n>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(ae," ").indexOf(e)>=0)return!0;return!1}});var le=/\r/g;Z.fn.extend({val:function(t){var e,i,n,s=this[0];{if(arguments.length)return n=Z.isFunction(t),this.each(function(i){var s;1===this.nodeType&&(s=n?t.call(this,i,Z(this).val()):t,null==s?s="":"number"==typeof s?s+="":Z.isArray(s)&&(s=Z.map(s,function(t){return null==t?"":t+""})),e=Z.valHooks[this.type]||Z.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,s,"value")||(this.value=s))});if(s)return e=Z.valHooks[s.type]||Z.valHooks[s.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(i=e.get(s,"value"))?i:(i=s.value,"string"==typeof i?i.replace(le,""):null==i?"":i)}}}),Z.extend({valHooks:{option:{get:function(t){var e=Z.find.attr(t,"value");return null!=e?e:Z.trim(Z.text(t))}},select:{get:function(t){for(var e,i,n=t.options,s=t.selectedIndex,r="select-one"===t.type||0>s,o=r?null:[],a=r?s+1:n.length,l=0>s?a:r?s:0;a>l;l++)if(i=n[l],(i.selected||l===s)&&(J.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!Z.nodeName(i.parentNode,"optgroup"))){if(e=Z(i).val(),r)return e;o.push(e)}return o},set:function(t,e){for(var i,n,s=t.options,r=Z.makeArray(e),o=s.length;o--;)n=s[o],(n.selected=Z.inArray(n.value,r)>=0)&&(i=!0);return i||(t.selectedIndex=-1),r}}}}),Z.each(["radio","checkbox"],function(){Z.valHooks[this]={set:function(t,e){return Z.isArray(e)?t.checked=Z.inArray(Z(t).val(),e)>=0:void 0}},J.checkOn||(Z.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}),Z.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){Z.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}),Z.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)},bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}});var ue=Z.now(),ce=/\?/;Z.parseJSON=function(t){return JSON.parse(t+"")},Z.parseXML=function(t){var e,i;if(!t||"string"!=typeof t)return null;try{i=new DOMParser,e=i.parseFromString(t,"text/xml")}catch(n){e=void 0}return(!e||e.getElementsByTagName("parsererror").length)&&Z.error("Invalid XML: "+t),e};var he=/#.*$/,pe=/([?&])_=[^&]*/,de=/^(.*?):[ \t]*([^\r\n]*)$/gm,fe=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,me=/^(?:GET|HEAD)$/,ge=/^\/\//,be=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,ye={},ve={},_e="*/".concat("*"),xe=t.location.href,Ce=be.exec(xe.toLowerCase())||[];Z.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:xe,type:"GET",isLocal:fe.test(Ce[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":_e,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":Z.parseJSON,"text xml":Z.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?M(M(t,Z.ajaxSettings),e):M(Z.ajaxSettings,t)},ajaxPrefilter:R(ye),ajaxTransport:R(ve),ajax:function(t,e){function i(t,e,i,o){var l,c,b,y,_,C=e;2!==v&&(v=2,a&&clearTimeout(a),n=void 0,r=o||"",x.readyState=t>0?4:0,l=t>=200&&300>t||304===t,i&&(y=F(h,x,i)),y=B(h,y,x,l),l?(h.ifModified&&(_=x.getResponseHeader("Last-Modified"),_&&(Z.lastModified[s]=_),_=x.getResponseHeader("etag"),_&&(Z.etag[s]=_)),204===t||"HEAD"===h.type?C="nocontent":304===t?C="notmodified":(C=y.state,c=y.data,b=y.error,l=!b)):(b=C,(t||!C)&&(C="error",0>t&&(t=0))),x.status=t,x.statusText=(e||C)+"",l?f.resolveWith(p,[c,C,x]):f.rejectWith(p,[x,C,b]),x.statusCode(g),g=void 0,u&&d.trigger(l?"ajaxSuccess":"ajaxError",[x,h,l?c:b]),m.fireWith(p,[x,C]),u&&(d.trigger("ajaxComplete",[x,h]),--Z.active||Z.event.trigger("ajaxStop")))}"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,s,r,o,a,l,u,c,h=Z.ajaxSetup({},e),p=h.context||h,d=h.context&&(p.nodeType||p.jquery)?Z(p):Z.event,f=Z.Deferred(),m=Z.Callbacks("once memory"),g=h.statusCode||{},b={},y={},v=0,_="canceled",x={readyState:0,getResponseHeader:function(t){var e;if(2===v){if(!o)for(o={};e=de.exec(r);)o[e[1].toLowerCase()]=e[2];e=o[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===v?r:null},setRequestHeader:function(t,e){var i=t.toLowerCase();return v||(t=y[i]=y[i]||t,b[t]=e),this},overrideMimeType:function(t){return v||(h.mimeType=t),this},statusCode:function(t){var e;if(t)if(2>v)for(e in t)g[e]=[g[e],t[e]];else x.always(t[x.status]);return this},abort:function(t){var e=t||_;return n&&n.abort(e),i(0,e),this}};if(f.promise(x).complete=m.add,x.success=x.done,x.error=x.fail,h.url=((t||h.url||xe)+"").replace(he,"").replace(ge,Ce[1]+"//"),h.type=e.method||e.type||h.method||h.type,h.dataTypes=Z.trim(h.dataType||"*").toLowerCase().match(dt)||[""],null==h.crossDomain&&(l=be.exec(h.url.toLowerCase()),h.crossDomain=!(!l||l[1]===Ce[1]&&l[2]===Ce[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(Ce[3]||("http:"===Ce[1]?"80":"443")))),h.data&&h.processData&&"string"!=typeof h.data&&(h.data=Z.param(h.data,h.traditional)),j(ye,h,e,x),2===v)return x;u=Z.event&&h.global,u&&0===Z.active++&&Z.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!me.test(h.type),s=h.url,h.hasContent||(h.data&&(s=h.url+=(ce.test(s)?"&":"?")+h.data,delete h.data),h.cache===!1&&(h.url=pe.test(s)?s.replace(pe,"$1_="+ue++):s+(ce.test(s)?"&":"?")+"_="+ue++)),h.ifModified&&(Z.lastModified[s]&&x.setRequestHeader("If-Modified-Since",Z.lastModified[s]),Z.etag[s]&&x.setRequestHeader("If-None-Match",Z.etag[s])),(h.data&&h.hasContent&&h.contentType!==!1||e.contentType)&&x.setRequestHeader("Content-Type",h.contentType),x.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+_e+"; q=0.01":""):h.accepts["*"]);for(c in h.headers)x.setRequestHeader(c,h.headers[c]);if(h.beforeSend&&(h.beforeSend.call(p,x,h)===!1||2===v))return x.abort();_="abort";for(c in{success:1,error:1,complete:1})x[c](h[c]);if(n=j(ve,h,e,x)){x.readyState=1,u&&d.trigger("ajaxSend",[x,h]),h.async&&h.timeout>0&&(a=setTimeout(function(){x.abort("timeout")},h.timeout));try{v=1,n.send(b,i)}catch(C){if(!(2>v))throw C;i(-1,C)}}else i(-1,"No Transport");return x},getJSON:function(t,e,i){return Z.get(t,e,i,"json")},getScript:function(t,e){return Z.get(t,void 0,e,"script")}}),Z.each(["get","post"],function(t,e){Z[e]=function(t,i,n,s){return Z.isFunction(i)&&(s=s||n,n=i,i=void 0),Z.ajax({url:t,type:e,dataType:s,data:i,success:n})}}),Z._evalUrl=function(t){return Z.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},Z.fn.extend({wrapAll:function(t){var e;return Z.isFunction(t)?this.each(function(e){Z(this).wrapAll(t.call(this,e))}):(this[0]&&(e=Z(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this)},wrapInner:function(t){return Z.isFunction(t)?this.each(function(e){Z(this).wrapInner(t.call(this,e))}):this.each(function(){var e=Z(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=Z.isFunction(t);return this.each(function(i){Z(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(){return this.parent().each(function(){Z.nodeName(this,"body")||Z(this).replaceWith(this.childNodes)}).end()}}),Z.expr.filters.hidden=function(t){return t.offsetWidth<=0&&t.offsetHeight<=0},Z.expr.filters.visible=function(t){return!Z.expr.filters.hidden(t)};var we=/%20/g,Se=/\[\]$/,Te=/\r?\n/g,Ee=/^(?:submit|button|image|reset|file)$/i,Ie=/^(?:input|select|textarea|keygen)/i;Z.param=function(t,e){var i,n=[],s=function(t,e){e=Z.isFunction(e)?e():null==e?"":e,n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(void 0===e&&(e=Z.ajaxSettings&&Z.ajaxSettings.traditional),Z.isArray(t)||t.jquery&&!Z.isPlainObject(t))Z.each(t,function(){s(this.name,this.value)});else for(i in t)q(i,t[i],e,s);return n.join("&").replace(we,"+")},Z.fn.extend({serialize:function(){return Z.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=Z.prop(this,"elements");return t?Z.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!Z(this).is(":disabled")&&Ie.test(this.nodeName)&&!Ee.test(t)&&(this.checked||!St.test(t))}).map(function(t,e){var i=Z(this).val();return null==i?null:Z.isArray(i)?Z.map(i,function(t){return{name:e.name,value:t.replace(Te,"\r\n")}}):{name:e.name,value:i.replace(Te,"\r\n")}}).get()}}),Z.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(t){}};var Ae=0,Oe={},Ne={0:200,1223:204},ke=Z.ajaxSettings.xhr();t.attachEvent&&t.attachEvent("onunload",function(){for(var t in Oe)Oe[t]()}),J.cors=!!ke&&"withCredentials"in ke,J.ajax=ke=!!ke,Z.ajaxTransport(function(t){var e;return J.cors||ke&&!t.crossDomain?{send:function(i,n){var s,r=t.xhr(),o=++Ae;if(r.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)r[s]=t.xhrFields[s];t.mimeType&&r.overrideMimeType&&r.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(s in i)r.setRequestHeader(s,i[s]);e=function(t){return function(){e&&(delete Oe[o],e=r.onload=r.onerror=null,"abort"===t?r.abort():"error"===t?n(r.status,r.statusText):n(Ne[r.status]||r.status,r.statusText,"string"==typeof r.responseText?{text:r.responseText}:void 0,r.getAllResponseHeaders()))}},r.onload=e(),r.onerror=e("error"),e=Oe[o]=e("abort");try{r.send(t.hasContent&&t.data||null)}catch(a){if(e)throw a}},abort:function(){e&&e()}}:void 0}),Z.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(t){return Z.globalEval(t),t}}}),Z.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),Z.ajaxTransport("script",function(t){if(t.crossDomain){var e,i;return{send:function(n,s){e=Z("<script>").prop({async:!0,charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&s("error"===t.type?404:200,t.type)}),Q.head.appendChild(e[0])},abort:function(){i&&i()}}}});var Pe=[],De=/(=)\?(?=&|$)|\?\?/;Z.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Pe.pop()||Z.expando+"_"+ue++;return this[t]=!0,t}}),Z.ajaxPrefilter("json jsonp",function(e,i,n){var s,r,o,a=e.jsonp!==!1&&(De.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&De.test(e.data)&&"data");return a||"jsonp"===e.dataTypes[0]?(s=e.jsonpCallback=Z.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(De,"$1"+s):e.jsonp!==!1&&(e.url+=(ce.test(e.url)?"&":"?")+e.jsonp+"="+s),e.converters["script json"]=function(){return o||Z.error(s+" was not called"),o[0]},e.dataTypes[0]="json",r=t[s],t[s]=function(){o=arguments},n.always(function(){t[s]=r,e[s]&&(e.jsonpCallback=i.jsonpCallback,Pe.push(s)),o&&Z.isFunction(r)&&r(o[0]),o=r=void 0}),"script"):void 0}),Z.parseHTML=function(t,e,i){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(i=e,e=!1),e=e||Q;var n=ot.exec(t),s=!i&&[];return n?[e.createElement(n[1])]:(n=Z.buildFragment([t],e,s),s&&s.length&&Z(s).remove(),Z.merge([],n.childNodes))};var Le=Z.fn.load;Z.fn.load=function(t,e,i){if("string"!=typeof t&&Le)return Le.apply(this,arguments);var n,s,r,o=this,a=t.indexOf(" ");return a>=0&&(n=Z.trim(t.slice(a)),t=t.slice(0,a)),Z.isFunction(e)?(i=e,e=void 0):e&&"object"==typeof e&&(s="POST"),o.length>0&&Z.ajax({url:t,type:s,dataType:"html",data:e}).done(function(t){r=arguments,o.html(n?Z("<div>").append(Z.parseHTML(t)).find(n):t)}).complete(i&&function(t,e){o.each(i,r||[t.responseText,e,t])}),this},Z.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){Z.fn[e]=function(t){return this.on(e,t)}}),Z.expr.filters.animated=function(t){return Z.grep(Z.timers,function(e){return t===e.elem}).length};var Re=t.document.documentElement;Z.offset={setOffset:function(t,e,i){var n,s,r,o,a,l,u,c=Z.css(t,"position"),h=Z(t),p={};"static"===c&&(t.style.position="relative"),a=h.offset(),r=Z.css(t,"top"),l=Z.css(t,"left"),u=("absolute"===c||"fixed"===c)&&(r+l).indexOf("auto")>-1,u?(n=h.position(),o=n.top,s=n.left):(o=parseFloat(r)||0,s=parseFloat(l)||0),Z.isFunction(e)&&(e=e.call(t,i,a)),null!=e.top&&(p.top=e.top-a.top+o),null!=e.left&&(p.left=e.left-a.left+s),"using"in e?e.using.call(t,p):h.css(p)}},Z.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){Z.offset.setOffset(this,t,e)});var e,i,n=this[0],s={top:0,left:0},r=n&&n.ownerDocument;if(r)return e=r.documentElement,Z.contains(e,n)?(typeof n.getBoundingClientRect!==Tt&&(s=n.getBoundingClientRect()),i=U(r),{top:s.top+i.pageYOffset-e.clientTop,left:s.left+i.pageXOffset-e.clientLeft}):s},position:function(){if(this[0]){var t,e,i=this[0],n={top:0,left:0};return"fixed"===Z.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),Z.nodeName(t[0],"html")||(n=t.offset()),n.top+=Z.css(t[0],"borderTopWidth",!0),n.left+=Z.css(t[0],"borderLeftWidth",!0)),{top:e.top-n.top-Z.css(i,"marginTop",!0),left:e.left-n.left-Z.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||Re;t&&!Z.nodeName(t,"html")&&"static"===Z.css(t,"position");)t=t.offsetParent;return t||Re})}}),Z.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,i){var n="pageYOffset"===i;Z.fn[e]=function(s){return gt(this,function(e,s,r){var o=U(e);return void 0===r?o?o[i]:e[s]:void(o?o.scrollTo(n?t.pageXOffset:r,n?r:t.pageYOffset):e[s]=r)},e,s,arguments.length,null)}}),Z.each(["top","left"],function(t,e){Z.cssHooks[e]=C(J.pixelPosition,function(t,i){return i?(i=x(t,e),Ht.test(i)?Z(t).position()[e]+"px":i):void 0})}),Z.each({Height:"height",Width:"width"},function(t,e){Z.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,n){Z.fn[n]=function(n,s){var r=arguments.length&&(i||"boolean"!=typeof n),o=i||(n===!0||s===!0?"margin":"border");return gt(this,function(e,i,n){var s;return Z.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(s=e.documentElement,Math.max(e.body["scroll"+t],s["scroll"+t],e.body["offset"+t],s["offset"+t],s["client"+t])):void 0===n?Z.css(e,i,o):Z.style(e,i,n,o)},e,r?n:void 0,r,null)}})}),Z.fn.size=function(){return this.length},Z.fn.andSelf=Z.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return Z});var je=t.jQuery,Me=t.$;return Z.noConflict=function(e){return t.$===Z&&(t.$=Me),e&&t.jQuery===Z&&(t.jQuery=je),Z},typeof e===Tt&&(t.jQuery=t.$=Z),Z})},{}],150:[function(t,e,i){arguments[4][12][0].apply(i,arguments)},{dup:12}],151:[function(t,e,i){function n(t){return t?t[0]:void 0}e.exports=n},{}],152:[function(t,e,i){var n=t("../internal/baseIndexOf"),s=t("../internal/cacheIndexOf"),r=t("../internal/createCache"),o=t("../internal/isArrayLike"),a=t("../function/restParam"),l=a(function(t){for(var e=t.length,i=e,a=Array(f),l=n,u=!0,c=[];i--;){var h=t[i]=o(h=t[i])?h:[];a[i]=u&&h.length>=120?r(i&&h):null}var p=t[0],d=-1,f=p?p.length:0,m=a[0];t:for(;++d<f;)if(h=p[d],(m?s(m,h):l(c,h,0))<0){for(var i=e;--i;){var g=a[i];if((g?s(g,h):l(t[i],h,0))<0)continue t}m&&m.push(h),c.push(h)}return c});e.exports=l},{"../function/restParam":171,"../internal/baseIndexOf":199,"../internal/cacheIndexOf":217,"../internal/createCache":227,"../internal/isArrayLike":246}],153:[function(t,e,i){arguments[4][13][0].apply(i,arguments)},{dup:13}],154:[function(t,e,i){var n=t("../internal/baseFlatten"),s=t("../internal/baseUniq"),r=t("../function/restParam"),o=r(function(t){return s(n(t,!1,!0))});e.exports=o},{"../function/restParam":171,"../internal/baseFlatten":194,"../internal/baseUniq":213}],155:[function(t,e,i){function n(t,e,i,n){var l=t?t.length:0;return l?(null!=e&&"boolean"!=typeof e&&(n=i,i=o(t,e,n)?void 0:e,e=!1),i=null==i?i:s(i,n,3),e?a(t,i):r(t,i)):[]}var s=t("../internal/baseCallback"),r=t("../internal/baseUniq"),o=t("../internal/isIterateeCall"),a=t("../internal/sortedUniq");e.exports=n},{"../internal/baseCallback":183,"../internal/baseUniq":213,"../internal/isIterateeCall":248,"../internal/sortedUniq":263}],156:[function(t,e,i){arguments[4][14][0].apply(i,arguments)},{"../function/restParam":171,"../internal/baseDifference":189,"../internal/isArrayLike":246,dup:14}],157:[function(t,e,i){function n(t){if(l(t)&&!a(t)&&!(t instanceof s)){if(t instanceof r)return t;if(h.call(t,"__chain__")&&h.call(t,"__wrapped__"))return u(t)}return new r(t)}var s=t("../internal/LazyWrapper"),r=t("../internal/LodashWrapper"),o=t("../internal/baseLodash"),a=t("../lang/isArray"),l=t("../internal/isObjectLike"),u=t("../internal/wrapperClone"),c=Object.prototype,h=c.hasOwnProperty;n.prototype=o.prototype,e.exports=n},{"../internal/LazyWrapper":172,"../internal/LodashWrapper":173,"../internal/baseLodash":203,"../internal/isObjectLike":252,"../internal/wrapperClone":266,"../lang/isArray":270}],158:[function(t,e,i){e.exports=t("./forEach")},{"./forEach":161}],159:[function(t,e,i){function n(t,e,i){var n=a(t)?s:o;return e=r(e,i,3),n(t,e)}var s=t("../internal/arrayFilter"),r=t("../internal/baseCallback"),o=t("../internal/baseFilter"),a=t("../lang/isArray");e.exports=n},{"../internal/arrayFilter":177,"../internal/baseCallback":183,"../internal/baseFilter":191,"../lang/isArray":270}],160:[function(t,e,i){var n=t("../internal/baseEach"),s=t("../internal/createFind"),r=s(n);e.exports=r},{"../internal/baseEach":190,"../internal/createFind":229}],161:[function(t,e,i){var n=t("../internal/arrayEach"),s=t("../internal/baseEach"),r=t("../internal/createForEach"),o=r(n,s);e.exports=o},{"../internal/arrayEach":176,"../internal/baseEach":190,"../internal/createForEach":230}],162:[function(t,e,i){function n(t,e,i,n){var p=t?r(t):0;return l(p)||(t=c(t),p=t.length),i="number"!=typeof i||n&&a(e,i,n)?0:0>i?h(p+i,0):i||0,"string"==typeof t||!o(t)&&u(t)?p>=i&&t.indexOf(e,i)>-1:!!p&&s(t,e,i)>-1}var s=t("../internal/baseIndexOf"),r=t("../internal/getLength"),o=t("../lang/isArray"),a=t("../internal/isIterateeCall"),l=t("../internal/isLength"),u=t("../lang/isString"),c=t("../object/values"),h=Math.max;e.exports=n},{"../internal/baseIndexOf":199,"../internal/getLength":239,"../internal/isIterateeCall":248,"../internal/isLength":251,"../lang/isArray":270,"../lang/isString":279,"../object/values":287}],163:[function(t,e,i){var n=t("../internal/createAggregator"),s=n(function(t,e,i){t[i]=e});e.exports=s},{"../internal/createAggregator":222}],164:[function(t,e,i){function n(t,e,i){var n=a(t)?s:o;return e=r(e,i,3),n(t,e)}var s=t("../internal/arrayMap"),r=t("../internal/baseCallback"),o=t("../internal/baseMap"),a=t("../lang/isArray");e.exports=n},{"../internal/arrayMap":178,"../internal/baseCallback":183,"../internal/baseMap":204,"../lang/isArray":270}],165:[function(t,e,i){function n(t,e){return s(t,r(e))}var s=t("./map"),r=t("../utility/property");e.exports=n},{"../utility/property":291,"./map":164}],166:[function(t,e,i){arguments[4][15][0].apply(i,arguments)},{"../internal/baseCallback":183,"../internal/baseMap":204,"../internal/baseSortBy":211,"../internal/compareAscending":219,"../internal/isIterateeCall":248,dup:15}],167:[function(t,e,i){var n=t("../internal/getNative"),s=n(Date,"now"),r=s||function(){return(new Date).getTime()};e.exports=r},{"../internal/getNative":241}],168:[function(t,e,i){var n=t("../internal/createWrapper"),s=t("../internal/replaceHolders"),r=t("./restParam"),o=1,a=32,l=r(function(t,e,i){var r=o;if(i.length){var u=s(i,l.placeholder);r|=a}return n(t,r,e,i,u)});l.placeholder={},e.exports=l},{"../internal/createWrapper":233,"../internal/replaceHolders":260,"./restParam":171}],169:[function(t,e,i){function n(t,e,i){function n(){b&&clearTimeout(b),d&&clearTimeout(d),v=0,d=b=y=void 0}function l(e,i){i&&clearTimeout(i),d=b=y=void 0,e&&(v=r(),f=t.apply(g,p),b||d||(p=g=void 0))}function u(){var t=e-(r()-m);0>=t||t>e?l(y,d):b=setTimeout(u,t)}function c(){l(x,b)}function h(){if(p=arguments,m=r(),g=this,y=x&&(b||!C),_===!1)var i=C&&!b;else{d||C||(v=m);var n=_-(m-v),s=0>=n||n>_;s?(d&&(d=clearTimeout(d)),v=m,f=t.apply(g,p)):d||(d=setTimeout(c,n))}return s&&b?b=clearTimeout(b):b||e===_||(b=setTimeout(u,e)),i&&(s=!0,f=t.apply(g,p)),!s||b||d||(p=g=void 0),f}var p,d,f,m,g,b,y,v=0,_=!1,x=!0;if("function"!=typeof t)throw new TypeError(o);if(e=0>e?0:+e||0,i===!0){var C=!0;x=!1}else s(i)&&(C=!!i.leading,_="maxWait"in i&&a(+i.maxWait||0,e),x="trailing"in i?!!i.trailing:x);return h.cancel=n,h}var s=t("../lang/isObject"),r=t("../date/now"),o="Expected a function",a=Math.max;e.exports=n},{"../date/now":167,"../lang/isObject":278}],170:[function(t,e,i){var n=t("../internal/baseDelay"),s=t("./restParam"),r=s(function(t,e,i){return n(t,e,i)});e.exports=r},{"../internal/baseDelay":188,
"./restParam":171}],171:[function(t,e,i){arguments[4][16][0].apply(i,arguments)},{dup:16}],172:[function(t,e,i){function n(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=o,this.__views__=[]}var s=t("./baseCreate"),r=t("./baseLodash"),o=Number.POSITIVE_INFINITY;n.prototype=s(r.prototype),n.prototype.constructor=n,e.exports=n},{"./baseCreate":187,"./baseLodash":203}],173:[function(t,e,i){function n(t,e,i){this.__wrapped__=t,this.__actions__=i||[],this.__chain__=!!e}var s=t("./baseCreate"),r=t("./baseLodash");n.prototype=s(r.prototype),n.prototype.constructor=n,e.exports=n},{"./baseCreate":187,"./baseLodash":203}],174:[function(t,e,i){arguments[4][17][0].apply(i,arguments)},{"./cachePush":218,"./getNative":241,dup:17}],175:[function(t,e,i){function n(t,e){var i=-1,n=t.length;for(e||(e=Array(n));++i<n;)e[i]=t[i];return e}e.exports=n},{}],176:[function(t,e,i){function n(t,e){for(var i=-1,n=t.length;++i<n&&e(t[i],i,t)!==!1;);return t}e.exports=n},{}],177:[function(t,e,i){function n(t,e){for(var i=-1,n=t.length,s=-1,r=[];++i<n;){var o=t[i];e(o,i,t)&&(r[++s]=o)}return r}e.exports=n},{}],178:[function(t,e,i){arguments[4][18][0].apply(i,arguments)},{dup:18}],179:[function(t,e,i){arguments[4][19][0].apply(i,arguments)},{dup:19}],180:[function(t,e,i){arguments[4][20][0].apply(i,arguments)},{dup:20}],181:[function(t,e,i){function n(t,e,i){for(var n=-1,r=s(e),o=r.length;++n<o;){var a=r[n],l=t[a],u=i(l,e[a],a,t,e);(u===u?u===l:l!==l)&&(void 0!==l||a in t)||(t[a]=u)}return t}var s=t("../object/keys");e.exports=n},{"../object/keys":283}],182:[function(t,e,i){function n(t,e){return null==e?t:s(e,r(e),t)}var s=t("./baseCopy"),r=t("../object/keys");e.exports=n},{"../object/keys":283,"./baseCopy":186}],183:[function(t,e,i){arguments[4][21][0].apply(i,arguments)},{"../utility/identity":289,"../utility/property":291,"./baseMatches":205,"./baseMatchesProperty":206,"./bindCallback":215,dup:21}],184:[function(t,e,i){function n(t,e,i,f,m,g,b){var v;if(i&&(v=m?i(t,f,m):i(t)),void 0!==v)return v;if(!p(t))return t;var _=h(t);if(_){if(v=l(t),!e)return s(t,v)}else{var C=F.call(t),w=C==y;if(C!=x&&C!=d&&(!w||m))return j[C]?u(t,C,e):m?t:{};if(v=c(w?{}:t),!e)return o(v,t)}g||(g=[]),b||(b=[]);for(var S=g.length;S--;)if(g[S]==t)return b[S];return g.push(t),b.push(v),(_?r:a)(t,function(s,r){v[r]=n(s,e,i,r,t,g,b)}),v}var s=t("./arrayCopy"),r=t("./arrayEach"),o=t("./baseAssign"),a=t("./baseForOwn"),l=t("./initCloneArray"),u=t("./initCloneByTag"),c=t("./initCloneObject"),h=t("../lang/isArray"),p=t("../lang/isObject"),d="[object Arguments]",f="[object Array]",m="[object Boolean]",g="[object Date]",b="[object Error]",y="[object Function]",v="[object Map]",_="[object Number]",x="[object Object]",C="[object RegExp]",w="[object Set]",S="[object String]",T="[object WeakMap]",E="[object ArrayBuffer]",I="[object Float32Array]",A="[object Float64Array]",O="[object Int8Array]",N="[object Int16Array]",k="[object Int32Array]",P="[object Uint8Array]",D="[object Uint8ClampedArray]",L="[object Uint16Array]",R="[object Uint32Array]",j={};j[d]=j[f]=j[E]=j[m]=j[g]=j[I]=j[A]=j[O]=j[N]=j[k]=j[_]=j[x]=j[C]=j[S]=j[P]=j[D]=j[L]=j[R]=!0,j[b]=j[y]=j[v]=j[w]=j[T]=!1;var M=Object.prototype,F=M.toString;e.exports=n},{"../lang/isArray":270,"../lang/isObject":278,"./arrayCopy":175,"./arrayEach":176,"./baseAssign":182,"./baseForOwn":197,"./initCloneArray":243,"./initCloneByTag":244,"./initCloneObject":245}],185:[function(t,e,i){arguments[4][22][0].apply(i,arguments)},{dup:22}],186:[function(t,e,i){function n(t,e,i){i||(i={});for(var n=-1,s=e.length;++n<s;){var r=e[n];i[r]=t[r]}return i}e.exports=n},{}],187:[function(t,e,i){var n=t("../lang/isObject"),s=function(){function t(){}return function(e){if(n(e)){t.prototype=e;var i=new t;t.prototype=void 0}return i||{}}}();e.exports=s},{"../lang/isObject":278}],188:[function(t,e,i){function n(t,e,i){if("function"!=typeof t)throw new TypeError(s);return setTimeout(function(){t.apply(void 0,i)},e)}var s="Expected a function";e.exports=n},{}],189:[function(t,e,i){arguments[4][23][0].apply(i,arguments)},{"./baseIndexOf":199,"./cacheIndexOf":217,"./createCache":227,dup:23}],190:[function(t,e,i){arguments[4][24][0].apply(i,arguments)},{"./baseForOwn":197,"./createBaseEach":224,dup:24}],191:[function(t,e,i){function n(t,e){var i=[];return s(t,function(t,n,s){e(t,n,s)&&i.push(t)}),i}var s=t("./baseEach");e.exports=n},{"./baseEach":190}],192:[function(t,e,i){function n(t,e,i,n){var s;return i(t,function(t,i,r){return e(t,i,r)?(s=n?i:t,!1):void 0}),s}e.exports=n},{}],193:[function(t,e,i){function n(t,e,i){for(var n=t.length,s=i?n:-1;i?s--:++s<n;)if(e(t[s],s,t))return s;return-1}e.exports=n},{}],194:[function(t,e,i){arguments[4][25][0].apply(i,arguments)},{"../lang/isArguments":269,"../lang/isArray":270,"./arrayPush":179,"./isArrayLike":246,"./isObjectLike":252,dup:25}],195:[function(t,e,i){arguments[4][26][0].apply(i,arguments)},{"./createBaseFor":225,dup:26}],196:[function(t,e,i){arguments[4][27][0].apply(i,arguments)},{"../object/keysIn":284,"./baseFor":195,dup:27}],197:[function(t,e,i){arguments[4][28][0].apply(i,arguments)},{"../object/keys":283,"./baseFor":195,dup:28}],198:[function(t,e,i){arguments[4][29][0].apply(i,arguments)},{"./toObject":264,dup:29}],199:[function(t,e,i){arguments[4][30][0].apply(i,arguments)},{"./indexOfNaN":242,dup:30}],200:[function(t,e,i){arguments[4][31][0].apply(i,arguments)},{"../lang/isObject":278,"./baseIsEqualDeep":201,"./isObjectLike":252,dup:31}],201:[function(t,e,i){arguments[4][32][0].apply(i,arguments)},{"../lang/isArray":270,"../lang/isTypedArray":280,"./equalArrays":234,"./equalByTag":235,"./equalObjects":236,dup:32}],202:[function(t,e,i){arguments[4][33][0].apply(i,arguments)},{"./baseIsEqual":200,"./toObject":264,dup:33}],203:[function(t,e,i){function n(){}e.exports=n},{}],204:[function(t,e,i){arguments[4][34][0].apply(i,arguments)},{"./baseEach":190,"./isArrayLike":246,dup:34}],205:[function(t,e,i){arguments[4][35][0].apply(i,arguments)},{"./baseIsMatch":202,"./getMatchData":240,"./toObject":264,dup:35}],206:[function(t,e,i){arguments[4][36][0].apply(i,arguments)},{"../array/last":153,"../lang/isArray":270,"./baseGet":198,"./baseIsEqual":200,"./baseSlice":210,"./isKey":249,"./isStrictComparable":253,"./toObject":264,"./toPath":265,dup:36}],207:[function(t,e,i){arguments[4][37][0].apply(i,arguments)},{dup:37}],208:[function(t,e,i){arguments[4][38][0].apply(i,arguments)},{"./baseGet":198,"./toPath":265,dup:38}],209:[function(t,e,i){var n=t("../utility/identity"),s=t("./metaMap"),r=s?function(t,e){return s.set(t,e),t}:n;e.exports=r},{"../utility/identity":289,"./metaMap":255}],210:[function(t,e,i){arguments[4][39][0].apply(i,arguments)},{dup:39}],211:[function(t,e,i){arguments[4][40][0].apply(i,arguments)},{dup:40}],212:[function(t,e,i){arguments[4][41][0].apply(i,arguments)},{dup:41}],213:[function(t,e,i){function n(t,e){var i=-1,n=s,l=t.length,u=!0,c=u&&l>=a,h=c?o():null,p=[];h?(n=r,u=!1):(c=!1,h=e?[]:p);t:for(;++i<l;){var d=t[i],f=e?e(d,i,t):d;if(u&&d===d){for(var m=h.length;m--;)if(h[m]===f)continue t;e&&h.push(f),p.push(d)}else n(h,f,0)<0&&((e||c)&&h.push(f),p.push(d))}return p}var s=t("./baseIndexOf"),r=t("./cacheIndexOf"),o=t("./createCache"),a=200;e.exports=n},{"./baseIndexOf":199,"./cacheIndexOf":217,"./createCache":227}],214:[function(t,e,i){function n(t,e){for(var i=-1,n=e.length,s=Array(n);++i<n;)s[i]=t[e[i]];return s}e.exports=n},{}],215:[function(t,e,i){arguments[4][42][0].apply(i,arguments)},{"../utility/identity":289,dup:42}],216:[function(t,e,i){(function(t){function i(t){var e=new n(t.byteLength),i=new s(e);return i.set(new s(t)),e}var n=t.ArrayBuffer,s=t.Uint8Array;e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],217:[function(t,e,i){arguments[4][43][0].apply(i,arguments)},{"../lang/isObject":278,dup:43}],218:[function(t,e,i){arguments[4][44][0].apply(i,arguments)},{"../lang/isObject":278,dup:44}],219:[function(t,e,i){arguments[4][45][0].apply(i,arguments)},{"./baseCompareAscending":185,dup:45}],220:[function(t,e,i){function n(t,e,i){for(var n=i.length,r=-1,o=s(t.length-n,0),a=-1,l=e.length,u=Array(l+o);++a<l;)u[a]=e[a];for(;++r<n;)u[i[r]]=t[r];for(;o--;)u[a++]=t[r++];return u}var s=Math.max;e.exports=n},{}],221:[function(t,e,i){function n(t,e,i){for(var n=-1,r=i.length,o=-1,a=s(t.length-r,0),l=-1,u=e.length,c=Array(a+u);++o<a;)c[o]=t[o];for(var h=o;++l<u;)c[h+l]=e[l];for(;++n<r;)c[h+i[n]]=t[o++];return c}var s=Math.max;e.exports=n},{}],222:[function(t,e,i){function n(t,e){return function(i,n,a){var l=e?e():{};if(n=s(n,a,3),o(i))for(var u=-1,c=i.length;++u<c;){var h=i[u];t(l,h,n(h,u,i),i)}else r(i,function(e,i,s){t(l,e,n(e,i,s),s)});return l}}var s=t("./baseCallback"),r=t("./baseEach"),o=t("../lang/isArray");e.exports=n},{"../lang/isArray":270,"./baseCallback":183,"./baseEach":190}],223:[function(t,e,i){function n(t){return o(function(e,i){var n=-1,o=null==e?0:i.length,a=o>2?i[o-2]:void 0,l=o>2?i[2]:void 0,u=o>1?i[o-1]:void 0;for("function"==typeof a?(a=s(a,u,5),o-=2):(a="function"==typeof u?u:void 0,o-=a?1:0),l&&r(i[0],i[1],l)&&(a=3>o?void 0:a,o=1);++n<o;){var c=i[n];c&&t(e,c,a)}return e})}var s=t("./bindCallback"),r=t("./isIterateeCall"),o=t("../function/restParam");e.exports=n},{"../function/restParam":171,"./bindCallback":215,"./isIterateeCall":248}],224:[function(t,e,i){arguments[4][46][0].apply(i,arguments)},{"./getLength":239,"./isLength":251,"./toObject":264,dup:46}],225:[function(t,e,i){arguments[4][47][0].apply(i,arguments)},{"./toObject":264,dup:47}],226:[function(t,e,i){(function(i){function n(t,e){function n(){var s=this&&this!==i&&this instanceof n?r:t;return s.apply(e,arguments)}var r=s(t);return n}var s=t("./createCtorWrapper");e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./createCtorWrapper":228}],227:[function(t,e,i){arguments[4][48][0].apply(i,arguments)},{"./SetCache":174,"./getNative":241,dup:48}],228:[function(t,e,i){function n(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=s(t.prototype),n=t.apply(i,e);return r(n)?n:i}}var s=t("./baseCreate"),r=t("../lang/isObject");e.exports=n},{"../lang/isObject":278,"./baseCreate":187}],229:[function(t,e,i){function n(t,e){return function(i,n,l){if(n=s(n,l,3),a(i)){var u=o(i,n,e);return u>-1?i[u]:void 0}return r(i,n,t)}}var s=t("./baseCallback"),r=t("./baseFind"),o=t("./baseFindIndex"),a=t("../lang/isArray");e.exports=n},{"../lang/isArray":270,"./baseCallback":183,"./baseFind":192,"./baseFindIndex":193}],230:[function(t,e,i){function n(t,e){return function(i,n,o){return"function"==typeof n&&void 0===o&&r(i)?t(i,n):e(i,s(n,o,3))}}var s=t("./bindCallback"),r=t("../lang/isArray");e.exports=n},{"../lang/isArray":270,"./bindCallback":215}],231:[function(t,e,i){(function(i){function n(t,e,x,C,w,S,T,E,I,A){function O(){for(var f=arguments.length,m=f,g=Array(f);m--;)g[m]=arguments[m];if(C&&(g=r(g,C,w)),S&&(g=o(g,S,T)),D||R){var v=O.placeholder,M=c(g,v);if(f-=M.length,A>f){var F=E?s(E):void 0,B=_(A-f,0),q=D?M:void 0,U=D?void 0:M,H=D?g:void 0,$=D?void 0:g;e|=D?b:y,e&=~(D?y:b),L||(e&=~(p|d));var z=[t,e,x,H,q,$,U,F,I,B],V=n.apply(void 0,z);return l(t)&&h(V,z),V.placeholder=v,V}}var G=k?x:this,W=P?G[t]:t;return E&&(g=u(g,E)),N&&I<g.length&&(g.length=I),this&&this!==i&&this instanceof O&&(W=j||a(t)),W.apply(G,g)}var N=e&v,k=e&p,P=e&d,D=e&m,L=e&f,R=e&g,j=P?void 0:a(t);return O}var s=t("./arrayCopy"),r=t("./composeArgs"),o=t("./composeArgsRight"),a=t("./createCtorWrapper"),l=t("./isLaziable"),u=t("./reorder"),c=t("./replaceHolders"),h=t("./setData"),p=1,d=2,f=4,m=8,g=16,b=32,y=64,v=128,_=Math.max;e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./arrayCopy":175,"./composeArgs":220,"./composeArgsRight":221,"./createCtorWrapper":228,"./isLaziable":250,"./reorder":259,"./replaceHolders":260,"./setData":261}],232:[function(t,e,i){(function(i){function n(t,e,n,o){function a(){for(var e=-1,s=arguments.length,r=-1,c=o.length,h=Array(c+s);++r<c;)h[r]=o[r];for(;s--;)h[r++]=arguments[++e];var p=this&&this!==i&&this instanceof a?u:t;return p.apply(l?n:this,h)}var l=e&r,u=s(t);return a}var s=t("./createCtorWrapper"),r=1;e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./createCtorWrapper":228}],233:[function(t,e,i){function n(t,e,i,n,b,y,v,_){var x=e&p;if(!x&&"function"!=typeof t)throw new TypeError(m);var C=n?n.length:0;if(C||(e&=~(d|f),n=b=void 0),C-=b?b.length:0,e&f){var w=n,S=b;n=b=void 0}var T=x?void 0:l(t),E=[t,e,i,n,b,w,S,y,v,_];if(T&&(u(E,T),e=E[1],_=E[9]),E[9]=null==_?x?0:t.length:g(_-C,0)||0,e==h)var I=r(E[0],E[2]);else I=e!=d&&e!=(h|d)||E[4].length?o.apply(void 0,E):a.apply(void 0,E);var A=T?s:c;return A(I,E)}var s=t("./baseSetData"),r=t("./createBindWrapper"),o=t("./createHybridWrapper"),a=t("./createPartialWrapper"),l=t("./getData"),u=t("./mergeData"),c=t("./setData"),h=1,p=2,d=32,f=64,m="Expected a function",g=Math.max;e.exports=n},{"./baseSetData":209,"./createBindWrapper":226,"./createHybridWrapper":231,"./createPartialWrapper":232,"./getData":237,"./mergeData":254,"./setData":261}],234:[function(t,e,i){arguments[4][49][0].apply(i,arguments)},{"./arraySome":180,dup:49}],235:[function(t,e,i){arguments[4][50][0].apply(i,arguments)},{dup:50}],236:[function(t,e,i){arguments[4][51][0].apply(i,arguments)},{"../object/keys":283,dup:51}],237:[function(t,e,i){var n=t("./metaMap"),s=t("../utility/noop"),r=n?function(t){return n.get(t)}:s;e.exports=r},{"../utility/noop":290,"./metaMap":255}],238:[function(t,e,i){function n(t){for(var e=t.name+"",i=s[e],n=i?i.length:0;n--;){var r=i[n],o=r.func;if(null==o||o==t)return r.name}return e}var s=t("./realNames");e.exports=n},{"./realNames":258}],239:[function(t,e,i){arguments[4][52][0].apply(i,arguments)},{"./baseProperty":207,dup:52}],240:[function(t,e,i){arguments[4][53][0].apply(i,arguments)},{"../object/pairs":286,"./isStrictComparable":253,dup:53}],241:[function(t,e,i){arguments[4][54][0].apply(i,arguments)},{"../lang/isNative":276,dup:54}],242:[function(t,e,i){arguments[4][55][0].apply(i,arguments)},{dup:55}],243:[function(t,e,i){function n(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&r.call(t,"index")&&(i.index=t.index,i.input=t.input),i}var s=Object.prototype,r=s.hasOwnProperty;e.exports=n},{}],244:[function(t,e,i){function n(t,e,i){var n=t.constructor;switch(e){case c:return s(t);case r:case o:return new n(+t);case h:case p:case d:case f:case m:case g:case b:case y:case v:var x=t.buffer;return new n(i?s(x):x,t.byteOffset,t.length);case a:case u:return new n(t);case l:var C=new n(t.source,_.exec(t));C.lastIndex=t.lastIndex}return C}var s=t("./bufferClone"),r="[object Boolean]",o="[object Date]",a="[object Number]",l="[object RegExp]",u="[object String]",c="[object ArrayBuffer]",h="[object Float32Array]",p="[object Float64Array]",d="[object Int8Array]",f="[object Int16Array]",m="[object Int32Array]",g="[object Uint8Array]",b="[object Uint8ClampedArray]",y="[object Uint16Array]",v="[object Uint32Array]",_=/\w*$/;e.exports=n},{"./bufferClone":216}],245:[function(t,e,i){function n(t){var e=t.constructor;return"function"==typeof e&&e instanceof e||(e=Object),new e}e.exports=n},{}],246:[function(t,e,i){arguments[4][56][0].apply(i,arguments)},{"./getLength":239,"./isLength":251,dup:56}],247:[function(t,e,i){arguments[4][57][0].apply(i,arguments)},{dup:57}],248:[function(t,e,i){arguments[4][58][0].apply(i,arguments)},{"../lang/isObject":278,"./isArrayLike":246,"./isIndex":247,dup:58}],249:[function(t,e,i){arguments[4][59][0].apply(i,arguments)},{"../lang/isArray":270,"./toObject":264,dup:59}],250:[function(t,e,i){function n(t){var e=o(t),i=a[e];if("function"!=typeof i||!(e in s.prototype))return!1;if(t===i)return!0;var n=r(i);return!!n&&t===n[0]}var s=t("./LazyWrapper"),r=t("./getData"),o=t("./getFuncName"),a=t("../chain/lodash");e.exports=n},{"../chain/lodash":157,"./LazyWrapper":172,"./getData":237,"./getFuncName":238}],251:[function(t,e,i){arguments[4][60][0].apply(i,arguments)},{dup:60}],252:[function(t,e,i){arguments[4][61][0].apply(i,arguments)},{dup:61}],253:[function(t,e,i){arguments[4][62][0].apply(i,arguments)},{"../lang/isObject":278,dup:62}],254:[function(t,e,i){function n(t,e){var i=t[1],n=e[1],m=i|n,g=h>m,b=n==h&&i==c||n==h&&i==p&&t[7].length<=e[8]||n==(h|p)&&i==c;if(!g&&!b)return t;n&l&&(t[2]=e[2],m|=i&l?0:u);var y=e[3];if(y){var v=t[3];t[3]=v?r(v,y,e[4]):s(y),t[4]=v?a(t[3],d):s(e[4])}return y=e[5],y&&(v=t[5],t[5]=v?o(v,y,e[6]):s(y),t[6]=v?a(t[5],d):s(e[6])),y=e[7],y&&(t[7]=s(y)),n&h&&(t[8]=null==t[8]?e[8]:f(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=m,t}var s=t("./arrayCopy"),r=t("./composeArgs"),o=t("./composeArgsRight"),a=t("./replaceHolders"),l=1,u=4,c=8,h=128,p=256,d="__lodash_placeholder__",f=Math.min;e.exports=n},{"./arrayCopy":175,"./composeArgs":220,"./composeArgsRight":221,"./replaceHolders":260}],255:[function(t,e,i){(function(i){var n=t("./getNative"),s=n(i,"WeakMap"),r=s&&new s;e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./getNative":241}],256:[function(t,e,i){arguments[4][63][0].apply(i,arguments)},{"./toObject":264,dup:63}],257:[function(t,e,i){arguments[4][64][0].apply(i,arguments)},{"./baseForIn":196,dup:64}],258:[function(t,e,i){var n={};e.exports=n},{}],259:[function(t,e,i){function n(t,e){for(var i=t.length,n=o(e.length,i),a=s(t);n--;){var l=e[n];t[n]=r(l,i)?a[l]:void 0}return t}var s=t("./arrayCopy"),r=t("./isIndex"),o=Math.min;e.exports=n},{"./arrayCopy":175,"./isIndex":247}],260:[function(t,e,i){function n(t,e){for(var i=-1,n=t.length,r=-1,o=[];++i<n;)t[i]===e&&(t[i]=s,o[++r]=i);return o}var s="__lodash_placeholder__";e.exports=n},{}],261:[function(t,e,i){var n=t("./baseSetData"),s=t("../date/now"),r=150,o=16,a=function(){var t=0,e=0;return function(i,a){var l=s(),u=o-(l-e);if(e=l,u>0){if(++t>=r)return i}else t=0;return n(i,a)}}();e.exports=a},{"../date/now":167,"./baseSetData":209}],262:[function(t,e,i){arguments[4][65][0].apply(i,arguments)},{"../lang/isArguments":269,"../lang/isArray":270,"../object/keysIn":284,"./isIndex":247,"./isLength":251,dup:65}],263:[function(t,e,i){function n(t,e){for(var i,n=-1,s=t.length,r=-1,o=[];++n<s;){var a=t[n],l=e?e(a,n,t):a;n&&i===l||(i=l,o[++r]=a)}return o}e.exports=n},{}],264:[function(t,e,i){arguments[4][66][0].apply(i,arguments)},{"../lang/isObject":278,dup:66}],265:[function(t,e,i){arguments[4][67][0].apply(i,arguments)},{"../lang/isArray":270,"./baseToString":212,dup:67}],266:[function(t,e,i){function n(t){return t instanceof s?t.clone():new r(t.__wrapped__,t.__chain__,o(t.__actions__))}var s=t("./LazyWrapper"),r=t("./LodashWrapper"),o=t("./arrayCopy");e.exports=n},{"./LazyWrapper":172,"./LodashWrapper":173,"./arrayCopy":175}],267:[function(t,e,i){function n(t,e,i,n){return e&&"boolean"!=typeof e&&o(t,e,i)?e=!1:"function"==typeof e&&(n=i,i=e,e=!1),"function"==typeof i?s(t,e,r(i,n,3)):s(t,e)}var s=t("../internal/baseClone"),r=t("../internal/bindCallback"),o=t("../internal/isIterateeCall");e.exports=n},{"../internal/baseClone":184,"../internal/bindCallback":215,"../internal/isIterateeCall":248}],268:[function(t,e,i){function n(t,e,i){return"function"==typeof e?s(t,!0,r(e,i,3)):s(t,!0)}var s=t("../internal/baseClone"),r=t("../internal/bindCallback");e.exports=n},{"../internal/baseClone":184,"../internal/bindCallback":215}],269:[function(t,e,i){arguments[4][68][0].apply(i,arguments)},{"../internal/isArrayLike":246,"../internal/isObjectLike":252,dup:68}],270:[function(t,e,i){arguments[4][69][0].apply(i,arguments)},{"../internal/getNative":241,"../internal/isLength":251,"../internal/isObjectLike":252,dup:69}],271:[function(t,e,i){function n(t){return t===!0||t===!1||s(t)&&a.call(t)==r}var s=t("../internal/isObjectLike"),r="[object Boolean]",o=Object.prototype,a=o.toString;e.exports=n},{"../internal/isObjectLike":252}],272:[function(t,e,i){function n(t){return null==t?!0:o(t)&&(r(t)||u(t)||s(t)||l(t)&&a(t.splice))?!t.length:!c(t).length}var s=t("./isArguments"),r=t("./isArray"),o=t("../internal/isArrayLike"),a=t("./isFunction"),l=t("../internal/isObjectLike"),u=t("./isString"),c=t("../object/keys");e.exports=n},{"../internal/isArrayLike":246,"../internal/isObjectLike":252,"../object/keys":283,"./isArguments":269,"./isArray":270,"./isFunction":274,"./isString":279}],273:[function(t,e,i){function n(t,e,i,n){i="function"==typeof i?r(i,n,3):void 0;var o=i?i(t,e):void 0;return void 0===o?s(t,e,i):!!o}var s=t("../internal/baseIsEqual"),r=t("../internal/bindCallback");e.exports=n},{"../internal/baseIsEqual":200,"../internal/bindCallback":215}],274:[function(t,e,i){arguments[4][70][0].apply(i,arguments)},{"./isObject":278,dup:70}],275:[function(t,e,i){function n(t,e,i,n){return i="function"==typeof i?r(i,n,3):void 0,s(t,o(e),i)}var s=t("../internal/baseIsMatch"),r=t("../internal/bindCallback"),o=t("../internal/getMatchData");e.exports=n},{"../internal/baseIsMatch":202,"../internal/bindCallback":215,"../internal/getMatchData":240}],276:[function(t,e,i){arguments[4][71][0].apply(i,arguments)},{"../internal/isObjectLike":252,"./isFunction":274,dup:71}],277:[function(t,e,i){function n(t){return"number"==typeof t||s(t)&&a.call(t)==r}var s=t("../internal/isObjectLike"),r="[object Number]",o=Object.prototype,a=o.toString;e.exports=n},{"../internal/isObjectLike":252}],278:[function(t,e,i){arguments[4][72][0].apply(i,arguments)},{dup:72}],279:[function(t,e,i){function n(t){return"string"==typeof t||s(t)&&a.call(t)==r}var s=t("../internal/isObjectLike"),r="[object String]",o=Object.prototype,a=o.toString;e.exports=n},{"../internal/isObjectLike":252}],280:[function(t,e,i){arguments[4][73][0].apply(i,arguments)},{"../internal/isLength":251,"../internal/isObjectLike":252,dup:73}],281:[function(t,e,i){var n=t("../internal/assignWith"),s=t("../internal/baseAssign"),r=t("../internal/createAssigner"),o=r(function(t,e,i){return i?n(t,e,i):s(t,e)});e.exports=o},{"../internal/assignWith":181,"../internal/baseAssign":182,"../internal/createAssigner":223}],282:[function(t,e,i){e.exports=t("./assign")},{"./assign":281}],283:[function(t,e,i){arguments[4][74][0].apply(i,arguments)},{"../internal/getNative":241,"../internal/isArrayLike":246,"../internal/shimKeys":262,"../lang/isObject":278,dup:74}],284:[function(t,e,i){arguments[4][75][0].apply(i,arguments)},{"../internal/isIndex":247,"../internal/isLength":251,"../lang/isArguments":269,"../lang/isArray":270,"../lang/isObject":278,dup:75}],285:[function(t,e,i){arguments[4][76][0].apply(i,arguments)},{"../function/restParam":171,"../internal/arrayMap":178,"../internal/baseDifference":189,"../internal/baseFlatten":194,"../internal/bindCallback":215,"../internal/pickByArray":256,"../internal/pickByCallback":257,"./keysIn":284,dup:76}],286:[function(t,e,i){arguments[4][77][0].apply(i,arguments)},{"../internal/toObject":264,"./keys":283,dup:77}],287:[function(t,e,i){function n(t){return s(t,r(t))}var s=t("../internal/baseValues"),r=t("./keys");e.exports=n},{"../internal/baseValues":214,"./keys":283}],288:[function(t,e,i){function n(t){return t=s(t),t&&t.charAt(0).toUpperCase()+t.slice(1)}var s=t("../internal/baseToString");e.exports=n},{"../internal/baseToString":212}],289:[function(t,e,i){arguments[4][78][0].apply(i,arguments)},{dup:78}],290:[function(t,e,i){function n(){}e.exports=n},{}],291:[function(t,e,i){arguments[4][79][0].apply(i,arguments)},{"../internal/baseProperty":207,"../internal/basePropertyDeep":208,"../internal/isKey":249,dup:79}],292:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/TextBlock");s.extend(n),n["static"].name="blockquote",e.exports=n},{"../../model/TextBlock":113}],293:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("../../ui/Component"),r=s.$$,o=t("../../ui/TextPropertyComponent");n.Prototype=function(){this.getClassNames=function(){return"sc-blockquote"},this.render=function(){return r("div").addClass(this.getClassNames()).attr("data-id",this.props.node.id).append(r(o,{path:[this.props.node.id,"content"]}))}},s.extend(n),e.exports=n},{"../../ui/Component":365,"../../ui/TextPropertyComponent":395}],294:[function(t,e,i){"use strict";e.exports={type:"blockquote",tagName:"blockquote","import":function(t,e,i){e.content=i.annotatedText(t,[e.id,"content"])},"export":function(t,e,i){e.append(i.annotatedText([t.id,"content"]))}}},{}],295:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/PropertyAnnotation");s.extend(n),n["static"].name="code",e.exports=n},{"../../model/PropertyAnnotation":108}],296:[function(t,e,i){"use strict";var n=t("../../ui/AnnotationCommand"),s=n.extend();s["static"].name="code",s["static"].annotationType="code",e.exports=s},{"../../ui/AnnotationCommand":358}],297:[function(t,e,i){"use strict";e.exports={type:"code",tagName:"code"}},{}],298:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("../../ui/SurfaceTool");s.extend(n),n["static"].name="code",n["static"].command="code",e.exports=n},{"../../ui/SurfaceTool":390}],299:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/TextBlock");s.extend(n),n["static"].name="codeblock",e.exports=n},{"../../model/TextBlock":113}],300:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("../../ui/Component"),r=s.$$,o=t("../../ui/TextPropertyComponent");n.Prototype=function(){this.getClassNames=function(){return"sc-codeblock"},this.render=function(){return r("div").addClass(this.getClassNames()).attr("data-id",this.props.node.id).append(r(o,{path:[this.props.node.id,"content"]}))}},s.extend(n),e.exports=n},{"../../ui/Component":365,"../../ui/TextPropertyComponent":395}],301:[function(t,e,i){"use strict";e.exports={type:"codeblock",tagName:"pre","import":function(t,e,i){var n=t.find("code");n&&(e.content=i.annotatedText(n,[e.id,"content"],{preserveWhitespace:!0}))},"export":function(t,e,i){var n=i.$$;e.append(n("code").append(i.annotatedText([t.id,"content"])))}}},{}],302:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/BlockNode");s.extend(n),n["static"].name="embed",n["static"].defineSchema({src:"string",html:{type:"string","volatile":!0}}),e.exports=n},{"../../model/BlockNode":84}],303:[function(t,e,i){"use strict";var n=t("../../util/uuid"),s=t("../../ui/SurfaceCommand"),r=s.extend({"static":{name:"embed"},getCommandState:function(){var t=this.getSelection(),e={disabled:!0,active:!1};return t&&!t.isNull()&&t.isPropertySelection()&&(e.disabled=!1),e},execute:function(t){var e=this.getCommandState(),i=this.getSurface();return e.disabled?void 0:(i.transaction(function(e,s){var r=e.create({id:n("embed"),type:"embed",src:t.src,html:t.html}),o={id:n("image-figure"),type:"image-figure",content:r.id,title:"Enter title",caption:"Enter caption"};return i.insertNode(e,{selection:s.selection,node:o})}),{status:"embed-created"})}});e.exports=r},{"../../ui/SurfaceCommand":388,"../../util/uuid":416}],304:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("../../ui/Component"),r=s.$$;n.Prototype=function(){this.getClassNames=function(){return"content-node sc-embed"},this.render=function(){var t,e=this.props.node;return t=e.src&&e.html?r("div").html(e.html):r("div").append(r("input").attr({type:"text",value:"http://"}).ref("src")),r("div").addClass(this.getClassNames()).attr("data-id",this.props.node.id).append(t)}},s.extend(n),e.exports=n},{"../../ui/Component":365}],305:[function(t,e,i){"use strict";var n=t("lodash/object/extend"),s=t("lodash/string/capitalize"),r=t("../../ui/SurfaceTool"),o=t("../../ui/Component"),a=o.$$,l=o.extend({onSave:function(t){t.preventDefault(),this.props.tool.createEmbed(this.refs.url.$el.val())},render:function(){var t=a("div").addClass("se-prompt");return t.append([a("div").addClass("se-prompt-title").append(this.i18n.t("embed-src")),a("input").attr({type:"text",placeholder:"https://vimeo.com/...",value:""}).ref("url").on("change",this.onSave)]),t}}),u=r.extend({"static":{name:"embed",command:"embed"},onClick:function(){var t=n({},this.state,{showPrompt:!this.state.showPrompt});this.setState(t)},createEmbed:function(t){var e=this.getSurface(),i=this.constructor["static"].command,n=this.context.embedResolver;n(t,function(n,s){e.executeCommand(i,{src:t,html:s})})},render:function(){var t=this.props.title||s(this.getName());this.state.mode&&(t=[s(this.state.mode),t].join(" "));var e=a("div").addClass("sc-embed-tool se-tool");this.state.disabled&&e.addClass("sm-disabled");var i=a("button").addClass("button").attr("title",t).on("click",this.onClick);if(i.append(this.props.children),e.append(i),this.state.showPrompt){var n=a(l,{tool:this});e.append(n)}return e}});e.exports=u},{"../../ui/Component":365,"../../ui/SurfaceTool":390,"lodash/object/extend":282,"lodash/string/capitalize":288}],306:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/PropertyAnnotation"),r=t("../../model/Fragmenter");s.extend(n),n["static"].name="emphasis",n["static"].fragmentation=r.ANY,e.exports=n},{"../../model/Fragmenter":101,"../../model/PropertyAnnotation":108}],307:[function(t,e,i){"use strict";var n=t("../../ui/AnnotationCommand"),s=n.extend({"static":{name:"emphasis",annotationType:"emphasis"}});e.exports=s},{"../../ui/AnnotationCommand":358}],308:[function(t,e,i){"use strict";e.exports={type:"emphasis",tagName:"em",matchElement:function(t){return t.is("em, i")}}},{}],309:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../ui/AnnotationTool");s.extend(n),n["static"].name="emphasis",n["static"].command="emphasis",e.exports=n},{"../../ui/AnnotationTool":360}],310:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments),this.guid=this.id}var s=t("../../model/DocumentNode");s.extend(n,function(){this.setLabel=function(t){this.label=t,this.emit("label:changed",t)},this.setText=function(t){this.text=t},this.getContentNode=function(){return this.document.get(this.content)}}),n["static"].name="figure",n["static"].defineSchema({title:"text",content:"id",caption:"text",guid:{type:"id",optional:!0}}),e.exports=n},{"../../model/DocumentNode":96}],311:[function(t,e,i){"use strict";function n(){s.apply(this,arguments),this.props.node.connect(this,{"label:changed":this.onLabelChanged})}var s=t("../../ui/Component"),r=t("../../ui/TextPropertyComponent"),o=s.$$;n.Prototype=function(){this.dispose=function(){this.props.node.disconnect(this)},this.onLabelChanged=function(){this.rerender()},this.render=function(){var t=this.context.componentRegistry,e=this.props.node.getContentNode(),i=t.get(e.type),n=o("div").addClass("sc-figure").attr("data-id",this.props.node.id);return n.append(o("div").addClass("se-label").attr("contenteditable",!1).append(this.props.node.label)),n.append(o(r,{tagName:"div",path:[this.props.node.id,"title"]}).addClass("se-title")),n.append(o("div").addClass("se-figure-content").attr("contenteditable",!1).append(o(i,{doc:this.props.doc,node:e}))),n.append(o("div").addClass("se-description").append(o(r,{tagName:"div",path:[this.props.node.id,"caption"]}).addClass("se-caption"))),n}},s.extend(n),e.exports=n},{"../../ui/Component":365,"../../ui/TextPropertyComponent":395}],312:[function(t,e,i){"use strict";var n=t("lodash/collection/each");e.exports={type:"figure",tagName:"figure","import":function(t,e,i){n(t.children,function(t){
var n=t.tagName;switch(n){case"title":case"caption":e[n]=i.annotatedText(t,[e.id,n])}})},"export":function(t,e,i){var n=i.$$;return e.append(n("title").append(i.annotatedText([t.id,"title"]))),e.append(i.convertNode(t.getContentNode())),e.append(n("caption").append(i.annotatedText([t.id,"caption"]))),e}}},{"lodash/collection/each":158}],313:[function(t,e,i){"use strict";var n=t("../../util/uuid"),s=t("../../ui/SurfaceCommand"),r=t("../../util/jquery"),o=s.extend({"static":{name:"insertFigure"},getCommandState:function(){var t=this.getSelection(),e={disabled:!0,active:!1};return t&&!t.isNull()&&t.isPropertySelection()&&(e.disabled=!1),e},execute:function(){var t=this.getCommandState(),e=this.getSurface(),i=e.getController();if(!t.disabled){var s=e.$el,o=r('<input type="file" id="file_input" style="opacity: 0;">');return s.append(o),o.click(),o.on("change",function(){var t=o[0].files[0];o.remove(),i.uploadFile(t,function(t,i){var s={selection:e.getSelection()};e.transaction(s,function(t,s){var r=t.create({id:n("image"),type:"image",src:i,previewSrc:i}),o={id:n("image-figure"),type:"image-figure",content:r.id,title:"Enter title",caption:"Enter caption"};return e.insertNode(t,{selection:s.selection,node:o})})})}.bind(this)),{status:"file-upload-process-started"}}}});e.exports=o},{"../../ui/SurfaceCommand":388,"../../util/jquery":412,"../../util/uuid":416}],314:[function(t,e,i){var n=t("../../ui/SurfaceTool"),s=n.extend({"static":{name:"insertFigure",command:"insertFigure"}});e.exports=s},{"../../ui/SurfaceTool":390}],315:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/TextBlock");s.extend(n),n["static"].name="heading",n["static"].defineSchema({level:{type:"number","default":1}}),e.exports=n},{"../../model/TextBlock":113}],316:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("../../ui/Component"),r=s.$$,o=t("../../ui/TextPropertyComponent");n.Prototype=function(){this.render=function(){return r("div").addClass("sc-heading sm-level-"+this.props.node.level).attr("data-id",this.props.node.id).append(r(o,{path:[this.props.node.id,"content"]}))}},s.extend(n),e.exports=n},{"../../ui/Component":365,"../../ui/TextPropertyComponent":395}],317:[function(t,e,i){"use strict";e.exports={type:"heading",matchElement:function(t){return/^h\d$/.exec(t.tagName)},"import":function(t,e,i){e.level=parseInt(""+t.tagName[1],10),e.content=i.annotatedText(t,[e.id,"content"])},"export":function(t,e,i){return e=e.withTagName("h"+t.level),e.append(i.annotatedText([t.id,"content"])),e}}},{}],318:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/DocumentNode");s.extend(n),n["static"].name="image",n["static"].defineSchema({src:{type:"string","default":"http://"},previewSrc:{type:"string",optional:!0}}),e.exports=n},{"../../model/DocumentNode":96}],319:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("../../ui/Component"),r=s.$$;n.Prototype=function(){this.initialize=function(){var t=this.props.doc;t.connect(this,{"document:changed":this.handleDocumentChange})},this.dispose=function(){var t=this.props.doc;t.disconnect(this)},this.render=function(){return r("img").addClass("sc-image").attr({"data-id":this.props.node.id,contentEditable:!1,src:this.props.node.src})},this.handleDocumentChange=function(t){t.isAffected([this.props.node.id,"src"])&&this.rerender()}},s.extend(n),e.exports=n},{"../../ui/Component":365}],320:[function(t,e,i){"use strict";e.exports={type:"image",tagName:"image","import":function(t,e){e.src=t.attr("src"),e.previewSrc=t.attr("preview-src")},"export":function(t,e){e.attr("src",t.src).attr("preview-src",t.previewSrc)}}},{}],321:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/PropertyAnnotation"),r=t("../../model/Fragmenter");s.extend(n),n["static"].name="link",n["static"].defineSchema({title:{type:"string",optional:!0},url:{type:"string","default":"http://"}}),n["static"].fragmentation=r.SHOULD_NOT_SPLIT,e.exports=n},{"../../model/Fragmenter":101,"../../model/PropertyAnnotation":108}],322:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../ui/AnnotationCommand");n.Prototype=function(){this.getAnnotationData=function(){return{url:"",title:""}},this.canEdit=function(t,e){return 1===t.length}},s.extend(n),n["static"].name="link",n["static"].annotationType="link",e.exports=n},{"../../ui/AnnotationCommand":358}],323:[function(t,e,i){"use strict";e.exports={type:"link",tagName:"a","import":function(t,e){e.url=t.attr("href"),e.title=t.attr("title")},"export":function(t,e){e.attr({href:t.url,title:t.title})}}},{}],324:[function(t,e,i){"use strict";function n(){l.apply(this,arguments)}function s(){c.apply(this,arguments);var t=this.getController();t.connect(this,{"command:executed":this.onCommandExecuted})}var r=t("lodash/object/extend"),o=t("lodash/collection/includes"),a=t("lodash/string/capitalize"),l=t("../../ui/Component"),u=l.$$,c=t("../../ui/SurfaceTool");n.Prototype=function(){this.onSave=function(t){t.preventDefault(),this.props.tool.updateLink({url:this.refs.url.$el.val()})},this.didMount=function(){},this.onDelete=function(t){t.preventDefault(),this.props.tool.deleteLink()},this.render=function(){var t=this.props.link,e=u("div").addClass("se-prompt");return e.append([u("div").addClass("se-prompt-title").append(this.i18n.t("hyperlink")),u("input").attr({type:"text",placeholder:"http://your-website.com",value:t.url}).ref("url").htmlProp("autofocus",!0).on("change",this.onSave),u("a").attr({href:"#"}).addClass("se-delete-link").append(this.i18n.t("delete")).on("click",this.onDelete)]),e}},l.extend(n),s.Prototype=function(){this.dispose=function(){var t=this.getController();t.disconnect(this)},this.onCommandExecuted=function(t,e){e===this.constructor["static"].command&&o(["edit","create"],t.mode)&&this.togglePrompt()},this.togglePrompt=function(){var t=r({},this.state,{showPrompt:!this.state.showPrompt});this.setState(t)},this.updateLink=function(t){var e=this.getLink();this.getSurface().transaction(function(i){i.set([e.id,"url"],t.url),i.set([e.id,"title"],t.title)})},this.deleteLink=function(){var t=this.getLink();this.getSurface().transaction(function(e){e["delete"](t.id)}),this.togglePrompt()},this.getLink=function(){return this.getDocument().get(this.state.annotationId)},this.render=function(){var t=this.props.title||a(this.getName());this.state.mode&&(t=[a(this.state.mode),t].join(" "));var e=u("div").addClass("sc-link-tool se-tool").attr("title",t);this.state.disabled&&e.addClass("sm-disabled"),"edit"===this.state.mode&&e.addClass("sm-active"),this.state.mode&&e.addClass(this.state.mode);var i=u("button").on("click",this.onClick);if(i.append(this.props.children),e.append(i),"edit"===this.state.mode&&this.state.showPrompt){var s=this.getLink(),r=u(n,{link:s,tool:this});e.append(r)}return e}},c.extend(s),s["static"].name="link",s["static"].command="link",e.exports=s},{"../../ui/Component":365,"../../ui/SurfaceTool":390,"lodash/collection/includes":162,"lodash/object/extend":282,"lodash/string/capitalize":288}],325:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/BlockNode"),r=t("../../model/ParentNodeMixin");s.extend(n,r,function(){this.getChildrenProperty=function(){return"items"},this.removeItem=function(t){var e=this.getDocument(),i=this.items.indexOf(t);if(!(i>=0))throw new Error("List item is not a child of this list: "+t);e.update([this.id,"items"],{"delete":{offset:i}})},this.insertItemAt=function(t,e){var i=this.getDocument();i.update([this.id,"items"],{insert:{offset:t,value:e}})}}),n["static"].name="list",n["static"].defineSchema({ordered:{type:"boolean","default":!1},items:{type:["id"],defaut:[]}}),e.exports=n},{"../../model/BlockNode":84,"../../model/ParentNodeMixin":106}],326:[function(t,e,i){"use strict";var n=t("lodash/collection/each"),s=t("lodash/lang/isArray"),r=t("lodash/array/last"),o=t("../../ui/DefaultDOMElement"),a={type:"list",matchElement:function(t){return t.is("ul, ol")},"import":function(t,e,i){e.items=[];var n={level:0,types:[],list:e};this._importList(n,t,i)},"export":function(t,e,i){var n=i.$$;return this.render(t,{createListElement:function(t){var e=t.ordered?"ol":"ul";return n(e).attr("data-id",t.id)},renderListItem:function(t){return n("li").attr("data-id",t.id).append(i.annotatedText([t.id,"content"]))}})},render:function(t,e){for(var i,n=t.getChildren(),s=e.createListElement(t),r=s,o=[r],a=1,l=0;l<n.length;l++){var u=n[l];if(u.level===a);else if(u.level>a)for(i=a;i<u.level;i++){var c=e.createListElement(u);r.append(c),r=c,o.push(r),a++}else{for(i=a;i>u.level;i--)o.pop(),a--;r=o[o.length-1]}r.append(e.renderListItem(u))}return s},_importList:function(t,e,i){t.level++,t.types.push(e.tagName),n(e.children,function(e){var n=e.tagName;"li"===n?this._importListItem(t,e,i):("ol"==n||"ul"===n)&&this._importList(t,e,i)}),t.level--,t.types.pop()},_normalizeListItem:function(t,e){var i=[[]],r=i[0];return n(e.childNodes,function(t){var e=t.tagName;if("ol"===e||"ul"===e)r=t,i.push(r);else{if(/^\s*$/.exec(t.textContent))return;s(r)||(r=[],i.push(r)),r.push(t)}}),i},_importListItem:function(t,e,i){for(var n="ol"===r(t.types),a=this._normalizeListItem(t,e,i),l=0;l<a.length;l++){var u=a[l];if(s(u)){var c=o.create("span").append(u);i.trimTextContent(c);var h=i.convertElement(c);h.ordered=n,h.level=t.level,t.list.items.push(h.id)}else this._importList(t,u,i)}}};e.exports=a},{"../../ui/DefaultDOMElement":373,"lodash/array/last":153,"lodash/collection/each":158,"lodash/lang/isArray":270}],327:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/DocumentNode");s.extend(n),n["static"].name="list-item",n["static"].defineSchema({parent:"id",level:{type:"number","default":1},ordered:{type:"bool","default":!1},content:"text"}),e.exports=n},{"../../model/DocumentNode":96}],328:[function(t,e,i){"use strict";e.exports={type:"list-item",tagName:"li","import":function(t,e,i){e.level=t.attr("data-level")||1,e.content=i.annotatedText(t,[e.id,"content"])},"export":function(t,e,i){e.attr("data-level",t.level).append(i.annotatedText([t.id,"content"]))}}},{}],329:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/TextBlock");s.extend(n),n["static"].name="paragraph",e.exports=n},{"../../model/TextBlock":113}],330:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("../../ui/Component"),r=s.$$,o=t("../../ui/TextPropertyComponent");n.Prototype=function(){this.getClassNames=function(){return"sc-paragraph"},this.render=function(){return r("div").addClass(this.getClassNames()).attr("data-id",this.props.node.id).append(r(o,{path:[this.props.node.id,"content"]}))}},s.extend(n),e.exports=n},{"../../ui/Component":365,"../../ui/TextPropertyComponent":395}],331:[function(t,e,i){"use strict";e.exports={type:"paragraph",tagName:"p","import":function(t,e,i){e.content=i.annotatedText(t,[e.id,"content"])},"export":function(t,e,i){e.append(i.annotatedText([t.id,"content"]))}}},{}],332:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/PropertyAnnotation"),r=t("../../model/Fragmenter");s.extend(n),n["static"].name="strong",n["static"].fragmentation=r.ANY,e.exports=n},{"../../model/Fragmenter":101,"../../model/PropertyAnnotation":108}],333:[function(t,e,i){"use strict";var n=t("../../ui/AnnotationCommand"),s=n.extend();s["static"].name="strong",s["static"].annotationType="strong",e.exports=s},{"../../ui/AnnotationCommand":358}],334:[function(t,e,i){"use strict";e.exports={type:"strong",tagName:"strong",matchElement:function(t){return t.is("strong, b")}}},{}],335:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../ui/SurfaceTool");s.extend(n),n["static"].name="strong",n["static"].command="strong",e.exports=n},{"../../ui/SurfaceTool":390}],336:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/PropertyAnnotation"),r=t("../../model/Fragmenter");s.extend(n),n["static"].name="subscript",n["static"].fragmentation=r.ANY,e.exports=n},{"../../model/Fragmenter":101,"../../model/PropertyAnnotation":108}],337:[function(t,e,i){"use strict";var n=t("../../ui/AnnotationCommand"),s=n.extend();s["static"].name="subscript",s["static"].annotationType="subscript",e.exports=s},{"../../ui/AnnotationCommand":358}],338:[function(t,e,i){"use strict";e.exports={type:"subscript",tagName:"sub"}},{}],339:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../ui/SurfaceTool");s.extend(n),n["static"].name="subscript",n["static"].command="subscript",e.exports=n},{"../../ui/SurfaceTool":390}],340:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/PropertyAnnotation"),r=t("../../model/Fragmenter");s.extend(n),n["static"].name="superscript",n["static"].fragmentation=r.ANY,e.exports=n},{"../../model/Fragmenter":101,"../../model/PropertyAnnotation":108}],341:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../ui/AnnotationCommand"),n=s.extend();n["static"].name="superscript",n["static"].annotationType="superscript",e.exports=n},{"../../ui/AnnotationCommand":358}],342:[function(t,e,i){"use strict";e.exports={type:"superscript",tagName:"sup"}},{}],343:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../ui/SurfaceTool");s.extend(n),n["static"].name="superscript",n["static"].command="superscript",e.exports=n},{"../../ui/SurfaceTool":390}],344:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments),this.matrix=null}var s=t("../../model/BlockNode"),r=t("../../model/ParentNodeMixin"),o=t("./TableMatrix"),a=t("./TableCellIterator");s.extend(n,r,function(){this.getChildrenProperty=function(){return"sections"},this.getSections=function(){return this.getChildren()},this.getSectionAt=function(t){return this.getChildAt(t)},this.getMatrix=function(){return this.matrix||(this.matrix=new o(this),this.matrix.update()),this.matrix},this.getIterator=function(){return new a(this)},this.getSize=function(t){var e=this.matrix.getSize();return"row"===t?e[0]:"col"===t?e[1]:e}}),n["static"].name="table",n["static"].defineSchema({sections:{type:["id"],"default":[]}}),e.exports=n},{"../../model/BlockNode":84,"../../model/ParentNodeMixin":106,"./TableCellIterator":347,"./TableMatrix":350}],345:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/DocumentNode");s.extend(n,function(){this.getSpan=function(t){return"col"===t?this.colspan||1:"row"===t?this.rowspan||1:void 0},this.isData=function(){return"data"===this.cellType}}),n["static"].name="table-cell",n["static"].defineSchema({parent:"id",cellType:{type:"string","default":"td"},colspan:{type:"number",optional:!0},rowspan:{type:"number",optional:!0},content:"text"}),e.exports=n},{"../../model/DocumentNode":96}],346:[function(t,e,i){"use strict";e.exports={type:"table-cell",matchElement:function(t){return t.is("th, td")},"import":function(t,e,i){var n=i.defaultId(t,"heading");t.is("th")?e.cellType="head":e.cellType="data";var s=t.attr("colspan");s&&(e.colspan=parseInt(s,10));var r=t.attr("rowspan");r&&(e.rowspan=parseInt(r,10)),e.content=i.annotatedText(t,[n,"content"])},"export":function(t,e,i){e.tagName="head"===t.cellType?"th":"td",e.append(i.annotatedText([t.id,"content"]))}}},{}],347:[function(t,e,i){"use strict";function n(t){this.table=t,this.__it={sectionIndex:-1,rowIndex:-1,rowNode:null,cellIndex:-1,cellNode:null,sectionNode:null,finished:!1},this.onNewSection=function(){},this.onNewRow=function(){}}var s=t("../../util/oo");n.Prototype=function(){this.next=function(){if(this.__it.finished)throw new Error("TableCellIterator has no more cells left.");return this.nextCell(this.__it),this.__it.finished?null:this.__it.cellNode},this.nextSection=function(t){t.sectionIndex++,t.sectionIndex<this.table.getChildCount()?t.sectionNode=this.table.getSectionAt(t.sectionIndex):t.sectionNode=null,t.sectionNode?(t.rowIndex=0,t.rowNode=t.sectionNode.getRowAt(0),this.onNewSection(t.sectionNode)):t.finished=!0},this.nextRow=function(t){for(t.rowIndex++,t.sectionNode&&(t.rowIndex<t.sectionNode.getChildCount()?t.rowNode=t.sectionNode.getRowAt(t.rowIndex):t.rowNode=null);!t.rowNode&&!t.finished;)this.nextSection(t);t.rowNode&&(t.cellIndex=0,t.cellNode=t.rowNode.getCellAt(0),this.onNewRow(t.rowNode))},this.nextCell=function(t){for(t.cellNode&&(t.cellIndex++,t.cellIndex<t.rowNode.getChildCount()?t.cellNode=t.rowNode.getCellAt(t.cellIndex):t.cellNode=null);!t.cellNode&&!t.finished;)this.nextRow(t)}},s.initClass(n),e.exports=n},{"../../util/oo":413}],348:[function(t,e,i){"use strict";function n(){o.apply(this,arguments),this.context.surface.connect(this,{"selection:changed":this.onSelectionChange})}var s=t("lodash/collection/each"),r=t("../../util/jquery"),o=t("../../ui/Component"),a=t("../../ui/TextPropertyComponent"),l=t("../../model/TableSelection"),u=o.$$;n.Prototype=function(){this.dispose=function(){this.context.surface.disconnect(this)},this.getInitialState=function(){return{mode:"table"}},this.render=function(){var t=u("table").addClass("content-node table").attr({"data-id":this.props.node.id,contentEditable:!1});return"table"===this.state.mode?t.addClass("table-editing-mode"):"cell"===this.state.mode&&t.addClass("cell-editing-mode"),this.props.node.getMatrix(),t.append(this.renderTableContent()),t},this.renderTableContent=function(){var t=[];return s(this.props.node.getSections(),function(e){var i=u("t"+e.sectionType).key(e.id);s(e.getRows(),function(t){var e=u("tr").attr({"data-id":t.id,contentEditable:!1});s(t.getCells(),function(t){var i=u("head"===t.cellType?"th":"td").attr({"data-id":t.id,"data-row":t.rowIdx,"data-col":t.colIdx}).on("mousedown",this.onMouseDown).on("doubleclick",this.onDoubleClick);t.colspan&&i.attr("colspan",t.colspan),t.rowspan&&i.attr("rowspan",t.rowspan),"cell"===this.state.mode&&t.rowIdx===this.state.row&&t.colIdx===this.state.col&&i.attr("contentEditable",!0),i.append(u(a,{path:[t.id,"content"]})),e.append(i)},this),i.append(e)},this),t.push(i)},this),t},this.onDoubleClick=function(t){t.preventDefault(),t.stopPropagation();var e=this.context.surface,i=r(t.currentTarget),n=i.data("id");this.setState({mode:"cell",cellId:n,row:i.data("row"),col:i.data("col")},function(){var t=e.getDocument(),i=[n,"content"],s=t.get(i);e.setSelection({type:"property",path:i,startOffset:s.length})})},this.onMouseDown=function(t){var e=this.$el,i=this.context.surface,n=i.getDocument(),s=this.props.node.id,o=this,a=r(t.currentTarget);if("cell"!==this.state.mode||this.state.cellId!==a.data("id")){t.preventDefault(),t.stopPropagation();var u=a,c=a,h=new l.Rectangle(u.data("row"),u.data("col"),c.data("row"),c.data("col")),p=function(t){c=r(t.currentTarget),h=new l.Rectangle(u.data("row"),u.data("col"),c.data("row"),c.data("col")),o._updateSelection(h)};e.on("mouseenter","th,td",p),r(window).one("mouseup",function(t){t.stopPropagation(),t.preventDefault(),e.off("mouseenter","th,td",p);var r=n.createSelection({type:"table",tableId:s,rectangle:h});i.setSelection(r)})}},this.onSelectionChange=function(t){var e=this.props.node,i=e.id;if(this.hasSelection&&this._clearSelection(),"cell"===this.state.mode){if(!t.isPropertySelection()||t.start.path[0]!==this.state.cellId){var n=this;this.setState({mode:"table"},function(){t.isTableSelection()&&t.getTableId()===i&&n._updateSelection(t.rectangle)})}}else t.isTableSelection()&&t.getTableId()===i&&this._updateSelection(t.rectangle)},this._updateSelection=function(t){var e=this.$el,i=e.find("th,td");i.each(function(){var e=r(this),i=e.data("row"),n=e.data("col");i>=t.start.row&&i<=t.end.row&&n>=t.start.col&&n<=t.end.col?e.addClass("selected"):e.removeClass("selected")}),this.hasSelection=!0},this._clearSelection=function(){var t=this.$el,e=t.find("th,td");e.removeClass("selected"),this.hasSelection=!1}},o.extend(n),e.exports=n},{"../../model/TableSelection":112,"../../ui/Component":365,"../../ui/TextPropertyComponent":395,"../../util/jquery":412,"lodash/collection/each":158}],349:[function(t,e,i){"use strict";var n=t("lodash/collection/each");e.exports={type:"table",tagName:"table","import":function(t,e,i){if(e.sections=[],n(["thead","tbody","tfoot"],function(n){var s=t.find(n);if(s){var r=i.convertElement(s);r.parent=e.id,e.sections.push(r.id)}}),0===e.sections.length){var s={id:i.nextId("tbody"),parent:e.id,type:"table-section",sectionType:"body",rows:[]};n(t.findAll("tr"),function(t){var e=i.convertElement(t);e.parent=s.id,s.rows.push(e.id)}),i.createNode(s),e.sections.push(s.id)}},"export":function(t,e,i){n(t.getSections(),function(t){e.append(i.convertNode(t))})}}},{"lodash/collection/each":158}],350:[function(t,e,i){"use strict";function n(t){this.tableNode=t,this._matrix=null,this._rowNodes=null}var s=t("../../util/oo");n.Prototype=function(){this.invalidate=function(){this._matrix=null,this._rowNodes=null},this.update=function(){var t,e,i,s,r,o,a,l,u=[],c=[],h=this.tableNode.getIterator(),p=-1,d=-1;for(h.onNewRow=function(t){p++,d=-1,u[p]=u[p]||[],c.push(t)};null!==(t=h.next());){for(d++;u[p][d];)d++;if(e=new n.Cell(t,p,d),t.rowIdx=p,t.colIdx=d,u[p][d]=e,i=t.getSpan("row"),s=t.getSpan("col"),1!==i||1!==s)for(r=0;i>r;r++)for(o=0;s>o;o++)(0!==r||0!==o)&&(a=p+r,l=d+o,u[a]=u[a]||[],u[a][l]=new n.Placeholder(e,a,l))}this._matrix=u,this._rowNodes=c},this.getCell=function(t,e){var i=this.getMatrix();return i[t][e]},this.getColumn=function(t){var e,i,n=this.getMatrix();for(e=[],i=0;i<n.length;i++)e.push(n[i][t]);return e},this.getRow=function(t){var e=this.getMatrix();return e[t]},this.getRowNode=function(t){var e=this.getRowNodes();return e[t]},this.getMatrix=function(){return this._matrix||this.update(),this._matrix},this.getRowNodes=function(){return this._rowNodes||this.update(),this._rowNodes},this.getRectangle=function(t,e){var i,s,r,o,a,l;return(i=this.lookupCell(t))?(s=t===e?i:this.lookupCell(e),r=Math.min(i.row,s.row),o=Math.max(i.row,s.row),a=Math.min(i.col,s.col),l=Math.max(i.col,s.col),new n.Rectangle(r,a,o,l)):null},this.getCellsForRectangle=function(t){var e,i,n,s,r;for(n=[],s={},e=t.start.row;e<=t.end.row;e++)for(i=t.start.col;i<=t.end.col;i++)r=this.getCell(e,i),"placeholder"===r.type&&(r=r.owner),s[r.key]||(n.push(r),s[r.key]=!0);return n},this.getBoundingRectangle=function(t){var e,i,s;if(t=n.Rectangle.copy(t),e=this.getCellsForRectangle(t),!e||0===e.length)return null;for(s=0;s<e.length;s++)i=e[s],t.start.row=Math.min(t.start.row,i.row),t.start.col=Math.min(t.start.col,i.col),t.end.row=Math.max(t.end.row,i.row+i.node.getSpan("row")-1),t.end.col=Math.max(t.end.col,i.col+i.node.getSpan("col")-1);return t},this.getSize=function(){var t=this.getMatrix();return 0===t.length?{rows:0,cols:0}:{rows:t.length,cols:t[0].length}},this.lookupCell=function(t){var e,i,n,s,r=this.getMatrix(),o=this.getRowNodes();if(e=o.indexOf(t.parent),0>e)return null;for(n=null,s=r[e],i=0;i<s.length&&(n=s[i],n.node!==t);i++);return n},this.findClosestCell=function(t){var e,i,n=this.getMatrix();for(i=n[t.row],e=t.col;e>=0;e--)if("cell"===i[e].type)return i[e];for(e=t.col+1;e<i.length;e++)if("cell"===i[e].type)return i[e];return null}},s.initClass(n),n.Cell=function(t,e,i){this.type="cell",this.node=t,this.row=e,this.col=i,this.key=e+"_"+i},s.initClass(n.Cell),n.Cell.sortDescending=function(t,e){return t.row!==e.row?e.row-t.row:e.col-t.col},n.Placeholder=function(t,e,i){n.Cell.call(this,t.node,e,i),this.type="placeholder",this.owner=t},n.Cell.extend(n.Placeholder),n.Rectangle=function(t,e,i,n){this.start={row:t,col:e},this.end={row:i,col:n}},n.Rectangle.copy=function(t){return new n.Rectangle(t.start.row,t.start.col,t.end.row,t.end.col)},e.exports=n},{"../../util/oo":413}],351:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/DocumentNode"),r=t("../../model/ParentNodeMixin");s.extend(n,r,function(){this.getChildrenProperty=function(){return"cells"},this.getCells=function(){return this.getChildren()},this.getCellAt=function(t){return this.getChildAt(t)}}),n["static"].name="table-row",n["static"].defineSchema({parent:"id",cells:{type:["id"],"default":[]}}),e.exports=n},{"../../model/DocumentNode":96,"../../model/ParentNodeMixin":106}],352:[function(t,e,i){"use strict";var n=t("lodash/collection/each");e.exports={type:"table-row",tagName:"tr","import":function(t,e,i){e.cells=[],n(t.findAll("th,td"),function(t){var n=i.convertElement(t);n.parent=e.id,e.cells.push(n.id)})},"export":function(t,e,i){n(t.getCells(),function(t){e.append(i.convertNode(t))})}}},{"lodash/collection/each":158}],353:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../../model/DocumentNode"),r=t("../../model/ParentNodeMixin");s.extend(n,r,function(){this.getChildrenProperty=function(){return"rows"},this.getRows=function(){return this.getChildren()},this.getRowAt=function(t){return this.getChildAt(t)}}),n["static"].name="table-section",n["static"].defineSchema({parent:"id",rows:{type:["id"],"default":[]},sectionType:{type:"string","default":"tbody"}}),e.exports=n},{"../../model/DocumentNode":96,"../../model/ParentNodeMixin":106}],354:[function(t,e,i){"use strict";var n=t("lodash/collection/each");e.exports={type:"table-section",matchElement:function(t){return t.is("thead, tbody, tfoot")},"import":function(t,e,i){var s=t.tagName,r=s.substring(1);e.sectionType=r,e.rows=[],n(t.findAll("tr"),function(t){var n=i.convertElement(t);n.parent=e.id,e.rows.push(n.id)})},"export":function(t,e,i){e.tagName="t"+t.sectionType,n(t.getRows(),function(t){e.append(i.convertNode(t))})}}},{"lodash/collection/each":158}],355:[function(t,e,i){"use strict";var n=t("../../ui/SurfaceCommand"),s=t("lodash/lang/isMatch"),r=t("lodash/collection/find"),o=t("lodash/lang/clone"),a=function(t){n.call(this,t)};a.Prototype=function(){this.getSelection=function(){return this.getSurface().getSelection()},this.getTextTypes=function(){return this.getSurface().getTextTypes()},this.getTextType=function(t){var e=this.getTextTypes();return r(e,function(e){return e.name===t})},this.getCurrentTextType=function(t){var e,i=this.getTextTypes();return i.forEach(function(i){var n=o(i.data);delete n.type,s(t,n)&&t.type===i.data.type&&(e=i)}),e},this.getCommandState=function(){var t=this.getSelection(),e=this.getSurface(),i={disabled:!1,sel:t,textTypes:this.getTextTypes()};if(!e.isEnabled()||t.isNull())i.disabled=!0;else if(t.isContainerSelection())i.disabled=!0,i.currentTextType={name:"container-selection"};else{var n=this.getDocument(),s=t.getPath(),r=n.get(s[0]);r&&(r.isText()&&r.isBlock()&&(i.currentTextType=this.getCurrentTextType(r),i.currentTextType||(i.disabled=!0)),i.currentTextType||(i.currentTextType={name:[r.type,s[1]].join(".")},i.disabled=!0))}return i},this.execute=function(t){var e=this.getTextType(t),i=e.data,n=this.getSurface();return n.transaction(function(t,e){return e.data=i,n.switchType(t,e)}),i}},n.extend(a),a["static"].name="switchTextType",e.exports=a},{"../../ui/SurfaceCommand":388,"lodash/collection/find":160,"lodash/lang/clone":267,"lodash/lang/isMatch":275}],356:[function(t,e,i){"use strict";function n(){a.apply(this,arguments),this.context.toolManager.registerTool(this)}var s=t("lodash/collection/each"),r=t("../../ui/Component"),o=r.$$,a=t("../../ui/SurfaceTool");n.Prototype=function(){this.getInitialState=function(){var t=this.context.toolManager.getCommandState(this);return t},this.getTextCommands=function(){var t=this.getSurface();return!this.textCommands&&t&&(this.textCommands=t.getTextCommands()),this.textCommands||{}},this.dispose=function(){this.context.toolManager.unregisterTool(this)},this.render=function(){var t="No selection";this.state.currentTextType&&(t=this.state.currentTextType.name);var e=o("div").addClass("sc-switch-text-type");this.state.open&&e.addClass("sm-open"),this.state.disabled&&e.addClass("sm-disabled"),e.append(o("button").addClass("se-toggle").attr("href","#").attr("title",this.props.title).append(this.i18n.t(t)).on("click",this.toggleAvailableTextTypes));var i=o("div").addClass("se-options");return s(this.state.textTypes,function(t){var e=o("button").addClass("se-option sm-"+t.name).attr("data-type",t.name).append(this.i18n.t(t.name)).on("click",this.handleClick);i.append(e)},this),e.append(i),e},this.handleClick=function(t){t.preventDefault(),this.executeCommand(t.currentTarget.dataset.type)},this.executeCommand=function(t){this.getSurface().executeCommand("switchTextType",t)},this.toggleAvailableTextTypes=function(t){t.preventDefault(),t.stopPropagation(),this.state.disabled||this.toggleDropdown()},this.toggleDropdown=function(){this.extendState({open:!this.state.open})}},a.extend(n),n["static"].name="switchTextType",n["static"].command="switchTextType",e.exports=n},{"../../ui/Component":365,"../../ui/SurfaceTool":390,"lodash/collection/each":158}],357:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("./Component"),r=s.$$,o=t("../model/Fragmenter"),a=t("./AnnotationComponent");n.Prototype=function(){this.render=function(){var t=this.context.componentRegistry,e=this.getDocument(),i=this.getPath(),n=e.get(i)||"",s=this.getAnnotations(),l=r(this.props.tagName||"span").addClass("sc-annotated-text").attr({"data-path":this.props.path.join("."),spellCheck:!1}).css({whiteSpace:"pre-wrap"}),u=new o,c={};return u.onText=function(t,e){e&&e.length>0&&t.append(e)},u.onEnter=function(i){var n=i.node,s=n.id;if(c[s]||(c[s]=0),c[s]=c[s]+1,"cursor"===n.type)return r("span").addClass("se-cursor");if("selection-fragment"===n.type)return r("span").addClass("se-selection-fragment");if("container-annotation-fragment"===n.type)return r(a,{doc:e,node:n}).addClass("se-annotation-fragment").addClass(n.anno.getTypeNames().join(" ").replace(/_/g,"-"));if("container-annotation-anchor"===n.type)return r(a,{doc:e,node:n}).addClass("se-anchor").addClass(n.anno.getTypeNames().join(" ").replace(/_/g,"-")).addClass(n.isStart?"start-anchor":"end-anchor");var o=t.get(n.type)||a,l=r(o,{doc:e,node:n});return n.constructor["static"].isInline&&l.attr("data-inline","1"),l},u.onExit=function(t,e,i){i.append(e)},u.start(l,n,s),l.append(r("br")),l},this.getAnnotations=function(){var t=this.getDocument(),e=t.getIndex("annotations").get(this.props.path);return e},this.getDocument=function(){return this.props.doc||this.context.doc},this.getPath=function(){return this.props.path}},s.extend(n),e.exports=n},{"../model/Fragmenter":101,"./AnnotationComponent":359,"./Component":365}],358:[function(t,e,i){"use strict";var n=t("./SurfaceCommand"),s=t("../model/documentHelpers"),r=t("../model/transform/createAnnotation"),o=t("../model/transform/fuseAnnotation"),a=t("../model/transform/expandAnnotation"),l=t("../model/transform/truncateAnnotation"),u=t("../model/transform/deleteAnnotation"),c=function(t){n.call(this,t)};c.Prototype=function(){this.getAnnotationType=function(){if(this.constructor["static"].annotationType)return this.constructor["static"].annotationType;throw new Error("Contract: AnnotationCommand.static.annotationType should be associated to a document annotation type.")},this.getAnnotationData=function(){return{}},this.isDisabled=function(t,e){if(e.isNull())return!0;var i=this.getAnnotationType(),n=this.getDocument();return!s.isContainerAnnotation(n,i)&&!e.isPropertySelection()},this.canEdit=function(){return!1},this.canCreate=function(t,e){return 0===t.length&&!e.isCollapsed()},this.canFuse=function(t,e){return t.length>=2&&!e.isCollapsed()},this.canDelete=function(t,e){if(1!==t.length)return!1;var i=t[0].getSelection();return e.isInsideOf(i)},this.canExpand=function(t,e){if(1!==t.length)return!1;var i=t[0].getSelection();return e.overlaps(i)&&!e.isInsideOf(i)},this.canTruncate=function(t,e){if(1!==t.length)return!1;var i=t[0].getSelection();
return(e.isLeftAlignedWith(i)||e.isRightAlignedWith(i))&&!e.contains(i)&&!e.isCollapsed()},this.getAnnotationsForSelection=function(){var t=this.getSelection(),e=this.getDocument(),i=this.getContainerId(),n=this.getAnnotationType(),r=s.getAnnotationsForSelection(e,t,n,i);return r},this.execute=function(){var t=this.getAnnotationsForSelection(),e=this.getSelection();return this.isDisabled(t,e)?!1:this.canCreate(t,e)?this.executeCreate():this.canFuse(t,e)?this.executeFuse():this.canTruncate(t,e)?this.executeTruncate():this.canExpand(t,e)?this.executeExpand():this.canEdit(t,e)?this.executeEdit(t,e):this.canDelete(t,e)?this.executeDelete():!1},this.getCommandState=function(){var t=this.getSelection(),e=this.getAnnotationsForSelection(),i={disabled:!1,active:!1,mode:null};return this.isDisabled(e,t)?i.disabled=!0:this.canCreate(e,t)?i.mode="create":this.canFuse(e,t)?i.mode="fusion":this.canTruncate(e,t)?(i.active=!0,i.mode="truncate"):this.canExpand(e,t)?i.mode="expand":this.canEdit(e,t)?(i.mode="edit",i.annotationId=e[0].id,i.active=!0):this.canDelete(e,t)?(i.active=!0,i.mode="delete"):i.disabled=!0,i},this.applyTransform=function(t){var e,i=this.getSurface(),n=this.getSelection(),s=this;return n.isNull()?void 0:(i.transaction(function(i,n){return n.annotationType=s.getAnnotationType(),n.annotationData=s.getAnnotationData(),n.splitContainerSelections=!1,n.containerId=s.getContainerId(),n=t(i,n),e=n.result,n}),e)},this.executeEdit=function(){var t=this.getAnnotationsForSelection();return{mode:"edit",anno:t[0],readyOnly:!0}},this.executeCreate=function(){var t=this.applyTransform(r);return{mode:"create",anno:t}},this.executeFuse=function(){var t=this.applyTransform(o);return{mode:"fuse",anno:t}},this.executeTruncate=function(){var t=this.applyTransform(l);return{mode:"truncate",anno:t}},this.executeExpand=function(){var t=this.applyTransform(a);return{mode:"expand",anno:t}},this.executeDelete=function(){var t=this.applyTransform(u);return{mode:"delete",annoId:t}}},n.extend(c),e.exports=c},{"../model/documentHelpers":131,"../model/transform/createAnnotation":134,"../model/transform/deleteAnnotation":135,"../model/transform/expandAnnotation":139,"../model/transform/fuseAnnotation":140,"../model/transform/truncateAnnotation":147,"./SurfaceCommand":388}],359:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("./Component"),r=s.$$;n.Prototype=function(){this.render=function(){var t=r("span").attr("data-id",this.props.node.id).addClass(this.getClassNames());return this.props.node.highlighted&&t.addClass("sm-highlighted"),t.append(this.props.children),t},this.getClassNames=function(){return"sc-"+this.props.node.type},this.didMount=function(){var t=this.props.node;t.connect(this,{highlighted:this.onHighlightedChanged})},this.dispose=function(){var t=this.props.node;t.disconnect(this)},this.onHighlightedChanged=function(){this.props.node.highlighted?this.$el.addClass("sm-highlighted"):this.$el.removeClass("sm-highlighted")}},s.extend(n),e.exports=n},{"./Component":365}],360:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("./SurfaceTool");n.Prototype=function(){},s.extend(n),e.exports=n},{"./SurfaceTool":390}],361:[function(t,e,i){"use strict";var n=t("../util/oo"),s=t("../model/documentHelpers"),r=t("./ClipboardImporter"),o=t("./ClipboardExporter"),a=t("../util/substanceGlobals"),l=t("./DefaultDOMElement"),u=function(t){this.surface=t;var e=t.getDocument(),i=e.getSchema();this.htmlImporter=new r({schema:i,DocumentClass:e.constructor}),this.htmlExporter=new o,this.onCopy=this.onCopy.bind(this),this.onCut=this.onCut.bind(this),this.isIe=-1!=window.navigator.userAgent.toLowerCase().indexOf("msie")||-1!=window.navigator.userAgent.toLowerCase().indexOf("trident"),this.isFF=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,this.isIe?(this.onBeforePasteShim=this.onBeforePasteShim.bind(this),this.onPasteShim=this.onPasteShim.bind(this)):this.onPaste=this.onPaste.bind(this)};u.Prototype=function(){this.getSurface=function(){return this.surface},this.attach=function(t){t.addEventListener("copy",null,this.onCopy,this),t.addEventListener("cut",null,this.onCut,this),this.isIe?(t.addEventListener("beforepaste",null,this.onBeforePasteShim,this),t.addEventListener("paste",null,this.onPasteShim,this)):t.addEventListener("paste",null,this.onPaste,this)},this.didMount=function(){var t=new l(this.surface.el);if(!u._sharedPasteElement){var e=t.getRoot(),i=e.find("body");if(i){var n=i.createElement("div").attr("contenteditable",!0).css({position:"fixed",opacity:"0.0",bottom:"-1000px",width:"0px"});u._sharedPasteElement=n,i.append(n)}}this.el=u._sharedPasteElement},this.detach=function(t){t.off("copy",this.onCopy),t.off("cut",this.onCut),this.isIe?(t.off("beforepaste",this.onBeforePasteShim),t.off("paste",this.onPasteShim)):t.off("paste",this.onPaste)},this.onCopy=function(t){var e=this._copy();u.clipboardData=e,a.clipboardData=e,t.clipboardData&&e.doc&&(t.preventDefault(),t.clipboardData.setData("text/plain",e.text),t.clipboardData.setData("text/html",e.html))},this.onCut=function(t){t.preventDefault(),this.onCopy(t);var e=this.getSurface();e&&e.transaction(function(t,i){return e["delete"](t,i)})},this.onPaste=function(t){for(var e=t.clipboardData,i={},n=0;n<e.types.length;n++)i[e.types[n]]=!0;t.preventDefault(),t.stopPropagation();var s,r;return i["text/plain"]&&(s=e.getData("text/plain")),i["text/html"]&&(r=e.getData("text/html")),a.clipboardData={text:s,html:r},this.isFF&&!r?void this._pastePlainText(s):void(r&&this._pasteHtml(r,s)||this._pastePlainText(s))},this._pastePlainText=function(t){var e=this.getSurface();e.transaction(function(i,n){return n.text=t,e.paste(i,n)})},this.onBeforePasteShim=function(){var t=this.getSurface();if(t){var e=this._getNativeElement();e.focus();var i=document.createRange();i.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(i)}},this.onPasteShim=function(){var t=this._getNativeElement;t.innerHTML="";var e=this.surface.getSelection();window.setTimeout(function(){this.surface.selection=e;var i=t.innerHTML,n=t.textContent;return t.innerHTML="",a.clipboardData={text:n,html:i},this._pasteHtml(i,t.textContent)}.bind(this))},this._copy=function(){var t=this.getSurface(),e=t.getSelection(),i=t.getDocument(),n=null,r="",o="";return e.isCollapsed()||(r=s.getTextForSelection(i,e),n=t.copy(i,e),o=this.htmlExporter.exportDocument(n)),{doc:n,html:o,text:r}},this._pasteHtml=function(t,e){var i=this.getSurface();if(i){var n=null;try{n=this.htmlImporter.importDocument(t)}catch(s){return!1}return n?(i.transaction(function(t,s){return s.text=e,s.doc=n,i.paste(t,s)}),!0):void 0}},this._getNativeElement=function(){return this.el.el}},n.initClass(u),u.clipboardData={doc:null,html:"",text:""},e.exports=u},{"../model/documentHelpers":131,"../util/oo":413,"../util/substanceGlobals":415,"./ClipboardExporter":362,"./ClipboardImporter":363,"./DefaultDOMElement":373}],362:[function(t,e,i){"use strict";function n(){n["super"].call(this,{converters:o})}var s=t("../model/HTMLExporter"),r=t("./ClipboardImporter"),o=r.converters,a=r.CLIPBOARD_CONTAINER_ID,l=r.CLIPBOARD_PROPERTY_ID,u=t("../model/JSONConverter");n.Prototype=function(){this.exportDocument=function(t){var e,i=this.convertDocument(t);e=1===i.length&&i[0].attr("data-id")===l?i[0].innerHTML:i.map(function(t){return t.outerHTML}).join("");var n=new u,s=["<meta name='substance' content='",JSON.stringify(n.exportDocument(t)),"'>"].join("");return"<html><head>"+s+"</head><body>"+e+"</body></html>"},this.convertDocument=function(t){var e=t.get(a);if(!e)throw new Error('Illegal clipboard document: could not find container "'+a+'"');return this.convertContainer(e)}},s.extend(n),n.CLIPBOARD_CONTAINER_ID=a,e.exports=n},{"../model/HTMLExporter":102,"../model/JSONConverter":105,"./ClipboardImporter":363}],363:[function(t,e,i){"use strict";function n(t){if(!t.schema)throw new Error("Missing argument: config.schema is required.");this.IGNORE_DEFAULT_WARNINGS=!0,r(t,{trimWhitespaces:!0,REMOVE_INNER_WS:!0,converters:h}),n["super"].call(this,t),this._isWindows=navigator&&navigator.appVersion&&-1!==navigator.appVersion.indexOf("Win")}var s=t("lodash/lang/isArray"),r=t("lodash/object/extend"),o=t("../model/HTMLImporter"),a=t("./DefaultDOMElement"),l=t("../model/JSONConverter"),u=t("../model/transform/copySelection").CLIPBOARD_CONTAINER_ID,c=t("../model/transform/copySelection").CLIPBOARD_PROPERTY_ID,h=[t("../packages/paragraph/ParagraphHTMLConverter"),t("../packages/heading/HeadingHTMLConverter"),t("../packages/emphasis/EmphasisHTMLConverter"),t("../packages/strong/StrongHTMLConverter"),t("../packages/code/CodeHTMLConverter"),t("../packages/superscript/SuperscriptHTMLConverter"),t("../packages/subscript/SubscriptHTMLConverter"),t("../packages/link/LinkHTMLConverter"),t("../packages/table/TableHTMLConverter"),t("../packages/table/TableSectionHTMLConverter"),t("../packages/table/TableRowHTMLConverter"),t("../packages/table/TableCellHTMLConverter"),t("../packages/list/ListHTMLConverter"),t("../packages/list/ListItemHTMLConverter")];n.Prototype=function(){function t(t){if(t){var e=t.find("b");return e&&/^docs-internal/.exec(e.id)?e:t}}this.importDocument=function(e){var i,n;if(this._isWindows){var r=/<!--StartFragment\-->(.*)<!--EndFragment-->/.exec(e);r&&(e=r[1])}if(e.search(/meta name=.substance./)>=0){n=a.parseHTML(e);var o=n.find('meta[name="substance"]');if(o){var l=o.attr("content");try{return this.importFromJSON(l)}catch(u){console.error(u)}}}if(n=a.parseHTML(e),s(n)?(i=this._createElement("body"),i.append(n)):i=n.find("body"),i||(i=this._createElement("body"),i.append(n)),i=t(i),!i)return console.warn("Invalid HTML."),null;this.reset(),this.convertBody(i);var c=this.generateDocument();return c},this.importFromJSON=function(t){var e=this.createDocument(),i=JSON.parse(t),n=new l;return n.importDocument(e,i),e},this.convertBody=function(t){this.convertContainer(t.childNodes,u)},this._wrapInlineElementsIntoBlockElement=function(t){for(var e=this._createElement("p");t.hasNext();){var i=t.next(),n=this._getConverterForElement(i,"block");if(n){t.back();break}e.append(i.clone())}e.attr("data-id",c);var s=this.defaultConverter(e,this);if(s){if(!s.type)throw new Error("Contract: Html.defaultConverter() must return a node with type.");this._createAndShow(s)}return s},this.createDocument=function(){var t=this._createDocument();return t.get(u)||t.create({type:"container",id:u,nodes:[]}),t}},o.extend(n),n.converters=h,n.CLIPBOARD_CONTAINER_ID=u,n.CLIPBOARD_PROPERTY_ID=c,e.exports=n},{"../model/HTMLImporter":103,"../model/JSONConverter":105,"../model/transform/copySelection":133,"../packages/code/CodeHTMLConverter":297,"../packages/emphasis/EmphasisHTMLConverter":308,"../packages/heading/HeadingHTMLConverter":317,"../packages/link/LinkHTMLConverter":323,"../packages/list/ListHTMLConverter":326,"../packages/list/ListItemHTMLConverter":328,"../packages/paragraph/ParagraphHTMLConverter":331,"../packages/strong/StrongHTMLConverter":334,"../packages/subscript/SubscriptHTMLConverter":338,"../packages/superscript/SuperscriptHTMLConverter":342,"../packages/table/TableCellHTMLConverter":346,"../packages/table/TableHTMLConverter":349,"../packages/table/TableRowHTMLConverter":352,"../packages/table/TableSectionHTMLConverter":354,"./DefaultDOMElement":373,"lodash/lang/isArray":270,"lodash/object/extend":282}],364:[function(t,e,i){"use strict";var n=t("../util/oo"),s=function(){};s.Prototype=function(){this.execute=function(){throw new Error("execute must be implemented by custom commands")}},n.initClass(s),e.exports=s},{"../util/oo":413}],365:[function(t,e,i){"use strict";function n(t,e){if(f.call(this),!t&&"root"!==t)throw new Error("Contract: every component needs to have a parent.");this.__id__=v++,this.$el=null,this.el=null,e=e||{},this.refs={},this._preserved={},this._ref=e._ref,this.parent=t,this.children=[],this.context=this._getContext(),this._isOnRoute=e._isOnRoute,"root"===t&&(this._isOnRoute=!0),this._htmlParams=o(e),this._setProps(e.props),this._setState(this._getInitialState()),this.actionHandlers={},this._data={attributes:{},style:{},handlers:{},props:{},children:[]},this.didInitialize&&(console.warn("Component.didInitialize() has been deprecated. Use Component.initialize() instead."),this.didInitialize(this.props,this.state)),this.initialize()}function s(t){x=t,C.push(t)}function r(){x=C.pop()}var o,a=t("../util/jquery"),l=t("lodash/lang/isFunction"),u=t("lodash/lang/isString"),l=t("lodash/lang/isFunction"),c=t("lodash/lang/isEqual"),h=t("lodash/object/extend"),p=t("lodash/collection/each"),d=t("./i18n"),f=t("../util/EventEmitter"),m=t("./DOMElement"),g=t("./DefaultDOMElement"),b=t("./VirtualDOMElement"),y=b.VirtualTextNode,v=0,_="undefined"!=typeof window;n.Prototype=function(){function t(){throw new Error("Not supported.")}function e(t){var e=[t.getState()];if("root"===t.parent)return e;if(!t._isOnRoute)return!1;for(var i=t.getParent(),n=t;i&&"root"!==i;){if(i.route){if(i.route!==n)return console.error("Route is broken!"),!1;e.unshift(i.getState()),n=i}i=i.getParent()}return e}h(this,f.prototype),this.getInitialContext=function(){return{}},this.getChildContext=function(){return this.childContext||{}},this.initialize=function(t,e){},this.getInitialState=function(){return{}},this.getParent=function(){return"root"!==this.parent?this.parent:null},this.render=function(){return n.$$("div")},this.shouldRerender=function(t,e){return!0},this.rerender=function(){s(this);var t=this.render();r(),this._render(t)},this.triggerDidMount=function(t){t||(t=n.isMounted(this)),t&&(this.children.forEach(function(t){t.triggerDidMount(!0)}),this.__didMountTriggered__||(this.didMount(),this.__didMountTriggered__=!0))},this.didMount=function(){},this.unmount=function(){return this.triggerDispose(),this.$el.remove(),this.__didMountTriggered__=!1,this},this.isMounted=function(){return n.isMounted(this)},this.triggerDispose=function(){p(this.children,function(t){t.triggerDispose()}),this.dispose()},this.dispose=function(){},this.send=function(t){for(var e=this;e;){if(e.actionHandlers[t])return e.actionHandlers[t].apply(e,Array.prototype.slice.call(arguments,1)),!0;e=e.getParent()}return console.warn("Action",t,"was not handled."),!1},this.handleActions=function(t){return p(t,function(t,e){this.handleAction(e,t)},this),this},this.actions=function(t){return console.log("DEPRECATED: Use 'this.handleActions(actions)' instead."),this.handleActions(t)},this.handleAction=function(t,e){if(!t||!e||!l(e))throw new Error("Illegal arguments.");e=e.bind(this),this.actionHandlers[t]=e},this.setState=function(t){var i=this.shouldRerender(this.getProps(),t);this.willUpdateState(t),this._setState(t),this.didUpdateState();var n=this.context.router;if(n&&n.isActive()&&n.truncateState(this),i&&this.rerender(),n&&n.isActive()){var s=e(this);s&&n.updateState(s)}},this.extendState=function(t){t=h({},this.state,t),this.setState(t)},this.willUpdateState=function(t){},this.didUpdateState=function(){},this.setProps=function(t){var e=this.shouldRerender(t,this.getState());this.willReceiveProps(t),this._setProps(t),e&&this.rerender(),this.didReceiveProps()},this.extendProps=function(t){var e=h({},this.props,t);this.setProps(e)},this.getProps=function(){return this.props},this.getState=function(){return this.state},this.willReceiveProps=function(t){},this.didReceiveProps=function(){},this.willRender=function(){},this.didRender=function(){},this._getInitialState=function(){if(this.context.router){var t=this.context.router.getInitialState(this);if(t)return t}return this.getInitialState()},this.hasClass=function(t){return this.$el?this.$el.hasClass(t):!1},this.addClass=function(t){return this._data.addClass(t),this.$el&&this.$el.addClass(t),this},this.removeClass=function(t){return this._data.removeClass(t),this.$el&&this.$el.removeClass(t),this},this.attr=g.prototype.attr,this.removeAttr=function(){return this._data.removeAttr.apply(this._data,arguments),this.$el&&this.$el.removeAttr.apply(this.$el,arguments),this},this.getAttribute=function(t){return this.$el.attr(t)},this.setAttribute=function(t,e){return this._data.attr(t,e),this.$el&&this.$el.attr(t,e),this},this.getTagName=g.prototype.getTagName,this.setTagName=function(){throw new Error("Not supported.")},this.getId=g.prototype.getId,this.setId=function(t){return this._data.setId(t),this.el.id=t,this},this.getTextContent=function(){return this.$el?this.$el.text():""},this.setTextContent=function(t){return this.empty(),this.append(t),this},this.getInnerHtml=function(){return this.$el?this.$el.html():""},this.setInnerHtml=function(){throw new Error("Not supported.")},this.getOuterHtml=g.prototype.getOuterHtml,this.getValue=g.prototype.getValue,this.setValue=function(t){return this._data.val(t),this.$el&&this.$el.val(t),this},this.getStyle=g.prototype.getStyle,this.setStyle=function(t,e){this._data.setStyle(t,e),this.$el.css(t,e)},this.addEventListener=g.prototype.addEventListener,this.removeEventListener=g.prototype.removeEventListener,this.focus=g.prototype.focus,this.isTextNode=g.prototype.isTextNode,this.isElementNode=g.prototype.isElementNode,this.isCommentNode=g.prototype.isCommentNode,this.isDocumentNode=g.prototype.isDocumentNode,this.getChildNodes=function(){return this.children},this.getChildren=function(){return this.children},this.getChildNodeIterator=g.prototype.getChildNodeIterator,this.createElement=function(){throw new Error("Not supported yet.")},this.clone=function(){throw new Error("Not supported yet.")},this.is=function(t){if(this.$el)return this.$el.is(t);throw new Error("Invalid state: you can use this after the component has been rendered.")},this.getRoot=function(){for(var t=this,e=t;e;)t=e,e=t.getParent();return t},this.find=t,this.findAll=t,this.append=function(t){u(t)&&(t=new y(t));var e=this._compileComponent(t);return this._data.append(t),this.$el.append(e.$el),this.children.push(e),e.triggerDidMount(),this},this.insertAt=function(t,e){var i=this._compileComponent(e);return this._data.insertAt(t,e),t>this.children.length-1?(this.$el.append(i.$el),this.children.push(i)):(i.$el.insertBefore(this.children[t].$el),this.children.splice(t,0,i)),i.triggerDidMount(),this},this.removeAt=function(t){return this._data.removeAt(t),this.children[t].unmount(),this.children.splice(t,1),this},this.empty=function(){this._data.children=[],this.$el.empty();for(var t=0;t<this.children.length;t++)this.children[t].unmount();return this.children=[],this},this.remove=function(){this.unmount()},this.htmlProp=function(){return 1===arguments.length&&u(arguments[0])?this.$el.prop(arguments[0]):(this._data.htmlProp.apply(this._data,arguments),this.$el&&this.$el.prop.apply(this.$el,arguments),this)},this.removeHtmlProp=function(){return this._data.removeHtmlProp.apply(this._data,arguments),this.$el&&this.$el.removeProp.apply(this.$el,arguments),this};var i=function(t){for(var e={},i=0;i<t.length;i++){var n=t[i],s=n._ref;s&&(e[s]=n)}return e};this._createElement=function(t,e){var i=a("<"+t.tagName+">");return i.addClass(this._htmlParams.classNames),i.addClass(t.classNames),i.attr(this._htmlParams.attributes),i.attr(t.attributes),i.prop(this._htmlParams.htmlProps),i.prop(t.htmlProps),i.css(this._htmlParams.style),t.style&&i.css(t.style),p(t.handlers,function(t,n){this._bindHandler(i[0],e,n,t)},this),i},this._updateElement=function(t,e,i){var n=this.$el,s=this.el,r=e.classNames,o=t.classNames;r!==o&&(n.removeClass(r),n.addClass(o));var a=e.attributes,l=t.attributes;if(!c(a,l)){var u=Object.keys(a);n.removeAttr(u.join(" ")),n.attr(l)}var h=e.htmlProps,d=t.htmlProps;if(!c(h,d)){var f=Object.keys(h);n.removeProp(f.join(" ")),n.prop(d)}return c(e.style,t.style)||t.style&&n.css(t.style),p(e.handlers,function(t,e){s.removeEventListener?s.removeEventListener(e,t.handler):n.off(e)}),p(t.handlers,function(t,e){this._bindHandler(s,i,e,t)},this),n},this._render=function(t,e){function s(t,e){t.triggerDispose(),t.$el.replaceWith(e.$el[0])}function r(t,i){if(t instanceof n.Container)t._render(i,e);else{var s=o(i);t._updateElement(s,t._htmlParams),t._htmlParams=s,t.setProps(i.props)}}if(this.willRender(),!t)throw new Error("Nothing to render. Make sure your render method returns a virtual element: "+this.displayName);if("element"!==t.type){if(t instanceof a)throw new Error("Your render() method accidently return a jQuery instance instead of a VirtualComponent created $$.");throw new Error("Component.render() must return one html element: e.g., $$('div')")}e={owner:e?e.owner:this,parent:this};var l=this._data;if(!this.$el)return this.$el=this._createElement(t,e),this.el=this.$el[0],void this._renderFromScratch(t,e);if(this._updateElement(t,l,e),0===Object.keys(this._preserved).length)return void this._renderFromScratch(t,e);var u=this.$el[0],h=n.isMounted(this),p=l.children,d=t.children;if(c(p,d))return void(this._data=t);for(var f=i(l.children,"old"),m=i(t.children),g=0,b=0,y=0,v=this.children,_=[];b<p.length||y<d.length;){var x=u.childNodes[g],C=p[b],w=d[y],S=null,T=v[b];if(!C){for(var E=y;E<d.length;E++)S=this._compileComponent(d[E],e),this.$el.append(S.$el),_.push(S),S.triggerDidMount(h);break}if(!w){for(var I=b;I<p.length;I++)v[I].unmount();break}if(x!==T.$el[0])throw new Error("Assertion failed: DOM structure is not as expected.");var A=w._ref,O=C._ref;if(O&&A)if(O===A)w._quasiEquals(C)?(S=T,r(S,w)):(S=this._compileComponent(w,e),s(T,S),S.triggerDidMount(h)),g++,b++,y++;else if(!f[A]&&m[O])S=this._compileComponent(w,e),S.$el.insertBefore(x),S.triggerDidMount(h),g++,y++;else{if(f[A]||m[O]){if(f[A]&&!m[O]){T.unmount(),b++;continue}throw f[A]&&m[O]?new Error("Swapping positions of persisted components not supported!"):new Error("Assertion failed: should not reach this statement.")}S=this._compileComponent(w,e),s(T,S),S.triggerDidMount(h),g++,y++,b++}else if(A){if(f[A]){T.unmount(),b++;continue}S=this._compileComponent(w,e),s(T,S),S.triggerDidMount(h),g++,b++,y++}else O?(S=this._compileComponent(w,e),m[O]?S.$el.insertBefore(x):(s(T,S),b++),S.triggerDidMount(h),g++,y++):("text"===w.type&&"text"===C.type&&w.props.text===C.props.text?S=T:(S=this._compileComponent(w,e),s(T,S),S.triggerDidMount(h)),g++,b++,y++);if(S._ref){var N=S._data;N._owner?N._owner.refs[S._ref]=S:console.warn("FIXME: owner is unknown."),this._preserved[t._ref]=S}S._isOnRoute&&(e.owner.route&&console.warn("Route is already defined in this scope. In every render() implementation there must be only one routed component."),e.owner.route=S),_.push(S)}this.children=_,this._data=t,this.didRender()},this._renderFromScratch=function(t,e){for(var i=0;i<this.children.length;i++)this.children[i].unmount();this.$el.empty();for(var s=n.isMounted(this),r=[],o=0;o<t.children.length;o++)if(t.children[o]instanceof b.RawHtml)this.$el.html(t.children[o].html),r=[];else{var a=this._compileComponent(t.children[o],e);this.$el.append(a.$el),r.push(a),a.triggerDidMount(s)}this.children=r,this._data=t,this.didRender()},this._compileComponent=function(t,e){return e=e||{owner:this,parent:this},n._render(t,e)},this._getContext=function(){var t=this.getParent(),e=this.getInitialContext();return t?(e=h({},t.context,e),t.getChildContext?h(e,t.getChildContext()):e):e},this._setProps=function(t){this.props=t||{},Object.freeze(this.props)},this._setState=function(t){this.state=t||{},Object.freeze(this.state)},this._bindHandler=function(t,e,i,n){var s=n.handler;if(s=n.context?s.bind(n.context):s.bind(e.owner),n.handler=s,n.selector){var r=s;s=function(t){a(t.target).is(n.selector)&&r(t)}}t.addEventListener?t.addEventListener(i,s):a(t).on(i,s)}},m.extend(n),d.mixin(n),o=function(t){return{classNames:t.classNames||"",attributes:t.attributes||{},htmlProps:t.htmlProps||{},style:t.style||{}}},n.Root=function(t){n.call(this,"root",t)},n.extend(n.Root),n.Container=function(t,e){n.call(this,t,e)},n.extend(n.Container),n.HTMLElement=function(t,e,i){this.tagName=e,n.Container.call(this,t,i)},n.Container.extend(n.HTMLElement),n.Text=function(t,e){n.call(this,t),this._text=e},n.Text.Prototype=function(){this._render=function(){this.$el?this.$el.text(this._text):(_?this.el=window.document.createTextNode(this._text):this.el=a._createTextNode(this._text),this.$el=a(this.el))}},n.extend(n.Text);var x=null,C=[];n.createElement=function(){if(!x)throw new Error("Component.createElement can not be used outside of the Component rendering lifecycle.");var t=b.createElement.apply(null,arguments);return t._owner=x,t},n.$$=n.createElement,n._render=function(t,e){var i;e=e||{owner:null,parent:null};var o=e.parent||"root";switch(t.type){case"text":i=new n.Text(o,t.props.text),i._render();break;case"element":i=new n.HTMLElement(o,t.tagName,t),i._render(t,e);break;case"component":i=new t.ComponentClass(o,t),s(i);var a=i.render();r(),i._render(a);break;case"html":throw new Error("$$.html() can not be used in combination with other composition methods.");default:throw new Error("Unsupported component type: "+t.type)}return t._ref&&(t._owner?t._owner.refs[t._ref]=i:console.warn("FIXME: owner is unknown."),e.parent&&(e.parent._preserved[t._ref]=i)),t._isOnRoute&&e.owner&&(e.owner.route&&console.warn("Route is already defined in this scope. Only one route is allowed in each render() implementation."),e.owner.route=i),i},n.render=function(t,e){if(e=e||{},!l(t))throw new Error("Unsupported arguments for Component.render");var i=t;i.prototype instanceof n||(i=function(){n.apply(this,arguments)},n.extend(i,{render:t})),t=new i("root",{props:e}),s(t);var o=t.render();return r(),t._render(o),t},n.mount=function(t,e,i){if(2===arguments.length&&(i=arguments[1],e={}),t instanceof n);else if(t instanceof b)console.warn("DEPRECATED: use Component.mount(MyComponent, {...}, el) instead."),t=n._render(t);else{if(!(arguments[0].prototype instanceof n))throw new Error("component must be of type Component or VirtualComponent");t=n.render(t,e)}if(!i)throw new Error("An element is needed for mounting.");return a(i).append(t.$el),t.triggerDidMount(),t},n.isMounted=function(t){var e;if(!t.$el)return!1;for(e=t.$el[0];e;){if(9===e.nodeType)return!0;e=e.parentNode}return!1},e.exports=n},{"../util/EventEmitter":405,"../util/jquery":412,"./DOMElement":372,"./DefaultDOMElement":373,"./VirtualDOMElement":403,"./i18n":404,"lodash/collection/each":158,"lodash/lang/isEqual":273,"lodash/lang/isFunction":274,"lodash/lang/isString":279,"lodash/object/extend":282}],366:[function(t,e,i){"use strict";function n(){o.apply(this,arguments)}var s=t("../util/helpers"),r=t("./Component"),o=t("./ContainerEditor"),a=r.$$;n.Prototype=function(){this.render=function(){var t=this.getDocument(),e=t.get(this.props.containerId),i=a("div").addClass("surface container-node "+e.id).attr({spellCheck:!1,"data-id":e.id,contenteditable:!1});return s.each(e.nodes,function(t){i.append(this._renderNode(t))},this),i}},o.extend(n),e.exports=n},{"../util/helpers":410,"./Component":365,"./ContainerEditor":367}],367:[function(t,e,i){"use strict";function n(){if(r.apply(this,arguments),!s.isString(this.props.containerId))throw new Error("Illegal argument: Expecting containerId.");var t=this.getDocument();this.editingBehavior=new a,this.textPropertyManager=new o(t,this.props.containerId),t.connect(this,{"document:changed":this.onDocumentChange})}var s=t("../util/helpers"),r=t("./Surface"),o=t("../model/TextPropertyManager"),a=t("../model/EditingBehavior"),l=t("../model/transform/insertText"),u=t("../model/transform/copySelection"),c=t("../model/transform/deleteSelection"),h=t("../model/transform/breakNode"),p=t("../model/transform/insertNode"),d=t("../model/transform/switchTextType"),f=t("../model/transform/paste"),m=t("../util/uuid"),g=t("./ContainerNodeMixin"),b=t("./Component"),y=b.$$;n.Prototype=function(){this.onCreateText=function(){var t;this.transaction(function(e){var i=e.get(this.props.containerId),n=e.getSchema().getDefaultTextType(),s=e.create({id:m(n),type:n,content:""});i.show(s.id),t=e.createSelection({type:"property",path:[s.id,"content"],startOffset:0,endOffset:0})}.bind(this)),this.rerender(),this.setSelection(t)},this.isEmpty=function(){var t=this.getDocument(),e=t.get(this.props.containerId);return e&&0===e.nodes.length},this.shouldEnableSurface=function(){return!this.isEmpty()},this.render=function(){var t=r.prototype.render.call(this),e=this.getDocument(),i=this.props.containerId,n=e.get(this.props.containerId);n||console.warn("No container node found for ",this.props.containerId);var o=this.isEmpty();return t.addClass("sc-container-editor container-node "+i).attr({spellCheck:!1,"data-id":i,contenteditable:!o}),o?t.append(y("a").attr("href","#").append("Start writing").on("click",this.onCreateText)):s.each(n.nodes,function(e){t.append(this._renderNode(e))},this),t},this.onDocumentChange=function(t){if(t.isAffected([this.props.containerId,"nodes"]))for(var e=0;e<t.ops.length;e++){var i=t.ops[e];if("update"===i.type&&i.path[0]===this.props.containerId){var n=i.diff;"insert"===n.type?this._insertNodeAt(n.getOffset(),n.getValue()):"delete"===n.type&&this._removeNodeAt(n.getOffset())}}},this.extendBehavior=function(t){t.register(this.editingBehavior)},this.isContainerEditor=function(){return!0},this.getContainerId=function(){return this.props.containerId},this.getContainer=function(){return this.getDocument().get(this.getContainerId())},this["delete"]=function(t,e){return this._prepareArgs(e),c(t,e)},this["break"]=function(t,e){return this._prepareArgs(e),e.selection.isPropertySelection()||e.selection.isContainerSelection()?h(t,e):void 0},this.insertNode=function(t,e){return this._prepareArgs(e),e.selection.isPropertySelection()||e.selection.isContainerSelection()?p(t,e):void 0},this.switchType=function(t,e){return this._prepareArgs(e),e.selection.isPropertySelection()?d(t,e):void 0},this.selectAll=function(){var t=this.getDocument(),e=t.get(this.getContainerId()),i=e.getFirstPath(),n=e.getLastPath(),s=t.get(n),r=t.createSelection({type:"container",containerId:e.id,startPath:i,startOffset:0,endPath:n,endOffset:s.length});console.log("###",r.toString()),this.setSelection(r)},this.paste=function(t,e){return this._prepareArgs(e),e.selection.isPropertySelection()||e.selection.isContainerSelection()?f(t,e):void 0},this.insertText=function(t,e){return e.selection.isPropertySelection()||e.selection.isContainerSelection()?l(t,e):void 0},this.softBreak=function(t,e){return e.text="\n",this.insertText(t,e)},this.copy=function(t,e){var i=u(t,{selection:e});return i.doc},this._prepareArgs=function(t){t.containerId=this.getContainerId(),t.editingBehavior=this.editingBehavior},this._insertNodeAt=function(t,e){var i=this._renderNode(e);this.insertAt(t,i)},this._removeNodeAt=function(t){this.removeAt(t)}},r.extend(n,g),e.exports=n},{"../model/EditingBehavior":100,"../model/TextPropertyManager":115,"../model/transform/breakNode":132,"../model/transform/copySelection":133,"../model/transform/deleteSelection":138,"../model/transform/insertNode":141,"../model/transform/insertText":142,"../model/transform/paste":144,"../model/transform/switchTextType":146,"../util/helpers":410,"../util/uuid":416,"./Component":365,"./ContainerNodeMixin":368,"./Surface":387}],368:[function(t,e,i){"use strict";var n=t("./UnsupportedNode"),s=t("./Component"),r=s.$$,o={_renderNode:function(t){var e=this.context.doc,i=e.get(t),s=this.context.componentRegistry||this.props.componentRegistry,o=s.get(i.type);return o||(console.error("Could not resolve a component for type: "+i.type),o=n),r(o,{doc:e,node:i})}};e.exports=o},{"./Component":365,"./UnsupportedNode":402}],369:[function(t,e,i){"use strict";function n(){if(r.apply(this,arguments),!this.props.doc)throw new Error("Controller requires a Substance document instance");this.documentSession=new c(this.props.doc),this.surfaces={},this.focusedSurface=null,this.stack=[],this.logger=new l;var t=this.getConfig();this._initializeComponentRegistry(t.controller.components),this._initializeCommandRegistry(t.controller.commands),t.i18n&&h.instance.load(t.i18n),this.toolManager=new o(this),
this._initialize(this.props),this.handleStateUpdate(this.state)}var s=t("../util/helpers"),r=t("./Component"),o=t("./ToolManager"),a=t("../util/Registry"),l=t("../util/Logger"),u=t("../model/Selection"),c=t("../model/DocumentSession"),h=t("./i18n");h.instance.load(t("../i18n/en")),n.Prototype=function(){this.getInitialState=function(){return{}},this.didMount=function(){this.$el.on("keydown",this.handleApplicationKeyCombos.bind(this))},this.dispose=function(){this.$el.off("keydown"),this.props.doc&&this._dispose()},this._dispose=function(){this.props.doc.disconnect(this)},this.willReceiveProps=function(t){this.props.doc&&t.doc!==this.props.doc&&(this._dispose(),this.empty(),this._initialize(t))},this._initialize=function(t){var e=t.doc;e.connect(this,{"document:changed":this.onDocumentChanged,"transaction:started":this.onTransactionStarted},{priority:-20})},this.getConfig=function(){return this.constructor["static"].config||this.props.config||{controller:{components:[],commands:[]}}},this.getChildContext=function(){return{config:this.getConfig(),doc:this.props.doc,controller:this,componentRegistry:this.componentRegistry,toolManager:this.toolManager,i18n:h.instance}},this.getToolManager=function(){return this.toolManager},this._initializeComponentRegistry=function(t){var e=new a;s.each(t,function(t,i){e.add(i,t)}),this.componentRegistry=e},this._initializeCommandRegistry=function(t){var e=new a;s.each(t,function(t){var i=new t(this);e.add(t["static"].name,i)},this),this.commandRegistry=e},this.getCommand=function(t){return this.commandRegistry.get(t)},this.executeCommand=function(t){var e=this.getCommand(t);if(!e)return void console.warn("command",t,"not registered on controller");var i=e.execute();i?this.emit("command:executed",i,t,e):void 0===i&&console.warn("command ",t,"must return either an info object or true when handled or false when not handled")},this.getLogger=function(){return this.logger},this.getDocument=function(){return this.props.doc},this.getDocumentSession=function(){return this.documentSession},this.getSurface=function(t){return t?this.surfaces[t]:(console.warn("Deprecated: Use getFocusedSurface. Always provide a name for getSurface otherwise."),this.getFocusedSurface())},this.getFocusedSurface=function(){return this.focusedSurface},this.getSelection=function(){var t=this.getSurface();return t?t.getSelection():u.nullSelection},this.getContainerId=function(){var t=this.getSurface();return t?t.getContainerId():void 0},this.registerSurface=function(t){t.connect(this,{"selection:changed":this._onSelectionChanged,"command:executed":this._onCommandExecuted}),this.surfaces[t.getName()]=t},this.unregisterSurface=function(t){t.disconnect(this),delete this.surfaces[t.getName()],t&&this.focusedSurface===t&&(this.focusedSurface=null)},this.hasSurfaces=function(){return Object.keys(this.surfaces).length>0},this.didFocus=function(t){this.focusedSurface&&t!==this.focusedSurface&&this.focusedSurface.setFocused(!1),this.focusedSurface=t},this.transaction=function(){var t=this.getFocusedSurface();t?t.transaction.apply(t,arguments):this.documentSession.transaction.apply(this.documentSession,arguments)},this.onTransactionStarted=function(t){},this.handleApplicationKeyCombos=function(t){var e=!1;return 27===t.keyCode?(this.setState(this.getInitialState()),e=!0):83===t.keyCode&&(t.metaKey||t.ctrlKey)&&(this.executeCommand("save"),e=!0),e?(t.preventDefault(),t.stopPropagation(),!0):void 0},this.handleStateUpdate=function(){},this.willUpdateState=function(t){this.handleStateUpdate(t)},this.onDocumentChanged=function(t,e){if(e.replay){var i=t.after.selection,n=t.after.surfaceId;if(n){var s=this.surfaces[n];s?(this.focusedSurface!==s&&this.didFocus(s),s.setSelection(i)):console.warn("No surface with name",n)}t.after.state&&this.setState(t.after.state)}var r=this.getDocument();r.__dirty=!0;var o=this.getLogger();o.info("Unsaved changes")},this.onSelectionChanged=function(t,e){},this.onCommandExecuted=function(t,e,i){},this._onSelectionChanged=function(t,e){this.focusedSurface=e,this.emit("selection:changed",t,e),this.onSelectionChanged(t,e)},this._onCommandExecuted=function(t,e,i){this.emit("command:executed",t,e,i),this.onCommandExecuted(t,e,i)},this.uploadFile=function(t,e){if(this.props.onUploadFile)return this.props.onUploadFile(t,e);var i=window.URL.createObjectURL(t);e(null,i)},this.pushState=function(){var t={surface:this.focusedSurface,selection:null};this.focusedSurface&&(t.selection=this.focusedSurface.getSelection()),this.focusedSurface=null,this.stack.push(t)},this.popState=function(){var t=this.stack.pop();t&&t.surface&&(t.surface.setFocused(!0),t.surface.setSelection(t.selection))},this.saveDocument=function(){var t=this.getDocument(),e=this.getLogger();if(t.__dirty&&!t.__isSaving)if(e.info("Saving ..."),t.__isSaving=!0,this.props.onSave){var i=[];this.props.onSave(t,i,function(i){t.__isSaving=!1,i?e.error(i.message||i.toString()):(t.__dirty=!1,this.emit("document:saved"),e.info("No changes"))}.bind(this))}else e.error("Document saving is not handled at the moment. Make sure onSave is passed in the props")},this.render=function(){throw new Error("Controller.prototype.render is abstract. You need to define your own controller component")}},r.extend(n),e.exports=n},{"../i18n/en":80,"../model/DocumentSession":99,"../model/Selection":111,"../util/Logger":406,"../util/Registry":408,"../util/helpers":410,"./Component":365,"./ToolManager":398,"./i18n":404}],370:[function(t,e,i){"use strict";var n=t("./Command"),s=function(t){this.controller=t};s.Prototype=function(){this.getController=function(){return this.controller},this.getDocument=function(){return this.controller.getDocument()},this.getDocumentSession=function(){return this.controller.getDocumentSession()},this.execute=function(){throw new Error("execute must be implemented by custom commands")}},n.extend(s),e.exports=s},{"./Command":364}],371:[function(t,e,i){"use strict";function n(){if(s.apply(this,arguments),!this.context.controller)throw new Error("No controller context found.")}var s=t("./Tool");n.Prototype=function(){this.getDocument=function(){return this.context.controller.getDocument()},this.performAction=function(){var t=this.getController();t.executeCommand(this.constructor["static"].command)}},s.extend(n),e.exports=n},{"./Tool":397}],372:[function(t,e,i){"use strict";function n(){}var s=t("../util/oo"),r=t("lodash/lang/isFunction"),o=t("lodash/lang/isObject"),a=t("lodash/lang/isString"),l=t("lodash/collection/each");n.Prototype=function(){this.hasClass=function(t){throw new Error("This method is abstract.")},this.addClass=function(t){throw new Error("This method is abstract.")},this.removeClass=function(t){throw new Error("This method is abstract.")},this.attr=function(){if(1===arguments.length){if(a(arguments[0]))return this.getAttribute(arguments[0]);o(arguments[0])&&l(arguments[0],function(t,e){this.setAttribute(e,t)},this)}else 2===arguments.length&&this.setAttribute(arguments[0],arguments[1]);return this},this.removeAttr=function(t){throw new Error("This method is abstract.")},this.getAttribute=function(t){throw new Error("This method is abstract.")},this.setAttribute=function(t,e){throw new Error("This method is abstract.")},this.getTagName=function(){throw new Error("This method is abstract.")},this.setTagName=function(t){throw new Error("This method is abstract.")},this.getId=function(){throw new Error("This method is abstract.")},this.setId=function(t){throw new Error("This method is abstract.")},this.text=function(t){return 0===arguments.length?this.getTextContent():this.setTextContent(t)},this.getTextContent=function(){throw new Error("This method is abstract.")},this.setTextContent=function(t){throw new Error("This method is abstract.")},this.html=function(t){return 0===arguments.length?this.getInnerHtml():this.setInnerHtml(t)},this.getInnerHtml=function(){throw new Error("This method is abstract.")},this.setInnerHtml=function(t){throw new Error("This method is abstract.")},this.getOuterHtml=function(){throw new Error("This method is abstract.")},this.val=function(t){return 0===arguments.length?this.getValue():(this.setValue(t),this)},this.getValue=function(){throw new Error("This method is abstract.")},this.setValue=function(t){throw new Error("This method is abstract.")},this.css=function(){if(1===arguments.length){if(a(arguments[0]))return this.getStyle(arguments[0]);if(!o(arguments[0]))throw new Error("Illegal arguments.");l(arguments[0],function(t,e){this.setStyle(e,t)},this)}else{if(2!==arguments.length)throw new Error("Illegal arguments.");this.setStyle(arguments[0],arguments[1])}return this},this.getStyle=function(t){throw new Error("This method is abstract.")},this.setStyle=function(t,e){throw new Error("This method is abstract.")},this.on=function(t,e,i){if(!a(t))throw new Error('Illegal argument: "event" must be a String.');if(2===arguments.length&&(i=arguments[1],e=null),e&&!a(e))throw new Error("Illegal argument: selector must be a string.");if(!i||!r(i))throw new Error("Illegal argument: invalid handler function for event "+t);return this.addEventListener(t,e,i),this},this.off=function(t){return this.removeEventListener(t),this},this.addEventListener=function(t,e,i,n){throw new Error("This method is abstract.")},this.removeEventListener=function(t){throw new Error("This method is abstract.")},this.focus=function(){},this.getNodeType=function(){if(this.isTextNode())return"text";if(this.isCommentNode())return"comment";if(this.isElementNode())return"element";if(this.isDocumentNode())return"document";throw new Error("Unsupported node type")},this.getChildNodes=function(){throw new Error("This method is abstract.")},this.getChildren=function(){throw new Error("This method is abstract.")},this.isTextNode=function(){throw new Error("This method is abstract.")},this.isElementNode=function(){throw new Error("This method is abstract.")},this.isCommentNode=function(){throw new Error("This method is abstract.")},this.isDocumentNode=function(){throw new Error("This method is abstract.")},this.clone=function(){throw new Error("This method is abstract.")},this.createElement=function(t){throw new Error("This method is abstract.")},this.is=function(t){throw new Error("This method is abstract.")},this.getParent=function(){throw new Error("This method is abstract.")},this.getRoot=function(){throw new Error("This method is abstract.")},this.find=function(t){throw new Error("This method is abstract.")},this.findAll=function(t){throw new Error("This method is abstract.")},this.append=function(t){throw new Error("This method is abstract.")},this.insertAt=function(t,e){throw new Error("This method is abstract.")},this.removeAt=function(t){throw new Error("This method is abstract.")},this.empty=function(){throw new Error("This method is abstract.")},this.remove=function(){throw new Error("This method is abstract.")},this.serialize=function(){return this.outerHTML}},s.initClass(n),Object.defineProperties(n.prototype,{id:{configurable:!0,get:function(){return this.getId()},set:function(t){this.setId(t)}},textContent:{configurable:!0,get:function(){return this.getTextContent()},set:function(t){this.setTextContent(t)}},innerHTML:{configurable:!0,get:function(){return this.getInnerHtml()},set:function(t){this.setInnerHtml(t)}},outerHTML:{configurable:!0,get:function(){return this.getOuterHtml()},set:function(){throw new Error("ui/DOMElement#outerHTML is readonly.")}},nodeType:{configurable:!0,get:function(){return this.getNodeType()},set:function(){throw new Error("ui/DOMElement#nodeType is readonly.")}},childNodes:{configurable:!0,get:function(){return this.getChildNodes()},set:function(){throw new Error("ui/DOMElement#childNodes is readonly.")}}}),n.parseHTML=function(e){var i=t("./DefaultDOMElement");return i.parseHTML(e)},n.parseXML=function(e){var i=t("./DefaultDOMElement");return i.parseXML(e)},e.exports=n},{"../util/oo":413,"./DefaultDOMElement":373,"lodash/collection/each":158,"lodash/lang/isFunction":274,"lodash/lang/isObject":278,"lodash/lang/isString":279}],373:[function(t,e,i){"use strict";function n(t){if(!t)throw new Error("Illegal argument: el is null");this.el=t,this.$el=o(t),this._handlers={},Object.freeze(this)}function s(t,e){var i,s=[];if(!t)return i=p?"xml"===e?(new window.DOMParser).parseFromString("<dummy/>","text/xml"):(new window.DOMParser).parseFromString("<html></html>","text/html"):"xml"===e?o.parseXML(""):o.parseHTML(""),new n(i);if(p){var r,a=new window.DOMParser;if("html"===e?(r=t.search(/<\s*html/i)>=0,i=a.parseFromString(t,"text/html")):"xml"===e&&(i=a.parseFromString(t,"text/xml")),i)if("html"===e)if(r)s=[i.querySelector("html")];else{var l=i.querySelector("body");s=l.childNodes}else"xml"===e&&(s=i.childNodes);else"html"===e?r?(i=o.parseXML(t),s=i.childNodes):s=o.parseHTML(t):"xml"===e&&(i=o.parseXML(t),s=i.childNodes)}else s=o.parseXML(t);for(var u=[],c=0;c<s.length;c++)u.push(new n(s[c]));return 1===u.length?u[0]:u}var r=t("../util/oo"),o=t("../util/jquery"),a=t("lodash/lang/isString"),l=t("lodash/lang/isArray"),u=t("lodash/object/extend"),c=t("lodash/collection/each"),h=t("lodash/collection/map"),p="undefined"!=typeof window,d=t("./DOMElement");n.Prototype=function(){this.hasClass=function(t){return p?this.el.classList.contains(t):this.$el.hasClass(t)},this.addClass=function(t){if(p){var e=this.el.classList,i=t.split(/\s+/);1===i.length?e.add(t):i.forEach(function(t){t&&e.add(t)})}else this.$el.addClass(t);return this},this.removeClass=function(t){if(p){var e=this.el.classList,i=t.split(/\s+/);1===i.length?e.remove(t):i.forEach(function(t){t&&e.remove(t)})}else this.$el.removeClass(t);return this},this.attr=function(t,e){return 1===arguments.length?a(arguments[0])?this.getAttribute(t):(c(arguments[0],function(t,e){this.setAttribute(e,t)}.bind(this)),this):(this.setAttribute(t,e),this)},this.removeAttr=function(t){return p?this.el.removeAttribute(t):delete this.el.attribs[t],this},this.removeAttribute=this.removeAttr,this.getAttribute=function(t){return p?this.el.hasAttribute(t)?this.el.getAttribute(t):void 0:this.el.attribs[t]},this.setAttribute=function(t,e){return p?this.el.setAttribute(t,e):this.el.attribs[t]=e,this},this.getTagName=function(){return p?this.el.tagName?this.el.tagName.toLowerCase():"":"tag"!==this.el.type?"":this.el.name.toLowerCase()},this.setTagName=function(){throw new Error("tagName is readonly.")},this.withTagName=function(t){if(p){var e=this._createNativeElement("div"),i=this.getTagName(),s=this.el.outerHTML;return s=s.replace(new RegExp("^s*<s*"+i),"<"+t),s=s.replace(new RegExp(i+"s*>s*$"),t+">"),e.innerHTML=s,new n(e.firstChild)}var r=this.createElement(t);return r.innerHTML=this.innerHTML,r.el.attribs=u({},this.el.attribs),r},this.getId=function(){return this.el.id},this.setId=function(t){return this.el.id=t,this},this.getTextContent=function(){return p?this.el.textContent:this.$el.text()},this.setTextContent=function(t){return p?this.el.textContent=t:this.$el.text(t),this},this.getInnerHtml=function(){return p?this.el.innerHTML:this.$el.html()},this.setInnerHtml=function(t){p?this.el.innerHTML=t:this.$el.html(t)},this.getOuterHtml=function(){return p?this.el.outerHTML:o._serialize(this.el)},this.getValue=function(){return this.$el.val()},this.setValue=function(t){return this.$el.val(t),this},this.getStyle=function(t){return p?this.el.style[t]:this.$el.css(t)},this.setStyle=function(t,e){return p?this.el.style[t]=e:this.$el.css(t,e),this},this.addEventListener=function(t,e,i,n){if(this._handlers[t])throw new Error('Handler for event "'+t+'" has already been registered.');if(p){if(n&&(i=i.bind(n)),e){var s=i;i=function(t){o(t.target).is(e)&&s(t)}}this.addEventListener(t,e,i),this._handlers[t]=i}},this.removeEventListener=function(t){var e=this._handlers[t];e&&(delete this._handlers[t],p&&this.el.removeEventListener(t,e))},this.focus=function(){p&&this.$el.focus()},this.isTextNode=function(){return p?this.el.nodeType===window.Node.TEXT_NODE:"text"===this.el.type},this.isElementNode=function(){return p?this.el.nodeType===window.Node.ELEMENT_NODE:"tag"===this.el.type},this.isCommentNode=function(){return p?this.el.nodeType===window.Node.COMMENT_NODE:"comment"===this.el.type},this.isDocumentNode=function(){return p?this.el.nodeType===window.Node.DOCUMENT_NODE:this.el===this.el.root},this.getChildNodes=function(){for(var t=[],e=this.getChildNodeIterator();e.hasNext();)t.push(e.next());return t},this.getChildren=function(){var t=this.$el.children();return h(t,function(t){return new n(t)})},this.getChildNodeIterator=function(){var t;return t=p?this.el.childNodes:this.el.children,new n.NodeIterator(t)},this._createNativeElement=function(t){var e;return e=p?this.el.ownerDocument.createElement(t):o._createElement(t,this.el.root)},this.createElement=function(t){var e=this._createNativeElement(t);return new n(e)},this.clone=function(){var t;return t=p?this.el.cloneNode(!0):this.$el.clone()[0],new n(t)},this.is=function(t){return this.$el.is(t)},this.getParent=function(){var t;return t=p?this.el.parentNode:this.el.parent,t?new n(t):null},this.getRoot=function(){for(var t=this.el,e=t;e;)t=e,e=p?t.parentNode:t.parent;return new n(t)},this.find=function(t){var e=null;return e=p&&this.el.querySelector?this.el.querySelector(t):this.$el.find(t)[0],e?new n(e):null},this.findAll=function(t){var e;return e=p&&this.el.querySelectorAll?this.el.querySelectorAll(t):this.$el.find(t),h(e,function(t){return new n(t)})},this.append=function(t){return l(t)?t.forEach(function(t){this.append(t)}.bind(this)):t instanceof n?this.$el.append(t.el):this.$el.append(t),this},this.insertAt=function(t,e){var i=this.children;return t>i.length-1?this.append(e):this.$el.insertBefore(i[t].$el),this},this.removeAt=function(t){return this.children[t].$el.remove(),this},this.empty=function(){return p?this.el.innerHTML="":this.$el.empty(),this},this.remove=function(){this.$el.remove()}},d.extend(n),Object.defineProperties(n.prototype,{tagName:{configurable:!0,get:function(){return this.getTagName()},set:function(t){this.setTagName(t)}},children:{configurable:!0,get:function(){return this.getChildren()},set:function(){throw new Error("ui/DOMElement#children is readonly.")}}}),n.createTextNode=function(t){var e;return e=p?window.document.createTextNode(t):o._createTextNode(t),new n(e)},n.NodeIterator=function(t){this.nodes=t,this.length=this.nodes.length,this.pos=-1},n.NodeIterator.Prototype=function(){this.hasNext=function(){return this.pos<this.length-1},this.next=function(){this.pos+=1;var t=this.nodes[this.pos];return t instanceof n?t:new n(t)},this.back=function(){return this.pos>=0&&(this.pos-=1),this}},r.initClass(n.NodeIterator),n.parseHTML=function(t){return s(t,"html")},n.parseXML=function(t){return s(t,"xml")},e.exports=n},{"../util/jquery":412,"../util/oo":413,"./DOMElement":372,"lodash/collection/each":158,"lodash/collection/map":164,"lodash/lang/isArray":270,"lodash/lang/isString":279,"lodash/object/extend":282}],374:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("./Component"),r=s.$$,o=t("./FontAwesomeIcon");n.Prototype=function(){this.render=function(){return r("div").addClass("sc-dialog-header").append(r("a").addClass("se-back").attr("href","#").on("click",this.handleCancel).append(r(o,{icon:"fa-chevron-left"})),r("div").addClass("se-label").append(this.props.label))},this.handleCancel=function(t){t.preventDefault(),this.send("closeDialog")}},s.extend(n),e.exports=n},{"./Component":365,"./FontAwesomeIcon":375}],375:[function(t,e,i){"use strict";function n(){s.Container.apply(this,arguments)}var s=t("./Component"),r=s.$$;n.Prototype=function(){this.render=function(){return r("i").addClass("fa "+this.props.icon)}},s.Container.extend(n),e.exports=n},{"./Component":365}],376:[function(t,e,i){"use strict";var n=t("../util/EventEmitter"),s=t("lodash/collection/each"),r=t("lodash/array/without"),o=function(t){n.apply(this,arguments),this.doc=t,this._highlights={}};o.Prototype=function(){this.get=function(){return this._highlights},this.set=function(t){var e=this._highlights,i=this.doc;s(t,function(t,n){var o=e[n]||[],a=r(o,t),l=r(t,o);s(a,function(t){var e=i.get(t);e&&e.setHighlighted(!1,n)}.bind(this)),s(l,function(t){var e=i.get(t);e.setHighlighted(!0,n)}.bind(this))}.bind(this)),this._highlights=t,this.emit("highlights:updated",t)}},n.extend(o),e.exports=o},{"../util/EventEmitter":405,"lodash/array/without":156,"lodash/collection/each":158}],377:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("./AnnotationComponent"),r=t("./Component"),o=r.$$;n.Prototype=function(){this.render=function(){return o("span").attr({"data-inline":1,contentEditable:!1})}},s.extend(n),e.exports=n},{"./AnnotationComponent":359,"./Component":365}],378:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("./ControllerCommand");n.Prototype=function(){this.getCommandState=function(){var t=this.getDocumentSession();return{disabled:!t.canRedo(),active:!1}},this.execute=function(){var t=this.getDocumentSession();return t.canRedo()?(t.redo(),!0):!1}},s.extend(n),n["static"].name="redo",e.exports=n},{"./ControllerCommand":370}],379:[function(t,e,i){"use strict";var n=t("./ControllerTool"),s=n.extend({"static":{name:"redo",command:"redo"}});e.exports=s},{"./ControllerTool":371}],380:[function(t,e,i){"use strict";var n=t("../util/oo"),s=t("lodash/collection/each"),r=t("../util/jquery"),o=function(t){this.app=t,this.state=[],this.loadState();var e=this;r(window).on("hashchange",function(){e.onHashChange()})};o.Prototype=function(){this.loadState=function(){var t=window.location.hash.slice(1);if(t){var e=this.getStateFromRoute(t);e&&(this.state=e)}},this.getInitialState=function(t){if(!t._isOnRoute)return null;var e=this.getRouteIndex(t),i=this.state[e];return console.log("Router: getInitialState",t,e,i),i},this.truncateState=function(t){if(!this.__disabled__){var e=this.getRouteIndex(t);this.state=this.state.slice(0,e)}},this.getRouteIndex=function(t){for(var e=-1;t&&"root"!==t;)t._isOnRoute&&e++,t=t.getParent();return e},this.updateState=function(t){if(!this.__disabled__){this.state=t.slice(0);var e=this.getRouteFromState(this.state,"state");window.history.pushState({},"","#"+e)}},this.getStateFromRoute=function(t){var e=[],i=t.split(";");return s(i,function(t){var i=t.split(","),n={};s(i,function(t){var e=t.split("=");n[e[0]]=e[1]}),e.push(n)}),e},this.getRouteFromState=function(t){var e=[];return s(t,function(t){var i=[];s(t,function(t,e){"object"!=typeof t&&i.push(e+"="+t)}),e.push(i.join(","))}),e.join(";")},this.onHashChange=function(){var t=window.location.hash.slice(1);this.state=[],t&&(this.state=this.getStateFromRoute(t)||[]),this.__disabled__=!0;for(var e=this.app,i=0;i<this.state.length;i++){var n=this.state[i];if(e.setState(n),e=e.route,!e)break}this.__disabled__=!1},this.isActive=function(){return!this.__disabled__}},n.initClass(o),e.exports=o},{"../util/jquery":412,"../util/oo":413,"lodash/collection/each":158}],381:[function(t,e,i){"use strict";var n=t("./ControllerCommand"),s=n.extend({"static":{name:"save"},getCommandState:function(){var t=this.getDocument();return{disabled:!t.__dirty,active:!1}},execute:function(){return this.getController().saveDocument(),{status:"saving-process-started"}}});e.exports=s},{"./ControllerCommand":370}],382:[function(t,e,i){"use strict";var n=t("./ControllerTool"),s=n.extend({"static":{name:"save",command:"save"}});e.exports=s},{"./ControllerTool":371}],383:[function(t,e,i){"use strict";function n(){o.apply(this,arguments),this.props.highlights&&this.props.highlights.connect(this,{"highlights:updated":this.onHighlightsUpdated})}var s=t("../util/jquery"),r=t("../util/platform"),o=t("./Component"),a=t("./Scrollbar"),l=o.$$;n.Prototype=function(){this.didMount=function(){this.refs.scrollbar&&this.context.doc.connect(this,{"document:changed":this.onDocumentChange},-1)},this.dispose=function(){this.props.highlights&&this.props.highlights.disconnect(this),this.context.doc.disconnect(this)},this.onDocumentChange=function(){this.refs.scrollbar.updatePositions()},this.onHighlightsUpdated=function(t){this.refs.scrollbar.extendProps({highlights:t})},this.render=function(){var t=l("div").addClass("sc-scroll-pane");return r.isFF&&t.addClass("sm-firefox"),"substance"===this.props.scrollbarType&&(t.addClass("sm-substance-scrollbar"),t.addClass("sm-scrollbar-position-"+this.props.scrollbarPosition),t.append(l(a,{scrollPane:this}).ref("scrollbar").attr("id","content-scrollbar")),t.append(l("div").ref("scanline").addClass("se-scanline"))),t.append(l("div").ref("scrollable").addClass("se-scrollable").append(l("div").ref("content").addClass("se-content").append(this.props.children)).on("scroll",this.onScroll)),t},this.onScroll=function(){this.props.onScroll&&this.props.onScroll(this.getScrollPosition(),this.refs.scrollable),this.props.toc&&this.context.toc.markActiveEntry(this)},this.getHeight=function(){var t=this.getScrollableElement();return s(t).height()},this.getContentHeight=function(){var t=0,e=this.refs.content.el;return s(e).children().each(function(){t+=s(this).outerHeight()}),t},this.getContentElement=function(){return this.refs.content.el},this.getScrollableElement=function(){return this.refs.scrollable.el},this.getScrollPosition=function(){var t=this.getScrollableElement();return Math.floor(s(t).scrollTop()+1)},this.getPanelOffsetForElement=function(t){function e(t){var n=t.parentNode;!s(t).hasClass("se-content")&&n&&(("absolute"===s(t).css("position")||"relative"===s(t).css("position"))&&(i+=s(t).position().top),e(n))}var i=s(t).position().top;return e(t.parentNode),i},this.scrollTo=function(t){var e=this.getScrollableElement(),i=s(e).find('*[data-id="'+t+'"]')[0];if(i){var n=this.getPanelOffsetForElement(i);s(e).scrollTop(n)}else console.warn(t,"not found in scrollable container")}},o.extend(n),e.exports=n},{"../util/jquery":412,"../util/platform":414,"./Component":365,"./Scrollbar":384}],384:[function(t,e,i){"use strict";function n(){r.apply(this,arguments),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}var s=t("../util/jquery"),r=t("./Component"),o=r.$$,a=t("lodash/collection/each");n.Prototype=function(){this.didMount=function(){setTimeout(function(){this.updatePositions()}.bind(this)),s(window).on("resize",this.rerender.bind(this));var t=this.props.scrollPane,e=t.getScrollableElement();s(e).on("scroll",this.onScroll.bind(this))},this.dispose=function(){s(window).off("resize")},this.didRender=function(){this.isMounted()&&this.updatePositions()},this.render=function(){var t=o("div").addClass("sc-scrollbar").on("mousedown",this.onMouseDown);if(this.props.highlights){var e=[];a(this.props.highlights,function(t,i){a(t,function(t){e.push(o("div").ref(t).addClass("se-highlight sm-"+i))})}),t.append(o("div").ref("highlights").addClass("se-highlights").append(e))}return t.append(o("div").ref("thumb").addClass("se-thumb")),t},this.onScroll=function(){this.updatePositions()},this.updatePositions=function(){var t=this.props.scrollPane,e=t.getScrollableElement(),i=t.getContentHeight(),r=t.getHeight(),o=t.getScrollPosition();this.factor=i/r,this.refs.thumb.css({top:o/this.factor,height:r/this.factor}),this.props.highlights&&a(this.props.highlights,function(t){a(t,function(t){var i=s(e).find('*[data-id="'+t+'"]');if(i.length){var r=i.position().top/this.factor,o=i.outerHeight(!0)/this.factor;o<n.overlayMinHeight&&(o=n.overlayMinHeight);var a=this.refs[t];a?this.refs[t].css({top:r,height:o}):console.warn("no ref found for highlight",t)}}.bind(this))}.bind(this))},this.onMouseDown=function(t){t.stopPropagation(),t.preventDefault(),this._mouseDown=!0,s(window).on("mousemove",this.onMouseMove),s(window).on("mouseup",this.onMouseUp);var e=this.$el.offset().top,i=t.pageY-e,n=this.refs.thumb.$el;t.target!==n[0]?(this.offset=n.height()/2,this.onMouseMove(t)):this.offset=i-n.position().top},this.onMouseUp=function(){this._mouseDown=!1,s(window).off("mousemove",this.onMouseMove),s(window).off("mouseup",this.onMouseUp)},this.onMouseMove=function(t){if(this._mouseDown){var e=this.props.scrollPane,i=e.getScrollableElement(),n=this.$el.offset().top,r=t.pageY-n,o=(r-this.offset)*this.factor;this.scrollTop=s(i).scrollTop(o)}}},r.extend(n),n.overlayMinHeight=2,e.exports=n},{"../util/jquery":412,"./Component":365,"lodash/collection/each":158}],385:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("./Component"),r=s.$$;n.Prototype=function(){this.getSizedStyle=function(t){return t&&"inherit"!==t?"horizontal"===this.props.splitType?{height:t}:{width:t}:{}},this.render=function(){if(2!==this.props.children.length)throw new Error("SplitPane only works with exactly two child elements");var t=r("div").addClass("sc-split-pane");"horizontal"===this.props.splitType?t.addClass("sm-horizontal"):t.addClass("sm-vertical");var e=this.props.children[0],i=this.props.children[1];return this.props.sizeB?(i.addClass("se-pane sm-sized"),i.css(this.getSizedStyle(this.props.sizeB)),e.addClass("se-pane sm-auto-fill")):(e.addClass("se-pane sm-sized"),e.css(this.getSizedStyle(this.props.sizeA)),i.addClass("se-pane sm-auto-fill")),t.append(e,i),t}},s.extend(n),e.exports=n},{"./Component":365}],386:[function(t,e,i){"use strict";function n(){s.apply(this,arguments);var t=this.context.controller,e=t.getLogger();e.connect(this,{"messages:updated":this.handleStatusUpdate})}var s=t("./Component"),r=s.$$,o={error:"fa-exclamation-circle",info:"fa-info",progress:"fa-exchange",success:"fa-check-circle"};n.Prototype=function(){this.render=function(){var t=this.props.doc.getDocumentMeta(),e=t?t.title:this.i18n.t("untitled"),i=this.state.message,n=r("div").addClass("status-bar-component fill-light");return n.append(r("div").addClass("document-status").append(e)),i&&(n.addClass(i.type),n.append(r("div").addClass("notifications").append(r("div").addClass("icon").append(r("i").addClass("fa "+o[i.type]))),r("div").addClass("message").append(i.message))),n},this.handleStatusUpdate=function(t){var e=t.pop();this.setState({message:e})}},s.extend(n),e.exports=n},{"./Component":365}],387:[function(t,e,i){"use strict";function n(){u.apply(this,arguments);var t=this.getController(),e=this.getDocument();if(!t)throw new Error("Surface needs a valid controller");if(!e)throw new Error("No doc provided");if(!this.props.name)throw new Error("No name provided");this.docSession=t.getDocumentSession(),this.name=this.props.name,this.clipboard=new c(this),this.$document=p(window.document),this.onMouseUp=this.onMouseUp.bind(this),this.surfaceSelection=null,this.dragging=!1,this.onDomMutations=this.onDomMutations.bind(this),this.domObserver=new window.MutationObserver(this.onDomMutations),this.domObserverConfig={subtree:!0,characterData:!0},this.skipNextObservation=!1,this.enabled=!0,this.undoEnabled=!0,this.textTypes=this.props.textTypes,this._initializeCommandRegistry(this.props.commands),t.registerSurface(this)}var s=t("../util/helpers"),r=t("../util/Registry"),o=t("./SurfaceSelection"),a=t("../model/Document"),l=t("../model/Selection"),u=t("./Component"),c=t("./Clipboard"),h=u.$$,p=t("../util/jquery"),d=t("../model/transform/copySelection"),f=t("../util/platform");n.Prototype=function(){this.render=function(){var t=this.shouldEnableSurface(),e=h("div").addClass("surface").attr("spellCheck",!1);return t&&(e.on("keydown",this.onKeyDown),f.isIE||e.on("compositionstart",this.onCompositionStart),window.TextEvent&&!f.isIE?e.on("textInput",this.onTextInput):e.on("keypress",this.onTextInputShim),e.on("mousedown",this.onMouseDown),e.on("dragstart",this.onDragStart),e.on("focus",this.onNativeFocus),e.on("blur",this.onNativeBlur),this.clipboard.attach(e)),e},this.shouldEnableSurface=function(){return!0},this.didMount=function(){var t=this.getDocument();this.surfaceSelection=new o(this.el,t,this.getContainer()),this.clipboard.didMount(),this.domObserver.observe(this.el,this.domObserverConfig)},this.dispose=function(){var t=this.getDocument();
this.setSelection(null),this.textPropertyManager.dispose(),this.domObserver.disconnect(),t.disconnect(this),this.surfaceSelection=null,this.getController().unregisterSurface(this)},this.getChildContext=function(){return{surface:this,doc:this.getDocument()}},this.getCommand=function(t){return this.commandRegistry.get(t)},this.getTextTypes=function(){return this.textTypes||[]},this.executeCommand=function(t,e){var i=this.getCommand(t);if(!i)return void console.warn("command",t,"not registered on controller");var n=i.execute(e);n?this.emit("command:executed",n,t,i):void 0===n&&console.warn("command ",t,"must return either an info object or true when handled or false when not handled")},this.getTextCommands=function(){var t={};return this.commandRegistry.each(function(e){e.constructor["static"].textTypeName&&(t[e.constructor["static"].name]=e)}),t},this.getName=function(){return this.name},this.getElement=function(){return this.el},this.getController=function(){return this.context.controller||this.props.controller},this.getDocument=function(){if(this.doc)return this.doc;var t=this.context.doc;if(!t){console.warn("TODO: provide the doc instance via context (or as prop).");var e=this.getController();e&&(t=e.getDocument())}if(!t)throw new Error("Could not retrieve document.");return this.doc=t,t},this.getDocumentSession=function(){return this.docSession},this.getContainer=function(){},this.getContainerId=function(){},this.enable=function(){this.enableContentEditable&&this.el.prop("contentEditable","true"),this.enabled=!0},this.isEnabled=function(){return this.enabled},this.disable=function(){this.enableContentEditable&&this.el.removeAttr("contentEditable"),this.enabled=!1},this.transaction=function(t){var e=this.docSession,i=this.getName(),n=e.transaction(function(e,n){return e.before.surfaceId=i,t(e,n)});if(n){var s=this.getSelection();this.emit("selection:changed",s,this),this.rerenderDomSelection()}},this.setFocused=function(t){!this.isFocused&&t?(this.isFocused=t,this.getController().didFocus(this),this.emit("focus",this)):this.isFocused&&!t&&(this.isFocused=t,this.textPropertyManager.removeSelection(),this.emit("blur",this))},this.getSelection=function(){return this.docSession.getSelection()},this.setSelection=function(t){this._setSelection(t)},this.setSelectionFromEvent=function(t){this.skipNextFocusEvent=!0;var e=n.getDOMRangeFromEvent(t),i=this.surfaceSelection.getSelectionFromDOMRange(e);this.setSelection(i)},this.rerenderDomSelection=function(){if(this.surfaceSelection){var t=this.surfaceSelection,e=this.getSelection();t.setSelection(e)}},this.getDomNodeForId=function(t){return this.getElement().querySelector("*[data-id="+t+"]")},this.getLogger=function(){return this.logger},this.getTextPropertyManager=function(){return this.textPropertyManager},this.copy=function(t,e){var i=d(t,{selection:e});return i.doc},this.onKeyDown=function(t){if(229!==t.which){switch(t.keyCode){case n.Keys.LEFT:case n.Keys.RIGHT:return this._handleLeftOrRightArrowKey(t);case n.Keys.UP:case n.Keys.DOWN:return this._handleUpOrDownArrowKey(t);case n.Keys.ENTER:return this._handleEnterKey(t);case n.Keys.SPACE:return this._handleSpaceKey(t);case n.Keys.BACKSPACE:case n.Keys.DELETE:return this._handleDeleteKey(t)}var e=!1;(t.ctrlKey||t.metaKey)&&65===t.keyCode?(this.selectAll(),e=!0):this.undoEnabled&&90===t.keyCode&&(t.metaKey||t.ctrlKey)?(t.shiftKey?this.getController().executeCommand("redo"):this.getController().executeCommand("undo"),e=!0):66===t.keyCode&&(t.metaKey||t.ctrlKey)?(this.executeCommand("strong"),e=!0):73===t.keyCode&&(t.metaKey||t.ctrlKey)?(this.executeCommand("emphasis"),e=!0):76===t.keyCode&&(t.metaKey||t.ctrlKey)&&(this.executeCommand("link"),e=!0),e&&(t.preventDefault(),t.stopPropagation())}},this.onTextInput=function(t){t.data&&(t.preventDefault(),t.stopPropagation(),this.skipNextObservation=!0,this.transaction(function(e,i){return this.surfaceSelection.clear(),i.text=t.data,this.insertText(e,i)}.bind(this)),this.rerenderDomSelection())},this.onCompositionStart=function(){this.skipNextObservation=!0},this.onTextInputShim=function(t){if(!(0===t.which||0===t.charCode||t.keyCode===n.Keys.TAB||t.keyCode===n.Keys.ESCAPE||t.metaKey||!!t.ctrlKey^!!t.altKey)){var e=String.fromCharCode(t.which);return this.skipNextObservation=!0,t.shiftKey||(e=e.toLowerCase()),e.length>0?(this.transaction(function(t,i){return this.surfaceSelection.clear(),i.text=e,this.insertText(t,i)}.bind(this)),this.rerenderDomSelection(),t.preventDefault(),void t.stopPropagation()):(t.preventDefault(),void t.stopPropagation())}},this.onMouseDown=function(t){if(!(f.isIE&&f.version<12)&&t.detail>=3){var e=this.getSelection();if(e.isPropertySelection())return this._selectProperty(e.path),t.preventDefault(),void t.stopPropagation();if(e.isContainerSelection())return this._selectProperty(e.startPath),t.preventDefault(),void t.stopPropagation()}1===t.which&&(this.skipNextFocusEvent=!0,this.dragging=!0,this.$document.one("mouseup",this.onMouseUp))},this.onMouseUp=function(){this.dragging=!1,this.setFocused(!0);var t=this,e=this.textPropertyManager;setTimeout(function(){if(t.surfaceSelection){var i=t.surfaceSelection.getSelection();e.hasSelection()?(e.removeSelection(),t.setSelection(i)):t._setModelSelection(i)}})},this.onMouseMove=function(){this.dragging},this.onDomMutations=function(){return this.skipNextObservation?void(this.skipNextObservation=!1):void console.info("We want to enable a DOM MutationObserver which catches all changes made by native interfaces (such as spell corrections, etc). Lookout for this message and try to set Surface.skipNextObservation=true when you know that you will mutate the DOM.")},this.onDragStart=function(t){t.preventDefault(),t.stopPropagation()},this.onNativeBlur=function(){window.getSelection().removeAllRanges(),this.textPropertyManager.renderSelection(this.getSelection()),this.isNativeFocused=!1,this.skipNextFocusEvent=!1},this.onNativeFocus=function(){this.isNativeFocused=!0,window.setTimeout(function(){if(!this.skipNextFocusEvent)if(this.isFocused)this.textPropertyManager.removeSelection(),this.rerenderDomSelection();else{var t=this.surfaceSelection.getSelection();this.setFocused(!0),this.setSelection(t)}}.bind(this))},this._initializeCommandRegistry=function(t){var e=new r;s.each(t,function(t){var i=new t(this);e.add(t["static"].name,i)},this),this.commandRegistry=e},this._handleLeftOrRightArrowKey=function(t){var e=this;window.setTimeout(function(){if(!e._isDisposed()){var i={direction:t.keyCode===n.Keys.LEFT?"left":"right"};e._updateModelSelection(i)}})},this._handleUpOrDownArrowKey=function(t){var e=this;window.setTimeout(function(){if(!e._isDisposed()){var i={direction:t.keyCode===n.Keys.UP?"left":"right"};e._updateModelSelection(i)}})},this._isDisposed=function(){return!this.surfaceSelection},this._handleSpaceKey=function(t){t.preventDefault(),t.stopPropagation(),this.transaction(function(t,e){return this.surfaceSelection.clear(),e.text=" ",this.insertText(t,e)}.bind(this)),this.rerenderDomSelection()},this._handleEnterKey=function(t){t.preventDefault(),t.shiftKey?this.transaction(function(t,e){return this.softBreak(t,e)}.bind(this)):this.transaction(function(t,e){return this["break"](t,e)}.bind(this)),this.rerenderDomSelection()},this._handleDeleteKey=function(t){t.preventDefault();var e=t.keyCode===n.Keys.BACKSPACE?"left":"right";this.transaction(function(t,i){return i.direction=e,this["delete"](t,i)}.bind(this)),this.rerenderDomSelection()},this._setSelection=function(t,e){t?!s.isObject(t)||t instanceof l||(t=this.getDocument().createSelection(t)):t=l.nullSelection,e?this._setModelSelection(t,e):this._setModelSelection(t)&&this.rerenderDomSelection(),f.isFF&&!t.isNull()&&this.el&&this.el.focus()},this._updateModelSelection=function(t){this._setModelSelection(this.surfaceSelection.getSelection(t))},this._setModelSelection=function(t,e){return t=t||a.nullSelection,this.docSession.setSelection(t),e||this.emit("selection:changed",t,this),!0},this._selectProperty=function(t){var e=this.getDocument(),i=e.get(t);this.setSelection(e.createSelection({type:"property",path:t,startOffset:0,endOffset:i.length}))}},u.extend(n),n.Keys={UNDEFINED:0,BACKSPACE:8,DELETE:46,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,SHIFT:16,SPACE:32},n.getDOMRangeFromEvent=function(t){var e,i=t.clientX,n=t.clientY;if(document.body.createTextRange)e=document.body.createTextRange(),e.moveToPoint(i,n);else if("undefined"!=typeof document.createRange)if("undefined"!=typeof t.rangeParent)e=document.createRange(),e.setStart(t.rangeParent,t.rangeOffset),e.collapse(!0);else if(document.caretPositionFromPoint){var s=document.caretPositionFromPoint(i,n);e=document.createRange(),e.setStart(s.offsetNode,s.offset),e.collapse(!0)}else document.caretRangeFromPoint&&(e=document.caretRangeFromPoint(i,n));return e},e.exports=n},{"../model/Document":92,"../model/Selection":111,"../model/transform/copySelection":133,"../util/Registry":408,"../util/helpers":410,"../util/jquery":412,"../util/platform":414,"./Clipboard":361,"./Component":365,"./SurfaceSelection":389}],388:[function(t,e,i){"use strict";var n=t("./Command"),s=function(t){this.surface=t};s.Prototype=function(){this.getSurface=function(){return this.surface},this.getSelection=function(){var t=this.getSurface();return t.getSelection()},this.getContainerId=function(){var t=this.getSurface();return t.getContainerId()},this.getDocument=function(){var t=this.getSurface();return t.getDocument()},this.execute=function(){throw new Error("execute must be implemented by custom commands")}},n.extend(s),e.exports=s},{"./Command":364}],389:[function(t,e,i){"use strict";function n(t,e,i){this.element=t,this.doc=e,this.container=i,this.state=new n.State}var s=t("lodash/lang/isEqual"),r=t("../util/jquery"),o=t("../util/oo"),a=t("../model/Document"),l=t("../model/Range"),u=t("../model/Coordinate"),c=t("../model/Selection");n.Prototype=function(){function t(t,e){var i=t.compareDocumentPosition(e);return i&window.document.DOCUMENT_POSITION_FOLLOWING?-1:i&window.document.DOCUMENT_POSITION_PRECEDING?1:0}this._pullState=function(e,i,s,r,o,a){if(a=a||{},!s||!e)return void(this.state=null);var l,u;o?(l=this.getModelCoordinate(e,i,a),u=l):(l=this.getModelCoordinate(e,i,a),u=this.getModelCoordinate(s,r,a));var c=!1;if(!o&&s&&e){var h=t(u.el,l.el);c=0>h||0===h&&u.offset<l.offset}if(c){var p=u;u=l,l=p}this.state=new n.State(o,c,l,u)},this.getModelCoordinate=function(t,e,i){for(var s=t,o=null;s;){if(s.dataset&&s.dataset.inline&&(t=s,e=e>0?1:0),s.dataset&&s.dataset.path){o=s;break}if(r(s).is(".content-node")&&0===e){var a=r(s).find("[data-path]");if(a.length)return new n.Coordinate(a[0],0)}s=s.parentNode}if(!o)return this.searchForCoordinate(t,e,i);var l=this._computeCharPosition(o,t,e);return new n.Coordinate(o,l)},this._computeCharPosition=function(t,e,i){function n(t){if(e===t)return r+=i,!0;if(t.nodeType===window.Node.TEXT_NODE)r+=t.textContent.length;else if(t.nodeType===window.Node.ELEMENT_NODE){if(t.dataset&&t.dataset.inline)return r+=1,!1;for(var s=t.firstChild;s;s=s.nextSibling)if(n(s))return!0}return!1}function s(t){var e=t.nodeType;if(e===window.Node.TEXT_NODE)return t.textContent.length;if(e===window.Node.ELEMENT_NODE){if(t.dataset&&t.dataset.inline)return 1;for(var i=0,n=t.firstChild;n;n=n.nextSibling)i+=s(n);return i}return 0}var r=0,o=!1;if(e===t){for(var a=t.firstChild,l=0;i>l&&a;l++)r+=s(a),a=a.nextSibling;o=!0}else o=n(t);return o?r:(console.error("Could not find char position."),0)},this.searchForCoordinate=function(e,i,s){var r,o,a,l,u,c=this.element.querySelectorAll("*[data-path]");for(o=0,a=c.length-1,l=t(c[o],e),u=t(c[a],e);;){var h=a-o+1;if(0>u){r=a;break}if(l>0){r=o;break}if(2>=h){r=a;break}var p=o+Math.floor(h/2),d=t(c[p],e);0>d?(o=p,l=d):(a=p,u=d)}var f;return"left"===s.direction?(r=Math.max(0,r-1),f=c[r].textContent.length):f=0>u?c[r].textContent.length:0,new n.Coordinate(c[r],f)},this._getSelection=function(t,e,i,n,r){if(this._pullState(t,e,i,n,r),!this.state)return a.nullSelection;var o,c,h,p,d,f,m,g,b=this.doc,y=this.state.start,v=this.state.end,_=new l(new u(y.path,y.offset),new u(v.path,v.offset));return s(y.path,v.path)?b.createSelection({type:"property",path:y.path,startOffset:y.offset,endOffset:v.offset,reverse:this.state.reverse}):(o=b.get(y.path[0]),c=b.get(v.path[0]),h=o.getRoot(),p=c.getRoot(),"table"===h.type&&h.id===p.id?(h.getMatrix(),d=o.rowIdx,f=o.colIdx,m=c.rowIdx,g=c.colIdx,b.createSelection({type:"table",tableId:h.id,startRow:d,startCol:f,endRow:m,endCol:g})):b.createSelection({type:"container",containerId:this.container.id,startPath:_.start.path,startOffset:_.start.offset,endPath:_.end.path,endOffset:_.end.offset,reverse:this.state.reverse}))},this.getSelection=function(){var t=window.getSelection();if(0===t.rangeCount)return c.nullSelection;var e;if(r(t.anchorNode).is(".surface")){var i=t.getRangeAt(0);e=this._getSelectionFromRange(i)}else e=this._getSelection(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset,t.collapsed);return e},this._getSelectionFromRange=function(t){var e=t.cloneContents(),i=e.querySelectorAll("*[data-path]");if(0===i.length)return c.nullSelection;var n,s=this.doc,r=i[0],o=i[i.length-1],a=r.dataset.path.split(".");if(r===o)return n=s.get(a),s.createSelection({type:"property",path:a,startOffset:0,endOffset:n.length});var l=o.dataset.path.split(".");return n=s.get(l),s.createSelection({type:"container",containerId:this.container.id,startPath:a,startOffset:0,endPath:l,endOffset:n.length})};var e=function(t,i){if(t.nodeType===document.TEXT_NODE){var n=t.textContent.length;return i>n?{node:null,offset:i-n}:{node:t,offset:i,boundary:n===i}}if(t.nodeType===document.ELEMENT_NODE){if(t.dataset&&t.dataset.inline)return{node:null,offset:i-1};if(!t.firstChild&&0===i)return{node:t,offset:0};for(var s=t.firstChild;s;s=s.nextSibling){var r=e(s,i);if(r.node)return r;i=r.offset}}return{node:null,offset:i}};this._getDomPosition=function(t,i){var n='*[data-path="'+t.join(".")+'"]',s=this.element.querySelector(n);if(!s)return console.warn("Could not find DOM element for path",t),null;var r=e(s,i);return r.node?r:null},this.setSelection=function(t){var e=window.getSelection();if(t.isNull()||t.isTableSelection())return this.clear();var i=t.getRange(),s=this._getDomPosition(i.start.path,i.start.offset);if(!s)return this.clear();var r;return(r=i.isCollapsed()?s:this._getDomPosition(i.end.path,i.end.offset))?(e.removeAllRanges(),i=window.document.createRange(),t.isReverse()?(i.setStart(r.node,r.offset),e.addRange(i),e.extend(s.node,s.offset)):(i.setStart(s.node,s.offset),i.setEnd(r.node,r.offset),e.addRange(i)),void(this.state=new n.State(t.isCollapsed(),t.isReverse(),i.start,i.end))):this.clear()},this.clear=function(){var t=window.getSelection();t.removeAllRanges(),this.state=null},this.getSelectionFromDOMRange=function(t){var e=window.getSelection();return e.removeAllRanges(),e.addRange(t),this.getSelection()}},o.initClass(n),n.State=function(t,e,i,n){this.collapsed=t,this.reverse=e,this.start=i,this.end=n,Object.freeze(this)},n.Coordinate=function(t,e){this.el=t,this.offset=e,this.path=t.dataset.path.split(".")},e.exports=n},{"../model/Coordinate":88,"../model/Document":92,"../model/Range":110,"../model/Selection":111,"../util/jquery":412,"../util/oo":413,"lodash/lang/isEqual":273}],390:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("./Tool");n.Prototype=function(){this.getCommand=function(){var t=this.getController(),e=t.getFocusedSurface();if(e){var i=this.constructor["static"].command;if(i)return e.getCommand(i);throw new Error("Contract: AnnotationTool.static.command should be associated to a supported command.")}},this.dispose=function(){var t=this.getController();t.disconnect(this)},this.getSurface=function(){return this.getController().getFocusedSurface()},this.getDocument=function(){return this.getController().getDocument()},this.getContainer=function(){var t=this.getSurface();return t?t.getContainer():void 0},this.performAction=function(){var t=this.getSurface();t.executeCommand(this.constructor["static"].command)}},s.extend(n),e.exports=n},{"./Tool":397}],391:[function(t,e,i){"use strict";function n(t){r.apply(this,arguments),this.controller=t,this.entries=this.computeEntries(),this.entries.length>0?this.activeEntry=this.entries[0].id:this.activeEntry=null;var e=this.getDocument();e.connect(this,{"document:changed":this.handleDocumentChange})}var s=t("../util/helpers"),r=t("../util/EventEmitter"),o=t("../util/jquery");n.Prototype=function(){this.dispose=function(){var t=this.getDocument();t.disconnect(this)},this.handleDocumentChange=function(t){for(var e=this.getDocument(),i=!1,n=this.constructor["static"].tocTypes,r=0;r<t.ops.length;r++){var o,a=t.ops[r];if(a.isCreate()||a.isDelete()){var l=a.getValue();if(o=l.type,s.includes(n,o)){i=!0;break}}else{var u=a.path[0],c=e.get(u);if(c&&s.includes(n,c.type)){i=!0;break}}}i&&(this.entries=this.computeEntries(),this.emit("toc:updated"))},this.computeEntries=function(){var t=this.getDocument(),e=this.controller.getConfig(),i=[],n=t.get(e.containerId).nodes;return s.each(n,function(e){var n=t.get(e);"heading"===n.type&&i.push({id:n.id,name:n.content,level:n.level,node:n})}),i},this.getEntries=function(){return this.entries},this.getDocument=function(){return this.controller.getDocument()},this.getConfig=function(){return this.controller.getConfig()},this.markActiveEntry=function(t){var e=o(t.getContentElement()),i=t.getContentHeight(),n=t.getHeight(),r=t.getScrollPosition(),a=r+n,l=r,u=2*a-i,c=Math.max(l,u),h=this.computeEntries();if(0!==h.length){var p=s.first(h).id;h.forEach(function(i){var n=e.find('[data-id="'+i.id+'"]')[0];if(!n)return void console.warn("Not found in Content panel",i.id);var s=t.getPanelOffsetForElement(n);c>=s&&(p=i.id)}.bind(this)),this.activeEntry!==p&&(this.activeEntry=p,this.emit("toc:updated"))}}},r.extend(n),n["static"].tocTypes=["heading"],e.exports=n},{"../util/EventEmitter":405,"../util/helpers":410,"../util/jquery":412}],392:[function(t,e,i){"use strict";function n(){r.apply(this,arguments);var t=this.context.toc;t.connect(this,{"toc:updated":this.onTOCUpdated})}var s=t("../util/helpers"),r=t("./Component"),o=t("./ScrollPane"),a=r.$$,l=t("./FontAwesomeIcon");n.Prototype=function(){this.getDocument=function(){return this.context.doc},this.onTOCUpdated=function(){this.rerender()},this.dispose=function(){var t=this.context.toc;t.disconnect(this)},this.render=function(){var t=this.context.toc,e=t.activeEntry,i=a("div").addClass("se-toc-entries").ref("tocEntries");s.each(t.getEntries(),function(t){var n=t.level,s=a("a").addClass("se-toc-entry").addClass("sm-level-"+n).attr({href:"#","data-id":t.id}).ref(t.id).on("click",this.handleClick).append(a(l,{icon:"fa-caret-right"}),t.name);e===t.id&&s.addClass("sm-active"),i.append(s)},this);var n=a("div").addClass("sc-toc-panel").append(a(o).ref("panelEl").append(i));return n},this.handleClick=function(t){var e=t.currentTarget.dataset.id;t.preventDefault(),this.send("tocEntrySelected",e)}},r.extend(n),e.exports=n},{"../util/helpers":410,"./Component":365,"./FontAwesomeIcon":375,"./ScrollPane":383}],393:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("./Component"),r=t("lodash/collection/each"),o=s.$$;n.Prototype=function(){this.render=function(){var t=o("div").addClass("sc-tabbed-pane"),e=o("div").addClass("se-tabs");return r(this.props.tabs,function(t){var i=o("a").addClass("se-tab").attr({href:"#","data-id":t.id}).on("click",this.onTabClicked);t.id===this.props.activeTab&&i.addClass("sm-active"),i.append(o("span").addClass("label").append(t.name)),e.append(i)},this),t.append(e),t.append(o("div").addClass("se-tab-content").ref("tabContent").append(this.props.children)),t},this.onTabClicked=function(t){t.preventDefault();var e=t.currentTarget.dataset.id;this.send("switchTab",e)}},s.extend(n),e.exports=n},{"./Component":365,"lodash/collection/each":158}],394:[function(t,e,i){"use strict";function n(){s.apply(this,arguments);var t=this.getDocument();this.textPropertyManager=new r(t)}var s=t("./Surface"),r=t("../model/TextPropertyManager"),o=t("./Component"),a=t("./TextPropertyComponent"),l=o.$$;n.Prototype=function(){this.dispose=function(){s.prototype.dispose.call(this)},this.isContainerEditor=function(){return!1},this.render=function(){var t=l(this.props.tagName||"div").addClass("sc-text-property-annotator").append(l(a,{tagName:"div",path:this.props.path}));return t}},s.extend(n),e.exports=n},{"../model/TextPropertyManager":115,"./Component":365,"./Surface":387,"./TextPropertyComponent":395}],395:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("./AnnotatedTextComponent");n.Prototype=function(){this.initialize=function(){this.getSurface()&&this.getTextPropertyManager().registerProperty(this)},this.dispose=function(){this.getSurface()&&this.getTextPropertyManager().unregisterProperty(this)},this.getInitialState=function(){return{fragments:this.getTextPropertyManager().getFragments(this.props.path)}},this.render=function(){var t=this["super"].render.call(this);return t.removeClass("sc-annotated-text").addClass("sc-text-property"),t},this.getAnnotations=function(){var t=this.getDocument(),e=t.getIndex("annotations").get(this.props.path);return this.state.fragments&&(e=e.concat(this.state.fragments)),e},this.getContainer=function(){return this.getSurface().getContainer()},this.getController=function(){return this.context.controller},this.getDocument=function(){return this.context.doc},this.getElement=function(){return this.$el[0]},this.getSurface=function(){return this.context.surface},this.setFragments=function(t){this.extendState({fragments:t})},this.update=function(){this.rerender()},this.getTextPropertyManager=function(){return this.getSurface().getTextPropertyManager()}},s.extend(n),e.exports=n},{"./AnnotatedTextComponent":357}],396:[function(t,e,i){"use strict";function n(){s.apply(this,arguments);var t=this.getDocument();this.textPropertyManager=new r(t)}var s=t("./Surface"),r=t("../model/TextPropertyManager"),o=t("../model/transform/insertText"),a=t("../model/transform/deleteSelection"),l=t("./Component"),u=t("./TextPropertyComponent"),c=l.$$;n.Prototype=function(){this.isContainerEditor=function(){return!1},this.render=function(){var t=s.prototype.render.call(this);return t.tagName=this.props.tagName||"div",t.addClass("sc-text-property-editor").attr({spellcheck:!1,contenteditable:!0}),t.append(c(u,{tagName:"div",path:this.props.path})),t},this.selectAll=function(){var t=this.getDocument(),e=this.props.path,i=t.get(e),n=t.createSelection({type:"property",path:e,startOffset:0,endOffset:i.length});this.setSelection(n)},this.insertText=function(t,e){return e.selection.isPropertySelection()||e.selection.isContainerSelection()?o(t,e):void 0},this["delete"]=function(t,e){return a(t,e)},this["break"]=function(t,e){return this.softBreak(t,e)},this.softBreak=function(t,e){return e.text="\n",this.insertText(t,e)},this.paste=function(t,e){return e.text?this.insertText(t,e):void 0}},s.extend(n),e.exports=n},{"../model/TextPropertyManager":115,"../model/transform/deleteSelection":138,"../model/transform/insertText":142,"./Component":365,"./Surface":387,"./TextPropertyComponent":395}],397:[function(t,e,i){"use strict";function n(){s.apply(this,arguments),this.context.toolManager.registerTool(this)}var s=t("./Component"),r=t("../util/helpers"),o=s.$$;n.Prototype=function(){this.getInitialState=function(){return this.context.toolManager.getCommandState(this)},this.dispose=function(){this.context.toolManager.unregisterTool(this)},this.getController=function(){return this.context.controller},this.getName=function(){var t=this.constructor["static"].name;if(t)return t;throw new Error("Contract: Tool.static.name must have a value")},this.onClick=function(t){t.preventDefault(),t.stopPropagation(),this.state.disabled||this.performAction()},this.render=function(){var t=this.props.title||this.i18n.t(this.getName());this.state.mode&&(t=[r.capitalize(this.state.mode),t].join(" "));var e=o("div").attr("title",t).addClass("se-tool");return e.append(o("button").on("click",this.onClick).append(this.props.children)),this.state.disabled&&e.addClass("sm-disabled"),this.state.mode&&e.addClass(this.state.mode),this.state.active&&e.addClass("sm-active"),e}},s.extend(n),e.exports=n},{"../util/helpers":410,"./Component":365}],398:[function(t,e,i){"use strict";function n(t){if(!t)throw new Error("Illegal arguments: controller is mandatory.");this.controller=t,this.tools=[];var e=this.controller.getDocument();e.connect(this,{"document:changed":this.updateTools},{priority:-2}),this.controller.connect(this,{"selection:changed":this.updateTools,"document:saved":this.updateTools})}var s=t("../util/oo"),r=t("./ControllerTool"),o=t("./SurfaceTool"),a=t("lodash/array/without"),l={disabled:!0,active:!1};n.Prototype=function(){this.dispose=function(){var t=this.controller.getDocument();this.controller.disconnect(this),t.disconnect(this)},this.getCommandState=function(t){var e=this.getCommand(t);return e?e.getCommandState():l},this.registerTool=function(t){this.tools.push(t)},this.unregisterTool=function(t){this.tools=a(this.tools,t)},this.getCommand=function(t){var e=t.constructor["static"].command;if(t instanceof o){var i=this.controller.getFocusedSurface();return i?i.getCommand(e):!1}return t instanceof r?this.controller.getCommand(e):void 0},this.updateTools=function(){this.tools.forEach(function(t){var e=this.getCommandState(t);t.setState(e)}.bind(this))}},s.initClass(n),e.exports=n},{"../util/oo":413,"./ControllerTool":371,"./SurfaceTool":390,"lodash/array/without":156}],399:[function(t,e,i){"use strict";function n(){o.apply(this,arguments)}function s(){o.apply(this,arguments)}function r(){o.apply(this,arguments)}var o=t("./Component"),a=o.$$,l=t("../util/jquery");n.Prototype=function(){this.render=function(){var t=a("div").addClass("sc-toolbar");return t.append(this.props.children),t}},o.extend(n),s.Prototype=function(){this.getInitialState=function(){return{open:!1}},this.render=function(){var t=a("div").addClass("se-toolbar-dropdown");return this.state.open&&t.addClass("sm-open"),t.append(a("button").ref("toggle").addClass("se-toggle").attr("title",this.props.title).append(this.props.label).on("click",this.handleDropdownToggle),a("div").ref("options").addClass("se-options").append(this.props.children)),t},this.handleClick=function(t){t.preventDefault()},this.handleDropdownToggle=function(t){t.preventDefault();var e=this.state.open,i=this;e||(this.setState({open:!this.state.open}),setTimeout(function(){l(window).one("click",function(t){i.close()})},0))},this.close=function(){this.setState({open:!1})}},o.extend(s),r.Prototype=function(){this.render=function(){var t=a("div").addClass("se-toolbar-group");return t.append(this.props.children),t}},o.extend(r),n.Group=r,n.Dropdown=s,e.exports=n},{"../util/jquery":412,"./Component":365}],400:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("./ControllerCommand");n.Prototype=function(){this.getCommandState=function(){var t=this.getDocumentSession();return{disabled:!t.canUndo(),active:!1}},this.execute=function(){var t=this.getDocumentSession();return t.canUndo()?(t.undo(),!0):!1}},s.extend(n),s["static"].name="undo",e.exports=n},{"./ControllerCommand":370}],401:[function(t,e,i){"use strict";var n=t("./ControllerTool"),s=n.extend({"static":{name:"undo",command:"undo"}});e.exports=s},{"./ControllerTool":371}],402:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("./Component"),r=s.$$;n.Prototype=function(){this.render=function(){return r("pre").addClass("content-node unsupported").attr({"data-id":this.props.node.id,contentEditable:!1}).append(JSON.stringify(this.props.node.properties,null,2))}},s.extend(n),e.exports=n},{"./Component":365}],403:[function(t,e,i){function n(){this.attributes={},this.htmlProps={},this.style={},this.handlers={},this.children=[],this._ref=null,this._isOnRoute=!1,this.props={children:this.children},this._owner=null}function s(t){n.call(this),this.type="element",this.tagName=t}function r(t){n.call(this),this.type="component",this.ComponentClass=t}function o(t){n.call(this),this.type="text",this.props={text:t}}function a(t){this.type="html",this.html=t}var l=t("lodash/lang/isFunction"),u=t("lodash/lang/isString"),c=t("lodash/lang/isArray"),h=t("lodash/lang/cloneDeep"),p=t("lodash/object/extend"),d=t("lodash/object/omit"),f=t("lodash/array/without"),m=t("./DOMElement");n.Prototype=function(){this.ref=function(t){if(!this._owner)throw new Error("$$().ref() can only be used during Component rendering.");return this._ref=t,this},this.key=function(t){return console.info("DEPRECATED: Use ref instead. Note that when you assign a ref, the component do incremental rerendering."),this.ref(t)},this.setProps=function(t){return this.props=t,this.props.children=this.props.children||this.children,this},this.extendProps=function(t){return p(this.props,t),this.props.children=this.props.children||this.children,this},this.addProps=function(t){return console.log("DEPRECATED: Use setProps() or extendProps()"),p(this.props,t),this.props.children=this.props.children||this.children,this},this.route=function(){return this._isOnRoute=!0,this},this.hasClass=function(t){return!!new RegExp("\\b"+t+"\\b").exec(this.classNames)},this.addClass=function(t){return this.classNames||(this.classNames=""),this.classNames+=" "+t,this},this.removeClass=function(t){this.classNames||(this.classNames="");var e=this.classNames.split(/\s+/);return e=f(e,t),this.classNames=e.join(" "),this},this.removeAttr=function(t){return u(t)?delete this.attributes[t]:this.attributes=d(this.attributes,t),this},this.getAttribute=function(t){return this.attributes[t]},this.setAttribute=function(t,e){return this.attributes[t]=e,this},this.getId=function(){return this.getAttribute("id")},this.setId=function(t){return this.setAttribute("id",t)},this.getTextContent=function(){var t=this._compile();return t.text()},this.setTextContent=function(t){return this.children=[],this.children.push(new o(t)),this},this.getInnerHtml=function(){var t=this._compile();return t.html()},this.setInnerHtml=function(t){return this.children=[],this.children.push(new a(t)),this},this.getOuterHtml=function(){var t=this._compile();return t.outerHTML},this.getValue=function(){return this.htmlProps.value},this.setValue=function(t){return this.htmlProps.value=t,this},this.getChildNodes=function(){return this.children},this.getChildren=function(){return this.children.filter(function(t){return"text"!==t.getNodeType()})},this.isTextNode=function(){return!1},this.isElementNode=function(){return!1},this.isCommentNode=function(){return!1},this.isDocumentNode=function(){return!1},this.createElement=function(t){return n.createElement(t)},this.clone=function(){var t=this._clone();return t.attributes=h(this.attributes),t.htmlProps=h(this.htmlProps),t.style=h(this.style),t.handlers=h(this.handlers),t.children=this.children.map(function(t){return t.clone()}),t._ref=this._ref,t._isOnRoute=this._isOnRoute,t.props=h(this.props),t},this.append=function(){var t,e=this.children;if(1===arguments.length){var i=arguments[0];if(!i)return this;c(i)?(t=i,n.prepareChildren(t),Array.prototype.push.apply(e,t)):u(i)?e.push(new o(i)):e.push(i)}else t=Array.prototype.slice.call(arguments,0),n.prepareChildren(t),Array.prototype.push.apply(e,t);return this},this.insertAt=function(t,e){return this.children.splice(t,0,e),this},this.removeAt=function(t){return this.children.splice(t,1),this},this.empty=function(){return this.children=[],this},this.htmlProp=function(t){return 2===arguments.length?this.htmlProps[arguments[0]]=arguments[1]:p(this.htmlProps,t),this},this.removeHtmlProp=function(){return u(arguments[0])?delete this.htmlProps[arguments[0]]:this.htmlProps=d(this.htmlProps,arguments[0]),this},this.getStyle=function(t){return this.style?this.style[t]:void 0;
},this.setStyle=function(t,e){this.style||(this.style={}),this.style[t]=e},this.addEventListener=function(t,e,i,n){if(this.handlers[t])throw new Error('Handler for event "'+t+'" has already been registered.');this.handlers[t]={handler:i,context:n,selector:e}},this.removeEventListener=function(t){delete this.handlers[t]},this._compile=function(){var e=t("./Component");return e._render(this)},this._render=this._compile},m.extend(n),s.Prototype=function(){this.getTagName=function(){return this.tagName},this.setTagName=function(t){return this.tagName=t,this},this.getNodeType=function(){return"element"},this.isElementNode=function(){return!0},this._clone=function(){return new s(this.tagName)},this._quasiEquals=function(t){return this.type===t.type&&this.tagName===t.tagName}},n.extend(s),r.Prototype=function(){this.getChildren=function(){return this.props.children},this.getNodeType=function(){return"component"},this.isElementNode=function(){return!0},this._clone=function(){return new r(this.ComponentClass)},this._quasiEquals=function(t){return this.type===t.type&&this.ComponentClass===t.ComponentClass}},n.extend(r),Object.defineProperties(r.prototype,{}),o.Prototype=function(){this.getTextContent=function(){return this.props.text},this.setTextContent=function(t){return this.props.text=t,this},this.getInnerHtml=this.getTextContent,this.setInnerHtml=this.setTextContent,this.getOuterHtml=this.getTextContent,this.getNodeType=function(){return"text"},this.isTextNode=function(){return!0},this._clone=function(){return new o(this.props.text)},this._quasiEquals=function(t){return this.type===t.type&&this.props.text===t.props.text}},n.extend(o),a.Prototype=function(){this.getNodeType=function(){return"rawHtml"},this.getOuterHtml=function(){return this.html},this._clone=function(){return new a(this.html)},this._quasiEquals=function(t){return this.type===t.type&&this.html===t.html}},n.extend(a),n.prepareChildren=function(t){for(var e=0;e<t.length;e++)if(u(t[e])&&(t[e]=new o(t[e])),!t[e])throw new Error("Illegal child element",t,e)},n.createElement=function(){var e=t("./Component"),i=null;if(u(arguments[0])){if(1!==arguments.length)throw new Error("Illegal usage of Component.$$.");i=new s(arguments[0])}else{if(!(l(arguments[0])&&arguments[0].prototype instanceof e))throw void 0===arguments[0]?new Error("Provided Component was undefined."):new Error("Illegal usage of Component.$$.");if(arguments.length<1||arguments.length>2)throw new Error("Illegal usage of Component.$$.");i=new r(arguments[0]),2===arguments.length&&i.setProps(arguments[1])}return i},n.$$=n.createElement,n.VirtualTextNode=o,n.RawHtml=a,e.exports=n},{"./Component":365,"./DOMElement":372,"lodash/array/without":156,"lodash/lang/cloneDeep":268,"lodash/lang/isArray":270,"lodash/lang/isFunction":274,"lodash/lang/isString":279,"lodash/object/extend":282,"lodash/object/omit":285}],404:[function(t,e,i){"use strict";function n(){this.map={}}var s=t("../util/oo"),r=t("../util/helpers");n.Prototype=function(){this.t=function(t){return this.map[t]?this.map[t]:t},this.load=function(t){r.extend(this.map,t)}},s.initClass(n),n.mixin=function(t){Object.defineProperty(t.prototype,"i18n",{get:function(){return this.context&&this.context.i18n?this.context.i18n:n.instance}})},n.instance=new n,e.exports=n},{"../util/helpers":410,"../util/oo":413}],405:[function(t,e,i){"use strict";function n(){this.__events__={}}var s=t("./oo"),r=t("lodash/collection/each"),o=!1;n.Prototype=function(){function t(t,e){if("string"==typeof t){if(void 0===e||null===e)throw new Error('Method name "'+t+'" has no context.');if(!(t in e))throw new Error('Method not found: "'+t+'"');if("function"!=typeof e[t])throw new Error('Property "'+t+'" is not a function')}else if("function"!=typeof t)throw new Error("Invalid callback. Function or method name expected.")}function e(t,e){return e.priority-t.priority}this._on=function(e,i,n,s){var r;return t(i,n),r=this.__events__.hasOwnProperty(e)?this.__events__[e]:this.__events__[e]=[],r.push({method:i,context:n||null,priority:s}),this},this._off=function(e,i,n){var s,r;if(1===arguments.length)return delete this.__events__[e],this;if(t(i,n),!(e in this.__events__&&this.__events__[e].length))return this;for(arguments.length<3&&(n=null),r=this.__events__[e],s=r.length;s--;)r[s].method===i&&r[s].context===n&&r.splice(s,1);return 0===r.length&&delete this.__events__[e],this},this._connect=function(t,i,n){var s=0;3===arguments.length&&(s=n.priority||s);for(var r in i){var o=i[r];this._on(r,o,t,s)}return this.__events__[r].sort(e),this},this._disconnect=function(t){var e,i,n;for(i in this.__events__)for(n=this.__events__[i],e=n.length;e--;)n[e]&&n[e].context===t&&this._off(i,n[e].method,t);return this},this.emit=function(t){if(t in this.__events__){o&&console.log("Emitting event %s on %s",t,this);for(var e=this.__events__[t].slice(),i=Array.prototype.slice.call(arguments,1),n=0,s=e.length;s>n;n++){var r=e[n];o&&console.log("- triggering %s",r.context.constructor.name),r.method.apply(r.context,i)}return!0}return!1},this.connect=function(t,e,i){return this._connect.apply(this,arguments)},this.disconnect=function(t){return this._disconnect(t)},this.on=function(t,i,n,s){var r=0;4===arguments.length&&(r=s.priority||r),this._on(t,i,n,r),this.__events__[t].sort(e)},this.off=function(t,e,i){return this._off.apply(this,arguments)},this._debugEvents=function(){console.log("### EventEmitter: ",this),r(this.__events__,function(t,e){console.log("- %s listeners for %s: ",t.length,e,t)},this)}},s.initClass(n),e.exports=n},{"./oo":413,"lodash/collection/each":158}],406:[function(t,e,i){"use strict";var n=t("./EventEmitter"),s=function(){n.call(this),this.messages=[]};s.Prototype=function(){this.addMessage=function(t){this.messages.push(t),this.emit("messages:updated",this.messages)},this.log=function(t){this.addMessage({type:"info",message:t})},this.error=function(t){this.addMessage({type:"error",message:t})},this.warn=this.log,this.info=this.log,this.clearMessages=function(){this.messages=[],this.emit("messages:updated",this.messages)}},n.extend(s),e.exports=s},{"./EventEmitter":405}],407:[function(t,e,i){"use strict";function n(t){t&&(this.root=t)}var s=t("lodash/lang/isString"),r=t("lodash/lang/isArray"),o=t("./oo"),a=t("./deleteFromArray");n.Prototype=function(){this.childrenScope=!1,this.getRoot=function(){return this.root||this},this._resolve=function(t,e){for(var i=t.length-1,n=this.getRoot(),s=0;i>s;s++){var r=t[s];if(void 0===n[r]){if(!e)return;n[r]={},this.childrenScope&&(n[r].children={})}n=n[r],this.childrenScope&&(n=n.children)}return n},this.get=function(t){if(s(t))return this[t];if(r(t)){var e=t[t.length-1],i=this._resolve(t);return i?i[e]:void 0}},this.set=function(t,e){if(s(t))this[t]=e;else{var i=t[t.length-1];this._resolve(t,!0)[i]=e}},this["delete"]=function(t,e){if(s(t))delete this[t];else{var i=t[t.length-1],n=this._resolve(t);if(e&&!n||!n[i])throw new Error("Invalid path.");delete n[i]}},this.clear=function(){var t=this.getRoot();for(var e in t)t.hasOwnProperty(e)&&delete t[e]},this._traverse=function(t,e,i,n){for(var s in t)if(t.hasOwnProperty(s)&&"__values__"!==s){var r=e.concat([s]);i.call(n,r,t[s]),this._traverse(t[s],r,i,n)}},this.traverse=function(t,e){this._traverse(this.getRoot(),[],t,e)}},o.initClass(n),n.Arrays=function(){n.apply(this,arguments)},n.Arrays.Prototype=function(){this.get=function(t){if(s(t))return this[t];if(t&&0!==t.length){var e=t[t.length-1],i=this._resolve(t);return i&&i[e]?i[e].__values__:void 0}return this.getRoot()},this.add=function(t,e){var i=t[t.length-1],n=this._resolve(t,!0);n[i]||(n[i]={__values__:[]});var s=n[i].__values__;s.push(e)},this.remove=function(t,e){var i=this.get(t);i?a(i,e):console.warn("Warning: trying to remove a value for an unknown path.",t,e)},this.removeAll=function(t){var e=this.get(t);e.splice(0,e.length)},this.set=function(){throw new Error("This method is not available for PathAdapter.Arrays")},this._traverse=function(t,e,i,n){for(var s in t)if(t.hasOwnProperty(s))if("__values__"===s)i.call(n,e,t.__values__);else{var r=e.concat([s]);this._traverse(t[s],r,i,n)}}},n.extend(n.Arrays),e.exports=n},{"./deleteFromArray":409,"./oo":413,"lodash/lang/isArray":270,"lodash/lang/isString":279}],408:[function(t,e,i){"use strict";function n(){this.entries={},this.names=[]}var s=t("./oo"),r={};n.Prototype=function(){this.contains=function(t){return this.entries.hasOwnProperty(t)},this.add=function(t,e){if(r[t])throw new Error('Illegal key: "'+t+'" is a property of Object which is thus not allowed as a key.');this.contains(t)&&this.remove(t),this.entries[t]=e,this.names.push(t)},this.remove=function(t){var e=this.names.indexOf(t);e>=0&&this.names.splice(e,1),delete this.entries[t]},this.clear=function(){this.names=[],this.entries={}},this.get=function(t){return this.entries[t]},this.each=function(t,e){for(var i=0;i<this.names.length;i++){var n=this.names[i],s=t.call(e,this.entries[n],n);if(s===!1)break}}},s.initClass(n),e.exports=n},{"./oo":413}],409:[function(t,e,i){"use strict";function n(t,e){for(var i=0;i<t.length;i++)t[i]===e&&(t.splice(i,1),i--)}e.exports=n},{}],410:[function(t,e,i){"use strict";var n={},s=t("./jquery"),r=t("./deleteFromArray");n.isEqual=t("lodash/lang/isEqual"),n.isObject=t("lodash/lang/isObject"),n.isArray=t("lodash/lang/isArray"),n.isString=t("lodash/lang/isString"),n.isNumber=t("lodash/lang/isNumber"),n.isBoolean=t("lodash/lang/isBoolean"),n.isFunction=t("lodash/lang/isFunction"),n.cloneDeep=t("lodash/lang/cloneDeep"),n.clone=t("lodash/lang/clone"),n.isEmpty=t("lodash/lang/isEmpty"),n.bind=t("lodash/function/bind"),n.delay=t("lodash/function/delay"),n.debounce=t("lodash/function/debounce"),n.extend=t("lodash/object/extend"),n.omit=t("lodash/object/omit"),n.values=t("lodash/object/values"),n.last=t("lodash/array/last"),n.first=t("lodash/array/first"),n.compact=t("lodash/array/compact"),n.uniq=t("lodash/array/uniq"),n.intersection=t("lodash/array/intersection"),n.union=t("lodash/array/union"),n.without=t("lodash/array/without"),n.each=t("lodash/collection/forEach"),n.filter=t("lodash/collection/filter"),n.includes=t("lodash/collection/includes"),n.find=t("lodash/collection/find"),n.map=t("lodash/collection/map"),n.pluck=t("lodash/collection/pluck"),n.indexBy=t("lodash/collection/indexBy"),n.sortBy=t("lodash/collection/sortBy"),n.capitalize=t("lodash/string/capitalize"),n.isArrayEqual=function(t,e){if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0},n.deleteFromArray=r,n.deepclone=function(t){return null===t||void 0===t?t:n.isFunction(t.clone)?t.clone():n.deepclone(t)},n.deepclone=n.cloneDeep,n.getRelativeOffset=function(t,e){var i=t.offset(),n=e.offset();return i.left-=n.left,i.top-=n.top,i},n.uuid=t("./uuid"),n.serializeDOMElement=function(t){var e=s("<div>");return e.append(t.clone()),e.html()},n.request=function(t,e,i,n){var r={type:t,url:e,contentType:"application/json; charset=UTF-8",success:function(t){n(null,t)},error:function(t){console.error(t),n(t.responseText)}};i&&(r.data=JSON.stringify(i)),s.ajax(r)},e.exports=n},{"./deleteFromArray":409,"./jquery":412,"./uuid":416,"lodash/array/compact":150,"lodash/array/first":151,"lodash/array/intersection":152,"lodash/array/last":153,"lodash/array/union":154,"lodash/array/uniq":155,"lodash/array/without":156,"lodash/collection/filter":159,"lodash/collection/find":160,"lodash/collection/forEach":161,"lodash/collection/includes":162,"lodash/collection/indexBy":163,"lodash/collection/map":164,"lodash/collection/pluck":165,"lodash/collection/sortBy":166,"lodash/function/bind":168,"lodash/function/debounce":169,"lodash/function/delay":170,"lodash/lang/clone":267,"lodash/lang/cloneDeep":268,"lodash/lang/isArray":270,"lodash/lang/isBoolean":271,"lodash/lang/isEmpty":272,"lodash/lang/isEqual":273,"lodash/lang/isFunction":274,"lodash/lang/isNumber":277,"lodash/lang/isObject":278,"lodash/lang/isString":279,"lodash/object/extend":282,"lodash/object/omit":285,"lodash/object/values":287,"lodash/string/capitalize":288}],411:[function(t,e,i){"use strict";e.exports=function(t,e){if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}},{}],412:[function(t,e,i){var n="undefined"!=typeof window,s=null;if(n)e.exports=t("jquery");else{if(!s){var r=t("cheerio");r.prototype.prop=r.prototype.attr,r.prototype.removeProp=r.prototype.removeAttr,r.prototype.on=function(){},r.prototype.off=function(){},s=r.load("",{decodeEntities:!1}),s._createElement=function(t,e){return{type:"tag",name:t,attribs:{},children:[],parent:null,root:e,options:e.options,next:null,prev:null}},s._createTextNode=function(t){return{data:t,type:"text",parent:null,prev:null,next:null,children:[]}};var o=function(t,e){var i=s.load(t,e),n=i.root()[0];return n.options||(n.options=e),n.children.slice()};s.parseHTML=function(t){return o(t,{xmlMode:!1})},s.parseXML=function(t){return o(t,{xmlMode:!0})},s._serialize=function(e){var i=t("dom-serializer"),n=e.options||e.root.options;return i(e,n)}}e.exports=s}},{cheerio:11,"dom-serializer":11,jquery:149}],413:[function(t,e,i){"use strict";function n(t){if(!t.__is_initialized__){!t.Prototype||t.prototype instanceof t.Prototype||(t.prototype=new t.Prototype,t.prototype.constructor=t);var e=u();t["static"]=t["static"]||new e(t),t.__is_initialized__=!0}}function s(t,e){if(t.prototype instanceof e)throw new Error("Target already inherits from origin");var i=t.Prototype;t["super"]=e,i?(i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t):t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),t.prototype["super"]=e.prototype;var n=u();e["static"]&&(n.prototype=e["static"]),t["static"]=new n(t),t["static"]._makeExtendFunction?t.extend=t["static"]._makeExtendFunction(t):l(t)}function r(t){var e=t.prototype;for(var i in e)"constructor"!==i&&"__class__"!==i&&e.hasOwnProperty(i)&&("static"!==i||c(t["static"],e["static"]))}function o(t){function e(){t.apply(this,arguments)}var i,n=Array.prototype.slice.call(arguments,1),r=[],o=0;for(p(n[0])?(i=n[0],o++):i=e;o<n.length;o++){if(p(n[o])){if(o!==n.length-1)throw new Error("Illegal use of Class.extend(): Prototype function must be last argument.");if(i.hasOwnProperty("Prototype"))throw new Error("Class "+i.name+" has defined "+i.name+".Prototype which would be overwritten by Class.extend().\nYou provided a prototype function when calling Class.extend().");i.Prototype=n[o];break}if(!h(n[o]))throw new Error("Illegal use of Class.extend");r.push(n[o])}s(i,t);for(var l=r.length-1;l>=0;l--)a(i,r[l]);return i}function a(t,e){var i=t.prototype;for(var n in e)if(e.hasOwnProperty(n)){if("static"===n){c(t["static"],e["static"]);continue}i.hasOwnProperty(n)||(i[n]=e[n])}}function l(t){t["static"]||f.initClass(t),t["static"]._makeExtendFunction=function(e){return d(o,t,e)},t.extend=t["static"]._makeExtendFunction(t)}function u(){return function(t){this.__class__=t}}function c(t,e){for(var i in e)"constructor"!==i&&"__class__"!==i&&e.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(t[i]=e[i])}var h=t("lodash/lang/isObject"),p=t("lodash/lang/isFunction"),d=t("lodash/function/bind"),f={};f.initClass=function(t){n(t),l(t)},f.inherit=function(t,e){t.__is_initialized__||f.initClass(t),s(t,e),r(t)},f.mixin=function(t,e){t.__is_initialized__||f.initClass(t),a(t,e)},f.makeExtensible=l,e.exports=f},{"lodash/function/bind":168,"lodash/lang/isFunction":274,"lodash/lang/isObject":278}],414:[function(t,e,i){var n={isIE:!1,isFF:!1,version:-1};if("undefined"!=typeof window){var s=window.navigator.userAgent,r=s.indexOf("MSIE "),o=s.indexOf("Trident/"),a=s.indexOf("Edge/");r>0?(n.isIE=!0,n.version=10):o>0?(n.isIE=!0,n.version=11):a>0&&(n.isIE=!0,n.version=12,parseInt(s.substring(a+5,s.indexOf(".",a)),10)),n.isFF=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}e.exports=n},{}],415:[function(t,e,i){(function(t){var i={};if(t.hasOwnProperty("Substance"))throw new Error("global.Substance is already defined.");t.Substance=i,e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],416:[function(t,e,i){e.exports=function(t,e){t&&"-"!==t[t.length-1]&&(t=t.concat("-"));var i,n="0123456789abcdefghijklmnopqrstuvwxyz".split(""),s=[],r=16;if(e=e||32)for(i=0;e>i;i++)s[i]=n[0|Math.random()*r];else{var o;for(s[8]=s[13]=s[18]=s[23]="-",s[14]="4",i=0;36>i;i++)s[i]||(o=0|16*Math.random(),s[i]=n[19==i?3&o|8:o])}return(t?t:"")+s.join("")}},{}],417:[function(t,e,i){"use strict";function n(){r.apply(this,arguments),this.actions({toggleBibItem:this.toggleBibItem})}var s=t("substance/util/helpers"),r=t("substance/ui/Component"),o=r.$$,a=t("./BibItemComponent"),l=t("substance/ui/DialogHeader"),u=t("substance/ui/ScrollPane");n.Prototype=function(){this.toggleBibItem=function(t){this.toggleItem(t.id)},this.didMount=function(){var t=this.$el.find("input");t.val(this.state.searchResult.searchStr).focus()},this.handleCancel=function(t){t.preventDefault(),this.send("switchContext","bib-items")},this.getInitialState=function(){return{searchResult:{searchStr:"",items:[]},runningQueries:[]}},this.render=function(){return o("div").addClass("sc-add-bib-items-panel").append(o(l,{label:this.i18n.t("add-bib-entries"),exitContext:"bib-items"}),o(u).ref("scrollPane").append(o("div").addClass("se-search-form").append(o("input").attr({type:"text",placeholder:this.i18n.t("enter_search_term"),value:this.state.searchResult.searchStr}).ref("searchStr").on("keypress",this.onKeyPress.bind(this)),o("button").addClass("button float-right").append("Search").on("click",this.startSearch.bind(this))),this.renderSearchResult()))},this.isAdded=function(t){return!!this.props.doc.get(t.data.DOI)},this.getLabel=function(t){var e="";if(t){var i=this.props.doc.get(t);i&&i.label&&(e=i.label)}return e},this.renderSearchResult=function(){var t=o("div").addClass("se-search-results"),e=this.state.searchResult.items;return s.each(e,function(e){var i=this.getLabel(e.data.DOI),n=e.text,s=this.isAdded(e);t.append(o(a,{node:{id:e.data.DOI,label:i,text:n},toggleName:this.i18n.t(s?"Remove":"Add"),highlighted:s}))},this),t},this.onKeyPress=function(t){13==t.which&&this.startSearch()},this.toggleItem=function(t){var e=this.props.doc;e.get(t)?this.removeItem(t):this.addItem(t)},this.getItem=function(t){return s.find(this.state.searchResult.items,function(e){return e.data.DOI===t})},this.addItem=function(t){var e=this.getItem(t),i=this.props.doc;i.transaction({},{},function(t){var i={id:e.data.DOI,type:"bib-item",data:e.data,format:"citeproc"};t.create(i)}),this.rerender()},this.removeItem=function(t){this.props.doc.transaction({},{},function(e){e["delete"](t)}),this.rerender()},this.startSearch=function(){var t;t=this.refs.searchStr?this.refs.scrollPane.val():this.refs.scrollPane.refs.searchStr.val();var e=this,i=this.props.doc,n=i.getCiteprocCompiler(),r=this.state.runningQueries;s.each(r,function(t){t.reject()}),r=[],s.each(this.context.bibSearchEngines,function(i){var s=i.find(t);s.progress(function(t){e.state.searchResult.items.push({data:t,label:"",text:n.renderReference(t)}),e.rerender()}),s.done(function(){var t=r.indexOf(s);t>=0&&r.splice(t,1)}),r.push(s)});var o=this.state.searchResult;o.searchStr=t,o.items=[],this.setState({searchResult:o,runningQueries:r})}},r.extend(n),e.exports=n},{"./BibItemComponent":423,"substance/ui/Component":365,"substance/ui/DialogHeader":374,"substance/ui/ScrollPane":383,"substance/util/helpers":410}],418:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("substance/model/DocumentNode");n.Prototype=function(){this.setLabel=function(t){this.label=t,this.emit("label",t)},this.setText=function(t){this.text=t},this.updateCollection=function(t){var e=t.getCollection(this.type);e&&e.update()}},s.extend(n),n["static"].name="bib-item",n["static"].defineSchema({format:"string",data:"object"}),n["static"].citationType="bib-item-citation",e.exports=n},{"substance/model/DocumentNode":96}],419:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../citations/Citation");n.Prototype=function(){this.getItemType=function(){return"bib-item"}},s.extend(n),n["static"].name="bib-item-citation",e.exports=n},{"../citations/Citation":437}],420:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../citations/CitationCommand");s.extend(n),n["static"].name="bibItemCitation",n["static"].annotationType="bib-item-citation",e.exports=n},{"../citations/CitationCommand":438}],421:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("substance/ui/AnnotationTool");s.extend(n),n["static"].name="bibItemCitation",n["static"].command="bibItemCitation",e.exports=n},{"substance/ui/AnnotationTool":360}],422:[function(t,e,i){"use strict";var n=t("../citations/CitationXMLConverter");e.exports={type:"bib-item-citation",tagName:"cite",matchElement:function(t){return t.is("cite")&&"bib"===t.attr("rtype")},"import":function(t,e){n["import"](t,e)},"export":function(t,e){n["export"](t,e),e.attr("rtype","bib")}}},{"../citations/CitationXMLConverter":440}],423:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("substance/ui/Component"),r=s.$$,o=t("substance/ui/FontAwesomeIcon");n.Prototype=function(){this.toggleFocus=function(){this.send("toggleBibItem",this.props.node)},this.render=function(){var t=r("div").addClass("sc-bib-item").attr("data-id",this.props.node.id);return this.props.highlighted&&t.addClass("se-highlighted"),t.append(r("div").addClass("se-label").append(this.props.node.label)),t.append(r("button").addClass("se-focus-toggle").append(r(o,{icon:"fa-eye"}),[" ",this.props.toggleName].join("")).on("click",this.toggleFocus)),t.append(r("div").addClass("se-text").append(this.props.node.text)),t}},s.extend(n),e.exports=n},{"substance/ui/Component":365,"substance/ui/FontAwesomeIcon":375}],424:[function(t,e,i){"use strict";function n(){r.apply(this,arguments),this.props.node.connect(this,{label:this.onLabelChanged})}var s=t("substance/util/oo"),r=t("substance/ui/Component"),o=r.$$;n.Prototype=function(){this.dispose=function(){this.props.node.disconnect(this)},this.render=function(){var t=o("div").addClass("bib-item border-bottom pad item small clearfix").attr("data-id",this.props.node.id);return t.on("click",this.onClick),t.on("mousedown",this.onMouseDown),this.props.active&&t.addClass("active"),this.props.node.label&&t.append(o("div").addClass("label").append(this.props.node.label)),t.append(o("div").addClass("text").append(this.props.node.text)),t},this.onClick=function(t){t.preventDefault(),t.stopPropagation()},this.onMouseDown=function(t){t.preventDefault(),this.props.handleSelection(this.props.node.id)},this.onLabelChanged=function(){this.rerender()}},s.inherit(n,r),e.exports=n},{"substance/ui/Component":365,"substance/util/oo":413}],425:[function(t,e,i){"use strict";e.exports={type:"bib-item",tagName:"bib","import":function(t,e){e.data=JSON.parse(t.text()),e.id=e.data.DOI,e.format="citeproc"},"export":function(t,e){e.attr("format","citeproc").text(JSON.stringify(t.data))}}},{}],426:[function(t,e,i){"use strict";function n(){s.apply(this,arguments);var t=this.props.doc;this.bibliography=t.getCollection("bib-item"),this.bibliography.connect(this,{"bibliography:updated":this.rerender})}var s=t("substance/ui/Component"),r=t("substance/ui/ScrollPane"),o=t("./BibItemComponent"),a=t("./BibliographySummary"),l=s.$$;n.Prototype=function(){this.dispose=function(){this.bibliography.disconnect(this)},this.didMount=function(){this._scrollToTarget()},this.didReceiveProps=function(){this._scrollToTarget()},this._scrollToTarget=function(){var t=this.getFirstActiveBibItemId();t&&this.refs.scrollPane.scrollTo(t)},this.getFirstActiveBibItemId=function(){var t=this.props.doc;if(this.props.bibItemId)return this.props.bibItemId;if(this.props.citationId){var e=t.get(this.props.citationId);return e.targets[0]}},this.isHighlighted=function(t){var e=this.props.doc;if(this.props.bibItemId===t.id)return!0;if(this.props.citationId){var i=e.get(this.props.citationId);if(i.targets&&i.targets.indexOf(t.id)>=0)return!0}return!1},this.render=function(){var t=this.bibliography.getItems(),e=l("div").addClass("se-bib-items").ref("bibItems");e.append(l(a,{bibItems:t})),t.forEach(function(t){e.append(l(o,{node:t,toggleName:this.i18n.t("focus"),highlighted:this.isHighlighted(t)}))}.bind(this));var i=l("div").addClass("sc-bib-items-panel").append(l(r,{doc:this.props.doc}).append(e).ref("scrollPane"));return i}},s.extend(n),e.exports=n},{"./BibItemComponent":423,"./BibliographySummary":429,"substance/ui/Component":365,"substance/ui/ScrollPane":383}],427:[function(t,e,i){"use strict";function n(t,e){r.call(this),this.doc=t,this.containerId=e,this.bibitemsByGuid={},this._compileDebounced=s.debounce(this.compile.bind(this),50),this.doc.connect(this,{"document:changed":this.onDocumentChanged})}var s=t("substance/util/helpers"),r=t("substance/util/EventEmitter"),o=t("lodash/collection/sortBy");n.Prototype=function(){this.onDocumentChanged=function(t){var e=this.doc,i=!1;s.each(t.ops,function(t){if(t.isCreate()||t.isSet()||t.isUpdate()){var n=t.path[0],s=e.get(n);if(!s)return;t.isCreate()?("bib-item"===s.type||"bib-item-citation"===s.type)&&(i=!0):"bib-item"===s.type?i=!0:"bib-item-citation"===s.type&&"targets"===t.path[1]&&(i=!0)}else if(t.isDelete()){var r=t.val;("bib-item-citation"===r.type||"bib-item"===r.type)&&(console.log("bib-item-(citation) deleted"),i=!0)}}),i&&this.update()},this.dispose=function(){this.doc.disconnect(this)},this.getDocument=function(){return this.doc},this.getCompiler=function(){return this.getDocument().getCiteprocCompiler()},this.compile=function(){var t=this.getDocument(),e=this.getCompiler(),i=t.get(this.containerId);e.clear();var n=t.getIndex("type").get("bib-item");this.bibitemsByGuid={},s.each(n,function(t){if("citeproc"!==t.format)throw new Error("Only 'citeproc' bibliographic items are supported right now.");var i=t.data;i.id=t.id,e.addRecord(i),this.bibitemsByGuid[t.guid]=t},this);var r=t.getIndex("type").get("bib-item-citation"),a=s.map(r,function(t){var e=i.getAddress(t.path);return{citation:t,address:e}});o(a,"address"),s.each(a,function(t){var e=t.citation;if(e.targets.length>0){var i=s.filter(e.targets,function(t){var e=!!n[t];return e||console.error("No Bibitem found with id",t),e}),r=this.getCompiler().addCitation(i);e.setLabel(r.label)}else e.setLabel("???")},this);var l=this.getCompiler().makeBibliography();l=s.sortBy(l,"rank"),this.sortedBibItems=s.map(l,function(t){var e=n[t.id];return e.setLabel(t.label),e.setText(t.content),e},this),this.emit("bibliography:updated")},this.update=function(){this._compileDebounced()},this.makeBibliography=function(){return this.getCompiler().makeBibliography()},this.getBibItems=function(){for(var t=[],e=this.getCompiler().getSortedIds(),i=0;i<e.length;i++)t.push(this.doc.get(e[i]));return t},this.getCompiledItems=function(){return this.sortedBibItems||this.compile(),this.sortedBibItems},this.getItems=function(){return this.getCompiledItems()}},r.extend(n),e.exports=n},{"lodash/collection/sortBy":15,"substance/util/EventEmitter":405,"substance/util/helpers":410}],428:[function(t,e,i){"use strict";function n(){o.apply(this,arguments)}var s=t("substance/util/helpers"),r=t("substance/util/oo"),o=t("substance/ui/Component"),a=o.$$;n.Prototype=function(){this.getDocument=function(){return this.context.controller.getDocument()},this.render=function(){var t=this.state;if(t.bibItems){var e=[a("div").addClass("content-node heading level-1").append("References")];return s.each(t.bibItems,function(t){t.label&&e.push(a("div").addClass("bib-item clearfix").append(a("div").addClass("label csl-left-margin").append(t.label),a("div").addClass("text csl-right-inline").append(t.text)))}),a("div").addClass("bibliography-component bib-items").append(e)}return a("div")},this.didMount=function(){var t=this.getDocument();this.bibliography=t.getCollection("bib-item"),this.bibliography.connect(this,{"bibliography:updated":this.update})},this.update=function(){var t=this.bibliography.getItems();this.setState({bibItems:t})}},r.inherit(n,o),e.exports=n},{"substance/ui/Component":365,"substance/util/helpers":410,"substance/util/oo":413}],429:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("substance/ui/Component"),r=s.$$;n.Prototype=function(){this.handleAddBibItems=function(t){t.preventDefault(),this.send("switchContext","add-bib-items")},this.render=function(){var t=r("div").addClass("se-bibliography-summary");t.append(r("p").append("Your bibliography has ",r("strong").append(this.props.bibItems.length.toString()," references")," in total."));var e=this.context.config;return e.isEditable&&t.append(r("p").append(r("a").attr({href:"#"}).on("click",this.handleAddBibItems).append("Add references"))),t}},s.extend(n),e.exports=n},{"substance/ui/Component":365}],430:[function(t,e,i){"use strict";function n(t){this.config=t||new a,this.style=this.config.style,this.clear()}var s=t("substance/util/helpers"),r=t("substance/util/jquery"),o=t("./citeproc/citeproc").CSL,a=t("./CiteprocDefaultConfig");n.prototype.setStyle=function(t){this.style=t,this.clear()},n.prototype.clear=function(){this.engine=new o.Engine(this,this.style),this.data={},this.citationLabels={},this.count=0},n.prototype.addRecord=function(t){return t.id=t.id||"ITEM_"+this.count++,this.sanitizeData(t),this.data[t.id]=t,t.id},n.prototype.addCitation=function(t){s.isArray(t)||(t=[t]);for(var e={citationItems:[],properties:{}},i=0;i<t.length;i++)e.citationItems.push({id:t[i]});var n=this.engine.appendCitationCluster(e),r=n[0][0];e=this.engine.registry.citationreg.citationByIndex[r];var o=e.citationID,a=n[0][1];for(this.citationLabels[o]=a,i=1;i<n.length;i++)this.citationLabels[n[i][0]]=n[i][1];return{id:o,label:a}},n.prototype.getCitationCount=function(t){var e=this.engine.registry.citationreg.citationsByItemId[t];return e?e.length:0},n.prototype.makeBibliography=function(){var t,e,i,n,s,r,o,a={},l=[],u=this.engine.registry.citationreg.citationByIndex,c=[];for(e=0;e<u.length;e+=1)n=u[e],c.push([""+n.citationID,n.properties.noteIndex]);for(t=this.engine.registry.getSortedIds(),i=0;i<t.length;i++)o=t[i],s=this.engine.previewCitationCluster({citationItems:[{id:o}],properties:{}},c,[],"html"),r=this.renderReference(this.data[o]),a[o]={id:o,rank:i,citeCount:this.getCitationCount(o),label:s,content:r},l.push(a[o]);for(o in this.data)a[o]||(i+=1,r=this.renderReference(this.data[o]),a[o]={id:o,rank:i,citeCount:0,label:null,content:r},l.push(a[o]));return a},n.prototype.getSortedIds=function(){var t,e,i,n;for(t=this.engine.registry.getSortedIds(),e={},i=0;i<t.length;i++)e[t[i]]=!0;for(n in this.data)e[n]||(t.push(n),e[n]=!0);return t},n.prototype.renderReference=function(t){function e(t){if(t.search("csl-right-inline")>=0){var e=r("<div>").append(r(t)).find(".csl-right-inline");return e.html()}return t}function i(){a.sanitizeData(t);var e=new o.Engine({retrieveItem:function(){return t},retrieveLocale:function(t){return a.config.locale[t]}},a.style),i={citationItems:[{id:t.id}],properties:{}};e.appendCitationCluster(i);try{return e.makeBibliography()[1][0]}catch(n){return console.error(n),"Error: invalid citation data."}}var s,a=this;if(this.data[t.id])try{s=n.getBibliographyEntry.call(this.engine,t.id)}catch(l){s=i()}else s=i();return e(s)},n.getBibliographyEntry=function(t){var e,i,n,s,r,a,l;if(this.tmp.area="bibliography",this.tmp.last_rendered_name=!1,this.tmp.bibliography_errors=[],this.tmp.bibliography_pos=0,this.tmp.disambig_override=!0,this.tmp.just_looking=!0,e=this.retrieveItem(t),this.parallel.StartCitation([[{id:""+e.id},e]]),this.tmp.term_predecessor=!1,o.getCite.call(this,e),this.output.queue[0].blobs.length&&this.output.queue[0].blobs[0].blobs.length){
for(s||!this.output.queue[0].blobs[0].blobs[0].strings?(i=this.output.queue[0].blobs,s=!1):i=this.output.queue[0].blobs[0].blobs,r=i.length-1;r>-1;r+=-1)if(i[r].blobs&&0!==i[r].blobs.length){var u,c=this.tmp.cite_locales[this.tmp.cite_locales.length-1];u=this.tmp.cite_affixes[this.tmp.area][c]?this.tmp.cite_affixes[this.tmp.area][c].suffix:this.bibliography.opt.layout_suffix,l=u.slice(0,1),l&&i[r].strings.suffix.slice(-1)===l&&(i[r].strings.suffix=i[r].strings.suffix.slice(0,-1)),i[r].strings.suffix+=u;break}i[0].strings.prefix=this.bibliography.opt.layout_prefix+i[0].strings.prefix}for(r=0,a=this.output.queue.length;a>r;r+=1)o.Output.Queue.purgeEmptyBlobs(this.output.queue[r]);for(r=0,a=this.output.queue.length;a>r;r+=1)this.output.adjust.upward(this.output.queue[r]),this.output.adjust.leftward(this.output.queue[r]),this.output.adjust.downward(this.output.queue[r],!0),this.output.adjust.fix(this.output.queue[r]);return n=this.output.string(this,this.output.queue)[0],n||(n="\n[CSL STYLE ERROR: reference with no printed form.]\n"),this.tmp.disambig_override=!1,this.tmp.just_looking=!1,n},n.prototype.retrieveItem=function(t){return this.data[t]},n.prototype.retrieveLocale=function(t){return this.config.locale[t]},n.prototype.sanitizeData=function(t){t["container-title"]=t["container-title"]||"",t.title=t.title||""},e.exports=n},{"./CiteprocDefaultConfig":431,"./citeproc/citeproc":433,"substance/util/helpers":410,"substance/util/jquery":412}],431:[function(t,e,i){"use strict";function n(t){t=t||{},this.style=t.style||n.defaultStyle,this.locale=t.locale||n.defaultLocale}n.defaultStyleName="PLOS",n.defaultStyle='<?xml version="1.0" encoding="utf-8"?><style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0" demote-non-dropping-particle="sort-only" page-range-format="expanded" default-locale="en-US">  <info>    <title>Public Library of Science</title>    <title-short>PLOS</title-short>    <id>http://www.zotero.org/styles/plos</id>    <link href="http://www.zotero.org/styles/plos" rel="self"/>    <link href="http://journals.plos.org/plosbiology/guidelines.php" rel="documentation"/>    <author>      <name>Julian Onions</name>      <email>julian.onions@gmail.com</email>    </author>    <category citation-format="numeric"/>    <category field="science"/>    <summary>Public Library of Science Journal style.</summary>    <updated>2012-09-27T22:06:38+00:00</updated>    <rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights>  </info>  <macro name="editor">    <names variable="editor" delimiter=", ">      <name name-as-sort-order="all" sort-separator=" " initialize-with="" delimiter=", " delimiter-precedes-last="always"/>      <label form="long" prefix=", "/>    </names>  </macro>  <macro name="author">    <names variable="author">      <name name-as-sort-order="all" sort-separator=" " initialize-with="" delimiter=", " delimiter-precedes-last="always"/>      <label form="long" prefix=", "/>      <substitute>        <names variable="editor"/>        <text variable="title"/>      </substitute>    </names>  </macro>  <macro name="access">    <group>      <choose>        <if variable="URL">          <text variable="URL" prefix="Available: " suffix="."/>          <group prefix=" " suffix=".">            <text term="accessed" text-case="capitalize-first" suffix=" "/>            <date variable="accessed">              <date-part name="day" suffix=" "/>              <date-part name="month" suffix=" "/>              <date-part name="year"/>            </date>          </group>        </if>        <else>          <text variable="DOI" prefix="doi:"/>        </else>      </choose>    </group>  </macro>  <macro name="publisher">    <group delimiter=": ">      <text variable="publisher-place"/>      <text variable="publisher"/>    </group>  </macro>  <macro name="year-date">    <choose>      <if variable="issued">        <date variable="issued">          <date-part name="year"/>        </date>      </if>      <else>        <text term="no date" form="short"/>      </else>    </choose>  </macro>  <macro name="edition">    <choose>      <if is-numeric="edition">        <group delimiter=" ">          <number variable="edition" form="ordinal"/>          <text term="edition" form="short"/>        </group>      </if>      <else>        <text variable="edition" suffix="."/>      </else>    </choose>  </macro>  <citation collapse="citation-number">    <sort>      <key variable="citation-number"/>    </sort>    <layout prefix="[" suffix="]" delimiter=",">      <text variable="citation-number"/>    </layout>  </citation>  <bibliography et-al-min="6" et-al-use-first="5" second-field-align="flush">    <layout suffix=".">      <text variable="citation-number" suffix=". "/>      <group delimiter=" ">        <text macro="author"/>        <text macro="year-date" prefix="(" suffix=")"/>        <text variable="title"/>      </group>      <choose>        <if type="book report" match="any">          <text variable="genre" prefix=". "/>          <group delimiter=" " prefix=". ">            <text macro="edition"/>            <text macro="editor"/>            <text macro="publisher" suffix="."/>            <group delimiter=" ">              <text variable="number-of-pages"/>              <text term="page" form="short" strip-periods="true"/>            </group>          </group>        </if>        <else-if type="chapter paper-conference" match="any">          <group prefix=". " delimiter=". " suffix=".">            <group delimiter=" ">              <text term="in" text-case="capitalize-first" suffix=":"/>              <text macro="editor"/>            </group>            <text variable="container-title"/>            <text variable="collection-title"/>          </group>          <group prefix=" " suffix="." delimiter=", ">            <text macro="publisher"/>            <text variable="volume" prefix="Vol. "/>          </group>          <group prefix=" ">            <label variable="page" suffix=" " form="short"/>            <text variable="page"/>          </group>        </else-if>        <else-if type="thesis">          <group delimiter=" " prefix=" ">            <text variable="genre" prefix="[" suffix="]."/>            <text macro="publisher"/>          </group>        </else-if>        <else>          <group delimiter=" " prefix=". ">            <text variable="container-title" form="short" strip-periods="true"/>            <text variable="volume"/>          </group>          <text variable="page" prefix=": "/>        </else>      </choose>      <text macro="access" prefix=". "/>    </layout>  </bibliography></style>',n.defaultLocale={"en-US":'<locale xml:lang="en" xmlns="http://purl.org/net/xbiblio/csl">  <style-options punctuation-in-quote="true"/>  <date form="text">    <date-part name="month" suffix=" "/>    <date-part name="day" suffix=", "/>    <date-part name="year"/>  </date>  <date form="numeric">    <date-part name="year"/>    <date-part name="month" form="numeric" prefix="-" range-delimiter="/"/>    <date-part name="day" prefix="-" range-delimiter="/"/>  </date>  <terms>    <term name="document-number-label">No.</term>    <term name="document-number-authority-suffix">Doc.</term>    <term name="un-sales-number-label">U.N. Sales No.</term>    <term name="collection-number-label">No.</term>    <term name="open-quote"></term>    <term name="close-quote"></term>    <term name="open-inner-quote"></term>    <term name="close-inner-quote"></term>    <term name="ordinal-01">st</term>    <term name="ordinal-02">nd</term>    <term name="ordinal-03">rd</term>    <term name="ordinal-04">th</term>    <term name="long-ordinal-01">first</term>    <term name="long-ordinal-02">second</term>    <term name="long-ordinal-03">third</term>    <term name="long-ordinal-04">fourth</term>    <term name="long-ordinal-05">fifth</term>    <term name="long-ordinal-06">sixth</term>    <term name="long-ordinal-07">seventh</term>    <term name="long-ordinal-08">eighth</term>    <term name="long-ordinal-09">ninth</term>    <term name="long-ordinal-10">tenth</term>    <term name="at">at</term>    <term name="in">in</term>    <term name="ibid">ibid</term>    <term name="accessed">accessed</term>    <term name="retrieved">retrieved</term>    <term name="from">from</term>    <term name="forthcoming">forthcoming</term>    <term name="references">      <single>reference</single>      <multiple>references</multiple>    </term>    <term name="references" form="short">      <single>ref</single>      <multiple>refs</multiple>    </term>    <term name="no date">n.d.</term>    <term name="and">and</term>    <term name="et-al">et al.</term>    <term name="interview">interview</term>    <term name="letter">letter</term>    <term name="anonymous">anonymous</term>    <term name="anonymous" form="short">anon.</term>    <term name="and others">and others</term>    <term name="in press">in press</term>    <term name="online">online</term>    <term name="cited">cited</term>    <term name="internet">internet</term>    <term name="presented at">presented at the</term>    <term name="ad">AD</term>    <term name="bc">BC</term>    <term name="season-01">Spring</term>    <term name="season-02">Summer</term>    <term name="season-03">Autumn</term>    <term name="season-04">Winter</term>    <term name="with">with</term>        <!-- CATEGORIES -->    <term name="anthropology">anthropology</term>    <term name="astronomy">astronomy</term>    <term name="biology">biology</term>    <term name="botany">botany</term>    <term name="chemistry">chemistry</term>    <term name="engineering">engineering</term>    <term name="generic-base">generic base</term>    <term name="geography">geography</term>    <term name="geology">geology</term>    <term name="history">history</term>    <term name="humanities">humanities</term>    <term name="literature">literature</term>    <term name="math">math</term>    <term name="medicine">medicine</term>    <term name="philosophy">philosophy</term>    <term name="physics">physics</term>    <term name="psychology">psychology</term>    <term name="sociology">sociology</term>    <term name="science">science</term>    <term name="political_science">political science</term>    <term name="social_science">social science</term>    <term name="theology">theology</term>    <term name="zoology">zoology</term>        <!-- LONG LOCATOR FORMS -->    <term name="book">      <single>book</single>      <multiple>books</multiple>    </term>    <term name="chapter">      <single>chapter</single>      <multiple>chapters</multiple>    </term>    <term name="column">      <single>column</single>      <multiple>columns</multiple>    </term>    <term name="figure">      <single>figure</single>      <multiple>figures</multiple>    </term>    <term name="folio">      <single>folio</single>      <multiple>folios</multiple>    </term>    <term name="issue">      <single>number</single>      <multiple>numbers</multiple>    </term>    <term name="line">      <single>line</single>      <multiple>lines</multiple>    </term>    <term name="note">      <single>note</single>      <multiple>notes</multiple>    </term>    <term name="opus">      <single>opus</single>      <multiple>opera</multiple>    </term>    <term name="page">      <single>page</single>      <multiple>pages</multiple>    </term>    <term name="paragraph">      <single>paragraph</single>      <multiple>paragraph</multiple>    </term>    <term name="part">      <single>part</single>      <multiple>parts</multiple>    </term>    <term name="section">      <single>section</single>      <multiple>sections</multiple>    </term>    <term name="volume">      <single>volume</single>      <multiple>volumes</multiple>    </term>    <term name="edition">      <single>edition</single>      <multiple>editions</multiple>    </term>    <term name="verse">      <single>verse</single>      <multiple>verses</multiple>    </term>    <term name="sub verbo">      <single>sub verbo</single>      <multiple>s.vv</multiple>    </term>        <!-- SHORT LOCATOR FORMS -->    <term name="book" form="short">bk.</term>    <term name="chapter" form="short">chap.</term>    <term name="column" form="short">col.</term>    <term name="figure" form="short">fig.</term>    <term name="folio" form="short">f.</term>    <term name="issue" form="short">no.</term>    <term name="opus" form="short">op.</term>    <term name="page" form="short">      <single>p.</single>      <multiple>pp.</multiple>    </term>    <term name="paragraph" form="short">para.</term>    <term name="part" form="short">pt.</term>    <term name="section" form="short">sec.</term>    <term name="sub verbo" form="short">      <single>s.v.</single>      <multiple>s.vv.</multiple>    </term>    <term name="verse" form="short">      <single>v.</single>      <multiple>vv.</multiple>    </term>    <term name="volume" form="short">     <single>vol.</single>     <multiple>vols.</multiple>    </term>    <term name="edition">edition</term>    <term name="edition" form="short">ed.</term>        <!-- SYMBOL LOCATOR FORMS -->    <term name="paragraph" form="symbol">      <single></single>      <multiple></multiple>    </term>    <term name="section" form="symbol">      <single></single>      <multiple></multiple>    </term>        <!-- LONG ROLE FORMS -->    <term name="author">      <single></single>      <multiple></multiple>    </term>    <term name="editor">      <single>editor</single>      <multiple>editors</multiple>    </term>    <term name="translator">      <single>translator</single>      <multiple>translators</multiple>    </term>        <!-- SHORT ROLE FORMS -->    <term name="author" form="short">      <single></single>      <multiple></multiple>    </term>    <term name="editor" form="short">      <single>ed.</single>      <multiple>eds.</multiple>    </term>    <term name="translator" form="short">      <single>tran.</single>      <multiple>trans.</multiple>    </term>        <!-- VERB ROLE FORMS -->    <term name="editor" form="verb">edited by</term>    <term name="translator" form="verb">translated by</term>    <term name="recipient" form="verb">to</term>    <term name="interviewer" form="verb">interview by</term>        <!-- SHORT VERB ROLE FORMS -->    <term name="editor" form="verb-short">ed.</term>    <term name="translator" form="verb-short">trans.</term>        <!-- LONG MONTH FORMS -->    <term name="month-01">January</term>    <term name="month-02">February</term>    <term name="month-03">March</term>    <term name="month-04">April</term>    <term name="month-05">May</term>    <term name="month-06">June</term>    <term name="month-07">July</term>    <term name="month-08">August</term>    <term name="month-09">September</term>    <term name="month-10">October</term>    <term name="month-11">November</term>    <term name="month-12">December</term>        <!-- SHORT MONTH FORMS -->    <term name="month-01" form="short">Jan.</term>    <term name="month-02" form="short">Feb.</term>    <term name="month-03" form="short">Mar.</term>    <term name="month-04" form="short">Apr.</term> <term name="month-05" form="short">May</term>    <term name="month-06" form="short">Jun.</term>    <term name="month-07" form="short">Jul.</term>    <term name="month-08" form="short">Aug.</term>    <term name="month-09" form="short">Sep.</term>    <term name="month-10" form="short">Oct.</term>    <term name="month-11" form="short">Nov.</term>    <term name="month-12" form="short">Dec.</term>  </terms></locale>'},e.exports=n},{}],432:[function(t,e,i){"use strict";function n(){this.lastSearch="",this.lastResult=[],this.name="crossref",this.label="CrossRef"}var s=t("substance/util/jquery");n.resolveDOI=function(t){var e=s.Deferred();return/^http:/.exec(t)||(t="http://dx.doi.org/"+t),s.ajax(t,{type:"GET",crossDomain:!0,cache:!1,headers:{Accept:"application/citeproc+json"},success:function(t){e.resolve(t)},error:function(t,i,n){window.console.error("Could not retrieve data from cross-ref",i,n),e.rejectWith(null,n)}}),e},n.prototype.find=function(t,e){var i,r,o,a,l=s.Deferred(),u=this;return this.lastSearch===t?(a=this.lastResult,window.setTimeout(function(){a.forEach(function(t){l.notifyWith(e,[t])}),l.resolveWith(e)},0)):(this.lastSearch="",this.lastSearch=[],a=[],i=t.trim().toLowerCase().split(/\s+/),r=i.join("+"),o=0,s.ajax("http://search.crossref.org/dois",{data:{q:r,sort:"score"},success:function(i){function s(){if(o<i.length){var r=i[o++],c=n.resolveDOI(r.doi);c.done(function(t){"pending"===l.state()&&(a.push(t),l.notifyWith(e,[t]))}).always(function(){"pending"===l.state()&&s()})}else u.lastSearch=t,u.lastResult=a,l.resolveWith(e)}s()},error:function(t,i,n){l.rejectWith(e,[n])}})),l},e.exports=n},{"substance/util/jquery":412}],433:[function(t,e,n){Array.indexOf||(Array.prototype.indexOf=function(t){var e,i;for(e=0,i=this.length;i>e;e+=1)if(this[e]===t)return e;return-1});var s={PROCESSOR_VERSION:"1.0.542",CONDITION_LEVEL_TOP:1,CONDITION_LEVEL_BOTTOM:2,PLAIN_HYPHEN_REGEX:/(?:[^\\]-|\u2013)/,LOCATOR_LABELS_REGEXP:new RegExp("^((art|ch|Ch|subch|col|fig|l|n|no|op|p|pp|para|subpara|pt|r|sec|subsec|Sec|sv|sch|tit|vrs|vol)\\.)\\s+(.*)"),STATUTE_SUBDIV_GROUPED_REGEX:/((?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/g,STATUTE_SUBDIV_PLAIN_REGEX:/(?:(?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/,STATUTE_SUBDIV_STRINGS:{"art.":"article","bk.":"book","ch.":"chapter","Ch.":"Chapter","subch.":"subchapter","p.":"page","pp.":"page","para.":"paragraph","subpara.":"subparagraph","pt.":"part","r.":"rule","sec.":"section","subsec.":"subsection","Sec.":"Section","sch.":"schedule","tit.":"title","col.":"column","fig.":"figure","fol.":"folio","l.":"line","n.":"note","no.":"issue","op.":"opus","sv.":"sub-verbo","vrs.":"verse","vol.":"volume"},STATUTE_SUBDIV_STRINGS_REVERSE:{article:"art.",book:"bk.",chapter:"ch.",Chapter:"Ch.",subchapter:"subch.",page:"p.",paragraph:"para.",subparagraph:"subpara.",part:"pt.",rule:"r.",section:"sec.",subsection:"subsec.",Section:"Sec.",schedule:"sch.",title:"tit.",column:"col.",figure:"fig.",folio:"fol.",line:"l.",note:"n.",issue:"no.",opus:"op.","sub-verbo":"sv.","sub verbo":"sv.",verse:"vrs.",volume:"vol."},LOCATOR_LABELS_MAP:{art:"article",bk:"book",ch:"chapter",Ch:"Chapter",subch:"subchapter",col:"column",fig:"figure",fol:"folio",l:"line",n:"note",no:"issue",op:"opus",p:"page",pp:"page",para:"paragraph",subpara:"subparagraph",pt:"part",r:"rule",sec:"section",subsec:"subsection",Sec:"Section",sv:"sub-verbo",sch:"schedule",tit:"title",vrs:"verse",vol:"volume"},NestedBraces:[["(","["],[")","]"]],checkNestedBraceOpen:new RegExp(".*\\("),checkNestedBraceClose:new RegExp(".*\\)"),LangPrefsMap:{title:"titles","title-short":"titles","container-title":"journals","collection-title":"journals",publisher:"publishers",authority:"publishers","publisher-place":"places","event-place":"places",number:"number",edition:"number",issue:"number",volume:"number"},AbbreviationSegments:function(){this["container-title"]={},this["collection-title"]={},this["institution-entire"]={},this["institution-part"]={},this.nickname={},this.number={},this.title={},this.place={},this.hereinafter={},this.classic={},this["container-phrase"]={},this["title-phrase"]={}},GENDERS:["masculine","feminine"],ERROR_NO_RENDERED_FORM:1,PREVIEW:"Just for laughs.",ASSUME_ALL_ITEMS_REGISTERED:2,START:0,END:1,SINGLETON:2,SEEN:6,SUCCESSOR:3,SUCCESSOR_OF_SUCCESSOR:4,SUPPRESS:5,SINGULAR:0,PLURAL:1,LITERAL:!0,BEFORE:1,AFTER:2,DESCENDING:1,ASCENDING:2,ONLY_FIRST:1,ALWAYS:2,ONLY_LAST:3,FINISH:1,POSITION_FIRST:0,POSITION_SUBSEQUENT:1,POSITION_IBID:2,POSITION_IBID_WITH_LOCATOR:3,MARK_TRAILING_NAMES:!0,POSITION_TEST_VARS:["position","first-reference-note-number","near-note"],AREAS:["citation","citation_sort","bibliography","bibliography_sort"],MULTI_FIELDS:["event","publisher","publisher-place","event-place","title","container-title","collection-title","authority","edition","genre","title-short","medium","jurisdiction","archive","archive-place"],CITE_FIELDS:["first-reference-note-number","locator","locator-revision"],MINIMAL_NAME_FIELDS:["literal","family"],SWAPPING_PUNCTUATION:[".","!","?",":",","],TERMINAL_PUNCTUATION:[":",".",";","!","?"," "],NONE:0,NUMERIC:1,POSITION:2,COLLAPSE_VALUES:["citation-number","year","year-suffix"],DATE_PARTS:["year","month","day"],DATE_PARTS_ALL:["year","month","day","season"],DATE_PARTS_INTERNAL:["year","month","day","year_end","month_end","day_end"],NAME_PARTS:["family","given","dropping-particle","non-dropping-particle","suffix","literal"],DECORABLE_NAME_PARTS:["given","family","suffix"],DISAMBIGUATE_OPTIONS:["disambiguate-add-names","disambiguate-add-givenname","disambiguate-add-year-suffix"],GIVENNAME_DISAMBIGUATION_RULES:["all-names","all-names-with-initials","primary-name","primary-name-with-initials","by-cite"],NAME_ATTRIBUTES:["and","delimiter-precedes-last","delimiter-precedes-et-al","initialize-with","initialize","name-as-sort-order","sort-separator","et-al-min","et-al-use-first","et-al-subsequent-min","et-al-subsequent-use-first","form","prefix","suffix","delimiter"],PARALLEL_MATCH_VARS:["container-title"],PARALLEL_TYPES:["bill","gazette","regulation","legislation","legal_case","treaty","article-magazine","article-journal"],PARALLEL_COLLAPSING_MID_VARSET:["volume","issue","container-title","section","collection-number"],LOOSE:0,STRICT:1,TOLERANT:2,PREFIX_PUNCTUATION:/[.;:]\s*$/,SUFFIX_PUNCTUATION:/^\s*[.;:,\(\)]/,NUMBER_REGEXP:/(?:^\d+|\d+$)/,NAME_INITIAL_REGEXP:/^([A-Z\u0590-\u05ff\u0080-\u017f\u0400-\u042f\u0600-\u06ff\u0370\u0372\u0376\u0386\u0388-\u03ab\u03e2\u03e4\u03e6\u03e8\u03ea\u03ec\u03ee\u03f4\u03f7\u03fd-\u03ff])([a-zA-Z\u0080-\u017f\u0400-\u052f\u0600-\u06ff\u0370-\u03ff\u1f00-\u1fff]*|)/,ROMANESQUE_REGEXP:/[-0-9a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ROMANESQUE_NOT_REGEXP:/[^a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/g,STARTSWITH_ROMANESQUE_REGEXP:/^[&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ENDSWITH_ROMANESQUE_REGEXP:/[.;:&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]$/,ALL_ROMANESQUE_REGEXP:/^[a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]+$/,VIETNAMESE_SPECIALS:/[\u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]/,VIETNAMESE_NAMES:/^(?:(?:[.AaBbCcDdEeGgHhIiKkLlMmNnOoPpQqRrSsTtUuVvXxYy \u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]{2,6})(\s+|$))+$/,NOTE_FIELDS_REGEXP:/\{:(?:[\-_a-z]+|[A-Z]+):[^\}]+\}/g,NOTE_FIELD_REGEXP:/\{:([\-_a-z]+|[A-Z]+):\s*([^\}]+)\}/,DISPLAY_CLASSES:["block","left-margin","right-inline","indent"],NAME_VARIABLES:["author","editor","translator","contributor","collection-editor","composer","container-author","director","editorial-director","interviewer","original-author","recipient"],NUMERIC_VARIABLES:["call-number","chapter-number","collection-number","edition","page","issue","locator","number","number-of-pages","number-of-volumes","volume","citation-number"],DATE_VARIABLES:["locator-date","issued","event-date","accessed","container","original-date","publication-date","original-date","available-date","submitted"],TAG_ESCAPE:function(t){var e,i,n,s,r;for(e=t.match(/((?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g),i=t.split(/(?:(?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g),r=[i[0]],s=1,n=i.length;n>s;s+=1)r.push(e[s-1]),r.push(i[s]);return i=r.slice()},TAG_USEALL:function(t){var e,i,n,s;for(e=[""],i=t.indexOf("<"),n=t.indexOf(">");i>-1&&n>-1;)s=i>n?i+1:n+1,n>i&&-1===t.slice(i+1,n).indexOf("<")?(e[e.length-1]+=t.slice(0,i),e.push(t.slice(i,n+1)),e.push(""),t=t.slice(s)):(e[e.length-1]+=t.slice(0,n+1),t=t.slice(s)),i=t.indexOf("<"),n=t.indexOf(">");return e[e.length-1]+=t,e},SKIP_WORDS:["about","above","across","afore","after","against","along","alongside","amid","amidst","among","amongst","anenst","apropos","apud","around","as","aside","astride","at","athwart","atop","barring","before","behind","below","beneath","beside","besides","between","beyond","but","by","circa","despite","down","during","except","for","forenenst","from","given","in","inside","into","lest","like","modulo","near","next","notwithstanding","of","off","on","onto","out","over","per","plus","pro","qua","sans","since","than","through"," thru","throughout","thruout","till","to","toward","towards","under","underneath","until","unto","up","upon","versus","vs.","v.","vs","v","via","vis- -vis","with","within","without","according to","ahead of","apart from","as for","as of","as per","as regards","aside from","back to","because of","close to","due to","except for","far from","inside of","instead of","near to","next to","on to","out from","out of","outside of","prior to","pursuant to","rather than","regardless of","such as","that of","up to","where as","or","yet","so","for","and","nor","a","an","the","de","d'","von","van","c","et","ca"],FORMAT_KEY_SEQUENCE:["@strip-periods","@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align","@quotes"],INSTITUTION_KEYS:["font-style","font-variant","font-weight","text-decoration","text-case"],SUFFIX_CHARS:"a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z",ROMAN_NUMERALS:[["","i","ii","iii","iv","v","vi","vii","viii","ix"],["","x","xx","xxx","xl","l","lx","lxx","lxxx","xc"],["","c","cc","ccc","cd","d","dc","dcc","dccc","cm"],["","m","mm","mmm","mmmm","mmmmm"]],CREATORS:["author","editor","contributor","translator","recipient","interviewer","composer","original-author","container-author","collection-editor"],LANGS:{"af-ZA":"Afrikaans","ar-AR":"Arabic","bg-BG":"Bulgarian","ca-AD":"Catalan","cs-CZ":"Czech","da-DK":"Danish","de-AT":"Austrian","de-CH":"German (CH)","de-DE":"German (DE)","el-GR":"Greek","en-GB":"English (GB)","en-US":"English (US)","es-ES":"Spanish","et-EE":"Estonian",eu:"European","fa-IR":"Persian","fi-FI":"Finnish","fr-CA":"French (CA)","fr-FR":"French (FR)","he-IL":"Hebrew","hr-HR":"Croatian","hu-HU":"Hungarian","is-IS":"Icelandic","it-IT":"Italian","ja-JP":"Japanese","km-KH":"Khmer","ko-KR":"Korean","lt-LT":"Lithuanian","lv-LV":"Latvian","mn-MN":"Mongolian","nb-NO":"Norwegian (Bokml)","nl-NL":"Dutch","nn-NO":"Norwegian (Nynorsk)","pl-PL":"Polish","pt-BR":"Portuguese (BR)","pt-PT":"Portuguese (PT)","ro-RO":"Romanian","ru-RU":"Russian","sk-SK":"Slovak","sl-SI":"Slovenian","sr-RS":"Serbian","sv-SE":"Swedish","th-TH":"Thai","tr-TR":"Turkish","uk-UA":"Ukranian","vi-VN":"Vietnamese","zh-CN":"Chinese (CN)","zh-TW":"Chinese (TW)"},LANG_BASES:{af:"af_ZA",ar:"ar_AR",bg:"bg_BG",ca:"ca_AD",cs:"cs_CZ",da:"da_DK",de:"de_DE",el:"el_GR",en:"en_US",es:"es_ES",et:"et_EE",eu:"eu",fa:"fa_IR",fi:"fi_FI",fr:"fr_FR",he:"he_IL",hu:"hu_HU",is:"is_IS",it:"it_IT",ja:"ja_JP",km:"km_KH",ko:"ko_KR",lt:"lt_LT",mn:"mn_MN",nb:"nb_NO",nl:"nl_NL",nn:"nn-NO",pl:"pl_PL",pt:"pt_PT",ro:"ro_RO",ru:"ru_RU",sk:"sk_SK",sl:"sl_SI",sr:"sr_RS",sv:"sv_SE",th:"th_TH",tr:"tr_TR",uk:"uk_UA",vi:"vi_VN",zh:"zh_CN"},SUPERSCRIPTS:{"":"a","":"2","":"3","":"1","":"o","":"h","":"","":"j","":"r","":"","":"","":"","":"w","":"y","":"","":"l","":"s","":"x","":"","":"A","":"","":"B","":"D","":"E","":"","":"G","":"H","":"I","":"J","":"K","":"L","":"M","":"N","":"O","":"","":"P","":"R","":"T","":"U","":"W","":"a","":"","":"","":"","":"b","":"d","":"e","":"","":"","":"","":"g","":"k","":"m","":"","":"o","":"","":"","":"","":"p","":"t","":"u","":"","":"","":"v","":"","":"","":"","":"","":"","":"","":"0","":"i","":"4","":"5","":"6","":"7","":"8","":"9","":"+","":"","":"=","":"(","":")","":"n","":"SM","":"TM","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},SUPERSCRIPTS_REGEXP:new RegExp("[]","g"),locale:{},locale_opts:{},locale_dates:{}};if("undefined"!=typeof t&&"undefined"!=typeof e&&"exports"in e){var r=!0,o=t("./csl_nodejs_jsdom").CSL_NODEJS_JSDOM;n.CSL=s}s.TERMINAL_PUNCTUATION_REGEXP=new RegExp("^(["+s.TERMINAL_PUNCTUATION.slice(0,-1).join("")+"])(.*)"),s.CLOSURES=new RegExp(".*[\\]\\)]"),"object"==typeof console&&"function"==typeof console.log?(s.debug=function(t){console.log("CSL: "+t)},s.error=function(t){console.log("CSL error: "+t)}):(s.debug=function(){},s.error=function(t){throw"CSL error: "+t});var a;a="undefined"!=typeof r?o:"undefined"!=typeof CSL_E4X?CSL_E4X:"undefined"!=typeof CSL_JSON?CSL_JSON:CSL_CHROME,s.System={},s.System.Xml={Parsing:a},s.getSortCompare=function(t){if(s.stringCompare)return s.stringCompare;var e,i={sensitivity:"base",ignorePunctuation:!0,numeric:!0};t||(t="en-US"),e=function(e,n){return e.toLocaleLowerCase().localeCompare(n.toLocaleLowerCase(),t,i)};var n=function(t){return t.replace(/^[\[\]\'\"]*/g,"")},r=function(){return e("[x","x")?function(t,i){return e(n(t),n(i))}:!1},o=r(),a=function(t,i){return o?o(t,i):e(t,i)};return a},s.ambigConfigDiff=function(t,e){var i,n,s,r;if(t.names.length!==e.names.length)return 1;for(i=0,n=t.names.length;n>i;i+=1){if(t.names[i]!==e.names[i])return 1;for(s=0,r=t.givens[i];r>s;s+=1)if(t.givens[i][s]!==e.givens[i][s])return 1}return t.disambiguate!=e.disambiguate?1:t.year_suffix!==e.year_suffix?1:0},s.cloneAmbigConfig=function(t,e,i){var n,s,r,o,a,l={};for(l.names=[],l.givens=[],l.year_suffix=!1,l.disambiguate=!1,n=0,s=t.names.length;s>n;n+=1)a=t.names[n],l.names[n]=a;for(n=0,s=t.givens.length;s>n;n+=1){for(a=[],r=0,o=t.givens[n].length;o>r;r+=1)a.push(t.givens[n][r]);l.givens.push(a)}return e?(l.year_suffix=e.year_suffix,l.disambiguate=e.disambiguate):(l.year_suffix=t.year_suffix,l.disambiguate=t.disambiguate),l},s.getAmbigConfig=function(){var t,e;return t=this.tmp.disambig_request,t||(t=this.tmp.disambig_settings),e=s.cloneAmbigConfig(t)},s.getMaxVals=function(){return this.tmp.names_max.mystack.slice()},s.getMinVal=function(){return this.tmp["et-al-min"]},s.tokenExec=function(t,e,i){var n,s,r,o,a,l;l=!1,n=t.next,s=!1;var u=function(e){return e?(this.tmp.jump.replace("succeed"),t.succeed):(this.tmp.jump.replace("fail"),t.fail)};for(t.test&&(n=u.call(this,t.test(e,i))),a=t.execs.length,o=0;a>o;o+=1)r=t.execs[o],s=r.call(t,this,e,i),s&&(n=s);return n},s.expandMacro=function(t){var e,i,n,r;if(e=t.postponed_macro,this.build.macro_stack.indexOf(e)>-1)throw'CSL processor error: call to macro "'+e+'" would cause an infinite loop';this.build.macro_stack.push(e);var o=!1,a=!1;if(i=this.sys.xml.getNodesByName(this.cslXml,"macro",e),i.length&&(a=this.sys.xml.getAttributeValue(i[0],"cslid"),o=this.sys.xml.getAttributeValue(i[0],"macro-has-date")),o&&(r=function(t,e){t.tmp.extension&&(t.tmp["doing-macro-with-date"]=!0)},t.execs.push(r)),t.tokentype=s.START,t.cslid=a,s.Node.group.build.call(t,this,this[this.build.area].tokens,!0),!this.sys.xml.getNodeValue(i))throw'CSL style error: undefined macro "'+e+'"';var l=s.makeBuilder(this);l(i[0]),n=new s.Token("group",s.END),t.decorations&&(n.decorations=t.decorations.slice()),
o&&(r=function(t,e){t.tmp.extension&&(t.tmp["doing-macro-with-date"]=!1)},n.execs.push(r)),s.Node.group.build.call(n,this,this[this.build.area].tokens,!0),this.build.macro_stack.pop()},s.XmlToToken=function(t,e){var i,n,r,o,a,l,u,c;if(i=t.sys.xml.nodename(this),!t.build.skip||t.build.skip===i){if(!i)return n=t.sys.xml.content(this),void(n&&(t.build.text=n));if(!s.Node[t.sys.xml.nodename(this)])throw'Undefined node name "'+i+'".';if(r=[],o=t.sys.xml.attributes(this),a=s.setDecorations.call(this,t,o),l=new s.Token(i,e),e!==s.END||"if"===i||"else-if"===i||"layout"===i){for(u in o)if(o.hasOwnProperty(u)){if(e===s.END&&"@language"!==u&&"@locale"!==u)continue;if(o.hasOwnProperty(u))if(s.Attributes[u])try{s.Attributes[u].call(l,t,""+o[u])}catch(h){throw s.error(h),"CSL processor error, "+u+" attribute: "+h}else s.debug('warning: undefined attribute "'+u+'" in style')}l.decorations=a}else e===s.END&&o["@variable"]&&(l.hasVariable=!0);c=t[t.build.area].tokens,s.Node[i].build.call(l,t,c)}},s.DateParser=function(){var t,e,i,n,r,o,a,l,u,c,h,p,d,f,m,g,b,y,v,_,x,C,w,S,T;for(t=[["",1867],["",1911],["",1925],["",1988]],e={},w=t.length,a=0;w>a;a+=1)l=t[a][0],u=t[a][1],e[l]=u;for(S=[],a=0;w>a;a+=1)u=t[a][0],S.push(u);for(S=S.join("|"),i="(?:"+S+")(?:[0-9]+)",i=new RegExp(i),T="(?:"+S+")(?:[0-9]+)",T=new RegExp(T,"g"),r=/(\u6708|\u5E74)/g,n=/\u65E5/,o=/\u301c/g,c="(?:[?0-9]{1,2}%%NUMD%%){0,2}[?0-9]{4}(?![0-9])",h="[?0-9]{4}(?:%%NUMD%%[?0-9]{1,2}){0,2}(?![0-9])",p="[?0-9]{1,3}",d="[%%DATED%%]",f="[?~]",m="[a-zA-Z]+",g="("+h+"|"+c+"|"+p+"|"+d+"|"+f+"|"+m+")",b=new RegExp(g.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"-")),y=new RegExp(g.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"/")),v=new RegExp(g.replace(/%%NUMD%%/g,"/").replace(/%%DATED%%/g,"-")),_=[],x=[],w=_.length,a=0;w>a;a+=1)C=new RegExp(_[a]+".*"),x.push(C);this.mstrings="january february march april may june july august september october november december spring summer fall winter spring summer",this.mstrings=this.mstrings.split(" "),this.setOrderDayMonth=function(){this.monthguess=1,this.dayguess=0},this.setOrderMonthDay=function(){this.monthguess=0,this.dayguess=1},this.setOrderMonthDay(),this.resetMonths=function(){var t,e,i,n;for(this.msets=[],t=0,e=this.mstrings.length;e>t;t+=1)this.msets.push([this.mstrings[t]]);for(this.mabbrevs=[],t=0,e=this.msets.length;e>t;t+=1)for(this.mabbrevs.push([]),i=0,n=this.msets[t].length;n>i;i+=1)this.mabbrevs[t].push(this.msets[t][0].slice(0,3));for(this.mrexes=[],t=0,e=this.mabbrevs.length;e>t;t+=1)this.mrexes.push(new RegExp("(?:"+this.mabbrevs[t].join("|")+")"))},this.resetMonths(),this.addMonths=function(t){var e,i,n,r,o,a,l,u;if("string"==typeof t&&(t=t.split(/\s+/)),12!==t.length&&16!==t.length)return void s.debug("month [+season] list of "+t.length+", expected 12 or 16. Ignoring.");for(e=0,i=t.length;i>e;e+=1){var c=!1,h=!1,p=3,d={};for(n=0,r=this.mabbrevs.length;r>n;n+=1){if(d[n]={},n===e){for(o=0,a=this.mabbrevs[e].length;a>o;o+=1)if(this.mabbrevs[e][o]===t[e].slice(0,this.mabbrevs[e][o].length)){h=!0;break}}else for(o=0,a=this.mabbrevs[n].length;a>o;o+=1)if(c=this.mabbrevs[n][o].length,this.mabbrevs[n][o]===t[e].slice(0,c)){for(;this.msets[n][o].slice(0,c)===t[e].slice(0,c);){if(c>t[e].length||c>this.msets[n][o].length){s.debug("unable to disambiguate month string in date parser: "+t[e]);break}c+=1}p=c,d[n][o]=c}for(l in d)if(d.hasOwnProperty(l))for(u in d[l])d[l].hasOwnProperty(u)&&(c=d[l][u],l=parseInt(l,10),u=parseInt(u,10),this.mabbrevs[l][u]=this.msets[l][u].slice(0,c))}h||(this.msets[e].push(t[e]),this.mabbrevs[e].push(t[e].slice(0,p)))}for(this.mrexes=[],e=0,i=this.mabbrevs.length;i>e;e+=1)this.mrexes.push(new RegExp("(?:"+this.mabbrevs[e].join("|")+")"))},this.parse=function(t){var l,u,c,h,p,d,f,m,g,_,C,S,E,I,A,O,N,k,P,D,L,R,j,M,F,B,q,U,H,$;if(t&&(t=""+t,t=t.replace(/\s*[0-9]{2}:[0-9]{2}(?::[0-9]+)/,""),p=t.match(r))){if(t=t.replace(/\s+/,"","g"),t=t.replace(n,"","g"),t=t.replace(r,"-","g"),t=t.replace(o,"/","g"),t=t.replace("-/","/","g"),t=t.replace(/-$/,"","g"),j=t.split(i),c=[],R=t.match(T)){var z=[];for(a=0,w=R.length;w>a;a+=1)z=z.concat(R[a].match(/([^0-9]+)([0-9]+)/).slice(1));for(a=0,w=j.length;w>a;a+=1)c.push(j[a]),a!==w-1&&(M=2*a,c.push(z[M]),c.push(z[M+1]))}else c=j;for(h=c.length,a=1;h>a;a+=3)c[a+1]=e[c[a]]+parseInt(c[a+1],10),c[a]="";t=c.join(""),t=t.replace(/\s*-\s*$/,"").replace(/\s*-\s*\//,"/"),t=t.replace(/\.\s*$/,""),t=t.replace(/\.(?! )/,""),l=t.indexOf("/"),u=t.indexOf("-")}if(t=t.replace(/([A-Za-z])\./g,"$1"),d="",f="",m={},'"'===t.slice(0,1)&&'"'===t.slice(-1))return m.literal=t.slice(1,-1),m;for(l>-1&&u>-1?(g=t.split("/"),g.length>3?(_="-",C="/",c=t.split(v)):(_="/",C="-",c=t.split(y))):(t=t.replace("/","-"),_="-",C="-",c=t.split(b)),S=[],w=c.length,a=0;w>a;a+=1)P=c[a],p=P.match(/^\s*([\-\/]|[a-zA-Z]+|[\-~?0-9]+)\s*$/),p&&S.push(p[1]);for(E=S.indexOf(_),I=[],A=!1,E>-1?(I.push([0,E]),I.push([E+1,S.length]),A=!0):I.push([0,S.length]),O="",F=0,B=I.length;B>F;F+=1){for(D=I[F],N=S.slice(D[0],D[1]),q=0,U=N.length;U>q;q+=1)if(L=N[q],L.indexOf(C)>-1)this.parseNumericDate(m,C,O,L);else if(L.match(/[0-9]{4}/))m["year"+O]=L.replace(/^0*/,"");else{for(k=!1,H=0,$=this.mrexes.length;$>H;H+=1){if(L.toLocaleLowerCase().match(this.mrexes[H])){m["month"+O]=""+(parseInt(H,10)+1),k=!0;break}k||(L.match(/^[0-9]+$/)&&(d=parseInt(L,10)),L.toLocaleLowerCase().match(/^bc/)&&d?(m["year"+O]=""+-1*d,d=""):L.toLocaleLowerCase().match(/^ad/)&&d&&(m["year"+O]=""+d,d=""))}for(k=!1,H=0,$=x.length;$>H;H+=1)if(L.toLocaleLowerCase().match(x[H])){m["season"+O]=""+(parseInt(H,10)+1),k=!0;break}k||("~"===L||"?"===L||"c"===L||L.match(/^cir/)?m.circa="1":!L.toLocaleLowerCase().match(/(?:mic|tri|hil|eas)/)||m["season"+O]||(f=L))}d&&(m["day"+O]=d,d=""),f&&!m["season"+O]&&(m["season"+O]=f,f=""),O="_end"}if(A)for(q=0,U=s.DATE_PARTS_ALL.length;U>q;q+=1)P=s.DATE_PARTS_ALL[q],m[P]&&!m[P+"_end"]?m[P+"_end"]=m[P]:!m[P]&&m[P+"_end"]&&(m[P]=m[P+"_end"]);return m.year||(m={literal:t}),this.use_array&&this.toArray(m),m},this.returnAsArray=function(){this.use_array=!0},this.returnAsKeys=function(){this.use_array=!1},this.toArray=function(t){var e,i,n;t["date-parts"]=[],t["date-parts"].push([]);var s=0;for(e=0,i=3;i>e&&(n=["year","month","day"][e],t[n]);e+=1)s+=1,t["date-parts"][0].push(t[n]),delete t[n];for(t["date-parts"].push([]),e=0,i=s;i>e&&(n=["year_end","month_end","day_end"][e],t[n]);e+=1)t["date-parts"][1].push(t[n]),delete t[n];t["date-parts"][0].length!==t["date-parts"][1].length&&t["date-parts"].pop()},this.parseNumericDate=function(t,e,i,n){var s,r,o;for(s=n.split(e),r=0,o=s.length;o>r;r+=1)if(4===s[r].length){t["year"+i]=s[r].replace(/^0*/,""),s=r?s.slice(0,r):s.slice(1);break}for(r=0,o=s.length;o>r;r+=1)s[r]=parseInt(s[r],10);1===s.length||2===s.length&&!s[1]?t["month"+i]=""+s[0]:2===s.length&&(s[this.monthguess]>12?(t["month"+i]=""+s[this.dayguess],t["day"+i]=""+s[this.monthguess]):(t["month"+i]=""+s[this.monthguess],t["day"+i]=""+s[this.dayguess]))}},s.Engine=function(t,e,i,n){function r(t){var t=t.slice(),e=new RegExp("((?:[?!:]*\\s+|-|^)(?:"+t.join("|")+")(?=[!?:]*\\s+|-|$))");return e}var o,a;this.processor_version=s.PROCESSOR_VERSION,this.csl_version="1.0",this.sys=t,t.variableWrapper&&(s.VARIABLE_WRAPPER_PREPUNCT_REX=new RegExp("^(["+[" "].concat(s.SWAPPING_PUNCTUATION).join("")+"]*)(.*)")),this.sys.xml=new s.System.Xml.Parsing,"undefined"==typeof CSL_JSON&&"string"!=typeof e&&(e=""),s.getAbbreviation&&(this.sys.getAbbreviation=s.getAbbreviation),this.sys.stringCompare&&(s.stringCompare=this.sys.stringCompare),this.sys.AbbreviationSegments=s.AbbreviationSegments,this.parallel=new s.Parallel(this),this.transform=new s.Transform(this),this.setParseNames=function(t){this.opt["parse-names"]=t},this.opt=new s.Engine.Opt,this.tmp=new s.Engine.Tmp,this.build=new s.Engine.Build,this.fun=new s.Engine.Fun(this),this.configure=new s.Engine.Configure,this.citation_sort=new s.Engine.CitationSort,this.bibliography_sort=new s.Engine.BibliographySort,this.citation=new s.Engine.Citation(this),this.bibliography=new s.Engine.Bibliography,this.output=new s.Output.Queue(this),this.dateput=new s.Output.Queue(this),this.cslXml=this.sys.xml.makeXml(e),(this.opt.development_extensions.csl_reverse_lookup_support||this.sys.csl_reverse_lookup_support)&&(this.build.cslNodeId=0,this.setCslNodeIds=function(t,e){var i=this.sys.xml.children(t);this.sys.xml.setAttribute(t,"cslid",this.build.cslNodeId),this.opt.nodenames.push(e),this.build.cslNodeId+=1;for(var n=0,s=this.sys.xml.numberofnodes(i);s>n;n+=1)e=this.sys.xml.nodename(i[n]),e&&this.setCslNodeIds(i[n],e)},this.setCslNodeIds(this.cslXml,"style")),this.sys.xml.addMissingNameNodes(this.cslXml),this.sys.xml.addInstitutionNodes(this.cslXml),this.sys.xml.insertPublisherAndPlace(this.cslXml),this.sys.xml.flagDateMacros(this.cslXml),o=this.sys.xml.attributes(this.cslXml),"undefined"==typeof o["@sort-separator"]&&this.sys.xml.setAttribute(this.cslXml,"sort-separator",", "),this.opt["initialize-with-hyphen"]=!0,this.setStyleAttributes(),this.opt.xclass=t.xml.getAttributeValue(this.cslXml,"class"),this.opt.styleID=this.sys.xml.getStyleId(this.cslXml),this.opt.styleName=this.sys.xml.getStyleId(this.cslXml,!0),s.getSuppressJurisdictions&&(this.opt.suppressJurisdictions=s.getSuppressJurisdictions(this.opt.styleID)),i&&(i=i.replace("_","-")),this.opt["default-locale"][0]&&(this.opt["default-locale"][0]=this.opt["default-locale"][0].replace("_","-")),i&&n&&(this.opt["default-locale"]=[i]),i&&!n&&this.opt["default-locale"][0]&&(i=this.opt["default-locale"][0]),0===this.opt["default-locale"].length&&(i||(i="en-US"),this.opt["default-locale"].push("en-US")),i||(i=this.opt["default-locale"][0]),a=s.localeResolve(i),this.opt.lang=a.best,this.opt["default-locale"][0]=a.best,this.locale={},this.opt["default-locale-sort"]||(this.opt["default-locale-sort"]=this.opt["default-locale"][0]),this.localeConfigure(a),this.locale[this.opt.lang].opts["skip-words-regexp"]=r(this.locale[this.opt.lang].opts["skip-words"]),this.output.adjust=new s.Output.Queue.adjust(this.getOpt("punctuation-in-quote")),this.registry=new s.Registry(this),this.buildTokenLists("citation"),this.buildTokenLists("bibliography"),this.configureTokenLists(),this.disambiguate=new s.Disambiguation(this),this.splice_delimiter=!1,this.fun.dateparser=new s.DateParser,this.fun.flipflopper=new s.Util.FlipFlopper(this),this.setCloseQuotesArray(),this.fun.ordinalizer.init(this),this.fun.long_ordinalizer.init(this),this.fun.page_mangler=s.Util.PageRangeMangler.getFunction(this,"page"),this.fun.year_mangler=s.Util.PageRangeMangler.getFunction(this,"year"),this.setOutputFormat("html")},s.Engine.prototype.setCloseQuotesArray=function(){var t;t=[],t.push(this.getTerm("close-quote")),t.push(this.getTerm("close-inner-quote")),t.push('"'),t.push("'"),this.opt.close_quotes_array=t},s.makeBuilder=function(t){function e(e){s.XmlToToken.call(e,t,s.START)}function i(e){s.XmlToToken.call(e,t,s.END)}function n(e){s.XmlToToken.call(e,t,s.SINGLETON)}function r(o){var a;if(t.sys.xml.numberofnodes(t.sys.xml.children(o))){a=o,e(a);for(var l=0;l<t.sys.xml.numberofnodes(t.sys.xml.children(a));l+=1)o=t.sys.xml.children(a)[l],null!==t.sys.xml.nodename(o)&&("date"===t.sys.xml.nodename(o)&&(s.Util.fixDateNode.call(t,a,l,o),o=t.sys.xml.children(a)[l]),r(o,e,i,n));i(a)}else n(o)}return r},s.Engine.prototype.buildTokenLists=function(t){var e,i=s.makeBuilder(this);if(e=this.sys.xml.getNodesByName(this.cslXml,t),this.sys.xml.getNodeValue(e)){this.build.area=t;var n=e[0];i(n)}},s.Engine.prototype.setStyleAttributes=function(){var t,e,i;t={};var n=this.cslXml,r=this.cslXml.tagName?(""+this.cslXml.tagName).toLowerCase():"";if("style"!==r&&"cslstyle"!==r&&this.cslXml.getElementsByTagName)var n=this.cslXml.getElementsByTagName("style")[0];t.name=this.sys.xml.nodename(n),e=this.sys.xml.attributes(n);for(i in e)e.hasOwnProperty(i)&&s.Attributes[i].call(t,this,e[i])},s.Engine.prototype.getTerm=function(t,e,i,n,r,o){t&&t.match(/[A-Z]/)&&t===t.toUpperCase()&&(s.debug("Warning: term key is in uppercase form: "+t),t=t.toLowerCase());var a;a=o?this.opt["default-locale"][0]:this.opt.lang;var l=s.Engine.getField(s.LOOSE,this.locale[a].terms,t,e,i,n);if(l||"range-delimiter"!==t||(l=""),"undefined"==typeof l){if(r===s.STRICT)throw'Error in getTerm: term "'+t+'" does not exist.';r===s.TOLERANT&&(l="")}return l&&(this.tmp.cite_renders_content=!0),l},s.Engine.prototype.getDate=function(t,e){var i;return i=e?this.opt["default-locale"]:this.opt.lang,this.locale[i].dates[t]?this.locale[i].dates[t]:!1},s.Engine.prototype.getOpt=function(t){return"undefined"!=typeof this.locale[this.opt.lang].opts[t]?this.locale[this.opt.lang].opts[t]:!1},s.Engine.prototype.getVariable=function(t,e,i,n){return s.Engine.getField(s.LOOSE,t,e,i,n)},s.Engine.prototype.getDateNum=function(t,e){return"undefined"==typeof t?0:t[e]},s.Engine.getField=function(t,e,i,n,r,o){var a,l,u,c,h,p;a="";{if("undefined"!=typeof e[i]){for(p=o&&e[i][o]?e[i][o]:e[i],l=[],"symbol"===n?l=["symbol","short"]:"verb-short"===n?l=["verb-short","verb"]:"long"!==n&&(l=[n]),l=l.concat(["long"]),h=l.length,c=0;h>c;c+=1)if(u=l[c],"string"==typeof p||"number"==typeof p)a=p;else if("undefined"!=typeof p[u]){a="string"==typeof p[u]||"number"==typeof p[u]?p[u]:"number"==typeof r?p[u][r]:p[u][0];break}return a}if(t===s.STRICT)throw'Error in getField: term "'+i+'" does not exist.'}},s.Engine.prototype.configureTokenLists=function(){var t,e,i,n,r,o,a,l,u,c,h;for(t=["year","month","day"],u=s.AREAS.length,i=0;u>i;i+=1)for(e=s.AREAS[i],c=this[e].tokens.length-1,a=c;a>-1;a+=-1){if(n=this[e].tokens[a],"date"===n.name&&s.END===n.tokentype&&(r=[]),"date-part"===n.name&&n.strings.name)for(h=t.length,l=0;h>l;l+=1)o=t[l],o===n.strings.name&&r.push(n.strings.name);"date"===n.name&&s.START===n.tokentype&&(r.reverse(),n.dateparts=r),n.next=a+1,n.name&&s.Node[n.name].configure&&s.Node[n.name].configure.call(n,this,a)}return this.version=s.version,this.state},s.Engine.prototype.retrieveItems=function(t){var e;e=[];for(var i=0,n=t.length;n>i;i+=1)e.push(this.retrieveItem(""+t[i]));return e},s.ITERATION=0,s.Engine.prototype.retrieveItem=function(t){var e,i,n,r,o;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&"boolean"==typeof this.opt.development_extensions.normalize_lang_keys_to_lowercase){for(var a=0,l=this.opt["default-locale"].length;l>a;a+=1)this.opt["default-locale"][a]=this.opt["default-locale"][a].toLowerCase();for(var a=0,l=this.opt["locale-translit"].length;l>a;a+=1)this.opt["locale-translit"][a]=this.opt["locale-translit"][a].toLowerCase();for(var a=0,l=this.opt["locale-translat"].length;l>a;a+=1)this.opt["locale-translat"][a]=this.opt["locale-translat"][a].toLowerCase();this.opt.development_extensions.normalize_lang_keys_to_lowercase=100}if(s.ITERATION+=1,e=this.sys.retrieveItem(""+t),this.opt.development_extensions.normalize_lang_keys_to_lowercase){if(e.multi){if(e.multi._keys)for(var u in e.multi._keys)for(var c in e.multi._keys[u])c!==c.toLowerCase()&&(e.multi._keys[u][c.toLowerCase()]=e.multi._keys[u][c],delete e.multi._keys[u][c]);if(e.multi.main)for(var u in e.multi.main)e.multi.main[u]=e.multi.main[u].toLowerCase()}for(var a=0,l=s.CREATORS.length;a>l;a+=1){var h=s.CREATORS[a];if(e[h]&&e[h].multi)for(var p=0,d=e[h].length;d>p;p+=1){var f=e[h][p];if(f.multi){if(f.multi._key)for(var c in f.multi._key)c!==c.toLowerCase()&&(f.multi._key[c.toLowerCase()]=f.multi._key[c],delete f.multi._key[c]);f.multi.main&&(f.multi.main=f.multi.main.toLowerCase())}}}}if(e.page){e["page-first"]=e.page;var m=""+e.page;i=m.split(/\s*(?:&|,|-|\u2013)\s*/),"\\"!==i[0].slice(-1)&&(e["page-first"]=i[0])}if(this.opt.development_extensions.field_hack&&e.note&&(i=e.note.match(s.NOTE_FIELDS_REGEXP))){for(n=0,r=i.length;r>n;n+=1){if(o=i[n].match(s.NOTE_FIELD_REGEXP),!e[o[1]]&&s.DATE_VARIABLES.indexOf(o[1])>-1)e[o[1]]={raw:o[2]};else if(!e[o[1]]&&s.NAME_VARIABLES.indexOf(o[1])>-1){e[o[1]]||(e[o[1]]=[]);var g=o[2].split(/\s*\|\|\s*/);1===g.length?e[o[1]].push({family:g[0],isInstitution:!0}):2===g.length&&e[o[1]].push({family:g[0],given:g[1]})}else e[o[1]]&&"type"!==o[1]||(e[o[1]]=o[2].replace(/^\s+/,"").replace(/\s+$/,""));e.note.replace(s.NOTE_FIELD_REGEXP,"")}}for(var a=1,l=s.DATE_VARIABLES.length;l>a;a+=1){var b=e[s.DATE_VARIABLES[a]];b&&(this.opt.development_extensions.raw_date_parsing&&b.raw&&(b=this.fun.dateparser.parse(b.raw)),e[s.DATE_VARIABLES[a]]=this.dateParseArray(b))}if(this.opt.development_extensions.static_statute_locator&&e.type&&["bill","gazette","legislation","treaty"].indexOf(e.type)>-1){var y,v=["type","title","jurisdiction","genre","volume","container-title"],_=[];for(a=0,l=v.length;l>a;a+=1)y=v[a],e[y]&&_.push(e[y]);for(v=["original-date","issued"],a=0,v.length;l>a;a+=1)if(y=v[a],e[y]&&e[y].year){var x=e[y].year;_.push(x);break}e.legislation_id=_.join("::")}if(e["title-short"]||(e["title-short"]=e.shortTitle),this.opt.development_extensions.main_title_from_short_title&&(e["title-main"]=e.title,e["title-sub"]=!1,e.title&&e["title-short"])){var C=e["title-short"];offset=C.length,e.title.slice(0,offset)===C&&e.title.slice(offset).match(/^\s*:/)&&(e["title-main"]=e.title.slice(0,offset).replace(/\s+$/,""),e["title-sub"]=e.title.slice(offset).replace(/^\s*:\s*/,""))}var w=["legal_case","legislation","gazette","regulation"].indexOf(e.type)>-1;if(!w&&e.title&&this.sys.getAbbreviation){var S=!1;e.jurisdiction||(S=!0);var T=this.transform.loadAbbreviation(e.jurisdiction,"title",e.title,e.type,!0);this.transform.abbrevs[T].title&&this.transform.abbrevs[T].title[e.title]&&(e["title-short"]=this.transform.abbrevs[T].title[e.title])}if(e["container-title-short"]=e.journalAbbreviation,e["container-title"]&&this.sys.getAbbreviation){var T=this.transform.loadAbbreviation(e.jurisdiction,"container-title",e["container-title"]);this.transform.abbrevs[T]["container-title"]&&this.transform.abbrevs[T]["container-title"][e["container-title"]]&&(e["container-title-short"]=this.transform.abbrevs[T]["container-title"][e["container-title"]])}return e},s.Engine.prototype.setOpt=function(t,e,i){"style"===t.name||"cslstyle"===t.name?this.opt[e]=i:["citation","bibliography"].indexOf(t.name)>-1?this[t.name].opt[e]=i:-1===["name-form","name-delimiter","names-delimiter"].indexOf(e)&&(t.strings[e]=i)},s.Engine.prototype.fixOpt=function(t,e,i){["citation","bibliography"].indexOf(t.name)>-1&&(this[t.name].opt[e]||"undefined"==typeof this.opt[e]||(this[t.name].opt[e]=this.opt[e])),("name"===t.name||"names"===t.name)&&"undefined"==typeof t.strings[i]&&"undefined"!=typeof this[this.build.root].opt[e]&&(t.strings[i]=this[this.build.root].opt[e])},s.Engine.prototype.remapSectionVariable=function(t){for(var e=0,i=t.length;i>e;e+=1){var n=t[e][0],r=t[e][1],o=!1;if(["bill","gazette","legislation","treaty"].indexOf(n.type)>-1){r.force_pluralism=0,r.label||(r.label="page");var a=["section","","",""];if(this.opt.development_extensions.static_statute_locator&&n.section?(l=n.section.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/),s.STATUTE_SUBDIV_STRINGS[l[0]]?(a[0]=" "+l[0]+" ",a[1]=l.slice(1).join(" ")):(a[0]=" sec. ",a[1]=l.slice(0).join(" "))):this.opt.development_extensions.clobber_locator_if_no_statute_section&&(r.locator=void 0,r.label=void 0),r.locator){var l=r.locator.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/);s.STATUTE_SUBDIV_STRINGS[l[0]]?(a[2]=" "+l[0]+" ",a[3]=l.slice(1).join(" ")):r.label?(a[2]=" "+s.STATUTE_SUBDIV_STRINGS_REVERSE[r.label]+" ",a[3]=l.slice(0).join(" ")):a[3]=l.join(" "),a[3]&&"&"===a[3].slice(0,1)&&(a[3]=" "+a[3])}if(a[2]||(a[2]=a[0]),a[3]){if(a[3].match(/^[^0-9a-zA-Z]/)){var u=a[3].split(/\s+/);a[0]===a[2]&&u[1]&&!s.STATUTE_SUBDIV_STRINGS[u[1].replace(/\s+/,"").replace(/\s+/,"")]&&(r.force_pluralism=1),a[2]=""}}else a[2]="";a[1]||(a[0]="");var o=a.join("");if(o=o.replace(/^\s+/,"").replace(/\s+$/,""))if(l=o.split(/\s+/),s.STATUTE_SUBDIV_STRINGS[l[0]]){for(var c=l.length-2;c>0;c+=-2)l[c]===l[0]&&(r.force_pluralism=1,l=l.slice(0,c).concat(l.slice(c+1)));r.label=s.STATUTE_SUBDIV_STRINGS[l[0]],r.locator=l.slice(1).join(" "),0===r.force_pluralism&&delete r.force_pluralism}else r.locator=l.slice(0).join(" ")}}},s.Engine.prototype.setNumberLabels=function(t){if(t.number&&["bill","gazette","legislation","treaty"].indexOf(t.type)>-1&&this.opt.development_extensions.static_statute_locator&&!this.tmp.shadow_numbers.number){this.tmp.shadow_numbers.number={},this.tmp.shadow_numbers.number.values=[],this.tmp.shadow_numbers.number.plural=0,this.tmp.shadow_numbers.number.numeric=!1,this.tmp.shadow_numbers.number.label=!1;var e=""+t.number;e=e.replace("\\","","g");var i=e.split(/\s/)[0],n=s.STATUTE_SUBDIV_STRINGS[i];if(n){var r=e.match(s.STATUTE_SUBDIV_GROUPED_REGEX),o=e.split(s.STATUTE_SUBDIV_PLAIN_REGEX);if(o.length>1){for(var a=[],l=1,u=o.length;u>l;l+=1){var c=r[l-1].replace(/^\s*/,"");a.push(c.replace("sec.","Sec.").replace("ch.","Ch.")),a.push(o[l].replace(/\s*$/,"").replace(/^\s*/,""))}e=a.join(" ")}else e=o[0];this.tmp.shadow_numbers.number.values.push(["Blob",e,!1]),this.tmp.shadow_numbers.number.numeric=!1}else this.tmp.shadow_numbers.number.values.push(["Blob",e,!1]),this.tmp.shadow_numbers.number.numeric=!0}},s.substituteOne=function(t){return function(e,i){return i?t.replace("%%STRING%%",i):""}},s.substituteTwo=function(t){return function(e){var i=t.replace("%%PARAM%%",e);return function(t,e){return e?i.replace("%%STRING%%",e):""}}},s.Mode=function(t){var e,i,n,r,o,a;e={},i=s.Output.Formats[t];for(n in i)if("@"===n.slice(0,1)){if(r=!1,o=i[n],a=n.split("/"),"string"==typeof o&&o.indexOf("%%STRING%%")>-1)r=o.indexOf("%%PARAM%%")>-1?s.substituteTwo(o):s.substituteOne(o);else if("boolean"!=typeof o||o){if("function"!=typeof o)throw"CSL.Compiler: Bad "+t+" config entry for "+n+": "+o;r=o}else r=s.Output.Formatters.passthrough;1===a.length?e[a[0]]=r:2===a.length&&(e[a[0]]||(e[a[0]]={}),e[a[0]][a[1]]=r)}else e[n]=i[n];return e},s.setDecorations=function(t,e){var i,n,r;i=[];for(r in s.FORMAT_KEY_SEQUENCE)n=s.FORMAT_KEY_SEQUENCE[r],e[n]&&(i.push([n,e[n]]),delete e[n]);return i},s.Engine.prototype.normalDecorIsOrphan=function(t,e){if("normal"===e[1]){var i,n=!1;i="citation"===this.tmp.area?[this.citation.opt.layout_decorations].concat(t.alldecor):t.alldecor;for(var s=i.length-1;s>-1;s+=-1)for(var r=i[s].length-1;r>-1;r+=-1)i[s][r][0]===e[0]&&"normal"!==i[s][r][1]&&(n=!0);if(!n)return!0}return!1},s.Engine.prototype.getCitationLabel=function(t){var e="",i=this.getTrigraphParams(),n=i[0],r=this.getTerm("reference","short",0);"undefined"==typeof r&&(r="reference"),r=r.replace(".",""),r=r.slice(0,1).toUpperCase()+r.slice(1);for(var o=0,a=s.CREATORS.length;a>o;o+=1){var l=s.CREATORS[o];if(t[l]){var u=t[l];n=u.length>i.length?i[i.length-1]:i[u.length-1];for(var c=0,h=u.length;h>c&&c!==n.authors.length;c+=1){var p=this.nameOutput.getName(u[c],"locale-translit",!0),d=p.name;d&&d.family?(r=d.family,r=r.replace(/^([ \'\u2019a-z]+\s+)/,"")):d&&d.literal&&(r=d.literal);var f=r.toLowerCase().match(/^(a\s+|the\s+|an\s+)/);if(f&&(r=r.slice(f[1].length)),r=r.replace(s.ROMANESQUE_NOT_REGEXP,"","g"),!r)break;r=r.slice(0,n.authors[c]),r.length>1?r=r.slice(0,1).toUpperCase()+r.slice(1).toLowerCase():1===r.length&&(r=r.toUpperCase()),e+=r}break}}var m="0000";return t.issued&&t.issued.year&&(m=""+t.issued.year),m=m.slice(-1*n.year),e+=m},s.Engine.prototype.getTrigraphParams=function(){var t=[],e=this.opt.trigraph.split(":");if(!this.opt.trigraph||"A"!==this.opt.trigraph.slice(0,1))throw"Bad trigraph definition: "+this.opt.trigraph;for(var i=0,n=e.length;n>i;i+=1){for(var s=e[i],r={authors:[],year:0},o=0,a=s.length;a>o;o+=1)switch(s.slice(o,o+1)){case"A":r.authors.push(1);break;case"a":r.authors[r.authors.length-1]+=1;break;case"0":r.year+=1;break;default:throw"Invalid character in trigraph definition: "+this.opt.trigraph}t.push(r)}return t},s.Engine.prototype.setOutputFormat=function(t){this.opt.mode=t,this.fun.decorate=s.Mode(t),this.output[t]||(this.output[t]={},this.output[t].tmp={})},s.Engine.prototype.getSortFunc=function(){return function(t,e){return t=t.split("-"),e=e.split("-"),t.length<e.length?1:t.length>e.length?-1:(t=t.slice(-1)[0],e=e.slice(-1)[0],t.length<e.length?1:t.length>e.length?-1:0)}},s.Engine.prototype.setLangTagsForCslSort=function(t){var e,i;if(t)for(this.opt["locale-sort"]=[],e=0,i=t.length;i>e;e+=1)this.opt["locale-sort"].push(t[e]);this.opt["locale-sort"].sort(this.getSortFunc())},s.Engine.prototype.setLangTagsForCslTransliteration=function(t){var e,i;if(this.opt["locale-translit"]=[],t)for(e=0,i=t.length;i>e;e+=1)this.opt["locale-translit"].push(t[e]);this.opt["locale-translit"].sort(this.getSortFunc())},s.Engine.prototype.setLangTagsForCslTranslation=function(t){var e,i;if(this.opt["locale-translat"]=[],t)for(e=0,i=t.length;i>e;e+=1)this.opt["locale-translat"].push(t[e]);this.opt["locale-translat"].sort(this.getSortFunc())},s.Engine.prototype.setLangPrefsForCites=function(t,e){var i=this.opt["cite-lang-prefs"];e||(e=function(t){return t.toLowerCase()});for(var n=["Persons","Institutions","Titles","Journals","Publishers","Places"],s=0,r=n.length;r>s;s+=1){var o=e(n[s]),a=n[s].toLowerCase();if(t[o]){for(var l=[];t[o].length>1;)l.push(t[o].pop());var u={orig:1,translit:2,translat:3};for(2===l.length&&u[l[0]]<u[l[1]]&&l.reverse();l.length;)t[o].push(l.pop());for(var c=i[a];c.length;)c.pop();for(var h=0,p=t[o].length;p>h;h+=1)c.push(t[o][h])}}},s.Engine.prototype.setLangPrefsForCiteAffixes=function(t){if(t&&48===t.length){for(var e,i=this.opt.citeAffixes,n=0,s=["persons","institutions","titles","journals","publishers","places"],r=["translit","orig","translit","translat"],o=0,a=s.length;a>o;o+=1)for(var l=0,u=r.length;u>l;l+=1)e="",n%8===4?i[s[o]]["locale-"+r[l]].prefix||i[s[o]]["locale-"+r[l]].suffix||(e=t[n]?t[n]:"",i[s[o]]["locale-"+r[l]].prefix=e,e=t[n]?t[n+1]:"",i[s[o]]["locale-"+r[l]].suffix=e):(e=t[n]?t[n]:"",i[s[o]]["locale-"+r[l]].prefix=e,e=t[n]?t[n+1]:"",i[s[o]]["locale-"+r[l]].suffix=e),n+=2;this.opt.citeAffixes=i}},s.Engine.prototype.setAutoVietnameseNamesOption=function(t){t?this.opt["auto-vietnamese-names"]=!0:this.opt["auto-vietnamese-names"]=!1},s.Engine.prototype.setAbbreviations=function(t){this.sys.setAbbreviations&&this.sys.setAbbreviations(t)},s.Engine.prototype.setSuppressTrailingPunctuation=function(t){this.citation.opt.suppressTrailingPunctuation=!!t},s.Output={},s.Output.Queue=function(t){this.levelname=["top"],this.state=t,this.queue=[],this.empty=new s.Token("empty");var e={};e.empty=this.empty,this.formats=new s.Stack(e),this.current=new s.Stack(this.queue)},s.Output.Queue.prototype.pop=function(){var t=this.current.value();return t.length?t.pop():t.blobs.pop()},s.Output.Queue.prototype.getToken=function(t){var e=this.formats.value()[t];return e},s.Output.Queue.prototype.mergeTokenStrings=function(t,e){var i,n,r,o;if(i=this.formats.value()[t],n=this.formats.value()[e],r=i,n){i||(i=new s.Token(t,s.SINGLETON),i.decorations=[]),r=new s.Token(t,s.SINGLETON),o="";for(o in i.strings)i.strings.hasOwnProperty(o)&&(r.strings[o]=i.strings[o]);for(o in n.strings)n.strings.hasOwnProperty(o)&&(r.strings[o]=n.strings[o]);r.decorations=i.decorations.concat(n.decorations)}return r},s.Output.Queue.prototype.addToken=function(t,e,i){var n,r;if(n=new s.Token("output"),"string"==typeof i&&(i=this.formats.value()[i]),i&&i.strings){for(r in i.strings)i.strings.hasOwnProperty(r)&&(n.strings[r]=i.strings[r]);n.decorations=i.decorations}"string"==typeof e&&(n.strings.delimiter=e),this.formats.value()[t]=n},s.Output.Queue.prototype.pushFormats=function(t){t||(t={}),t.empty=this.empty,this.formats.push(t)},s.Output.Queue.prototype.popFormats=function(t){this.formats.pop()},s.Output.Queue.prototype.startTag=function(t,e){var i={};this.state.tmp["doing-macro-with-date"]&&this.state.tmp.extension&&(e=this.empty,t="empty"),i[t]=e,this.pushFormats(i),this.openLevel(t)},s.Output.Queue.prototype.endTag=function(t){this.closeLevel(),this.popFormats()},s.Output.Queue.prototype.openLevel=function(t,e){var i,n;if("object"==typeof t)i=new s.Blob(void 0,t);else if("undefined"==typeof t)i=new s.Blob(void 0,this.formats.value().empty,"empty");else{if(!this.formats.value()||!this.formats.value()[t])throw'CSL processor error: call to nonexistent format token "'+t+'"';i=new s.Blob(void 0,this.formats.value()[t],t)}this.nestedBraces&&(i.strings.prefix=i.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),i.strings.prefix=i.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]),i.strings.suffix=i.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),i.strings.suffix=i.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])),n=this.current.value(),n.push(i),this.current.push(i)},s.Output.Queue.prototype.closeLevel=function(t){t&&t!==this.current.value().levelname&&s.error("Level mismatch error:  wanted "+t+" but found "+this.current.value().levelname),this.current.pop()},s.Output.Queue.prototype.append=function(t,e,i,n,r){var o,a,l,u=!0;if(i&&(n=!0),this.state.tmp["doing-macro-with-date"]&&!i){if("macro-with-date"!==e)return!1;"macro-with-date"===e&&(e="empty")}if("undefined"==typeof t)return!1;if("number"==typeof t&&(t=""+t),!i&&this.state.tmp.element_trace&&"suppress-me"===this.state.tmp.element_trace.value())return!1;if(a=!1,e?"literal"===e?(o=!0,u=!1):o="string"==typeof e?this.formats.value()[e]:e:o=this.formats.value().empty,!o)throw"CSL processor error: unknown format token name: "+e;if(o.strings&&"undefined"==typeof o.strings.delimiter&&(o.strings.delimiter=""),"string"==typeof t&&t.length&&(t=t.replace(/ ([:;?!\u00bb])/g,"$1").replace(/\u00ab /g,""),this.last_char_rendered=t.slice(-1),t=t.replace(/\s+'/g,"  '").replace(/^'/g," '"),n?i&&(this.state.tmp.term_predecessor_name=!0):this.state.tmp.term_predecessor=!0),a=new s.Blob(t,o),this.nestedBraces&&(a.strings.prefix=a.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),a.strings.prefix=a.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]),a.strings.suffix=a.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),a.strings.suffix=a.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])),l=this.current.value(),"undefined"==typeof l&&0===this.current.mystack.length&&(this.current.mystack.push([]),l=this.current.value()),"string"==typeof a.blobs&&(n?i&&(this.state.tmp.term_predecessor_name=!0):this.state.tmp.term_predecessor=!0),i||this.state.parallel.AppendBlobPointer(l),"string"==typeof t){l.push(a),a.strings["text-case"]&&(a.blobs=s.Output.Formatters[a.strings["text-case"]](this.state,t)),this.state.tmp.strip_periods&&!r&&(a.blobs=a.blobs.replace(/\.([^a-z]|$)/g,"$1"));for(var c=a.decorations.length-1;c>-1;c+=-1)"@quotes"===a.decorations[c][0]&&"true"===a.decorations[c][1]&&(a.punctuation_in_quote=this.state.getOpt("punctuation-in-quote")),a.blobs.match(s.ROMANESQUE_REGEXP)||"@font-style"===a.decorations[c][0]&&(a.decorations=a.decorations.slice(0,c).concat(a.decorations.slice(c+1)));this.state.fun.flipflopper.init(t,a),this.state.fun.flipflopper.processTags()}else u?l.push(a):l.push(t);return!0},s.Output.Queue.prototype.string=function(t,e,i){var n,r,o,a,l,u=s.getSafeEscape(this.state),c=e.slice(),h=[];if(0===c.length)return h;var p="";i?p=i.strings.delimiter:(t.tmp.count_offset_characters=!1,t.tmp.offset_characters=0),i&&i.new_locale&&(i.old_locale=t.opt.lang,t.opt.lang=i.new_locale);var d,f,m,g;for(n=0,r=c.length;r>n;n+=1){if(d=c[n],d.strings.first_blob&&(t.tmp.count_offset_characters=d.strings.first_blob),"string"==typeof d.blobs){if("number"==typeof d.num)h.push(d);else if(d.blobs){l=u(d.blobs);var b=l.length;if(!t.tmp.suppress_decorations)for(o=0,a=d.decorations.length;a>o;o+=1)g=d.decorations[o],"@showid"!==g[0]&&(t.normalDecorIsOrphan(d,g)||(l=t.fun.decorate[g[0]][g[1]].call(d,t,l,g[2])));if(l&&l.length){if(l=u(d.strings.prefix,t.tmp.nestedBraces)+l+u(d.strings.suffix,t.tmp.nestedBraces),(t.opt.development_extensions.csl_reverse_lookup_support||t.sys.csl_reverse_lookup_support)&&!t.tmp.suppress_decorations)for(o=0,
a=d.decorations.length;a>o;o+=1)g=d.decorations[o],"@showid"===g[0]&&(l=t.fun.decorate[g[0]][g[1]].call(d,t,l,g[2]));h.push(l),t.tmp.count_offset_characters&&(t.tmp.offset_characters+=b+d.strings.suffix.length+d.strings.prefix.length)}}}else if(d.blobs.length){var y=t.output.string(t,d.blobs,d);h=h.concat(y)}d.strings.first_blob&&(t.registry.registry[d.strings.first_blob].offset=t.tmp.offset_characters,t.tmp.count_offset_characters=!1)}for(n=0,r=h.length-1;r>n;n+=1)"number"!=typeof h[n].num||"number"!=typeof h[n+1].num||h[n+1].UGLY_DELIMITER_SUPPRESS_HACK||(h[n].strings.suffix=h[n].strings.suffix+(p?p:""),h[n+1].successor_prefix="",h[n+1].UGLY_DELIMITER_SUPPRESS_HACK=!0);var v=0;for(n=0,r=h.length;r>n;n+=1)"string"==typeof h[n]&&(v=parseInt(n,10)+1,n<h.length-1&&"object"==typeof h[n+1]&&(p&&!h[n+1].UGLY_DELIMITER_SUPPRESS_HACK&&(h[n]+=u(p)),h[n+1].UGLY_DELIMITER_SUPPRESS_HACK=!0));i&&(i.decorations.length||i.strings.suffix||i.strings.prefix)&&(v=h.length);var _=t.output.renderBlobs(h.slice(0,v),p,!0,i);if(_&&i&&(i.decorations.length||i.strings.suffix||i.strings.prefix)){if(!t.tmp.suppress_decorations)for(n=0,r=i.decorations.length;r>n;n+=1)g=i.decorations[n],["@cite","@bibliography","@display","@showid"].indexOf(g[0])>-1||t.normalDecorIsOrphan(d,g)||"string"==typeof _&&(_=t.fun.decorate[g[0]][g[1]].call(i,t,_,g[2]));if(l=_,f=i.strings.suffix,l&&l.length&&(m=i.strings.prefix,l=u(m,t.tmp.nestedBraces)+l+u(f,t.tmp.nestedBraces),t.tmp.count_offset_characters&&(t.tmp.offset_characters+=m.length+f.length)),_=l,!t.tmp.suppress_decorations)for(n=0,r=i.decorations.length;r>n;n+=1)g=i.decorations[n],-1!==["@cite","@bibliography","@display","@showid"].indexOf(g[0])&&"string"==typeof _&&(_=t.fun.decorate[g[0]][g[1]].call(i,t,_,g[2]))}var x=h.slice(v,h.length);return!x.length&&_?h=[_]:x.length&&!_?h=x:_&&x.length&&(h=[_].concat(x)),"undefined"==typeof i?(this.queue=[],this.current.mystack=[],this.current.mystack.push(this.queue),t.tmp.suppress_decorations&&(h=t.output.renderBlobs(h,void 0,!0))):"boolean"==typeof i&&(h=t.output.renderBlobs(h,void 0,!0)),i&&i.new_locale&&(t.opt.lang=i.old_locale),h},s.Output.Queue.prototype.clearlevel=function(){var t,e,i;for(t=this.current.value(),i=t.blobs.length,e=0;i>e;e+=1)t.blobs.pop()},s.Output.Queue.prototype.renderBlobs=function(t,e,i,n){var r,o,a,l,u,c,h,p,d,f,m,g;if(g=s.getSafeEscape(this.state),e||(e=""),r=this.state,o="",a=[],l="",h=t.length,"citation"===this.state.tmp.area&&!this.state.tmp.just_looking&&1===h&&"object"==typeof t[0]&&n)return t[0].strings.prefix=n.strings.prefix+t[0].strings.prefix,t[0].strings.suffix=t[0].strings.suffix+n.strings.suffix,t[0].decorations=t[0].decorations.concat(n.decorations),t[0].params=n.params,t[0];var b=!0;for(c=0;h>c;c+=1)t[c].checkNext?(t[c].checkNext(t[c+1],b),b=!1):b=!0;var y=!0;for(c=t.length-1;c>0;c+=-1)t[c].checkLast?y&&t[c].checkLast(t[c-1])&&(y=!1):y=!0;for(h=t.length,c=0;h>c;c+=1)if(u=t[c],o&&(l=e),"string"==typeof u)o+=g(l),o+=u,r.tmp.count_offset_characters&&(r.tmp.offset_characters+=l.length);else if(u.status!==s.SUPPRESS){f=u.formatter.format(u.num,u.gender);var v=f.replace(/<[^>]*>/g,"").length;this.append(f,"empty",!0);var _=this.pop(),x=r.tmp.count_offset_characters;if(f=this.string(r,[_],!1),r.tmp.count_offset_characters=x,u.strings["text-case"]&&(f=s.Output.Formatters[u.strings["text-case"]](this.state,f)),f&&this.state.tmp.strip_periods&&(f=f.replace(/\.([^a-z]|$)/g,"$1")),!r.tmp.suppress_decorations)for(d=u.decorations.length,p=0;d>p;p+=1)m=u.decorations[p],r.normalDecorIsOrphan(u,m)||(f=r.fun.decorate[m[0]][m[1]].call(u,r,f,m[2]));f=g(u.strings.prefix)+f+g(u.strings.suffix);var C="";u.status===s.END?C=g(u.range_prefix):u.status===s.SUCCESSOR?C=g(u.successor_prefix):u.status===s.START?C="":u.status===s.SEEN&&(C=g(u.splice_prefix)),o+=C,o+=f,r.tmp.count_offset_characters&&(r.tmp.offset_characters+=C.length+u.strings.prefix.length+v+u.strings.suffix.length)}return o},s.Output.Queue.purgeEmptyBlobs=function(t){if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length)for(var e=t.blobs.length-1;e>-1;e--){s.Output.Queue.purgeEmptyBlobs(t.blobs[e]);var i=t.blobs[e];if(!i||!i.blobs||!i.blobs.length){for(var n=[];t.blobs.length-1>e;)n.push(t.blobs.pop());for(t.blobs.pop();n.length;)t.blobs.push(n.pop())}}},s.Output.Queue.adjust=function(t){function e(t){return"number"==typeof t.num||t.blobs&&1===t.blobs.length&&"number"==typeof t.blobs[0].num}function i(t){return"number"==typeof t.num?!0:t.blobs&&"object"==typeof t.blobs?i(t.blobs[t.blobs.length-1])?!0:void 0:!1}function n(t,e){var i=!1,n=["@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align"];if(e&&n.push("@quotes"),t.decorations)for(var s=0,r=t.decorations.length;r>s;s++)if(n.indexOf(t.decorations[s][0])>-1){i=!0;break}return i}function s(t){if(t.decorations)for(var e=0,i=t.decorations.length;i>e;e++)if("@quotes"===t.decorations[e][0])return!0;return"object"!=typeof t.blobs?!1:s(t.blobs[t.blobs.length-1])?!0:!1}function r(t,e){if(!g[e])return!1;if("string"==typeof t.blobs)return t.blobs.slice(-1)===e?!0:!1;var i=t.blobs[t.blobs.length-1];if(i){var n=i.strings.suffix.slice(-1);return n?i.strings.suffix.slice(-1)==e?!0:!1:r(i,e)}return!1}function o(t,e,i,n,s){function r(){SecondStrings[n]=SecondStrings[n].slice(1)}function o(){FirstStrings[e]=FirstStrings[e].slice(0,-1)}function a(t){SecondStrings[n]=t+SecondStrings[n]}function l(t){FirstStrings[e]+=t}function u(){return v[m]}function c(){FirstStrings[e].slice(-1);return d[f]}function h(){var t=d[f][m];"string"==typeof t?(o(),r(),a(t)):(a(f),o())}function p(){var t=v[m][f];"string"==typeof t?(o(),r(),l(t)):(l(m),r())}FirstStrings="blobs"===e?t:t.strings,SecondStrings="blobs"===n?i:i.strings;var f=FirstStrings[e].slice(-1),m=SecondStrings[n].slice(0,1),g=s?o:r,b=s?c:u,y=s?h:p,_=f===m;_?g():b()&&y()}function a(t){if(t.blobs&&"string"==typeof t.blobs)return void(g[t.strings.suffix.slice(0,1)]&&t.strings.suffix.slice(0,1)===t.blobs.slice(-1)&&(t.strings.suffix=t.strings.suffix.slice(1)));if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length)for(var e=n(t,!0),i=t.blobs.length-1;i>-1;i--){i===t.blobs.length-1;this.upward(t.blobs[i]);var s=t.strings,r=t.blobs[i].strings;if(0===i){" "===s.prefix.slice(-1)&&" "===r.prefix.slice(0,1)&&(r.prefix=r.prefix.slice(1));var o=r.prefix.slice(0,1);e||!b[o]||s.prefix||(s.prefix+=o,r.prefix=r.prefix.slice(1))}if(i===t.blobs.length-1){var o=r.suffix.slice(-1);!e&&[" "].indexOf(o)>-1&&(s.suffix.slice(0,1)!==o&&(s.suffix=o+s.suffix),r.suffix=r.suffix.slice(0,-1))}s.delimiter&&i>0&&b[s.delimiter.slice(-1)]&&s.delimiter.slice(-1)===r.prefix.slice(0,1)&&(r.prefix=r.prefix.slice(1))}}function l(t){if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length)for(var e=t.blobs.length-1;e>-1;e--)if(this.leftward(t.blobs[e]),e<t.blobs.length-1&&!t.strings.delimiter){var i=t.blobs[e],s=i.strings.suffix.slice(-1),r=t.blobs[e+1],a=r.strings.prefix.slice(0,1),l=n(i)||n(r),u="number"==typeof s||"number"==typeof a;if(!l&&!u&&g[a]&&!u){var c=a===i.strings.suffix.slice(-1),h=!i.strings.suffix&&"string"==typeof i.blobs&&i.blobs.slice(-1)===a;c||h?r.strings.prefix=r.strings.prefix.slice(1):o(i,"suffix",r,"prefix")}}}function u(t,a){if(t.blobs&&"string"==typeof t.blobs)return void(g[t.strings.suffix.slice(0,1)]&&t.strings.suffix.slice(0,1)===t.blobs.slice(-1)&&(t.strings.suffix=t.strings.suffix.slice(1)));if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length){for(var l=t.strings,u=!1,c=0,h=t.blobs.length;h>c;c++)if(e(t.blobs[c])){u=!0;break}if(!u&&l.delimiter&&g[l.delimiter.slice(0,1)]){for(var p=l.delimiter.slice(0,1),c=t.blobs.length-2;c>-1;c--){var d=t.blobs[c].strings;d.suffix+=p}l.delimiter=l.delimiter.slice(1)}for(var f=n(t,!0),c=(e(t),t.blobs.length-1);c>-1;c--){var m=t.blobs[c],d=t.blobs[c].strings,y=n(m,!0),v=e(m);if(c===t.blobs.length-1){if(!f||s(m)){var _=l.suffix.slice(0,1);g[_]&&(i(m)||(o(m,"suffix",t,"suffix"),"."===l.suffix.slice(0,1)&&(d.suffix+=l.suffix.slice(0,1),l.suffix=l.suffix.slice(1))))," "===d.suffix.slice(-1)&&l.suffix.slice(0,1)&&(l.suffix=l.suffix.slice(1))}b[d.suffix.slice(0,1)]&&("string"==typeof m.blobs&&m.blobs.slice(-1)===d.suffix.slice(0,1)&&(d.suffix=d.suffix.slice(1)),d.suffix.slice(-1)===l.suffix.slice(0,1)&&(l.suffix=l.suffix.slice(0,-1))),r(t,t.strings.suffix.slice(0,1))&&(t.strings.suffix=t.strings.suffix.slice(1))}else if(l.delimiter)b[l.delimiter.slice(0,1)]&&l.delimiter.slice(0,1)===d.suffix.slice(-1)&&(t.blobs[c].strings.suffix=t.blobs[c].strings.suffix.slice(0,-1));else{var x=t.blobs[c+1].strings;e(m)||y||!b[d.suffix.slice(-1)]||d.suffix.slice(-1)!==x.prefix.slice(0,1)||(x.prefix=x.prefix.slice(1))}v||y||!g[d.suffix.slice(0,1)]||"string"!=typeof m.blobs||o(m,"blobs",m,"suffix"),this.downward(t.blobs[c])}}}function c(e){if("object"==typeof e&&"object"==typeof e.blobs&&e.blobs.length){for(var i,n=0,s=e.blobs.length;s>n;n++){for(var r=e.blobs[n],a=!1,l=0,u=r.decorations.length;u>l;l++){var c=r.decorations[l];"@quotes"===c[0]&&(a=!0)}if(a)if(t){var h=r.strings.suffix.slice(0,1);if("string"==typeof r.blobs)for(;f[h];)o(r,"blobs",r,"suffix"),h=r.strings.suffix.slice(0,1);else for(;f[h];)o(r.blobs[r.blobs.length-1],"suffix",r,"suffix"),h=r.strings.suffix.slice(0,1)}else if("string"==typeof r.blobs)for(var h=r.blobs.slice(-1);m[h];)o(r,"blobs",r,"suffix",!0),h=r.blobs.slice(-1);else for(var h=r.blobs[r.blobs.length-1].strings.suffix.slice(-1);m[h];)o(r.blobs[r.blobs.length-1],"suffix",r,"suffix",!0),h=r.blobs[r.blobs.length-1].strings.suffix.slice(-1);i=this.fix(e.blobs[n]),r.blobs&&"string"==typeof r.blobs&&(i=r.blobs.slice(-1))}return i}}var h={";":!0,":":!0},p={".":!0,"!":!0,"?":!0};this.upward=a,this.leftward=l,this.downward=u,this.fix=c;var d={"!":{".":"!","?":"!?",":":"!",",":"!,",";":"!;"},"?":{"!":"?!",".":"?",":":"?",",":"?,",";":"?;"},".":{"!":".!","?":".?",":":".:",",":".,",";":".;"},":":{"!":"!","?":"?",".":":",",":":,",";":":;"},",":{"!":",!","?":",?",":":",:",".":",.",";":",;"},";":{"!":"!","?":"?",":":";",",":";,",".":";"}},f={},m={},g={},b={};for(var y in d)g[y]=!0,b[y]=!0,h[y]||(f[y]=!0),p[y]||(m[y]=!0);b[" "]=!0,b[" "]=!0;var v={};for(var y in d)for(var _ in d[y])v[_]||(v[_]={}),v[_][y]=d[y][_]},s.Engine.Opt=function(){this.has_disambiguate=!1,this.mode="html",this.dates={},this["locale-sort"]=[],this["locale-translit"]=[],this["locale-translat"]=[],this.citeAffixes={persons:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},institutions:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},titles:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},journals:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},publishers:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},places:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}}},this["default-locale"]=[],this.update_mode=s.NONE,this.bib_mode=s.NONE,this.sort_citations=!1,this["et-al-min"]=0,this["et-al-use-first"]=1,this["et-al-use-last"]=!1,this["et-al-subsequent-min"]=!1,this["et-al-subsequent-use-first"]=!1,this["demote-non-dropping-particle"]="display-and-sort",this["parse-names"]=!0,this.citation_number_slug=!1,this.trigraph="Aaaa00:AaAa00:AaAA00:AAAA00",this.development_extensions={},this.development_extensions.field_hack=!0,this.development_extensions.locator_date_and_revision=!0,this.development_extensions.locator_parsing_for_plurals=!0,this.development_extensions.locator_label_parse=!0,this.development_extensions.raw_date_parsing=!0,this.development_extensions.clean_up_csl_flaws=!0,this.development_extensions.flip_parentheses_to_braces=!0,this.development_extensions.jurisdiction_subfield=!0,this.development_extensions.static_statute_locator=!1,this.development_extensions.csl_reverse_lookup_support=!1,this.development_extensions.clobber_locator_if_no_statute_section=!1,this.development_extensions.wrap_url_and_doi=!1,this.development_extensions.allow_force_lowercase=!1,this.development_extensions.handle_parallel_articles=!1,this.development_extensions.thin_non_breaking_space_html_hack=!1,this.development_extensions.apply_citation_wrapper=!1,this.development_extensions.main_title_from_short_title=!1,this.development_extensions.normalize_lang_keys_to_lowercase=!1,this.development_extensions.strict_text_case_locales=!1,this.development_extensions.rtl_support=!1,this.development_extensions.strict_page_numbers=!1,this.development_extensions.expect_and_symbol_form=!1,this.development_extensions.require_explicit_legal_case_title_short=!1,this.nodenames=[],this.gender={},this["cite-lang-prefs"]={persons:["orig"],institutions:["orig"],titles:["orig","translat"],journals:["translit"],publishers:["orig"],places:["orig"],number:["translat"]},this.has_layout_locale=!1},s.Engine.Tmp=function(){this.names_max=new s.Stack,this.names_base=new s.Stack,this.givens_base=new s.Stack,this.value=[],this.namepart_decorations={},this.namepart_type=!1,this.area="citation",this.root="citation",this.extension="",this.can_substitute=new s.Stack(0,s.LITERAL),this.element_rendered_ok=!1,this.element_trace=new s.Stack("style"),this.nameset_counter=0,this.group_context=new s.Stack([!1,!1,!1],s.LITERAL),this.term_predecessor=!1,this.jump=new s.Stack(0,s.LITERAL),this.decorations=new s.Stack,this.tokenstore_stack=new s.Stack,this.last_suffix_used="",this.last_names_used=[],this.last_years_used=[],this.years_used=[],this.names_used=[],this.taintedItemIDs={},this.taintedCitationIDs={},this.initialize_with=new s.Stack,this.disambig_request=!1,this["name-as-sort-order"]=!1,this.suppress_decorations=!1,this.disambig_settings=new s.AmbigConfig,this.bib_sort_keys=[],this.prefix=new s.Stack("",s.LITERAL),this.suffix=new s.Stack("",s.LITERAL),this.delimiter=new s.Stack("",s.LITERAL),this.cite_locales=[],this.cite_affixes={citation:!1,bibliography:!1,citation_sort:!1,bibliography_sort:!1},this.strip_periods=0,this.shadow_numbers={}},s.Engine.Fun=function(t){this.match=new s.Util.Match,this.suffixator=new s.Util.Suffixator(s.SUFFIX_CHARS),this.romanizer=new s.Util.Romanizer,this.ordinalizer=new s.Util.Ordinalizer(t),this.long_ordinalizer=new s.Util.LongOrdinalizer},s.Engine.Build=function(){this["alternate-term"]=!1,this.in_bibliography=!1,this.in_style=!1,this.skip=!1,this.postponed_macro=!1,this.layout_flag=!1,this.name=!1,this.form=!1,this.term=!1,this.macro={},this.macro_stack=[],this.text=!1,this.lang=!1,this.area="citation",this.root="citation",this.extension="",this.substitute_level=new s.Stack(0,s.LITERAL),this.names_level=0,this.render_nesting_level=0,this.render_seen=!1},s.Engine.Configure=function(){this.fail=[],this.succeed=[]},s.Engine.Citation=function(t){this.opt={},this.tokens=[],this.srt=new s.Registry.Comparifier(t,"citation_sort"),this.opt.collapse=[],this.opt["disambiguate-add-names"]=!1,this.opt["disambiguate-add-givenname"]=!1,this.opt["disambiguate-add-year-suffix"]=!1,this.opt["givenname-disambiguation-rule"]="by-cite",this.opt["near-note-distance"]=5,this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="citation"},s.Engine.Bibliography=function(){this.opt={},this.tokens=[],this.opt.collapse=[],this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt["line-spacing"]=1,this.opt["entry-spacing"]=1,this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="bibliography"},s.Engine.BibliographySort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="bibliography"},s.Engine.CitationSort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="citation"},s.Engine.prototype.previewCitationCluster=function(t,e,i,n){var r=this.opt.mode;this.setOutputFormat(n);var o=this.processCitationCluster(t,e,i,s.PREVIEW);return this.setOutputFormat(r),o[1]},s.Engine.prototype.appendCitationCluster=function(t){for(var e=[],i=this.registry.citationreg.citationByIndex.length,n=0;i>n;n+=1){var s=this.registry.citationreg.citationByIndex[n];e.push([""+s.citationID,s.properties.noteIndex])}return this.processCitationCluster(t,e,[])[1]},s.Engine.prototype.processCitationCluster=function(t,e,i,n){var r,o,a,l,u,c,h,p,d,f,m,g,b,y,v,_;this.debug=!1,this.tmp.citation_errors=[];var x={bibchange:!1};this.setCitationId(t);var C,w,S;if(n===s.PREVIEW){C=this.registry.citationreg.citationByIndex.slice(),w=this.registry.reflist.slice();var T=e.concat([[""+t.citationID,t.properties.noteIndex]]).concat(i),E={},I=[];for(o=0,a=T.length;a>o;o+=1)for(r=this.registry.citationreg.citationById[T[o][0]],l=0,u=r.citationItems.length;u>l;l+=1)E[r.citationItems[l].id]=!0,I.push(""+r.citationItems[l].id);for(S={},o=0,a=w.length;a>o;o+=1)if(!E[w[o].id]){var A=this.registry.registry[w[o].id].ambig,O=this.registry.ambigcites[A];if(O)for(l=0,u=O.length;u>l;l+=1)S[O[l]]=s.cloneAmbigConfig(this.registry.registry[O[l]].disambig)}}this.tmp.taintedCitationIDs={};var N=[],k={};for(o=0,a=t.citationItems.length;a>o;o+=1){g={};for(f in t.citationItems[o])g[f]=t.citationItems[o][f];if(m=this.retrieveItem(""+g.id),m.id&&this.transform.loadAbbreviation("default","hereinafter",m.id),this.remapSectionVariable([[m,g]]),this.opt.development_extensions.locator_date_and_revision&&g.locator){g.locator=""+g.locator;var P=g.locator.indexOf("|");if(P>-1){var D=g.locator;g.locator=D.slice(0,P),D=D.slice(P+1),v=D.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2}).*/),v&&(g["locator-date"]=this.fun.dateparser.parse(v[1]),D=D.slice(v[1].length)),g["locator-revision"]=D.replace(/^\s+/,"").replace(/\s+$/,"")}}this.opt.development_extensions.locator_label_parse&&(!g.locator||-1!==["bill","gazette","legislation","treaty"].indexOf(m.type)||g.label&&"page"!==g.label||(v=s.LOCATOR_LABELS_REGEXP.exec(g.locator),v&&(g.label=s.LOCATOR_LABELS_MAP[v[2]],g.locator=v[3])));var L=[m,g];N.push(L),t.citationItems[o].item=m}t.sortedItems=N;var R=[];for(o=0,a=e.length;a>o;o+=1)r=e[o],this.registry.citationreg.citationById[r[0]].properties.noteIndex=r[1],R.push(this.registry.citationreg.citationById[r[0]]);for(R.push(t),o=0,a=i.length;a>o;o+=1)r=i[o],this.registry.citationreg.citationById[r[0]].properties.noteIndex=r[1],R.push(this.registry.citationreg.citationById[r[0]]);this.registry.citationreg.citationByIndex=R,this.registry.citationreg.citationsByItemId={},this.opt.update_mode===s.POSITION&&(y=[],b=[],_={});var j=[];for(o=0,a=R.length;a>o;o+=1){for(R[o].properties.index=o,l=0,u=R[o].sortedItems.length;u>l;l+=1)g=R[o].sortedItems[l],this.registry.citationreg.citationsByItemId[g[1].id]||(this.registry.citationreg.citationsByItemId[g[1].id]=[],j.push(""+g[1].id)),-1===this.registry.citationreg.citationsByItemId[g[1].id].indexOf(R[o])&&this.registry.citationreg.citationsByItemId[g[1].id].push(R[o]);this.opt.update_mode===s.POSITION&&(R[o].properties.noteIndex?b.push(R[o]):(R[o].properties.noteIndex=0,y.push(R[o])))}if(n!==s.ASSUME_ALL_ITEMS_REGISTERED&&this.updateItems(j),!this.opt.citation_number_sort&&N&&N.length>1&&this.citation_sort.tokens.length>0){for(o=0,a=N.length;a>o;o+=1)N[o][1].sortkeys=s.getSortKeys.call(this,N[o][0],"citation_sort");if(this.opt.grouped_sort&&!t.properties.unsorted){for(o=0,a=N.length;a>o;o+=1){var M=N[o][1].sortkeys;this.tmp.authorstring_request=!0;var F=this.registry.registry[N[o][0].id].disambig;this.tmp.authorstring_request=!0,s.getAmbiguousCite.call(this,N[o][0],F);var B=this.registry.authorstrings[N[o][0].id];this.tmp.authorstring_request=!1,N[o][1].sortkeys=[B].concat(M)}N.sort(this.citation.srt.compareCompositeKeys);var q=!1,U=!1,H=!1;for(o=0,a=N.length;a>o;o+=1)N[o][1].sortkeys[0]!==q&&(H=N[o][1].sortkeys[0],U=N[o][1].sortkeys[1]),N[o][1].sortkeys[0]=""+U+o,q=H}t.properties.unsorted||N.sort(this.citation.srt.compareCompositeKeys)}var $;if(this.opt.update_mode===s.POSITION)for(o=0;2>o;o+=1){$=[y,b][o];var z={},V={};for(l=0,u=$.length;u>l;l+=1){var G=$[l];for($[l].properties.noteIndex||($[l].properties.noteIndex=0),$[l].properties.noteIndex=parseInt($[l].properties.noteIndex,10),l>0&&$[l-1].properties.noteIndex>$[l].properties.noteIndex&&(_={},z={},V={}),c=0,h=G.sortedItems.length;h>c;c+=1)this.registry.registry[G.sortedItems[c][1].id].parallel||(_[G.properties.noteIndex]?_[G.properties.noteIndex]+=1:_[G.properties.noteIndex]=1);for(c=0,h=$[l].sortedItems.length;h>c;c+=1){g=$[l].sortedItems[c];var W=g[0].id,X=g[1].locator,K=g[1].label;g[0].legislation_id&&(W=g[0].legislation_id);var J;if(c>0&&(J=G.sortedItems[c-1][0].legislation_id?G.sortedItems[c-1][0].legislation_id:G.sortedItems[c-1][1].id),n!==s.PREVIEW||G.citationID==t.citationID){var Q={};if(Q.position=g[1].position,Q["first-reference-note-number"]=g[1]["first-reference-note-number"],Q["near-note"]=g[1]["near-note"],g[1]["first-reference-note-number"]=0,g[1]["near-note"]=!1,this.registry.citationreg.citationsByItemId[W]&&"note"===this.opt.xclass&&this.opt.has_disambiguate){var Y=this.registry.registry[W]["citation-count"],Z=this.registry.citationreg.citationsByItemId[W].length;if(this.registry.registry[W]["citation-count"]=this.registry.citationreg.citationsByItemId[W].length,"number"==typeof Y){var tt=2>Y,et=2>Z;if(tt!==et)for(var it=0,nt=this.registry.citationreg.citationsByItemId[W].length;nt>it;it++)k[this.registry.registry[W].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[W][it].citationID]=!0}else for(var it=0,nt=this.registry.citationreg.citationsByItemId[W].length;nt>it;it++)k[this.registry.registry[W].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[W][it].citationID]=!0}var st;if("undefined"==typeof z[W])z[W]=G.properties.noteIndex,this.registry.registry[W]&&(this.registry.registry[W]["first-reference-note-number"]=G.properties.noteIndex),V[W]=G.properties.noteIndex,g[1].position=s.POSITION_FIRST;else{var rt=!1,ot=!1;if(l>0&&(st=$[l-1].sortedItems.slice(-1)[0][1].id,$[l-1].sortedItems[0].slice(-1)[0].legislation_id&&(st=$[l-1].sortedItems[0].slice(-1)[0].legislation_id)),l>0&&0===parseInt(c,10)&&$[l-1].properties.noteIndex!==$[l].properties.noteIndex){var at=$[l-1].sortedItems,lt=!1,ut=$[l-1].sortedItems[0][0].id;for($[l-1].sortedItems[0][0].legislation_id&&(ut=$[l-1].sortedItems[0][0].legislation_id),(ut==W&&$[l-1].properties.noteIndex>=$[l].properties.noteIndex-1||$[l-1].sortedItems[0][1].id==this.registry.registry[g[1].id].parallel)&&(1===_[$[l-1].properties.noteIndex]||0===$[l-1].properties.noteIndex)&&(lt=!0),p=0,d=at.slice(1).length;d>p;p+=1){var ct=at.slice(1)[p];this.registry.registry[ct[1].id].parallel&&this.registry.registry[ct[1].id].parallel!=this.registry.registry[ct[1].id]||(lt=!1)}lt?rt=!0:ot=!0}else c>0&&J==W?rt=!0:0===c&&$[l-1].properties.noteIndex==$[l].properties.noteIndex&&$[l-1].sortedItems.length&&st==W?rt=!0:ot=!0;var ht,pt,dt,ft,mt;if(rt&&(ht=c>0?G.sortedItems[c-1][1]:$[l-1].sortedItems[0][1],ht.locator?(dt=ht.label?ht.label:"",pt=""+ht.locator+dt):pt=ht.locator,X?(mt=K?K:"",ft=""+X+mt):ft=X),rt&&pt&&!ft&&(rt=!1,ot=!0),rt&&(!pt&&ft?g[1].position=s.POSITION_IBID_WITH_LOCATOR:pt||ft?pt&&ft===pt?g[1].position=s.POSITION_IBID:pt&&ft&&ft!==pt?g[1].position=s.POSITION_IBID_WITH_LOCATOR:(rt=!1,ot=!0):g[1].position=s.POSITION_IBID),ot&&(g[1].position=s.POSITION_SUBSEQUENT),(ot||rt)&&z[W]!=G.properties.noteIndex&&(g[1]["first-reference-note-number"]=z[W],this.registry.registry[W])){var gt=this.registry.citationreg.citationsByItemId[W][0].properties.noteIndex,bt=G.properties.noteIndex;this.registry.registry[W]["first-reference-note-number"]=gt>bt?bt:gt}}if(G.properties.noteIndex){var yt=parseInt(G.properties.noteIndex,10)-parseInt(V[W],10);g[1].position!==s.POSITION_FIRST&&yt<=this.citation.opt["near-note-distance"]&&(g[1]["near-note"]=!0),V[W]=G.properties.noteIndex}if(G.citationID!=t.citationID)for(p=0,d=s.POSITION_TEST_VARS.length;d>p;p+=1){var vt=s.POSITION_TEST_VARS[p];g[1][vt]!==Q[vt]&&("first-reference-note-number"===vt&&(k[this.registry.registry[W].ambig]=!0),this.tmp.taintedCitationIDs[G.citationID]=!0,"first-reference-note-number"===vt&&(this.tmp.taintedItemIDs[W]=!0))}this.sys.variableWrapper&&(g[1].index=G.properties.index,g[1].noteIndex=G.properties.noteIndex)}else"undefined"==typeof z[g[1].id]?(z[W]=G.properties.noteIndex,V[W]=G.properties.noteIndex):V[W]=G.properties.noteIndex}}}if(this.opt.citation_number_sort&&N&&N.length>1&&this.citation_sort.tokens.length>0){for(o=0,a=N.length;a>o;o+=1)N[o][1].sortkeys=s.getSortKeys.call(this,N[o][0],"citation_sort");t.properties.unsorted||N.sort(this.citation.srt.compareCompositeKeys)}for(f in this.tmp.taintedItemIDs)if(this.tmp.taintedItemIDs.hasOwnProperty(f)&&($=this.registry.citationreg.citationsByItemId[f]))for(o=0,a=$.length;a>o;o+=1)this.tmp.taintedCitationIDs[$[o].citationID]=!0;var _t=[];if(n===s.PREVIEW){try{_t=this.process_CitationCluster.call(this,t.sortedItems,t.citationID)}catch(xt){s.error("Error running CSL processor for preview: "+xt)}for(this.registry.citationreg.citationByIndex=C,this.registry.citationreg.citationById={},o=0,a=C.length;a>o;o+=1)this.registry.citationreg.citationById[C[o].citationID]=C[o];var Ct=[];for(o=0,a=w.length;a>o;o+=1)Ct.push(""+w[o].id);this.updateItems(Ct);for(f in S)S.hasOwnProperty(f)&&(this.registry.registry[f].disambig=S[f])}else{for(var wt in k)this.disambiguate.run(wt,t);var St;for(f in this.tmp.taintedCitationIDs)if(f!=t.citationID){var Tt=this.registry.citationreg.citationById[f];this.tmp.citation_pos=Tt.properties.index,this.tmp.citation_note_index=Tt.properties.noteIndex,this.tmp.citation_id=""+Tt.citationID,St=[],St.push(Tt.properties.index),St.push(this.process_CitationCluster.call(this,Tt.sortedItems,Tt.citationID)),_t.push(St)}this.tmp.taintedItemIDs={},this.tmp.taintedCitationIDs={},this.tmp.citation_pos=t.properties.index,this.tmp.citation_note_index=t.properties.noteIndex,this.tmp.citation_id=""+t.citationID,St=[],St.push(e.length),St.push(this.process_CitationCluster.call(this,N,t.citationID)),_t.push(St),_t.sort(function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:0})}return x.citation_errors=this.tmp.citation_errors.slice(),[x,_t]},s.Engine.prototype.process_CitationCluster=function(t,e){var i;return this.parallel.StartCitation(t),i=s.getCitationCluster.call(this,t,e)},s.Engine.prototype.makeCitationCluster=function(t){var e,i,n,r,o,a,l;for(e=[],o=t.length,r=0;o>r;r+=1){a={};for(var u in t[r])a[u]=t[r][u];if(l=this.retrieveItem(""+a.id),this.opt.development_extensions.locator_label_parse&&a.locator&&-1===["bill","gazette","legislation","treaty"].indexOf(l.type)&&(!a.label||"page"===a.label)){var c=s.LOCATOR_LABELS_REGEXP.exec(a.locator);c&&(a.label=s.LOCATOR_LABELS_MAP[c[2]],a.locator=c[3])}i=[l,a],e.push(i)}if(this.remapSectionVariable(e),e&&e.length>1&&this.citation_sort.tokens.length>0){for(o=e.length,r=0;o>r;r+=1)e[r][1].sortkeys=s.getSortKeys.call(this,e[r][0],"citation_sort");e.sort(this.citation.srt.compareCompositeKeys)}return this.tmp.citation_errors=[],this.parallel.StartCitation(e),n=s.getCitationCluster.call(this,e)},s.getAmbiguousCite=function(t,e,i){var n,r,o=this.tmp.group_context.value().slice();e?this.tmp.disambig_request=e:this.tmp.disambig_request=!1;var a={position:1};this.registry.registry[t.id]&&this.registry.citationreg.citationsByItemId&&this.registry.citationreg.citationsByItemId[t.id]&&this.registry.citationreg.citationsByItemId[t.id].length&&i&&"by-cite"===this.citation.opt["givenname-disambiguation-rule"]&&(a["first-reference-note-number"]=this.registry.registry[t.id]["first-reference-note-number"]),this.tmp.area="citation",n=this.parallel.use_parallels,this.parallel.use_parallels=!1,this.tmp.suppress_decorations=!0,this.tmp.just_looking=!0,s.getCite.call(this,t,a);for(var l=0,u=this.output.queue.length;u>l;l+=1)s.Output.Queue.purgeEmptyBlobs(this.output.queue[l]);if(this.opt.development_extensions.clean_up_csl_flaws)for(var c=0,h=this.output.queue.length;h>c;c+=1)this.output.adjust.upward(this.output.queue[c]),this.output.adjust.leftward(this.output.queue[c]),this.output.adjust.downward(this.output.queue[c]),this.output.adjust.fix(this.output.queue[c]);return r=this.output.string(this,this.output.queue),this.tmp.just_looking=!1,this.tmp.suppress_decorations=!1,this.parallel.use_parallels=n,this.tmp.group_context.replace(o,"literal"),r},s.getSpliceDelimiter=function(t,e){if(t&&!this.tmp.have_collapsed&&"string"==typeof this.citation.opt["after-collapse-delimiter"])this.tmp.splice_delimiter=this.citation.opt["after-collapse-delimiter"];else if(this.tmp.have_collapsed&&"in-text"===this.opt.xclass&&this.opt.update_mode!==s.NUMERIC)this.tmp.splice_delimiter=", ";else if(this.tmp.use_cite_group_delimiter)this.tmp.splice_delimiter=this.citation.opt.cite_group_delimiter;else if(this.tmp.cite_locales[e-1]){var i=this.tmp.cite_affixes[this.tmp.area][this.tmp.cite_locales[e-1]];i&&i.delimiter&&(this.tmp.splice_delimiter=i.delimiter)}return this.tmp.splice_delimiter||(this.tmp.splice_delimiter=""),this.tmp.splice_delimiter},s.getCitationCluster=function(t,e){var i,n,r,o,a,l,u,c,h,p,d,f,m,g,b,y,v,_,x;this.tmp.last_primary_names_string=!1,this.tmp.nestedBraces=!1,_=s.getSafeEscape(this),this.tmp.area="citation",i="",n=[],this.tmp.last_suffix_used="",this.tmp.last_names_used=[],this.tmp.last_years_used=[],this.tmp.backref_index=[],this.tmp.cite_locales=[];var C=!1;if("note"===this.opt.xclass&&this.citation.opt.suppressTrailingPunctuation&&(C=!0),e&&this.registry.citationreg.citationById[e].properties["suppress-trailing-punctuation"]&&(C=!0),"note"===this.opt.xclass){for(var w=[],S=!1,T=!1,E=!1,I=[],A=0,O=t.length;O>A;A+=1){var N=t[A][0].type,k=t[A][0].title,P=t[A][1].position,D=t[A][0].id;k&&"legal_case"===N&&D!==E&&P&&((k!==S||0===w.length)&&(I=[],w.push(I)),I.push(t[A][1])),S=k,T=P,E=D}for(A=0,O=w.length;O>A;A+=1)if(I=w[A],!(I.length<2)){var L=I.slice(-1)[0].locator;if(L)for(var R=0,j=I.length-1;j>R;R+=1)I[R].locator&&(L=!1);L&&(I[0].locator=L,delete I.slice(-1)[0].locator,I[0].label=I.slice(-1)[0].label,I.slice(-1)[0].label&&delete I.slice(-1)[0].label)}}for(r=[],o=t.length,a=0;o>a;a+=1){if(m=t[a][0],l=t[a][1],u=this.tmp.have_collapsed,c={},a>0?s.getCite.call(this,m,l,""+t[a-1][0].id):(this.tmp.term_predecessor=!1,s.getCite.call(this,m,l)),this.tmp.cite_renders_content||(x={citationID:""+this.tmp.citation_id,index:this.tmp.citation_pos,noteIndex:this.tmp.citation_note_index,itemID:""+m.id,citationItems_pos:a,error_code:s.ERROR_NO_RENDERED_FORM},this.tmp.citation_errors.push(x)),a===t.length-1&&this.parallel.ComposeSet(),c.splice_delimiter=s.getSpliceDelimiter.call(this,u,a),l&&l["author-only"]&&(this.tmp.suppress_decorations=!0),a>0){v=t[a-1][1];var M=v.suffix&&"."===v.suffix.slice(-1),F=!v.suffix&&l.prefix&&"."===l.prefix.slice(0,1);if(M||F){var B=c.splice_delimiter.indexOf(" ");B>-1&&!F?c.splice_delimiter=c.splice_delimiter.slice(B):c.splice_delimiter=""}}c.suppress_decorations=this.tmp.suppress_decorations,c.have_collapsed=this.tmp.have_collapsed,r.push(c)}this.tmp.has_purged_parallel=!1,this.parallel.PruneOutputQueue(this),h=0,f=this.output.queue.slice();var q=({strings:{suffix:this.citation.opt.layout_suffix,delimiter:this.citation.opt.layout_delimiter}},this.citation.opt.layout_suffix),U=this.tmp.cite_locales[this.tmp.cite_locales.length-1];U&&this.tmp.cite_affixes[this.tmp.area][U]&&this.tmp.cite_affixes[this.tmp.area][U].suffix&&(q=this.tmp.cite_affixes[this.tmp.area][U].suffix),s.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(q.slice(0,1))>-1&&(q=q.slice(0,1));var H=this.citation.opt.layout_delimiter;H||(H=""),s.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(H.slice(0,1))>-1&&(H=H.slice(0,1));for(var $=q,A=0,O=this.output.queue.length;O>A;A+=1)s.Output.Queue.purgeEmptyBlobs(this.output.queue[A]);
if(!this.tmp.suppress_decorations&&this.output.queue.length&&(this.opt.development_extensions.apply_citation_wrapper&&this.sys.wrapCitationEntry&&!this.tmp.just_looking&&"citation"===this.tmp.area||(C||(this.output.queue[this.output.queue.length-1].strings.suffix=$),this.output.queue[0].strings.prefix=this.citation.opt.layout_prefix)),this.opt.development_extensions.clean_up_csl_flaws)for(var R=0,j=this.output.queue.length;j>R;R+=1)this.output.adjust.upward(this.output.queue[R]),this.output.adjust.leftward(this.output.queue[R]),this.output.adjust.downward(this.output.queue[R]),this.tmp.last_chr=this.output.adjust.fix(this.output.queue[R]);for(a=0,o=f.length;o>a;a+=1){if(this.output.queue=[f[a]],this.tmp.suppress_decorations=r[a].suppress_decorations,this.tmp.splice_delimiter=r[a].splice_delimiter,f[a].parallel_delimiter&&(this.tmp.splice_delimiter=f[a].parallel_delimiter),this.tmp.have_collapsed=r[a].have_collapsed,p=this.output.string(this,this.output.queue),this.tmp.suppress_decorations=!1,"string"==typeof p)return this.tmp.suppress_decorations=!1,p;if("object"==typeof p&&0===p.length&&!l["suppress-author"])if(this.tmp.has_purged_parallel)p.push("");else{var z="[CSL STYLE ERROR: reference with no printed form.]",V=0===a?_(this.citation.opt.layout_prefix):"",G=a===f.length-1?_(this.citation.opt.layout_suffix):"";p.push(V+z+G)}if(n.length&&"string"==typeof p[0]){p.reverse();var W=p.pop();W&&","===W.slice(0,1)?n.push(W):"string"==typeof n.slice(-1)[0]&&","===n.slice(-1)[0].slice(-1)?n.push(" "+W):W&&n.push(_(this.tmp.splice_delimiter)+W)}else p.reverse(),d=p.pop(),"undefined"!=typeof d&&(n.length&&"string"==typeof n[n.length-1]&&(n[n.length-1]+=d.successor_prefix),n.push(d));for(g=p.length,b=0;g>b;b+=1)y=p[b],"string"!=typeof y?(d=p.pop(),"undefined"!=typeof d&&n.push(d)):n.push(_(this.tmp.splice_delimiter)+y);0!==n.length||t[a][1]["suppress-author"]||(h+=1)}if(i+=this.output.renderBlobs(n),i&&(this.output.nestedBraces=!1,!this.tmp.suppress_decorations))for(o=this.citation.opt.layout_decorations.length,a=0;o>a;a+=1)c=this.citation.opt.layout_decorations[a],"normal"!==c[1]&&(i=this.fun.decorate[c[0]][c[1]](this,i));return this.tmp.suppress_decorations=!1,i},s.getCite=function(t,e,i){var n,r;for(this.tmp.cite_renders_content=!1,this.parallel.StartCite(t,e,i),s.citeStart.call(this,t,e),n=0,this.nameOutput=new s.NameOutput(this,t,e);n<this[this.tmp.area].tokens.length;)n=s.tokenExec.call(this,this[this.tmp.area].tokens[n],t,e);return s.citeEnd.call(this,t,e),this.parallel.CloseCite(this),this.tmp.cite_renders_content||this.tmp.just_looking||"bibliography"===this.tmp.area&&(r={index:this.tmp.bibliography_pos,itemID:""+t.id,error_code:s.ERROR_NO_RENDERED_FORM},this.tmp.bibliography_errors.push(r)),""+t.id},s.citeStart=function(t,e){if(this.tmp.disambiguate_count=0,this.tmp.disambiguate_maxMax=0,this.tmp.same_author_as_previous_cite=!1,this.tmp.suppress_decorations?this.tmp.subsequent_author_substitute_ok=!1:this.tmp.subsequent_author_substitute_ok=!0,this.tmp.lastchr="","citation"===this.tmp.area&&this.citation.opt.collapse&&this.citation.opt.collapse.length?this.tmp.have_collapsed=!0:this.tmp.have_collapsed=!1,this.tmp.render_seen=!1,this.tmp.disambig_request&&!this.tmp.disambig_override?this.tmp.disambig_settings=this.tmp.disambig_request:this.registry.registry[t.id]&&!this.tmp.disambig_override?(this.tmp.disambig_request=this.registry.registry[t.id].disambig,this.tmp.disambig_settings=this.registry.registry[t.id].disambig):this.tmp.disambig_settings=new s.AmbigConfig,"citation"!==this.tmp.area&&this.registry.registry[t.id]&&(this.tmp.disambig_restore=s.cloneAmbigConfig(this.registry.registry[t.id].disambig),"bibliography"===this.tmp.area&&this.tmp.disambig_settings&&this.tmp.disambig_override&&(this.opt["disambiguate-add-names"]&&(this.tmp.disambig_settings.names=this.registry.registry[t.id].disambig.names.slice(),this.tmp.disambig_request.names=this.registry.registry[t.id].disambig.names.slice()),this.opt["disambiguate-add-givenname"]))){this.tmp.disambig_request=this.tmp.disambig_settings,this.tmp.disambig_settings.givens=this.registry.registry[t.id].disambig.givens.slice(),this.tmp.disambig_request.givens=this.registry.registry[t.id].disambig.givens.slice();for(var i=0,n=this.tmp.disambig_settings.givens.length;n>i;i+=1)this.tmp.disambig_settings.givens[i]=this.registry.registry[t.id].disambig.givens[i].slice();for(var i=0,n=this.tmp.disambig_request.givens.length;n>i;i+=1)this.tmp.disambig_request.givens[i]=this.registry.registry[t.id].disambig.givens[i].slice()}if(this.tmp.names_used=[],this.tmp.nameset_counter=0,this.tmp.years_used=[],this.tmp.names_max.clear(),this.tmp.splice_delimiter=this[this.tmp.area].opt.layout_delimiter,this.bibliography_sort.keys=[],this.citation_sort.keys=[],this.tmp.has_done_year_suffix=!1,this.tmp.last_cite_locale=!1,!this.tmp.just_looking&&e&&!e.position&&this.registry.registry[t.id]&&(this.tmp.disambig_restore=s.cloneAmbigConfig(this.registry.registry[t.id].disambig)),this.tmp.shadow_numbers={},this.setNumberLabels(t),this.tmp.first_name_string=!1,this.opt.development_extensions.flip_parentheses_to_braces&&e&&e.prefix){var r=s.checkNestedBraceOpen.exec(e.prefix),o=s.checkNestedBraceClose.exec(e.prefix);r?o?o[0].length<r[0].length?this.output.nestedBraces=s.NestedBraces:this.output.nestedBraces=!1:this.output.nestedBraces=s.NestedBraces:o&&(this.output.nestedBraces=!1)}},s.citeEnd=function(t,e){if(this.tmp.disambig_restore){this.registry.registry[t.id].disambig.names=this.tmp.disambig_restore.names.slice(),this.registry.registry[t.id].disambig.givens=this.tmp.disambig_restore.givens.slice();for(var i=0,n=this.registry.registry[t.id].disambig.givens.length;n>i;i+=1)this.registry.registry[t.id].disambig.givens[i]=this.tmp.disambig_restore.givens[i].slice()}if(this.tmp.disambig_restore=!1,e&&e.suffix?this.tmp.last_suffix_used=e.suffix:this.tmp.last_suffix_used="",this.tmp.last_years_used=this.tmp.years_used.slice(),this.tmp.last_names_used=this.tmp.names_used.slice(),this.tmp.cut_var=!1,this.tmp.disambig_request=!1,this.tmp.cite_locales.push(this.tmp.last_cite_locale),this.tmp.issued_date&&this.tmp.renders_collection_number){for(var r=[],i=this.tmp.issued_date.list.length-1;i>this.tmp.issued_date.pos;i+=-1)r.push(this.tmp.issued_date.list.pop());for(this.tmp.issued_date.list.pop(),i=r.length-1;i>-1;i+=-1)this.tmp.issued_date.list.push(r.pop());this.parallel.use_parallels&&(this.parallel.cite.issued=!1)}if(this.tmp.issued_date=!1,this.tmp.renders_collection_number=!1,this.opt.development_extensions.flip_parentheses_to_braces&&e&&e.suffix){var o=s.checkNestedBraceOpen.exec(e.suffix),a=s.checkNestedBraceClose.exec(e.suffix);a?o?o[0].length<a[0].length?this.output.nestedBraces=!1:this.output.nestedBraces=s.NestedBraces:this.output.nestedBraces=!1:o&&(this.output.nestedBraces=s.NestedBraces)}},s.Engine.prototype.makeBibliography=function(t){var e,i,n,r,o,a,l,u,c;if(e=!1,!this.bibliography.tokens.length)return!1;"string"==typeof t&&(this.opt.citation_number_slug=t,t=!1),i=s.getBibliographyEntries.call(this,t),u=i[0],c=i[1];var h=i[2];for(n={maxoffset:0,entryspacing:this.bibliography.opt["entry-spacing"],linespacing:this.bibliography.opt["line-spacing"],"second-field-align":!1,entry_ids:u,bibliography_errors:this.tmp.bibliography_errors.slice(),done:h},this.bibliography.opt["second-field-align"]&&(n["second-field-align"]=this.bibliography.opt["second-field-align"]),r=0,a=this.registry.reflist.length,l=0;a>l;l+=1)o=this.registry.reflist[l],o.offset>n.maxoffset&&(n.maxoffset=o.offset);return this.bibliography.opt.hangingindent&&(n.hangingindent=this.bibliography.opt.hangingindent),n.bibstart=this.fun.decorate.bibstart,n.bibend=this.fun.decorate.bibend,this.opt.citation_number_slug=!1,[n,c]},s.getBibliographyEntries=function(t){function e(t,e){return t===e?!0:!1}function i(t,i){for(f=i.length,m=0;f>m;m+=1)if(e(t,i[m]))return!0;return!1}function n(t,n){return"none"!==t&&t||n?"string"==typeof n?e(t,n):n?i(t,n):!1:!0}var r,o,a,l,u,c,h,p,d,f,m,g,b,y,v,_,x,C,w,S,T,E,I,A;r=[],E=[],this.tmp.area="bibliography",this.tmp.last_rendered_name=!1,this.tmp.bibliography_errors=[],this.tmp.bibliography_pos=0,o=t&&t.page_start&&t.page_length?this.registry.getSortedIds():this.retrieveItems(this.registry.getSortedIds()),this.tmp.disambig_override=!0,C={};var O;if(t&&t.page_start&&t.page_length&&(O=0,t.page_start!==!0))for(v=0,_=o.length;_>v&&(C[o[v]]=!0,t.page_start!=o[v]);v+=1);var N=[];for(v=0,_=o.length;_>v;v+=1){if(t&&t.page_start&&t.page_length){if(C[o[v]])continue;if(p=this.retrieveItem(o[v]),O===t.page_length)break}else if(p=o[v],C[p.id])continue;if(t){if(a=!0,t.include){for(a=!1,I=0,A=t.include.length;A>I;I+=1)if(d=t.include[I],n(d.value,p[d.field])){a=!0;break}}else if(t.exclude){for(l=!1,I=0,A=t.exclude.length;A>I;I+=1)if(d=t.exclude[I],n(d.value,p[d.field])){l=!0;break}l&&(a=!1)}else if(t.select){for(a=!1,u=!0,I=0,A=t.select.length;A>I;I+=1)d=t.select[I],n(d.value,p[d.field])||(u=!1);u&&(a=!0)}if(t.quash){for(u=!0,I=0,A=t.quash.length;A>I;I+=1)d=t.quash[I],n(d.value,p[d.field])||(u=!1);u&&(a=!1)}if(!a)continue}if(c=new s.Token("group",s.START),c.decorations=[["@bibliography","entry"]].concat(this.bibliography.opt.layout_decorations),this.output.startTag("bib_entry",c),p.system_id&&this.sys.embedBibliographyEntry?this.output.current.value().item_id=p.system_id:this.output.current.value().system_id=p.id,w=[[{id:""+p.id},p]],b=[],!this.registry.registry[p.id].master||t&&t.page_start&&t.page_length)this.registry.registry[p.id].siblings||(this.parallel.StartCitation(w),this.tmp.term_predecessor=!1,b.push(""+s.getCite.call(this,p)),t&&t.page_start&&t.page_length&&(O+=1));else{for(y=!0,this.parallel.StartCitation(w),this.output.queue[0].strings.delimiter=", ",this.tmp.term_predecessor=!1,b.push(""+s.getCite.call(this,p)),C[p.id]=!0,x=this.registry.registry[p.id].siblings,I=0,A=x.length;A>I;I+=1){var k=this.registry.registry[p.id].siblings[I];S=this.retrieveItem(k),b.push(""+s.getCite.call(this,S)),C[S.id]=!0}this.parallel.ComposeSet(),this.parallel.PruneOutputQueue()}if(E.push(""),this.tmp.bibliography_pos+=1,N.push(b),this.output.endTag("bib_entry"),this.output.queue[0].blobs.length&&this.output.queue[0].blobs[0].blobs.length){for(y||!this.output.queue[0].blobs[0].blobs[0].strings?(g=this.output.queue[0].blobs,y=!1):g=this.output.queue[0].blobs[0].blobs,I=g.length-1;I>-1;I+=-1)if(g[I].blobs&&0!==g[I].blobs.length){var P,D=this.tmp.cite_locales[this.tmp.cite_locales.length-1];P=this.tmp.cite_affixes[this.tmp.area][D]?this.tmp.cite_affixes[this.tmp.area][D].suffix:this.bibliography.opt.layout_suffix,T=P.slice(0,1),T&&g[I].strings.suffix.slice(-1)===T&&(g[I].strings.suffix=g[I].strings.suffix.slice(0,-1)),g[I].strings.suffix+=P;break}g[0].strings.prefix=this.bibliography.opt.layout_prefix+g[0].strings.prefix}for(var I=0,A=this.output.queue.length;A>I;I+=1)s.Output.Queue.purgeEmptyBlobs(this.output.queue[I]);for(var I=0,A=this.output.queue.length;A>I;I+=1)this.output.adjust.upward(this.output.queue[I]),this.output.adjust.leftward(this.output.queue[I]),this.output.adjust.downward(this.output.queue[I],!0),this.output.adjust.fix(this.output.queue[I]);h=this.output.string(this,this.output.queue)[0],h||(h="\n[CSL STYLE ERROR: reference with no printed form.]\n"),r.push(h)}var L=!1;if(t&&t.page_start&&t.page_length){var R=o.slice(-1)[0],j=N.slice(-1)[0];R&&j&&R!=j||(L=!0)}return this.tmp.disambig_override=!1,[N,r,L]},s.Engine.prototype.setCitationId=function(t,e){var i,n,s;if(i=!1,!t.citationID||e){for(n=Math.floor(1e14*Math.random());;){if(s=0,!this.registry.citationreg.citationById[n]){t.citationID=n.toString(32);break}s=!s&&5e13>n?1:-1,n+=1===s?1:-1}i=""+n}return this.registry.citationreg.citationById[t.citationID]=t,i},s.Engine.prototype.rebuildProcessorState=function(t,e,i){t||(t=[]),e||(e="html");for(var n={},r=[],o=0,a=t.length;a>o;o+=1)for(var l=0,u=t[o].citationItems.length;u>l;l+=1){var c=""+t[o].citationItems[l].id;n[c]||r.push(c),n[c]=!0}this.updateItems(r);var h=[],p=[],d=[],f=this.opt.mode;this.setOutputFormat(e);for(var o=0,a=t.length;a>o;o+=1){var m=this.processCitationCluster(t[o],h,p,s.ASSUME_ALL_ITEMS_REGISTERED);h.push([t[o].citationID,t[o].properties.noteIndex]);for(var l=0,u=m[1].length;u>l;l+=1){var g=m[1][l][0];d[g]=[h[g][0],h[g][1],m[1][l][1]]}}return this.updateUncitedItems(i),this.setOutputFormat(f),d},s.Engine.prototype.restoreProcessorState=function(t){var e,i,n,r,o,a,l,u,c,h;u=[],c=[],t||(t=[]);var p=[],d={};for(e=0,i=t.length;i>e;e+=1)d[t[e].citationID]&&this.setCitationId(t[e],!0),d[t[e].citationID]=!0,p.push(t[e].properties.index);var f=t.slice();for(f.sort(function(t,e){return t.properties.index<e.properties.index?-1:t.properties.index>e.properties.index?1:0}),e=0,i=f.length;i>e;e+=1)f[e].properties.index=e;for(e=0,i=f.length;i>e;e+=1){for(h=[],n=0,r=f[e].citationItems.length;r>n;n+=1)o=f[e].citationItems[n],"undefined"==typeof o.sortkeys&&(o.sortkeys=[]),a=this.retrieveItem(""+o.id),l=[a,o],h.push(l),f[e].citationItems[n].item=a,c.push(""+o.id);f[e].properties.unsorted||h.sort(this.citation.srt.compareCompositeKeys),f[e].sortedItems=h,this.registry.citationreg.citationById[f[e].citationID]=f[e]}for(this.updateItems(c),e=0,i=t.length;i>e;e+=1)u.push([""+t[e].citationID,t[e].properties.noteIndex]);var m=[];return t&&t.length?m=this.processCitationCluster(t[0],[],u.slice(1)):(this.registry=new s.Registry(this),this.tmp=new s.Engine.Tmp,this.disambiguate=new s.Disambiguation(this)),m},s.Engine.prototype.updateItems=function(t,e,i){var n=this.tmp.area;if(this.registry.init(t),i)for(var s in this.registry.ambigcites)this.registry.ambigsTouched[s]=!0;return this.registry.dodeletes(this.registry.myhash),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(),this.registry.setsortkeys(),this.registry.setdisambigs(),e||this.registry.sorttokens(),this.registry.renumber(),this.tmp.area=n,this.registry.getSortedIds()},s.Engine.prototype.updateUncitedItems=function(t,e){if(t||(t=[]),"object"==typeof t)if("undefined"==typeof t.length){var i=t;t=[];for(var n in i)t.push(n)}else if("number"==typeof t.length)for(var i={},s=0,r=t.length;r>s;s+=1)i[t[s]]=!0;return this.registry.init(t,!0),this.registry.dopurge(i),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(),this.registry.setsortkeys(),this.registry.setdisambigs(),e||this.registry.sorttokens(),this.registry.renumber(),this.registry.getSortedIds()},s.localeResolve=function(t,e){var i,n;return e||(e="en-US"),t||(t=e),i={},n=t.split(/[\-_]/),i.base=s.LANG_BASES[n[0]],"undefined"==typeof i.base?(s.debug("Warning: unknown locale "+t+", setting fallback to "+e),{base:e,best:t,bare:n[0]}):(1===n.length&&(i.generic=!0),1===n.length||"x"===n[1]?i.best=i.base.replace("_","-"):i.best=n.slice(0,2).join("-"),i.base=i.base.replace("_","-"),i.bare=n[0],i)},s.Engine.prototype.localeConfigure=function(t,e){var i;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(t.best=t.best.toLowerCase(),t.bare=t.bare.toLowerCase(),t.base=t.base.toLowerCase()),(!e||!this.locale[t.best])&&(i=this.sys.xml.makeXml(this.sys.retrieveLocale("en-US")),this.localeSet(i,"en-US",t.best),"en-US"!==t.best&&(t.base!==t.best&&(i=this.sys.xml.makeXml(this.sys.retrieveLocale(t.base)),this.localeSet(i,t.base,t.best)),i=this.sys.xml.makeXml(this.sys.retrieveLocale(t.best)),this.localeSet(i,t.best,t.best)),this.localeSet(this.cslXml,"",t.best),this.localeSet(this.cslXml,t.bare,t.best),t.base!==t.best&&this.localeSet(this.cslXml,t.base,t.best),this.localeSet(this.cslXml,t.best,t.best),"undefined"==typeof this.locale[t.best].terms["page-range-delimiter"]&&(["fr","pt"].indexOf(t.best.slice(0,2).toLowerCase())>-1?this.locale[t.best].terms["page-range-delimiter"]="-":this.locale[t.best].terms["page-range-delimiter"]=""),"undefined"==typeof this.locale[t.best].terms["year-range-delimiter"]&&(this.locale[t.best].terms["year-range-delimiter"]=""),"undefined"==typeof this.locale[t.best].terms["citation-range-delimiter"]&&(this.locale[t.best].terms["citation-range-delimiter"]=""),this.opt.development_extensions.normalize_lang_keys_to_lowercase)){for(var n=["default-locale","locale-sort","locale-translit","locale-translat"],s=0,r=n.length;r>s;s+=1)for(var o=0,a=this.opt[n[s]].length;a>o;o+=1)this.opt[n[s]][o]=this.opt[n[s]][o].toLowerCase();this.opt.lang=this.opt.lang.toLowerCase()}},s.Engine.prototype.localeSet=function(t,e,i){var n,r,o,a,l,u,c,h,p,d,f,m,g,b,y,v;if(e=e.replace("_","-"),i=i.replace("_","-"),this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(e=e.toLowerCase(),i=i.toLowerCase()),this.locale[i]||(this.locale[i]={},this.locale[i].terms={},this.locale[i].opts={},this.locale[i].opts["skip-words"]=s.SKIP_WORDS,this.locale[i].opts["leading-noise-words"]||(this.locale[i].opts["leading-noise-words"]=[]),this.locale[i].dates={},this.locale[i].ord={"1.0.1":!1,keys:{}},this.locale[i]["noun-genders"]={}),r=this.sys.xml.makeXml(),this.sys.xml.nodeNameIs(t,"locale"))r=t;else for(o=this.sys.xml.getNodesByName(t,"locale"),l=0,m=this.sys.xml.numberofnodes(o);m>l;l+=1)if(n=o[l],this.sys.xml.getAttributeValue(n,"lang","xml")===e){r=n;break}for(o=this.sys.xml.getNodesByName(r,"type"),y=0,v=this.sys.xml.numberofnodes(o);v>y;y+=1){var _=o[y],x=this.sys.xml.getAttributeValue(_,"name"),C=this.sys.xml.getAttributeValue(_,"gender");this.opt.gender[x]=C}var w=this.sys.xml.getNodesByName(r,"term","ordinal").length;if(w){for(var S in this.locale[i].ord.keys)delete this.locale[i].terms[S];this.locale[i].ord={"1.0.1":!1,keys:{}}}o=this.sys.xml.getNodesByName(r,"term");var T={"last-digit":{},"last-two-digits":{},"whole-number":{}},E=!1,I={};for(l=0,m=this.sys.xml.numberofnodes(o);m>l;l+=1){if(u=o[l],h=this.sys.xml.getAttributeValue(u,"name"),"sub verbo"===h&&(h="sub-verbo"),"ordinal"===h.slice(0,7)){this.sys.xml.getNodeValue(u);if("ordinal"===h)E=!0;else{var A=this.sys.xml.getAttributeValue(u,"match"),O=h.slice(8),g=this.sys.xml.getAttributeValue(u,"gender-form");g||(g="neuter"),A||(A="last-two-digits","0"===O.slice(0,1)&&(A="last-digit")),"0"===O.slice(0,1)&&(O=O.slice(1)),T[A][O]||(T[A][O]={}),T[A][O][g]=h}this.locale[i].ord.keys[h]=!0}"undefined"==typeof this.locale[i].terms[h]&&(this.locale[i].terms[h]={}),c="long",g=!1,this.sys.xml.getAttributeValue(u,"form")&&(c=this.sys.xml.getAttributeValue(u,"form")),this.sys.xml.getAttributeValue(u,"gender-form")&&(g=this.sys.xml.getAttributeValue(u,"gender-form")),this.sys.xml.getAttributeValue(u,"gender")&&(this.locale[i]["noun-genders"][h]=this.sys.xml.getAttributeValue(u,"gender")),g?(this.locale[i].terms[h][g]={},this.locale[i].terms[h][g][c]=[],b=this.locale[i].terms[h][g],I[h]=!0):(this.locale[i].terms[h][c]=[],b=this.locale[i].terms[h]),this.sys.xml.numberofnodes(this.sys.xml.getNodesByName(u,"multiple"))?(b[c][0]=this.sys.xml.getNodeValue(u,"single"),b[c][1]=this.sys.xml.getNodeValue(u,"multiple")):b[c]=this.sys.xml.getNodeValue(u)}if(E){for(var N in I){var k={},P=0;for(var D in this.locale[i].terms[N])["masculine","feminine"].indexOf(D)>-1?k[D]=this.locale[i].terms[N][D]:P+=1;if(!P)if(k.feminine)for(var D in k.feminine)this.locale[i].terms[N][D]=k.feminine[D];else if(k.masculine)for(var D in k.masculine)this.locale[i].terms[N][D]=k.masculine[D]}this.locale[i].ord["1.0.1"]=T}for(h in this.locale[i].terms)for(y=0,v=2;v>y;y+=1)if(g=s.GENDERS[y],this.locale[i].terms[h][g])for(c in this.locale[i].terms[h])this.locale[i].terms[h][g][c]||(this.locale[i].terms[h][g][c]=this.locale[i].terms[h][c]);for(o=this.sys.xml.getNodesByName(r,"style-options"),l=0,m=this.sys.xml.numberofnodes(o);m>l;l+=1){p=o[l],a=this.sys.xml.attributes(p);for(f in a)if(a.hasOwnProperty(f))if("@punctuation-in-quote"===f||"@limit-day-ordinals-to-day-1"===f)"true"===a[f]?this.locale[i].opts[f.slice(1)]=!0:this.locale[i].opts[f.slice(1)]=!1;else if("@skip-words"===f){var L=a[f].split(/\s*,\s*/);this.locale[i].opts[f.slice(1)]=L}else if("@leading-noise-words"===f&&e===i){var R=a[f].split(/\s*,\s*/);this.locale[i].opts["leading-noise-words"]=R}else if("@name-as-sort-order"===f){this.locale[i].opts["name-as-sort-order"]={};for(var j=a[f].split(/\s+/),y=0,v=j.length;v>y;y+=1)this.locale[i].opts["name-as-sort-order"][j[y]]=!0}else if("@name-as-reverse-order"===f){this.locale[i].opts["name-as-reverse-order"]={};for(var j=a[f].split(/\s+/),y=0,v=j.length;v>y;y+=1)this.locale[i].opts["name-as-reverse-order"][j[y]]=!0}else if("@name-never-short"===f){this.locale[i].opts["name-never-short"]={};for(var j=a[f].split(/\s+/),y=0,v=j.length;v>y;y+=1)this.locale[i].opts["name-never-short"][j[y]]=!0}}for(o=this.sys.xml.getNodesByName(r,"date"),l=0,m=this.sys.xml.numberofnodes(o);m>l;l+=1)d=o[l],this.locale[i].dates[this.sys.xml.getAttributeValue(d,"form")]=d},s.Node={},s.Node.bibliography={build:function(t,e){this.tokentype===s.START&&(t.build.area="bibliography",t.build.root="bibliography",t.fixOpt(this,"names-delimiter","delimiter"),t.fixOpt(this,"name-delimiter","delimiter"),t.fixOpt(this,"name-form","form"),t.fixOpt(this,"and","and"),t.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),t.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),t.fixOpt(this,"initialize-with","initialize-with"),t.fixOpt(this,"initialize","initialize"),t.fixOpt(this,"name-as-sort-order","name-as-sort-order"),t.fixOpt(this,"sort-separator","sort-separator"),t.fixOpt(this,"and","and"),t.fixOpt(this,"et-al-min","et-al-min"),t.fixOpt(this,"et-al-use-first","et-al-use-first"),t.fixOpt(this,"et-al-use-last","et-al-use-last"),t.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),t.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first")),e.push(this)}},s.Node.choose={build:function(t,e){var i;this.tokentype===s.START&&(i=function(t,e){t.tmp.jump.push(void 0,s.LITERAL)}),this.tokentype===s.END&&(i=function(t,e){t.tmp.jump.pop()}),this.execs.push(i),e.push(this)},configure:function(t,e){this.tokentype===s.END?(t.configure.fail.push(e),t.configure.succeed.push(e)):(t.configure.fail.pop(),t.configure.succeed.pop())}},s.Node.citation={build:function(t,e){if(this.tokentype===s.START&&(t.fixOpt(this,"names-delimiter","delimiter"),t.fixOpt(this,"name-delimiter","delimiter"),t.fixOpt(this,"name-form","form"),t.fixOpt(this,"and","and"),t.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),t.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),t.fixOpt(this,"initialize-with","initialize-with"),t.fixOpt(this,"initialize","initialize"),t.fixOpt(this,"name-as-sort-order","name-as-sort-order"),t.fixOpt(this,"sort-separator","sort-separator"),t.fixOpt(this,"and","and"),t.fixOpt(this,"et-al-min","et-al-min"),t.fixOpt(this,"et-al-use-first","et-al-use-first"),t.fixOpt(this,"et-al-use-last","et-al-use-last"),t.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),t.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first"),t.build.area="citation"),this.tokentype===s.END){if(t.opt.grouped_sort="in-text"===t.opt.xclass&&t.citation.opt.collapse&&t.citation.opt.collapse.length||t.citation.opt.cite_group_delimiter&&t.citation.opt.cite_group_delimiter.length&&t.opt.update_mode!==s.POSITION&&t.opt.update_mode!==s.NUMERIC,t.opt.grouped_sort&&t.citation_sort.opt.sort_directions.length){var i=t.citation_sort.opt.sort_directions[0].slice();t.citation_sort.opt.sort_directions=[i].concat(t.citation_sort.opt.sort_directions)}t.citation.srt=new s.Registry.Comparifier(t,"citation_sort")}}},s.Node["#comment"]={build:function(t,e){}},s.Node.date={build:function(t,e){var i,n,r,o,a,l,u,c,h,p;(this.tokentype===s.START||this.tokentype===s.SINGLETON)&&(t.build.date_parts=[],t.build.date_variables=this.variables,t.build.extension||s.Util.substituteStart.call(this,t,e),i=t.build.extension?s.dateMacroAsSortKey:function(t,e,i){var s;if(t.tmp.element_rendered_ok=!1,t.tmp.donesies=[],t.tmp.dateparts=[],s=[],!this.variables.length||t.tmp.just_looking&&"issued"!==this.variables[0])t.tmp.date_object=!1;else{for(t.parallel.StartVariable(this.variables[0]),n=e[this.variables[0]],"undefined"==typeof n&&(n={"date-parts":[[0]]},t.opt.development_extensions.locator_date_and_revision&&i&&"locator-date"===this.variables[0]&&i["locator-date"]&&(n=i["locator-date"])),t.tmp.date_object=n,r=this.dateparts.length,o=0;r>o;o+=1)a=this.dateparts[o],"undefined"!=typeof t.tmp.date_object[a+"_end"]?s.push(a):"month"===a&&"undefined"!=typeof t.tmp.date_object.season_end&&s.push(a);for(l=[],u=["year","month","day"],r=u.length,o=0;r>o;o+=1)s.indexOf(u[o])>-1&&l.push(u[o]);for(s=l.slice(),c=2,r=s.length,o=0;r>o;o+=1)if(a=s[o],h=t.tmp.date_object[a],p=t.tmp.date_object[a+"_end"],h!==p){c=o;break}t.tmp.date_collapse_at=s.slice(c)}},this.execs.push(i),i=function(t,e){if(t.output.startTag("date",this),"issued"===this.variables[0]&&"legal_case"===e.type&&!t.tmp.extension&&""+e["collection-number"]==""+t.tmp.date_object.year&&1===this.dateparts.length&&"year"===this.dateparts[0])for(var i in t.tmp.date_object)if(t.tmp.date_object.hasOwnProperty(i)&&"year"===i.slice(0,4)){t.tmp.issued_date={};var n=t.output.current.mystack.slice(-2)[0].blobs;t.tmp.issued_date.list=n,t.tmp.issued_date.pos=n.length-1}},this.execs.push(i)),t.build.extension||this.tokentype!==s.END&&this.tokentype!==s.SINGLETON||(i=function(t,e){t.output.endTag(),t.parallel.CloseVariable("date")},this.execs.push(i)),e.push(this),(this.tokentype===s.END||this.tokentype===s.SINGLETON)&&(t.build.extension||s.Util.substituteEnd.call(this,t,e))}},s.Node["date-part"]={build:function(t,e){var i,n,r,o,a,l,u,c,h,p,d,f,m,g,b,y,v,_,x,C,w,S,T,E;this.strings.form||(this.strings.form="long"),t.build.date_parts.push(this.strings.name);var I=t.build.date_variables[0];i=function(t,e){if(t.tmp.date_object){if(o=!0,a="",l="",t.tmp.donesies.push(this.strings.name),t.tmp.date_object.literal&&"year"===this.strings.name&&(t.parallel.AppendToVariable(t.tmp.date_object.literal),t.output.append(t.tmp.date_object.literal,this)),t.tmp.date_object&&(a=t.tmp.date_object[this.strings.name],l=t.tmp.date_object[this.strings.name+"_end"]),"year"!==this.strings.name||0!==a||t.tmp.suppress_decorations||(a=!1),u=!t.tmp.suppress_decorations,c=t.tmp.have_collapsed,h="year-suffix"===t[t.tmp.area].opt.collapse||"year-suffix-ranged"===t[t.tmp.area].opt.collapse,p=t.opt["disambiguate-add-year-suffix"],u&&p&&h&&(t.tmp.years_used.push(a),d=t.tmp.last_years_used.length>=t.tmp.years_used.length,d&&c&&t.tmp.last_years_used[t.tmp.years_used.length-1]===a&&(a=!1)),"undefined"!=typeof a){f=!1,m=!1,g=!1,b=!1,"year"===this.strings.name&&(parseInt(a,10)<500&&parseInt(a,10)>0&&(m=t.getTerm("ad")),parseInt(a,10)<0&&(f=t.getTerm("bc"),a=-1*parseInt(a,10)),l&&(parseInt(l,10)<500&&parseInt(l,10)>0&&(b=t.getTerm("ad")),parseInt(l,10)<0&&(g=t.getTerm("bc"),l=-1*parseInt(l,10)))),t.parallel.AppendToVariable(a);for(var i=""+t.tmp.date_object.month;i.length<2;)i="0"+i;i="month-"+i;var A=t.locale[t.opt.lang]["noun-genders"][i];if(this.strings.form){var O=this.strings.form;if("day"===this.strings.name&&"ordinal"===O&&t.locale[t.opt.lang].opts["limit-day-ordinals-to-day-1"]&&""+a!="1"&&(O="numeric"),a=s.Util.Dates[this.strings.name][O](t,a,A,"accessed"===I),"month"===this.strings.name)if(t.tmp.strip_periods)a=a.replace(/\./g,"");else for(T=0,E=this.decorations.length;E>T;T+=1)if("@strip-periods"===this.decorations[T][0]&&"true"===this.decorations[T][1]){a=a.replace(/\./g,"");break}if(l)if(l=s.Util.Dates[this.strings.name][O](t,l,A,"accessed"===I,"_end"),t.tmp.strip_periods)l=l.replace(/\./g,"");else for(T=0,E=this.decorations.length;E>T;T+=1)if("@strip-periods"===this.decorations[T][0]&&"true"===this.decorations[T][1]){l=l.replace(/\./g,"");break}}if(t.output.openLevel("empty"),t.tmp.date_collapse_at.length){for(y=!0,r=t.tmp.date_collapse_at.length,n=0;r>n;n+=1)if(S=t.tmp.date_collapse_at[n],-1===t.tmp.donesies.indexOf(S)){y=!1;break}if(y){if(""+l!="0"){if(0===t.dateput.queue.length&&(o=!0),t.opt["year-range-format"]&&"expanded"!==t.opt["year-range-format"]&&!t.tmp.date_object.day&&!t.tmp.date_object.month&&!t.tmp.date_object.season&&"year"===this.strings.name&&a&&l){l=t.fun.year_mangler(a+"-"+l,!0);var N=t.getTerm("year-range-delimiter");l=l.slice(l.indexOf(N)+1)}t.dateput.append(l,this),o&&(t.dateput.current.value()[0].strings.prefix="")}t.output.append(a,this),v=t.output.current.value(),v.blobs[v.blobs.length-1].strings.suffix="",t.output.append(t.getTerm("year-range-delimiter"),"empty"),_=t.dateput.current.value(),v.blobs=v.blobs.concat(_),t.dateput.string(t,t.dateput.queue),t.tmp.date_collapse_at=[]}else t.output.append(a,this),t.tmp.date_collapse_at.indexOf(this.strings.name)>-1&&""+l!="0"&&(0===t.dateput.queue.length&&(o=!0),t.dateput.openLevel("empty"),t.dateput.append(l,this),o&&(t.dateput.current.value().blobs[0].strings.prefix=""),f&&t.dateput.append(f),m&&t.dateput.append(m),t.dateput.closeLevel())}else t.output.append(a,this);f&&t.output.append(f),m&&t.output.append(m),t.output.closeLevel()}else"month"===this.strings.name&&t.tmp.date_object.season&&(a=""+t.tmp.date_object.season,a&&a.match(/^[1-4]$/)?(t.tmp.group_context.replace([!1,!1,!0]),t.output.append(t.getTerm("season-0"+a),this)):a&&t.output.append(a,this));t.tmp.value=[],!a&&!t.tmp.have_collapsed||t.opt.has_year_suffix||"year"!==this.strings.name||t.tmp.just_looking||t.registry.registry[e.id]&&t.registry.registry[e.id].disambig.year_suffix!==!1&&!t.tmp.has_done_year_suffix&&(t.tmp.has_done_year_suffix=!0,C=parseInt(t.registry.registry[e.id].disambig.year_suffix,10),x=new s.NumericBlob(C,this,e.id),this.successor_prefix=t[t.build.area].opt.layout_delimiter,this.splice_prefix=t[t.build.area].opt.layout_delimiter,w=new s.Util.Suffixator(s.SUFFIX_CHARS),x.setFormatter(w),"year-suffix-ranged"===t[t.tmp.area].opt.collapse&&(x.range_prefix=t.getTerm("citation-range-delimiter")),t[t.tmp.area].opt["year-suffix-delimiter"]?x.successor_prefix=t[t.tmp.area].opt["year-suffix-delimiter"]:x.successor_prefix=t[t.tmp.area].opt.layout_delimiter,x.UGLY_DELIMITER_SUPPRESS_HACK=!0,t.output.append(x,"literal"))}},this.execs.push(i),e.push(this)}},s.Node["else-if"]={build:function(t,e){s.Conditions.TopNode.call(this,t,e),e.push(this)},configure:function(t,e){s.Conditions.Configure.call(this,t,e)}},s.Node["else"]={build:function(t,e){e.push(this)},configure:function(t,e){this.tokentype===s.START&&(t.configure.fail[t.configure.fail.length-1]=e)}},s.Node["et-al"]={build:function(t,e){if("citation"===t.build.area||"bibliography"===t.build.area){var i=function(t,e,i){t.tmp.etal_node=this,"string"==typeof this.strings.term&&(t.tmp.etal_term=this.strings.term)};this.execs.push(i)}e.push(this)}},s.Node.group={build:function(t,e){var i,n;this.tokentype===s.START?(s.Util.substituteStart.call(this,t,e),t.build.substitute_level.value()&&t.build.substitute_level.replace(t.build.substitute_level.value()+1),i=function(t,e){t.output.startTag("group",this),t.tmp.group_context.mystack.length&&(t.output.current.value().parent=t.tmp.group_context.value()[4]);var i=t.tmp.group_context.value()[5];!i&&this.strings.label_form_override&&(i=this.strings.label_form_override),t.tmp.group_context.push([!1,!1,!1,!1,t.output.current.value(),i,this.strings.set_parallel_condition],s.LITERAL),this.strings.oops&&(t.tmp.group_context.value()[3]=this.strings.oops)},n=[],n.push(i),this.execs=n.concat(this.execs),this.strings["has-publisher-and-publisher-place"]&&(t.build["publisher-special"]=!0,i=function(t,e){if(this.strings["subgroup-delimiter"]&&e.publisher&&e["publisher-place"]){var i=e.publisher.split(/;\s*/),n=e["publisher-place"].split(/;\s*/);i.length>1&&i.length===n.length&&(t.publisherOutput=new s.PublisherOutput(t,this),t.publisherOutput["publisher-list"]=i,t.publisherOutput["publisher-place-list"]=n)}},this.execs.push(i))):(t.build["publisher-special"]&&(t.build["publisher-special"]=!1,"string"==typeof t[t.build.root].opt["name-delimiter"]&&(i=function(t,e){t.publisherOutput&&(t.publisherOutput.render(),t.publisherOutput=!1)},this.execs.push(i))),i=function(t,e){
var i=t.tmp.group_context.pop();t.output.endTag();t.tmp.group_context.value();if(i[1]&&(t.tmp.group_context.value()[1]=!0),i[2]||i[0]&&!i[1]){t.tmp.group_context.value()[2]=!0;var n=t.output.current.value().blobs,s=t.output.current.value().blobs.length-1;if(!t.tmp.just_looking&&"undefined"!=typeof i[6]){var r={blobs:n,conditions:i[6],id:e.id,pos:s};t.parallel.parallel_conditional_blobs_list.push(r)}}else t.output.current.value().blobs&&t.output.current.value().blobs.pop(),t.tmp.group_context.value()[3]&&(t.output.current.mystack[t.output.current.mystack.length-2].strings.delimiter=t.tmp.group_context.value()[3])},this.execs.push(i)),e.push(this),this.tokentype===s.END&&(t.build.substitute_level.value()&&t.build.substitute_level.replace(t.build.substitute_level.value()-1),s.Util.substituteEnd.call(this,t,e))}},s.Node["if"]={build:function(t,e){s.Conditions.TopNode.call(this,t,e),e.push(this)},configure:function(t,e){s.Conditions.Configure.call(this,t,e)}},s.Node.conditions={build:function(t,e){this.tokentype===s.START&&t.tmp.conditions.addMatch(this.match),this.tokentype===s.END&&t.tmp.conditions.matchCombine()}},s.Node.condition={build:function(t,e){if(this.tokentype===s.SINGLETON){var i=t.fun.match[this.match](this,t,this.tests);t.tmp.conditions.addTest(i)}}},s.Conditions={},s.Conditions.TopNode=function(t,e){var i;(this.tokentype===s.START||this.tokentype===s.SINGLETON)&&(this.locale&&(t.opt.lang=this.locale),this.tests&&this.tests.length?this.test=t.fun.match[this.match](this,t,this.tests):t.tmp.conditions=new s.Conditions.Engine(t,this)),(this.tokentype===s.END||this.tokentype===s.SINGLETON)&&(i=function(t,e){this.locale_default&&(t.output.current.value().old_locale=this.locale_default,t.output.closeLevel("empty"),t.opt.lang=this.locale_default);var i=this[t.tmp.jump.value()];return i},this.execs.push(i),this.locale_default&&(t.opt.lang=this.locale_default))},s.Conditions.Configure=function(t,e){this.tokentype===s.START?(this.fail=t.configure.fail.slice(-1)[0],this.succeed=this.next,t.configure.fail[t.configure.fail.length-1]=e):this.tokentype===s.SINGLETON?(this.fail=this.next,this.succeed=t.configure.succeed.slice(-1)[0],t.configure.fail[t.configure.fail.length-1]=e):(this.succeed=t.configure.succeed.slice(-1)[0],this.fail=this.next)},s.Conditions.Engine=function(t,e){this.token=e,this.state=t},s.Conditions.Engine.prototype.addTest=function(t){this.token.tests.push(t)},s.Conditions.Engine.prototype.addMatch=function(t){this.token.match=t},s.Conditions.Engine.prototype.matchCombine=function(){this.token.test=this.state.fun.match[this.token.match](this.token,this.state,this.token.tests)},s.Node.info={build:function(t,e){this.tokentype===s.START?t.build.skip="info":t.build.skip=!1}},s.Node.institution={build:function(t,e){if([s.SINGLETON,s.START].indexOf(this.tokentype)>-1){var i=function(t,e){"string"!=typeof t.build.name_delimiter||this.strings.delimiter||(this.strings.delimiter=t.tmp.name_delimiter);"text"===this.strings.and?this.and_term=t.getTerm("and","long",0):"symbol"===this.strings.and?t.opt.development_extensions.expect_and_symbol_form?this.and_term=t.getTerm("and","symbol",0):this.and_term="&":"none"===this.strings.and&&(this.and_term=this.strings.delimiter),"undefined"==typeof this.and_term&&t.tmp.and_term&&(this.and_term=t.getTerm("and","long",0)),s.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof this.strings.delimiter&&(this.and_prefix_multiple=this.strings.delimiter),this.and_suffix=" "):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===this.strings["delimiter-precedes-last"]?this.and_prefix_single=this.strings.delimiter:"never"===this.strings["delimiter-precedes-last"]&&this.and_prefix_multiple&&(this.and_prefix_multiple=" "),this.and={},"undefined"!=typeof this.and_term?(t.output.append(this.and_term,"empty",!0),this.and.single=t.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,t.output.append(this.and_term,"empty",!0),this.and.multiple=t.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):"undefined"!==this.strings.delimiter&&(this.and.single=new s.Blob(this.strings.delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new s.Blob(this.strings.delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),t.nameOutput.institution=this};this.execs.push(i)}e.push(this)},configure:function(t,e){[s.SINGLETON,s.START].indexOf(this.tokentype)>-1&&(t.build.has_institution=!0)}},s.Node["institution-part"]={build:function(t,e){var i;"long"===this.strings.name?i=this.strings["if-short"]?function(t,e){t.nameOutput.institutionpart["long-with-short"]=this}:function(t,e){t.nameOutput.institutionpart["long"]=this}:"short"===this.strings.name&&(i=function(t,e){t.nameOutput.institutionpart["short"]=this}),this.execs.push(i),e.push(this)}},s.Node.key={build:function(t,e){var i,n=new s.Token("key",s.START);n.strings["et-al-min"]=this.strings["et-al-min"],n.strings["et-al-use-first"]=this.strings["et-al-use-first"],n.strings["et-al-use-last"]=this.strings["et-al-use-last"],i=function(t,e){t.tmp.done_vars=[]},n.execs.push(i),t.opt.citation_number_sort_direction=this.strings.sort_direction,i=function(t,e){t.output.openLevel("empty")},n.execs.push(i);var r=[];if(this.strings.sort_direction===s.DESCENDING?(r.push(1),r.push(-1)):(r.push(-1),r.push(1)),t[t.build.area].opt.sort_directions.push(r),s.DATE_VARIABLES.indexOf(this.variables[0])>-1&&(t.build.date_key=!0),i=function(t,e){t.tmp.sort_key_flag=!0,this.strings["et-al-min"]&&(t.tmp["et-al-min"]=this.strings["et-al-min"]),this.strings["et-al-use-first"]&&(t.tmp["et-al-use-first"]=this.strings["et-al-use-first"]),"boolean"==typeof this.strings["et-al-use-last"]&&(t.tmp["et-al-use-last"]=this.strings["et-al-use-last"])},n.execs.push(i),e.push(n),this.variables.length){var o=this.variables[0];if("citation-number"===o&&("citation_sort"===t.build.area&&(t.opt.citation_number_sort=!0),"bibliography_sort"===t.build.area&&(t.opt.citation_number_sort_used=!0)),s.CREATORS.indexOf(o)>-1){var a=new s.Token("names",s.START);a.tokentype=s.START,a.variables=this.variables,s.Node.names.build.call(a,t,e);var l=new s.Token("name",s.SINGLETON);l.tokentype=s.SINGLETON,l.strings["name-as-sort-order"]="all",l.strings["sort-separator"]=" ",l.strings["et-al-use-last"]=this.strings["et-al-use-last"],l.strings["et-al-min"]=this.strings["et-al-min"],l.strings["et-al-use-first"]=this.strings["et-al-use-first"],s.Node.name.build.call(l,t,e);var u=new s.Token("institution",s.SINGLETON);u.tokentype=s.SINGLETON,s.Node.institution.build.call(u,t,e);var c=new s.Token("names",s.END);c.tokentype=s.END,s.Node.names.build.call(c,t,e)}else{var h=new s.Token("text",s.SINGLETON);if(h.dateparts=this.dateparts,s.NUMERIC_VARIABLES.indexOf(o)>-1)i=function(t,e){var i;i=!1,i="citation-number"===o?t.registry.registry[e.id].seq.toString():e[o],i&&(i=s.Util.padding(i)),t.output.append(i,this)};else if("citation-label"===o)i=function(t,e){var i=t.getCitationLabel(e);t.output.append(i,this)};else if(s.DATE_VARIABLES.indexOf(o)>-1)i=s.dateAsSortKey,h.variables=this.variables;else if("title"===o){var p="title",d=!1,f=!1,m=!0;i=t.transform.getOutputFunction(this.variables,p,d,f,m)}else i=function(t,e){var i=e[o];t.output.append(i,"empty")};h.execs.push(i),e.push(h)}}else{var g=new s.Token("text",s.SINGLETON);g.postponed_macro=this.postponed_macro,s.expandMacro.call(t,g)}var b=new s.Token("key",s.END);i=function(t,e){var i=t.output.string(t,t.output.queue);t.sys.normalizeUnicode&&(i=t.sys.normalizeUnicode(i)),""===i&&(i=void 0),("string"!=typeof i||t.tmp.empty_date)&&(i=void 0,t.tmp.empty_date=!1),t[t.tmp.area].keys.push(i),t.tmp.value=[]},b.execs.push(i),t.build.date_key&&("citation_sort"===t.build.area&&(t[t.build.area].opt.sort_directions.push([-1,1]),i=function(t,e){var i=t.registry.registry[e.id].disambig.year_suffix;i||(i=0);var n=s.Util.padding(""+i);t[t.tmp.area].keys.push(n)},b.execs.push(i)),t.build.date_key=!1),i=function(t,e){t.tmp["et-al-min"]=void 0,t.tmp["et-al-use-first"]=void 0,t.tmp["et-al-use-last"]=void 0,t.tmp.sort_key_flag=!1},b.execs.push(i),e.push(b)}},s.Node.label={build:function(t,e){if(this.strings.term){this.strings.form||(this.strings.form="long");var i=function(t,e,i){var n=s.evaluateLabel(this,t,e,i);i&&"locator"===this.strings.term&&(t.parallel.StartVariable("label"),t.parallel.AppendToVariable(i.label),i.section_form_override=this.strings.form),t.output.append(n,this),i&&"locator"===this.strings.term&&t.parallel.CloseVariable()};this.execs.push(i)}else{var n=t.build.names_variables.slice(-1)[0];t.build.name_label||(t.build.name_label={});for(var r=0,o=n.length;o>r;r+=1)t.build.name_label[n[r]]||(t.build.name_label[n[r]]={});if(t.build.name_flag)for(var r=0,o=n.length;o>r;r+=1)t.build.name_label[n[r]].after=this;else for(var r=0,o=n.length;o>r;r+=1)t.build.name_label[n[r]].before=this}e.push(this)}},s.Node.layout={build:function(t,e){var i,n,r,o;this.tokentype===s.START&&(i=function(t,e,i){t.opt.development_extensions.apply_citation_wrapper&&t.sys.wrapCitationEntry&&!t.tmp.just_looking&&e.system_id&&"citation"===t.tmp.area&&(cite_entry=new s.Token("group",s.START),cite_entry.decorations=[["@cite","entry"]],t.output.startTag("cite_entry",cite_entry),t.output.current.value().item_id=e.system_id,i&&(t.output.current.value().locator_txt=i.locator_txt,t.output.current.value().suffix_txt=i.suffix_txt))},this.execs.push(i)),this.tokentype!==s.START||t.tmp.cite_affixes[t.build.area]||(i=function(t,e){t.tmp.done_vars=[],!t.tmp.just_looking&&t.registry.registry[e.id].parallel&&t.tmp.done_vars.push("first-reference-note-number"),t.tmp.rendered_name=!1,t.tmp.name_node={}},this.execs.push(i),i=function(t,e){t.tmp.sort_key_flag=!1},this.execs.push(i),i=function(t,e){t.tmp.nameset_counter=0},this.execs.push(i),i=function(t,e){var i="empty";t.opt.development_extensions.rtl_support&&["ar","he","fa","ur","yi","ps","syr"].indexOf(e.language)>-1&&(i=new s.Token,i.strings.prefix="",i.strings.suffix=""),t.output.openLevel(i)},this.execs.push(i),e.push(this),t.opt.development_extensions.rtl_support,1,"citation"===t.build.area&&(n=new s.Token("text",s.SINGLETON),i=function(t,e,i){var n;if(i&&i.prefix){n="";var r=i.prefix.replace(/<[^>]+>/g,"").replace(/["'\u201d\u2019\u00bb\u202f\u00a0 ]+$/g,""),o=r.slice(-1);r.match(s.ENDSWITH_ROMANESQUE_REGEXP)?n=" ":s.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(o)>-1?n=" ":o.match(/[\)\],0-9]/)&&(n=" ");var a=!1;s.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(o)>-1&&(t.tmp.term_predecessor=!1,a=!0),prefix=(i.prefix+n).replace(/\s+/g," "),t.output.append(prefix,this,!1,a)}},n.execs.push(i),e.push(n)));var a;if(this.locale_raw&&(a=new s.Token("dummy",s.START),a.locale=this.locale_raw,a.strings.delimiter=this.strings.delimiter,a.strings.suffix=this.strings.suffix,t.tmp.cite_affixes[t.build.area]||(t.tmp.cite_affixes[t.build.area]={})),this.tokentype===s.START&&(t.build.layout_flag=!0,this.locale_raw||(t[t.tmp.area].opt.topdecor=[this.decorations],t[t.tmp.area+"_sort"].opt.topdecor=[this.decorations],t[t.build.area].opt.layout_prefix=this.strings.prefix,t[t.build.area].opt.layout_suffix=this.strings.suffix,t[t.build.area].opt.layout_delimiter=this.strings.delimiter,t[t.build.area].opt.layout_decorations=this.decorations,t.tmp.cite_affixes[t.build.area]&&(o=new s.Token("else",s.START),s.Node["else"].build.call(o,t,e))),this.locale_raw)){if(t.build.layout_locale_flag)a.name="else-if",s.Attributes["@locale-internal"].call(a,t,this.locale_raw),s.Node["else-if"].build.call(a,t,e);else{var l=new s.Token("choose",s.START);s.Node.choose.build.call(l,t,e),a.name="if",s.Attributes["@locale-internal"].call(a,t,this.locale_raw),s.Node["if"].build.call(a,t,e)}t.tmp.cite_affixes[t.build.area][a.locale]={},t.tmp.cite_affixes[t.build.area][a.locale].delimiter=this.strings.delimiter,t.tmp.cite_affixes[t.build.area][a.locale].suffix=this.strings.suffix}this.tokentype===s.END&&(this.locale_raw&&(t.build.layout_locale_flag?(a.name="else-if",a.tokentype=s.END,s.Attributes["@locale-internal"].call(a,t,this.locale_raw),s.Node["else-if"].build.call(a,t,e)):(a.name="if",a.tokentype=s.END,s.Attributes["@locale-internal"].call(a,t,this.locale_raw),s.Node["if"].build.call(a,t,e),t.build.layout_locale_flag=!0)),this.locale_raw||(t.tmp.cite_affixes[t.build.area]&&t.build.layout_locale_flag&&(o=new s.Token("else",s.END),s.Node["else"].build.call(o,t,e),o=new s.Token("choose",s.END),s.Node.choose.build.call(o,t,e)),t.build_layout_locale_flag=!0,"citation"===t.build.area&&(r=new s.Token("text",s.SINGLETON),i=function(t,e,i){var n;i&&i.suffix&&(n="",(i.suffix.match(s.STARTSWITH_ROMANESQUE_REGEXP)||["[","("].indexOf(i.suffix.slice(0,1))>-1)&&(n=" "),t.output.append(n+i.suffix,this))},r.execs.push(i),e.push(r)),i=function(t,e){"bibliography"===t.tmp.area&&t.bibliography.opt["second-field-align"]&&t.output.endTag(),t.output.closeLevel()},this.execs.push(i),i=function(t,e){t.opt.development_extensions.apply_citation_wrapper&&t.sys.wrapCitationEntry&&!t.tmp.just_looking&&e.system_id&&"citation"===t.tmp.area&&t.output.endTag()},this.execs.push(i),e.push(this),t.build.layout_flag=!1,t.build.layout_locale_flag=!1))}},s.Node.macro={build:function(t,e){}},s.NameOutput=function(t,e,i,n){this.debug=!1,this.state=t,this.Item=e,this.item=i,this.nameset_base=0,this.etal_spec={},this._first_creator_variable=!1,this._please_chop=!1},s.NameOutput.prototype.init=function(t){this.state.tmp.term_predecessor&&(this.state.tmp.subsequent_author_substitute_ok=!1),this.nameset_offset&&(this.nameset_base=this.nameset_base+this.nameset_offset),this.nameset_offset=0,this.names=t,this.variables=t.variables,this.state.tmp.value=[],this.state.tmp.rendered_name=[],this.state.tmp.label_blob=!1,this.state.tmp.etal_node=!1,this.state.tmp.etal_term=!1;for(var e=0,i=this.variables.length;i>e;e+=1)this.Item[this.variables[e]]&&this.Item[this.variables[e]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[e]]));this["et-al"]=void 0,this["with"]=void 0,this.name=void 0,this.institutionpart={},this.state.tmp.group_context.value()[1]=!0,!this.state.tmp.value.length},s.NameOutput.prototype.reinit=function(t){if(this.state.tmp.can_substitute.value()){this.nameset_offset=0,this.variables=t.variables;var e=this.state.tmp.value.slice();this.state.tmp.value=[];for(var i=0,n=this.variables.length;n>i;i+=1)this.Item[this.variables[i]]&&this.Item[this.variables[i]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[i]]));this.state.tmp.value.length&&this.state.tmp.can_substitute.replace(!1,s.LITERAL),this.state.tmp.value=e}},s.NameOutput.prototype.outputNames=function(){var t,e,i=this.variables;if(this.institution.and&&(this.institution.and.single.blobs&&this.institution.and.single.blobs.length||(this.institution.and.single.blobs=this.name.and.single.blobs),this.institution.and.multiple.blobs&&this.institution.and.multiple.blobs.length||(this.institution.and.multiple.blobs=this.name.and.multiple.blobs)),this.variable_offset={},this.family)for(this.family_decor=s.Util.cloneToken(this.family),this.family_decor.strings.prefix="",this.family_decor.strings.suffix="",t=0,e=this.family.execs.length;e>t;t+=1)this.family.execs[t].call(this.family_decor,this.state,this.Item);else this.family_decor=!1;if(this.given)for(this.given_decor=s.Util.cloneToken(this.given),this.given_decor.strings.prefix="",this.given_decor.strings.suffix="",t=0,e=this.given.execs.length;e>t;t+=1)this.given.execs[t].call(this.given_decor,this.state,this.Item);else this.given_decor=!1;if(this.getEtAlConfig(),this.divideAndTransliterateNames(),this.truncatePersonalNameLists(),this.disambigNames(),this.constrainNames(),"count"===this.name.strings.form)return void((this.state.tmp.extension||0!=this.names_count)&&(this.state.output.append(this.names_count,"empty"),this.state.tmp.group_context.value()[2]=!0));this.setEtAlParameters(),this.setCommonTerm(),this.state.tmp.name_node={},this.state.tmp.name_node.children=[],this.renderAllNames();var n=[];for(t=0,e=i.length;e>t;t+=1){for(var r=i[t],o=[],a=!1,l=0,u=this.institutions[r].length;u>l;l+=1)o.push(this.joinPersonsAndInstitutions([this.persons[r][l],this.institutions[r][l]]));if(this.institutions[r].length){var c=this.nameset_base+this.variable_offset[r];this.freeters[r].length&&(c+=1),a=this.joinInstitutionSets(o,c)}var h=this.joinFreetersAndInstitutionSets([this.freeters[r],a]);if(h&&("_sort"!==this.state.tmp.area.slice(-5)&&(h=this._applyLabels(h,r)),n.push(h)),this.common_term)break}for(this.state.output.openLevel("empty"),this.state.output.current.value().strings.delimiter=this.names.strings.delimiter,t=0,e=n.length;e>t;t+=1)this.state.output.append(n[t],"literal",!0);this.state.output.closeLevel("empty");var p=this.state.output.pop();if(this.state.output.append(p,this.names),this.state.tmp.term_predecessor_name&&(this.state.tmp.term_predecessor=!0),this.state.tmp.name_node.top=this.state.output.current.value(),"authority"!==i[0]){var d=[],f=this.Item[i[0]];if(f)for(var t=0,e=f.length;e>t;t+=1)substring=s.Util.Names.getRawName(f[t]),substring&&d.push(substring);d=d.join(", "),d&&(this.state.tmp.name_node.string=d)}if(this.state.tmp.name_node.string&&!this.state.tmp.first_name_string&&(this.state.tmp.first_name_string=this.state.tmp.name_node.string),"classic"===this.Item.type){var m=[];this.state.tmp.first_name_string&&m.push(this.state.tmp.first_name_string),this.Item.title&&m.push(this.Item.title),m=m.join(", "),m&&this.state.sys.getAbbreviation&&(this.state.transform.loadAbbreviation("default","classic",m),this.state.transform.abbrevs["default"].classic[m]&&(this.state.tmp.done_vars.push("title"),this.state.output.append(this.state.transform.abbrevs["default"].classic[m],"empty",!0),p=this.state.output.pop(),this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.top.blobs.push(p)))}this._collapseAuthor(),this.variables=[]},s.NameOutput.prototype._applyLabels=function(t,e){var i;if(!this.label||!this.label[e])return t;var n=0,s=this.freeters_count[e]+this.institutions_count[e];if(s>1)n=1;else{for(var r=0,o=this.persons[e].length;o>r;r+=1)s+=this.persons_count[e][r];s>1&&(n=1)}return this.label[e].before&&("number"==typeof this.label[e].before.strings.plural&&(n=this.label[e].before.strings.plural),i=this._buildLabel(e,n,"before",e),this.state.output.openLevel("empty"),this.state.output.append(i,this.label[e].before,!0),this.state.output.append(t,"literal",!0),this.state.output.closeLevel("empty"),t=this.state.output.pop()),this.label[e].after&&("number"==typeof this.label[e].after.strings.plural&&(n=this.label[e].after.strings.plural),i=this._buildLabel(e,n,"after",e),this.state.output.openLevel("empty"),this.state.output.append(t,"literal",!0),this.state.output.append(i,this.label[e].after,!0),this.state.tmp.label_blob=this.state.output.pop(),this.state.output.append(this.state.tmp.label_blob,"literal",!0),this.state.output.closeLevel("empty"),t=this.state.output.pop()),t},s.NameOutput.prototype._buildLabel=function(t,e,i,n){this.common_term&&(t=this.common_term);var r=!1,o=this.label[n][i];return o&&(r=s.castLabel(this.state,o,t,e,s.TOLERANT)),r},s.NameOutput.prototype._collapseAuthor=function(){var t,e,i;0===this.nameset_base&&this.Item[this.variables[0]]&&!this._first_creator_variable&&(this._first_creator_variable=this.variables[0]),(this.item&&this.item["suppress-author"]&&this._first_creator_variable==this.variables[0]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter.length)&&(this.state.tmp.authorstring_request?(e="",t=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,i=this.state.tmp.offset_characters,t&&(e=this.state.output.string(this.state,t,!1)),this.state.tmp.offset_characters=i,this.state.registry.authorstrings[this.Item.id]=e):this.state.tmp.just_looking||this.state.tmp.suppress_decorations||!(this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter)||(e="",t=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,i=this.state.tmp.offset_characters,t&&(e=this.state.output.string(this.state,t,!1)),e===this.state.tmp.last_primary_names_string?((this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length)&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=i),this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!0)):(this.state.tmp.last_primary_names_string=e,this.variables.indexOf(this._first_creator_variable)>-1&&this.item&&this.item["suppress-author"]&&"legal_case"!==this.Item.type&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=i,this.state.tmp.term_predecessor=!1),this.state.tmp.have_collapsed=!1,this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!1))))},s.NameOutput.prototype.isPerson=function(t){return t.literal||!t.given&&t.family&&t.isInstitution?!1:!0},s.NameOutput.prototype.truncatePersonalNameLists=function(){var t,e,i,n,s,r,o;this.freeters_count={},this.persons_count={},this.institutions_count={};for(t in this.freeters)this.freeters.hasOwnProperty(t)&&(this.freeters_count[t]=this.freeters[t].length,this.freeters[t]=this._truncateNameList(this.freeters,t));for(t in this.persons)if(this.persons.hasOwnProperty(t))for(this.institutions_count[t]=this.institutions[t].length,this._truncateNameList(this.institutions,t),this.persons[t]=this.persons[t].slice(0,this.institutions[t].length),this.persons_count[t]=[],n=0,s=this.persons[t].length;s>n;n+=1)this.persons_count[t][n]=this.persons[t][n].length,this.persons[t][n]=this._truncateNameList(this.persons,t,n);if(r=1!==this.etal_min||1!==this.etal_use_first||this.state.tmp.extension||this.state.tmp.just_looking?!1:t,r||this._please_chop)for(e=0,i=this.variables.length;i>e;e+=1){for(t=this.variables[e],this.freeters[t].length&&(this._please_chop===t?(this.freeters[t]=this.freeters[t].slice(1),this.freeters_count[t]+=-1,this._please_chop=!1):r&&!this._please_chop&&(this.freeters[t]=this.freeters[t].slice(0,1),this.freeters_count[t]=1,this.institutions[t]=[],this.persons[t]=[],this._please_chop=r)),e=0,i=this.persons[t].length;i>e;e+=1)if(this.persons[t][e].length){if(this._please_chop===t){this.persons[t][e]=this.persons[t][e].slice(1),this.persons_count[t][e]+=-1,this._please_chop=!1;break}if(r&&!this._please_chop){this.freeters[t]=this.persons[t][e].slice(0,1),this.freeters_count[t]=1,this.institutions[t]=[],this.persons[t]=[],o=[],this._please_chop=r;break}}this.institutions[t].length&&(this._please_chop===t?(this.institutions[t]=this.institutions[t].slice(1),this.institutions_count[t]+=-1,this._please_chop=!1):r&&!this._please_chop&&(this.institutions[t]=this.institutions[t].slice(0,1),this.institutions_count[t]=1,o=[],this._please_chop=r))}for(e=0,i=this.variables.length;i>e;e+=1)for(this.institutions[t].length&&(this.nameset_offset+=1),e=0,i=this.persons[t].length;i>e;e+=1)this.persons[t][e].length&&(this.nameset_offset+=1)},s.NameOutput.prototype._truncateNameList=function(t,e,i){var n;return n="undefined"==typeof i?t[e]:t[e][i],this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names&&n.length>50&&n.length>this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2&&(n=n.slice(0,this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2)),n},s.NameOutput.prototype.divideAndTransliterateNames=function(){var t,e,i,n,s=this.Item,r=this.variables;for(this.varnames=r.slice(),this.freeters={},this.persons={},this.institutions={},t=0,e=r.length;e>t;t+=1){var o=r[t];this.variable_offset[o]=this.nameset_offset;var a=this._normalizeVariableValue(s,o);if(this.name.strings["suppress-min"]&&a.length>=this.name.strings["suppress-min"]&&(a=[]),this.name.strings["suppress-max"]&&a.length<=this.name.strings["suppress-max"]&&(a=[]),this._getFreeters(o,a),this._getPersonsAndInstitutions(o,a),0===this.name.strings["suppress-min"])for(this.freeters[o]=[],i=0,n=this.persons[o].length;n>i;i+=1)this.persons[o][i]=[];else if(0===this.institution.strings["suppress-min"]){for(this.institutions[o]=[],this.freeters[o]=this.freeters[o].concat(this.persons[o]),i=0,n=this.persons[o].length;n>i;i+=1)for(var l=0,u=this.persons[o][i].length;u>l;l+=1)this.freeters[o].push(this.persons[o][i][l]);this.persons[o]=[]}}},s.NameOutput.prototype._normalizeVariableValue=function(t,e){var i;return i="string"==typeof t[e]?[{literal:t[e]}]:t[e]?t[e].slice():[]},s.NameOutput.prototype._getFreeters=function(t,e){this.freeters[t]=[];for(var i=e.length-1;i>-1&&this.isPerson(e[i]);i+=-1){var n=this._checkNickname(e.pop());n&&this.freeters[t].push(n)}this.freeters[t].reverse(),this.freeters[t].length&&(this.nameset_offset+=1)},s.NameOutput.prototype._getPersonsAndInstitutions=function(t,e){this.persons[t]=[],this.institutions[t]=[];for(var i=[],n=!1,s=!0,r=e.length-1;r>-1;r+=-1)if(this.isPerson(e[r])){var o=this._checkNickname(e[r]);o&&i.push(o)}else n=!0,this.institutions[t].push(e[r]),s||(i.reverse(),this.persons[t].push(i),i=[]),s=!1;n&&(i.reverse(),this.persons[t].push(i),this.persons[t].reverse(),this.institutions[t].reverse())},s.NameOutput.prototype._clearValues=function(t){for(var e=t.length-1;e>-1;e+=-1)t.pop()},s.NameOutput.prototype._checkNickname=function(t){if(["interview","personal_communication"].indexOf(this.Item.type)>-1){var e="";if(e=s.Util.Names.getRawName(t),e&&this.state.sys.getAbbreviation&&(!this.item||!this.item["suppress-author"])){this.state.transform.loadAbbreviation("default","nickname",e);var i=this.state.transform.abbrevs["default"].nickname[e];i&&(t="!here>>>"===i?!1:{family:i,given:""})}}return t},s.NameOutput.prototype.joinPersons=function(t,e,i){var n;return n="undefined"==typeof i?1===this.etal_spec[e].freeters?this._joinEtAl(t,"name"):2===this.etal_spec[e].freeters?this._joinEllipsis(t,"name"):this.state.tmp.sort_key_flag?this._join(t," "):this._joinAnd(t,"name"):1===this.etal_spec[e].persons[i]?this._joinEtAl(t,"name"):2===this.etal_spec[e].persons[i]?this._joinEllipsis(t,"name"):this.state.tmp.sort_key_flag?this._join(t," "):this._joinAnd(t,"name")},s.NameOutput.prototype.joinInstitutionSets=function(t,e){var i;return i=1===this.etal_spec[e].institutions?this._joinEtAl(t,"institution"):2===this.etal_spec[e].institutions?this._joinEllipsis(t,"institution"):this._joinAnd(t,"institution")},s.NameOutput.prototype.joinPersonsAndInstitutions=function(t){return this._join(t,this.name.strings.delimiter)},s.NameOutput.prototype.joinFreetersAndInstitutionSets=function(t){var e=this._join(t,"[never here]",this["with"].single,this["with"].multiple);return e},s.NameOutput.prototype._joinEtAl=function(t,e){var i=this._join(t,this.name.strings.delimiter);return this.state.output.openLevel(this._getToken(e)),this.state.output.current.value().strings.delimiter="",this.state.output.append(i,"literal",!0),t.length>1?this.state.output.append(this["et-al"].multiple,"literal",!0):1===t.length&&this.state.output.append(this["et-al"].single,"literal",!0),this.state.output.closeLevel(),this.state.output.pop()},s.NameOutput.prototype._joinEllipsis=function(t,e){return this._join(t,this.name.strings.delimiter,this.name.ellipsis.single,this.name.ellipsis.multiple,e)},s.NameOutput.prototype._joinAnd=function(t,e){return this._join(t,this[e].strings.delimiter,this[e].and.single,this[e].and.multiple,e)},s.NameOutput.prototype._join=function(t,e,i,n,r){var o,a;if(!t)return!1;for(o=t.length-1;o>-1;o+=-1)t[o]&&0!==t[o].length&&t[o].blobs.length||(t=t.slice(0,o).concat(t.slice(o+1)));if(!t.length)return!1;if(i&&2===t.length)i&&(i=new s.Blob(i.blobs,i)),t=[t[0],i,t[1]];else{var l;for(l=n?2:1,o=0,a=t.length-l;a>o;o+=1)t[o].strings.suffix+=e;if(t.length>1){var u=t.pop();n?(n=new s.Blob(n.blobs,n),t.push(n)):(i&&(i=new s.Blob(i.blobs,i)),t.push(i)),t.push(u)}}for(this.state.output.openLevel(this._getToken(r)),i&&n&&(this.state.output.current.value().strings.delimiter=""),o=0,a=t.length;a>o;o+=1)this.state.output.append(t[o],!1,!0);return this.state.output.closeLevel(),this.state.output.pop()},s.NameOutput.prototype._getToken=function(t){var e=this[t];if("institution"===t){var i=new s.Token;return i}return e},s.NameOutput.prototype.setCommonTerm=function(){var t=this.variables,e=t.slice();if(e.sort(),this.common_term=e.join(""),!this.common_term)return!1;var i=!1;if(this.label&&this.label[this.variables[0]]&&(this.label[this.variables[0]].before?i=this.state.getTerm(this.common_term,this.label[this.variables[0]].before.strings.form,0):this.label[this.variables[0]].after&&(i=this.state.getTerm(this.common_term,this.label[this.variables[0]].after.strings.form,0))),!this.state.locale[this.state.opt.lang].terms[this.common_term]||!i||this.variables.length<2)return void(this.common_term=!1);for(var n=0,s=0,r=this.variables.length-1;r>s;s+=1){var o=this.variables[s],a=this.variables[s+1];if(this.freeters[o].length||this.freeters[a].length){if(this.etal_spec[o].freeters!==this.etal_spec[a].freeters||!this._compareNamesets(this.freeters[o],this.freeters[a]))return void(this.common_term=!1);n+=1}if(this.persons[o].length!==this.persons[a].length)return void(this.common_term=!1);for(var l=0,u=this.persons[o].length;u>l;l+=1)if(this.etal_spec[o].persons[l]!==this.etal_spec[a].persons[l]||!this._compareNamesets(this.persons[o][l],this.persons[a][l]))return void(this.common_term=!1)}},s.NameOutput.prototype._compareNamesets=function(t,e){if(t.length!==e.length)return!1;for(var i=0,n=e.length;n>i;i+=1)for(var r=(e[i],0),o=s.NAME_PARTS.length;o>r;r+=1){var a=s.NAME_PARTS[r];if(!t[i]||t[i][a]!=e[i][a])return!1}return!0},s.NameOutput.prototype.constrainNames=function(){this.names_count=0;for(var t,e=0,i=this.variables.length;i>e;e+=1){var n=this.variables[e];t=this.nameset_base+e,this.freeters[n].length&&(this.state.tmp.names_max.push(this.freeters[n].length,"literal"),this._imposeNameConstraints(this.freeters,this.freeters_count,n,t),this.names_count+=this.freeters[n].length),this.institutions[n].length&&(this.state.tmp.names_max.push(this.institutions[n].length,"literal"),this._imposeNameConstraints(this.institutions,this.institutions_count,n,t),this.persons[n]=this.persons[n].slice(0,this.institutions[n].length),this.names_count+=this.institutions[n].length);for(var s=0,r=this.persons[n].length;r>s;s+=1)this.persons[n][s].length&&(this.state.tmp.names_max.push(this.persons[n][s].length,"literal"),this._imposeNameConstraints(this.persons[n],this.persons_count[n],s,t),this.names_count+=this.persons[n][s].length)}},s.NameOutput.prototype._imposeNameConstraints=function(t,e,i,n){var s=t[i],r=this.state.tmp["et-al-min"];this.state.tmp.suppress_decorations?this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[n]?r=this.state.tmp.disambig_request.names[n]:e[i]>=this.etal_min&&(r=this.etal_use_first):(this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[n]>this.etal_use_first?r=e[i]<this.etal_min?e[i]:this.state.tmp.disambig_request.names[n]:e[i]>=this.etal_min&&(r=this.etal_use_first),this.etal_use_last&&r>this.etal_min-2&&(r=this.etal_min-2));var o=this.etal_min>=this.etal_use_first,a=e[i]>r;r>e[i]&&(r=s.length),o&&a&&(this.etal_use_last?t[i]=s.slice(0,r).concat(s.slice(-1)):t[i]=s.slice(0,r)),this.state.tmp.disambig_settings.names[n]=t[i].length,
this.state.disambiguate.padBase(this.state.tmp.disambig_settings)},s.NameOutput.prototype.disambigNames=function(){for(var t,e=0,i=this.variables.length;i>e;e+=1){var n=this.variables[e];if(t=this.nameset_base+e,this.freeters[n].length&&this._runDisambigNames(this.freeters[n],t),this.institutions[n].length){"undefined"==typeof this.state.tmp.disambig_settings.givens[t]&&(this.state.tmp.disambig_settings.givens[t]=[]);for(var s=0,r=this.institutions[n].length;r>s;s+=1)"undefined"==typeof this.state.tmp.disambig_settings.givens[t][s]&&this.state.tmp.disambig_settings.givens[t].push(2)}for(var s=0,r=this.persons[n].length;r>s;s+=1)this.persons[n][s].length&&this._runDisambigNames(this.persons[n][s],t)}},s.NameOutput.prototype._runDisambigNames=function(t,e){var i,n,r,o,a,l,u;for(a=0,l=t.length;l>a;a+=1)if(t[a].given||t[a].family){if(r=this.name.strings["initialize-with"],this.state.registry.namereg.addname(""+this.Item.id,t[a],a),i=this.state.tmp.disambig_settings.givens[e],"undefined"==typeof i)for(var c=0,h=e+1;h>c;c+=1)this.state.tmp.disambig_settings.givens[c]||(this.state.tmp.disambig_settings.givens[c]=[]);if(i=this.state.tmp.disambig_settings.givens[e][a],"undefined"==typeof i&&(n=this.name.strings.form,o=this.state.registry.namereg.evalname(""+this.Item.id,t[a],a,0,n,r),this.state.tmp.disambig_settings.givens[e].push(o)),n=this.name.strings.form,u=this.state.registry.namereg.evalname(""+this.Item.id,t[a],a,0,n,r),this.state.tmp.disambig_request){var p=this.state.tmp.disambig_settings.givens[e][a];1!==p||"by-cite"!==this.state.citation.opt["givenname-disambiguation-rule"]||"undefined"!=typeof this.name.strings["initialize-with"]&&"undefined"!=typeof t[a].given||(p=2),o=p,this.state.opt["disambiguate-add-givenname"]&&t[a].given&&(o=this.state.registry.namereg.evalname(""+this.Item.id,t[a],a,o,this.name.strings.form,this.name.strings["initialize-with"]))}else o=u;!this.state.tmp.just_looking&&this.item&&this.item.position===s.POSITION_FIRST&&u>o&&(o=u),this.state.tmp.sort_key_flag||(this.state.tmp.disambig_settings.givens[e][a]=o,"string"!=typeof r||"undefined"!=typeof this.name.strings.initialize&&!0!==this.name.strings.initialize||(this.state.tmp.disambig_settings.use_initials=!0))}},s.NameOutput.prototype.getEtAlConfig=function(){var t=this.item;this["et-al"]={},this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].single=this.state.output.pop(),this["et-al"].single.strings.suffix=this.etal_suffix,this["et-al"].single.strings.prefix=this.etal_prefix_single,this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].multiple=this.state.output.pop(),this["et-al"].multiple.strings.suffix=this.etal_suffix,this["et-al"].multiple.strings.prefix=this.etal_prefix_multiple,"undefined"==typeof t&&(t={}),t.position?(this.name.strings["et-al-subsequent-min"]?this.etal_min=this.name.strings["et-al-subsequent-min"]:this.etal_min=this.name.strings["et-al-min"],this.name.strings["et-al-subsequent-use-first"]?this.etal_use_first=this.name.strings["et-al-subsequent-use-first"]:this.etal_use_first=this.name.strings["et-al-use-first"]):(this.state.tmp["et-al-min"]?this.etal_min=this.state.tmp["et-al-min"]:this.etal_min=this.name.strings["et-al-min"],this.state.tmp["et-al-use-first"]?this.etal_use_first=this.state.tmp["et-al-use-first"]:this.etal_use_first=this.name.strings["et-al-use-first"],"boolean"==typeof this.state.tmp["et-al-use-last"]?this.etal_use_last=this.state.tmp["et-al-use-last"]:this.etal_use_last=this.name.strings["et-al-use-last"]),this.state.tmp["et-al-min"]||(this.state.tmp["et-al-min"]=this.etal_min)},s.NameOutput.prototype.setEtAlParameters=function(){var t,e,i,n;for(t=0,e=this.variables.length;e>t;t+=1){var s=this.variables[t];for("undefined"==typeof this.etal_spec[s]&&(this.etal_spec[s]={freeters:0,institutions:0,persons:[]}),this.etal_spec[this.nameset_base+t]=this.etal_spec[s],this.freeters[s].length&&this._setEtAlParameter("freeters",s),i=0,n=this.persons[s].length;n>i;i+=1)"undefined"==typeof this.etal_spec[s][i]&&(this.etal_spec[s].persons[i]=0),this._setEtAlParameter("persons",s,i);this.institutions[s].length&&this._setEtAlParameter("institutions",s)}},s.NameOutput.prototype._setEtAlParameter=function(t,e,i){var n,s;"persons"===t?(n=this.persons[e][i],s=this.persons_count[e][i]):(n=this[t][e],s=this[t+"_count"][e]),n.length<s&&!this.state.tmp.sort_key_flag?this.etal_use_last?"persons"===t?this.etal_spec[e].persons[i]=2:this.etal_spec[e][t]=2:"persons"===t?this.etal_spec[e].persons[i]=1:this.etal_spec[e][t]=1:"persons"===t?this.etal_spec[e].persons[i]=0:this.etal_spec[e][t]=0},s.NameOutput.prototype.renderAllNames=function(){for(var t,e=0,i=this.variables.length;i>e;e+=1){var n=this.variables[e];t=this.nameset_base+e,this.freeters[n].length&&(this.freeters[n]=this._renderPersonalNames(this.freeters[n],t));for(var s=0,r=this.institutions[n].length;r>s;s+=1)this.persons[n][s]=this._renderPersonalNames(this.persons[n][s],t,s)}this.renderInstitutionNames()},s.NameOutput.prototype.renderInstitutionNames=function(){for(var t=0,e=this.variables.length;e>t;t+=1)for(var i=this.variables[t],n=0,s=this.institutions[i].length;s>n;n+=1){var r,o,a,l,u,n,s,c,h=this.institutions[i][n];if(c=this.state.tmp.extension?["sort"]:h.isInstitution?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons,slot={primary:"locale-orig",secondary:!1,tertiary:!1},c)for(var p=["primary","secondary","tertiary"],d=0,f=p.length;f>d&&!(c.length-1<d);d+=1)c[d]&&(slot[p[d]]="locale-"+c[d]);else slot.primary="locale-translat";"bibliography"===this.state.tmp.area||"citation"===this.state.tmp.area&&"note"===this.state.opt.xclass&&this.item&&!this.item.position||(slot.secondary=!1,slot.tertiary=!1);var m;this.setRenderedName(h),m=this.getName(h,slot.primary,!0);var g=m.name,b=m.usedOrig;switch(g&&(g=this.fixupInstitution(g,i,n)),secondary=!1,slot.secondary&&(m=this.getName(h,slot.secondary,!1,b),secondary=m.name,b=m.usedOrig,secondary&&(secondary=this.fixupInstitution(secondary,i,n))),tertiary=!1,slot.tertiary&&(m=this.getName(h,slot.tertiary,!1,b),tertiary=m.name,tertiary&&(tertiary=this.fixupInstitution(tertiary,i,n))),this.institution.strings["institution-parts"]){case"short":g["short"].length?(l=this._getShortStyle(),r=[this._renderOneInstitutionPart(g["short"],l)]):(u=this._getLongStyle(g,i,n),r=[this._renderOneInstitutionPart(g["long"],u)]);break;case"short-long":u=this._getLongStyle(g,i,n),l=this._getShortStyle(),o=this._renderOneInstitutionPart(g["short"],l),a=this._composeOneInstitutionPart([g,secondary,tertiary],slot,u),r=[o,a];break;case"long-short":u=this._getLongStyle(g,i,n),l=this._getShortStyle(),o=this._renderOneInstitutionPart(g["short"],l),a=this._composeOneInstitutionPart([g,secondary,tertiary],slot,u,!0),r=[a,o];break;default:u=this._getLongStyle(g,i,n),r=[this._composeOneInstitutionPart([g,secondary,tertiary],slot,u)]}this.institutions[i][n]=this._join(r,"")}},s.NameOutput.prototype._composeOneInstitutionPart=function(t,e,i){var n=!1,r=!1,o=!1;t[0]&&(n=this._renderOneInstitutionPart(t[0]["long"],i)),t[1]&&(r=this._renderOneInstitutionPart(t[1]["long"],i)),t[2]&&(o=this._renderOneInstitutionPart(t[2]["long"],i));var a;return r||o?(this.state.output.openLevel("empty"),this.state.output.append(n),secondary_tok=s.Util.cloneToken(i),e.secondary&&(secondary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[e.secondary].prefix,secondary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[e.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ")),this.state.output.append(r,secondary_tok),tertiary_tok=s.Util.cloneToken(i),e.tertiary&&(tertiary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[e.tertiary].prefix,tertiary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[e.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ")),this.state.output.append(o,tertiary_tok),this.state.output.closeLevel(),a=this.state.output.pop()):a=n,a},s.NameOutput.prototype._renderOneInstitutionPart=function(t,e){for(var i=0,n=t.length;n>i;i+=1)if(t[i]){var r=t[i];if(this.state.tmp.strip_periods)r=r.replace(/\./g,"");else for(var o=0,a=e.decorations.length;a>o;o+=1)if("@strip-periods"===e.decorations[o][0]&&"true"===e.decorations[o][1]){r=r.replace(/\./g,"");break}this.state.tmp.group_context.value()[2]=!0,this.state.tmp.can_substitute.replace(!1,s.LITERAL),"!here>>>"===r?t[i]=!1:(this.state.output.append(r,e,!0),t[i]=this.state.output.pop())}return"undefined"==typeof this.institution.strings["part-separator"]&&(this.institution.strings["part-separator"]=this.name.strings.delimiter),this._join(t,this.institution.strings["part-separator"])},s.NameOutput.prototype._renderPersonalNames=function(t,e,i){var n=!1;if(t.length){for(var r=[],o=0,a=t.length;a>o;o+=1){var n,l,u=t[o];if(l=this.state.tmp.extension?["sort"]:u.isInstitution?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons,slot={primary:"locale-orig",secondary:!1,tertiary:!1},l)for(var c=["primary","secondary","tertiary"],h=0,p=c.length;p>h&&!(l.length-1<h);h+=1)slot[c[h]]="locale-"+l[h];else slot.primary="locale-translat";(this.state.tmp.sort_key_flag||"bibliography"!==this.state.tmp.area&&("citation"!==this.state.tmp.area||"note"!==this.state.opt.xclass||!this.item||this.item.position))&&(slot.secondary=!1,slot.tertiary=!1),this.setRenderedName(u);var d=this.getName(u,slot.primary,!0),f=this._renderOnePersonalName(d.name,e,o,i);secondary=!1,slot.secondary&&(d=this.getName(u,slot.secondary,!1,d.usedOrig),d.name&&(secondary=this._renderOnePersonalName(d.name,e,o,i))),tertiary=!1,slot.tertiary&&(d=this.getName(u,slot.tertiary,!1,d.usedOrig),d.name&&(tertiary=this._renderOnePersonalName(d.name,e,o,i)));var m;secondary||tertiary?(this.state.output.openLevel("empty"),this.state.output.append(f),secondary_tok=new s.Token,slot.secondary&&(secondary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.secondary].prefix,secondary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ")),this.state.output.append(secondary,secondary_tok),tertiary_tok=new s.Token,slot.tertiary&&(tertiary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.tertiary].prefix,tertiary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ")),this.state.output.append(tertiary,tertiary_tok),this.state.output.closeLevel(),m=this.state.output.pop()):m=f,r.push(m)}n=this.joinPersons(r,e,i)}return n},s.NameOutput.prototype._isRomanesque=function(t){var e=2;if(t.family.replace('"',"","g").match(s.ROMANESQUE_REGEXP)||(e=0),!e&&t.given&&t.given.match(s.STARTSWITH_ROMANESQUE_REGEXP)&&(e=1),2==e){if(t.multi&&t.multi.main)var i=t.multi.main.slice(0,2);else this.Item.language&&(i=this.Item.language.slice(0,2));["ja","zh"].indexOf(i)>-1&&(e=1)}return e},s.NameOutput.prototype._renderOnePersonalName=function(t,e,i,n){var r=t,o=this._droppingParticle(r,e,n),a=this._familyName(r),l=this._nonDroppingParticle(r),u=this._givenName(r,e,i),c=this._nameSuffix(r);this._isShort(e,i)&&!r["full-form-always"]&&(o=!1,u=!1,c=!1);var h=this.name.strings["sort-separator"];h||(h="");var p;p=r["comma-suffix"]?", ":" ";var d,f,m,g,b=this._isRomanesque(r),y=l&&"-"===l.blobs.slice(-1);return 0===b?d=this._join([l,a,u],""):1===b||r["static-ordering"]?d=this._join([l,a,u]," "):r["reverse-ordering"]?d=this._join([u,l,a]," "):this.state.tmp.sort_key_flag?"never"===this.state.opt["demote-non-dropping-particle"]?(m=this._join([l,a,o]," "),f=this._join([m,u]," "),d=this._join([f,c]," ")):(g=this._join([u,o,l]," "),f=this._join([a,g]," "),d=this._join([f,c]," ")):"all"===this.name.strings["name-as-sort-order"]||"first"===this.name.strings["name-as-sort-order"]&&0===i&&(0===n||"undefined"==typeof n)?(["Lord","Lady"].indexOf(r.given)>-1&&(h=", "),["always","display-and-sort"].indexOf(this.state.opt["demote-non-dropping-particle"])>-1&&!y?(g=this._join([u,o],r["comma-dropping-particle"]+" "),g=this._join([g,l]," "),g&&this.given&&(g.strings.prefix=this.given.strings.prefix,g.strings.suffix=this.given.strings.suffix),a&&this.family&&(a.strings.prefix=this.family.strings.prefix,a.strings.suffix=this.family.strings.suffix),f=this._join([a,g],h),d=this._join([f,c],h)):("bibliography"===this.state.tmp.area&&!this.state.tmp.term_predecessor&&l&&(y||(l.blobs=s.Output.Formatters["capitalize-first"](this.state,l.blobs))),m=y?this._join([l,a],""):this._join([l,a]," "),m&&this.family&&(m.strings.prefix=this.family.strings.prefix,m.strings.suffix=this.family.strings.suffix),g=this._join([u,o],r["comma-dropping-particle"]+" "),g&&this.given&&(g.strings.prefix=this.given.strings.prefix,g.strings.suffix=this.given.strings.suffix),f=this._join([m,g],h),d=this._join([f,c],h))):(r["dropping-particle"]&&r.family&&!r["non-dropping-particle"]&&["'","",""].indexOf(r["dropping-particle"].slice(-1))>-1&&(a=this._join([o,a],""),o=!1),this.state.tmp.term_predecessor||u||"bibliography"!==this.state.tmp.area||(!o&&l?y||(l.blobs=s.Output.Formatters["capitalize-first"](this.state,l.blobs)):o&&(o.blobs=s.Output.Formatters["capitalize-first"](this.state,o.blobs))),y?(g=this._join([l,a],""),g=this._join([o,g]," ")):g=this._join([o,l,a]," "),g=this._join([g,c],p),g&&this.family&&(g.strings.prefix=this.family.strings.prefix,g.strings.suffix=this.family.strings.suffix),u&&this.given&&(u.strings.prefix=this.given.strings.prefix,u.strings.suffix=this.given.strings.suffix),g.strings.prefix&&(r["comma-dropping-particle"]=""),d=this._join([u,g],r["comma-dropping-particle"]+" ")),this.state.tmp.group_context.value()[2]=!0,this.state.tmp.can_substitute.replace(!1,s.LITERAL),this.state.tmp.term_predecessor=!0,this.state.tmp.name_node.children.push(d),d},s.NameOutput.prototype._isShort=function(t,e){return 0===this.state.tmp.disambig_settings.givens[t][e]?!0:!1},s.NameOutput.prototype._normalizeNameInput=function(t){var e={literal:t.literal,family:t.family,isInstitution:t.isInstitution,given:t.given,suffix:t.suffix,"comma-suffix":t["comma-suffix"],"non-dropping-particle":t["non-dropping-particle"],"dropping-particle":t["dropping-particle"],"static-ordering":t["static-ordering"],"reverse-ordering":t["reverse-ordering"],"full-form-always":t["full-form-always"],"parse-names":t["parse-names"],"comma-dropping-particle":"",block_initialize:t.block_initialize,multi:t.multi};return this._parseName(e),e},s.NameOutput.prototype._stripPeriods=function(t,e){var i=this[t+"_decor"];if(e)if(this.state.tmp.strip_periods)e=e.replace(/\./g,"");else if(i)for(var n=0,s=i.decorations.length;s>n;n+=1)if("@strip-periods"===i.decorations[n][0]&&"true"===i.decorations[n][1]){e=e.replace(/\./g,"");break}return e},s.NameOutput.prototype._nonDroppingParticle=function(t){var e=t["non-dropping-particle"];e&&this.state.tmp.sort_key_flag&&(e=e.replace(/[\'\u2019]/,""));var i=this._stripPeriods("family",e);return this.state.output.append(i,this.family_decor,!0)?this.state.output.pop():!1},s.NameOutput.prototype._droppingParticle=function(t,e,i){var n=t["dropping-particle"];n&&this.state.tmp.sort_key_flag&&(n=n.replace(/[\'\u2019]/,""));var s=this._stripPeriods("given",n);if(t["dropping-particle"]&&t["dropping-particle"].match(/^et.?al[^a-z]$/))this.name.strings["et-al-use-last"]?"undefined"==typeof i?this.etal_spec[e].freeters=2:this.etal_spec[e].persons=2:"undefined"==typeof i?this.etal_spec[e].freeters=1:this.etal_spec[e].persons=1,t["comma-dropping-particle"]="";else if(this.state.output.append(s,this.given_decor,!0))return this.state.output.pop();return!1},s.NameOutput.prototype._familyName=function(t){var e=this._stripPeriods("family",t.family);return this.state.output.append(e,this.family_decor,!0)?this.state.output.pop():!1},s.NameOutput.prototype._givenName=function(t,e,i){if(this.name.strings.initialize===!1)t.family&&t.given&&this.name.strings.initialize===!1&&(t.given=s.Util.Names.initializeWith(this.state,t.given,this.name.strings["initialize-with"],!0)),t.given=s.Util.Names.unInitialize(this.state,t.given);else if(t.family&&1===this.state.tmp.disambig_settings.givens[e][i]&&!t.block_initialize){var n=this.name.strings["initialize-with"];t.given=s.Util.Names.initializeWith(this.state,t.given,n)}else t.given=s.Util.Names.unInitialize(this.state,t.given);var r=this._stripPeriods("given",t.given);return this.state.output.append(r,this.given_decor,!0)?this.state.output.pop():!1},s.NameOutput.prototype._nameSuffix=function(t){var e=t.suffix;return"string"==typeof this.name.strings["initialize-with"]&&(e=s.Util.Names.initializeWith(this.state,t.suffix,this.name.strings["initialize-with"],!0)),e=this._stripPeriods("family",e),this.state.output.append(e,"empty",!0)?this.state.output.pop():!1},s.NameOutput.prototype._getLongStyle=function(t,e,i){var n;return n=t["short"].length&&this.institutionpart["long-with-short"]?this.institutionpart["long-with-short"]:this.institutionpart["long"],n||(n=new s.Token),n},s.NameOutput.prototype._getShortStyle=function(){var t;return t=this.institutionpart["short"]?this.institutionpart["short"]:new s.Token},s.NameOutput.prototype._parseName=function(t){var e,i;if(!t["parse-names"]&&"undefined"!=typeof t["parse-names"])return t;t.family&&!t.given&&t.isInstitution&&(t.literal=t.family,t.family=void 0,t.isInstitution=void 0);var n;if(t.family&&'"'===t.family.slice(0,1)&&'"'===t.family.slice(-1)||!t["parse-names"]&&"undefined"!=typeof t["parse-names"]?(t.family=t.family.slice(1,-1),n=!0,t["parse-names"]=0):n=!1,!t["non-dropping-particle"]&&t.family&&!n&&t.given&&(e=t.family.match(/^((?:[\'\u2019a-z][ \'\u2019a-z]*[-\s\'\u2019]+|[ABDVL][^ ][-\s]+[a-z]*\s*|[ABDVL][^ ][^ ][-\s]+[a-z]*\s*))/),e&&(t.family=t.family.slice(e[1].length),t["non-dropping-particle"]=e[1].replace(/\s+$/,"").replace("'",""))),!t.suffix&&t.given&&(e=t.given.match(/(\s*,!*\s*)/))){i=t.given.indexOf(e[1]);var s=t.given.slice(i+e[1].length),r=t.given.slice(i,i+e[1].length).replace(/\s*/g,"");s.length<=3?(2===r.length&&(t["comma-suffix"]=!0),t.suffix=s):!t["dropping-particle"]&&t.given&&(t["dropping-particle"]=s,t["comma-dropping-particle"]=","),t.given=t.given.slice(0,i)}!t["dropping-particle"]&&t.given&&(e=t.given.match(/(\s+)([a-z][ \'\u2019a-z]*)$/),e&&(t.given=t.given.slice(0,-1*(e[1].length+e[2].length)),t["dropping-particle"]=e[2]))},s.NameOutput.prototype.getName=function(t,e,n,s){if(s&&"locale-orig"===e)return{name:!1,usedOrig:s};t.family||(t.family=""),t.given||(t.given="");var r={};r["static-ordering"]=this.getStaticOrder(t);var o=!0;if("locale-orig"!==e&&(o=!1,t.multi)){var a=this.state.opt[e];for(i=0,ilen=a.length;i<ilen;i+=1)if(l=a[i],t.multi._key[l]){o=!0,t=t.multi._key[l],r=this.getNameParams(l),r.transliterated=!0;break}}if(!o){var l=!1;t.multi&&t.multi.main?l=t.multi.main:this.Item.language&&(l=this.Item.language),l&&(r=this.getNameParams(l))}if(!n&&!o)return{name:!1,usedOrig:s};t.family||(t.family=""),t.given||(t.given=""),t={family:t.family,given:t.given,"non-dropping-particle":t["non-dropping-particle"],"dropping-particle":t["dropping-particle"],suffix:t.suffix,"static-ordering":r["static-ordering"],"reverse-ordering":r["reverse-ordering"],"full-form-always":r["full-form-always"],"parse-names":t["parse-names"],"comma-suffix":t["comma-suffix"],"comma-dropping-particle":t["comma-dropping-particle"],transliterated:r.transliterated,block_initialize:r["block-initialize"],literal:t.literal,isInstitution:t.isInstitution,multi:t.multi},!t.literal&&!t.given&&t.family&&t.isInstitution&&(t.literal=t.family),t.literal&&(delete t.family,delete t.given),t=this._normalizeNameInput(t);var u;return u=s?s:!o,{name:t,usedOrig:u}},s.NameOutput.prototype.getNameParams=function(t){var e={},i=s.localeResolve(this.Item.language,this.state.opt["default-locale"][0]),n=this.state.locale[i.best]?i.best:this.state.opt["default-locale"][0],r=this.state.locale[n].opts["name-as-sort-order"],o=this.state.locale[n].opts["name-as-reverse-order"],a=this.state.locale[n].opts["name-never-short"],l=t.split("-")[0];return r&&r[l]&&(e["static-ordering"]=!0,e["reverse-ordering"]=!1),o&&o[l]&&(e["reverse-ordering"]=!0,e["static-ordering"]=!1),a&&a[l]&&(e["full-form-always"]=!0),e["static-ordering"]&&(e["block-initialize"]=!0),e},s.NameOutput.prototype.setRenderedName=function(t){if("bibliography"===this.state.tmp.area){for(var e="",i=0,n=s.NAME_PARTS.length;n>i;i+=1)t[s.NAME_PARTS[i]]&&(e+=t[s.NAME_PARTS[i]]);this.state.tmp.rendered_name.push(e)}},s.NameOutput.prototype.fixupInstitution=function(t,e,i){t=this._splitInstitution(t,e,i),this.institution.strings["reverse-order"]&&t["long"].reverse();var n=t["long"],s=n.slice();if(this.state.sys.getAbbreviation)for(var r=this.Item.jurisdiction,o=0,a=n.length;a>o;o+=1)r=this.state.transform.loadAbbreviation(r,"institution-part",n[o]),this.state.transform.abbrevs[r]["institution-part"][n[o]]&&(s[o]=this.state.transform.abbrevs[r]["institution-part"][n[o]]);return t["short"]=s,t},s.NameOutput.prototype.getStaticOrder=function(t,e){var i=!1;return!e&&t["static-ordering"]?i=!0:0===this._isRomanesque(t)?i=!0:(!t.multi||!t.multi.main)&&this.Item.language&&["vi","hu"].indexOf(this.Item.language)>-1?i=!0:t.multi&&t.multi.main&&["vi","hu"].indexOf(t.multi.main.slice(0,2))>-1?i=!0:this.state.opt["auto-vietnamese-names"]&&s.VIETNAMESE_NAMES.exec(t.family+" "+t.given)&&s.VIETNAMESE_SPECIALS.exec(t.family+t.given)&&(i=!0),i},s.NameOutput.prototype._splitInstitution=function(t,e,i){var n={},s=t.literal.replace(/\s*\|\s*/g,"|");if(s=s.split("|"),"short"===this.institution.strings.form&&this.state.sys.getAbbreviation)for(var r=this.Item.jurisdiction,o=s.length;o>0;o+=-1){var a=s.slice(0,o).join("|");if(r=this.state.transform.loadAbbreviation(r,"institution-entire",a),this.state.transform.abbrevs[r]["institution-entire"][a]){var l=this.state.transform.abbrevs[r]["institution-entire"][a];l=this.state.transform.quashCheck(l);var u=l.split(/>>[0-9]{4}>>/),c=l.match(/>>([0-9]{4})>>/);if(l=u.pop(),u.length>0&&this.Item["original-date"]&&this.Item["original-date"].year)for(var h=c.length-1;h>0&&!(parseInt(this.Item["original-date"].year,10)>=parseInt(c[h],10));h+=-1)l=u.pop();l=l.replace(/\s*\|\s*/g,"|"),s=[l]}}return s.reverse(),n["long"]=this._trimInstitution(s,e,i),n},s.NameOutput.prototype._trimInstitution=function(t,e,i){var n=!1,s=!1,r=!1,o=t.slice();return this.institution&&("undefined"!=typeof this.institution.strings["use-first"]&&(n=this.institution.strings["use-first"]),"undefined"!=typeof this.institution.strings["stop-last"]&&(o=o.slice(0,this.institution.strings["stop-last"]),t=t.slice(0,this.institution.strings["stop-last"])),"undefined"!=typeof this.institution.strings["use-last"]&&(s=this.institution.strings["use-last"])),!1===n&&(0===this.persons[e].length&&(n=this.institution.strings["substitute-use-first"]),n||(n=0)),!1===s&&(s=n?0:t.length),n>t.length-s&&(n=t.length-s),r&&(s=0),t=t.slice(0,n),o=o.slice(n),s&&(s>o.length&&(s=o.length),s&&(t=t.concat(o.slice(o.length-s)))),t},s.PublisherOutput=function(t,e){this.state=t,this.group_tok=e,this.varlist=[]},s.PublisherOutput.prototype.render=function(){this.clearVars(),this.composeAndBlob(),this.composeElements(),this.composePublishers(),this.joinPublishers()},s.PublisherOutput.prototype.composeAndBlob=function(){this.and_blob={};var t=!1;"text"===this.group_tok.strings.and?t=this.state.getTerm("and"):"symbol"===this.group_tok.strings.and&&(t="&");var e=new s.Token;e.strings.suffix=" ",e.strings.prefix=" ",this.state.output.append(t,e,!0);var i=this.state.output.pop();e.strings.prefix=this.group_tok.strings["subgroup-delimiter"],this.state.output.append(t,e,!0);var n=this.state.output.pop();this.and_blob.single=!1,this.and_blob.multiple=!1,t&&("always"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?this.and_blob.single=n:"never"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?(this.and_blob.single=i,this.and_blob.multiple=i):(this.and_blob.single=i,this.and_blob.multiple=n))},s.PublisherOutput.prototype.composeElements=function(){for(var t=0,e=2;e>t;t+=1)for(var i=["publisher","publisher-place"][t],n=0,s=this["publisher-list"].length;s>n;n+=1){var r=this[i+"-list"][n],o=this[i+"-token"];this.state.output.append(r,o,!0),this[i+"-list"][n]=this.state.output.pop()}},s.PublisherOutput.prototype.composePublishers=function(){for(var t,e=0,i=this["publisher-list"].length;i>e;e+=1){t=[this[this.varlist[0]+"-list"][e],this[this.varlist[1]+"-list"][e]],this["publisher-list"][e]=this._join(t,this.group_tok.strings.delimiter)}},s.PublisherOutput.prototype.joinPublishers=function(){var t=this["publisher-list"],e=(this.name_delimiter,this._join(t,this.group_tok.strings["subgroup-delimiter"],this.and_blob.single,this.and_blob.multiple,this.group_tok));this.state.output.append(e,"literal")},s.PublisherOutput.prototype._join=s.NameOutput.prototype._join,s.PublisherOutput.prototype._getToken=s.NameOutput.prototype._getToken,s.PublisherOutput.prototype.clearVars=function(){this.state.tmp["publisher-list"]=!1,this.state.tmp["publisher-place-list"]=!1,this.state.tmp["publisher-group-token"]=!1,this.state.tmp["publisher-token"]=!1,this.state.tmp["publisher-place-token"]=!1},s.evaluateLabel=function(t,e,i,n){var r;"locator"===t.strings.term?(n&&n.label&&(r="sub verbo"===n.label?"sub-verbo":n.label),r||(r="page")):r=t.strings.term;var o=t.strings.plural;return n&&"number"==typeof n.force_pluralism?o=n.force_pluralism:"number"!=typeof o&&("locator"===t.strings.term?n&&n.locator&&(e.opt.development_extensions.locator_parsing_for_plurals?(e.tmp.shadow_numbers.locator||e.processNumber(!1,n,"locator",i.type),o=e.tmp.shadow_numbers.locator.plural):o=s.evaluateStringPluralism(n.locator)):["page","page-first"].indexOf(t.variables[0])>-1?(e.processNumber(!1,i,r,i.type),o=e.tmp.shadow_numbers[r].plural,r=e.tmp.shadow_numbers[r].label):(e.tmp.shadow_numbers[r]||e.processNumber(!1,i,r,i.type),o=e.tmp.shadow_numbers[r].plural),t.decorations&&(e.opt.development_extensions.csl_reverse_lookup_support||e.sys.csl_reverse_lookup_support)&&(t.decorations.reverse(),t.decorations.push(["@showid","true",t.cslid]),t.decorations.reverse())),s.castLabel(e,t,r,o,s.TOLERANT)},s.evaluateStringPluralism=function(t){if(t){var e=t.match(/(?:[0-9],\s*[0-9]|\s+and\s+|&|([0-9]+)\s*[\-\u2013]\s*([0-9]+))/);if(e&&(!e[1]||parseInt(e[1],10)<parseInt(e[2],10)))return 1}return 0},s.castLabel=function(t,e,i,n,s){var r=e.strings.form;t.tmp.group_context.value()[5]&&(r=t.tmp.group_context.value()[5]);var o=t.getTerm(i,r,n,!1,s);if(t.tmp.strip_periods)o=o.replace(/\./g,"");else for(var a=0,l=e.decorations.length;l>a;a+=1)if("@strip-periods"===e.decorations[a][0]&&"true"===e.decorations[a][1]){o=o.replace(/\./g,"");break}return o},s.Node.name={build:function(t,e){var i;[s.SINGLETON,s.START].indexOf(this.tokentype)>-1&&(t.fixOpt(this,"name-delimiter","name_delimiter"),t.fixOpt(this,"name-form","form"),t.fixOpt(this,"and","and"),t.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),t.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),t.fixOpt(this,"initialize-with","initialize-with"),t.fixOpt(this,"initialize","initialize"),t.fixOpt(this,"name-as-sort-order","name-as-sort-order"),t.fixOpt(this,"sort-separator","sort-separator"),t.fixOpt(this,"and","and"),t.fixOpt(this,"et-al-min","et-al-min"),t.fixOpt(this,"et-al-use-first","et-al-use-first"),t.fixOpt(this,"et-al-use-last","et-al-use-last"),t.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),t.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first"),this.strings["et-al-subsequent-min"]&&this.strings["et-al-subsequent-min"]!==this.strings["et-al-min"]&&(t.opt.update_mode=s.POSITION),this.strings["et-al-subsequent-use-first"]&&this.strings["et-al-subsequent-use-first"]!==this.strings["et-al-use-first"]&&(t.opt.update_mode=s.POSITION),"undefined"==typeof this.strings.name_delimiter?this.strings.delimiter=", ":this.strings.delimiter=this.strings.name_delimiter,this.strings["et-al-use-last"]&&(this.ellipsis_term="",this.ellipsis_prefix_single=" ",this.ellipsis_prefix_multiple=this.strings.delimiter,this.ellipsis_suffix=" "),i=function(t,e){t.tmp.etal_term="et-al",t.tmp.name_delimiter=this.strings.delimiter,t.tmp["delimiter-precedes-et-al"]=this.strings["delimiter-precedes-et-al"],"text"===this.strings.and?this.and_term=t.getTerm("and","long",0):"symbol"===this.strings.and&&(t.opt.development_extensions.expect_and_symbol_form?this.and_term=t.getTerm("and","symbol",0):this.and_term="&"),t.tmp.and_term=this.and_term,s.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof this.strings.delimiter&&(this.and_prefix_multiple=this.strings.delimiter),this.and_suffix=" ",t.build.name_delimiter=this.strings.delimiter):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===this.strings["delimiter-precedes-last"]?this.and_prefix_single=this.strings.delimiter:"never"===this.strings["delimiter-precedes-last"]?this.and_prefix_multiple&&(this.and_prefix_multiple=" "):"after-inverted-name"===this.strings["delimiter-precedes-last"]&&(this.and_prefix_single&&(this.and_prefix_single=this.strings.delimiter),this.and_prefix_multiple&&(this.and_prefix_multiple=" ")),this.and={},this.strings.and?(t.output.append(this.and_term,"empty",!0),this.and.single=t.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,t.output.append(this.and_term,"empty",!0),this.and.multiple=t.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):this.strings.delimiter&&(this.and.single=new s.Blob(this.strings.delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new s.Blob(this.strings.delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),this.ellipsis={},this.strings["et-al-use-last"]&&(this.ellipsis.single=new s.Blob(this.ellipsis_term),this.ellipsis.single.strings.prefix=this.ellipsis_prefix_single,this.ellipsis.single.strings.suffix=this.ellipsis_suffix,this.ellipsis.multiple=new s.Blob(this.ellipsis_term),this.ellipsis.multiple.strings.prefix=this.ellipsis_prefix_multiple,this.ellipsis.multiple.strings.suffix=this.ellipsis_suffix),"undefined"==typeof t.tmp["et-al-min"]&&(t.tmp["et-al-min"]=this.strings["et-al-min"]),"undefined"==typeof t.tmp["et-al-use-first"]&&(t.tmp["et-al-use-first"]=this.strings["et-al-use-first"]),"undefined"==typeof t.tmp["et-al-use-last"]&&(t.tmp["et-al-use-last"]=this.strings["et-al-use-last"]),t.nameOutput.name=this},t.build.name_flag=!0,this.execs.push(i)),e.push(this)}},s.Node["name-part"]={build:function(t,e){t.build[this.strings.name]=this}},s.Node.names={build:function(t,e){var i;if((this.tokentype===s.START||this.tokentype===s.SINGLETON)&&(s.Util.substituteStart.call(this,t,e),t.build.substitute_level.push(1),t.fixOpt(this,"names-delimiter","delimiter")),this.tokentype===s.SINGLETON){t.build.names_variables.push(this.variables);for(var n=0,r=this.variables.length;r>n;n+=1)t.build.name_label[this.variables[n]]=t.build.name_label[t.build.names_variables.slice(0)[0]];i=function(t,e,i){t.nameOutput.reinit(this)},this.execs.push(i)}if(this.tokentype===s.START&&(t.build.names_flag=!0,t.build.names_level+=1,1===t.build.names_level&&(t.build.names_variables=[],t.build.name_label={}),t.build.names_variables.push(this.variables),i=function(t,e,i){t.tmp.can_substitute.push(!0),t.parallel.StartVariable("names",this.variables[0]),t.nameOutput.init(this)},this.execs.push(i)),this.tokentype===s.END){for(var n=0,r=3;r>n;n+=1){var o=["family","given","et-al"][n];this[o]=t.build[o],1===t.build.names_level&&(t.build[o]=void 0)}this.label=t.build.name_label,1===t.build.names_level&&(t.build.name_label={}),t.build.names_level+=-1,t.build.names_variables.pop();var a="with",l="",u="";
s.STARTSWITH_ROMANESQUE_REGEXP.test(a)&&(l=" ",u=" "),this["with"]={},this["with"].single=new s.Blob(a),this["with"].single.strings.suffix=u,this["with"].multiple=new s.Blob(a),this["with"].multiple.strings.suffix=u,"always"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=this.strings.delimiter,this["with"].multiple.strings.prefix=this.strings.delimiter):"contextual"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=l,this["with"].multiple.strings.prefix=this.strings.delimiter):"after-inverted-name"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=this.strings.delimiter,this["with"].multiple.strings.prefix=l):(this["with"].single.strings.prefix=l,this["with"].multiple.strings.prefix=l),i=function(t,e,i){t.tmp.etal_node?this.etal_style=t.tmp.etal_node:this.etal_style="empty",this.etal_term=t.getTerm(t.tmp.etal_term,"long",0),s.STARTSWITH_ROMANESQUE_REGEXP.test(this.etal_term)?(this.etal_prefix_single=" ",this.etal_prefix_multiple=t.tmp.name_delimiter,"always"===t.tmp["delimiter-precedes-et-al"]?this.etal_prefix_single=t.tmp.name_delimiter:"never"===t.tmp["delimiter-precedes-et-al"]?this.etal_prefix_multiple=" ":"after-inverted-name"===t.tmp["delimiter-precedes-et-al"]&&(this.etal_prefix_single=t.tmp.name_delimiter,this.etal_prefix_multiple=" "),this.etal_suffix=""):(this.etal_prefix_single="",this.etal_prefix_multiple="",this.etal_suffix="");for(var n=0,r=3;r>n;n+=1){var o=["family","given"][n];t.nameOutput[o]=this[o]}t.nameOutput["with"]=this["with"],t.nameOutput.label=this.label,t.nameOutput.etal_style=this.etal_style,t.nameOutput.etal_term=this.etal_term,t.nameOutput.etal_prefix_single=this.etal_prefix_single,t.nameOutput.etal_prefix_multiple=this.etal_prefix_multiple,t.nameOutput.etal_suffix=this.etal_suffix,t.nameOutput.outputNames(),t.tmp["et-al-use-first"]=void 0,t.tmp["et-al-min"]=void 0,t.tmp["et-al-use-last"]=void 0},this.execs.push(i),i=function(t,e){t.tmp.can_substitute.pop()||t.tmp.can_substitute.replace(!1,s.LITERAL),t.parallel.CloseVariable("names"),1===t.tmp.can_substitute.mystack.length&&(t.tmp.can_block_substitute=!1)},this.execs.push(i),t.build.name_flag=!1}e.push(this),(this.tokentype===s.END||this.tokentype===s.SINGLETON)&&(t.build.substitute_level.pop(),s.Util.substituteEnd.call(this,t,e))}},s.Node.number={build:function(t,e){var i;s.Util.substituteStart.call(this,t,e),"roman"===this.strings.form?this.formatter=t.fun.romanizer:"ordinal"===this.strings.form?this.formatter=t.fun.ordinalizer:"long-ordinal"===this.strings.form&&(this.formatter=t.fun.long_ordinalizer),"undefined"==typeof this.successor_prefix&&(this.successor_prefix=t[t.build.area].opt.layout_delimiter),"undefined"==typeof this.splice_prefix&&(this.splice_prefix=t[t.build.area].opt.layout_delimiter),i=function(t,e,i){var n,r,o,a;if(0!==this.variables.length){if("undefined"==typeof i)var i={};var l,u;if(l=this.variables[0],"locator"!==l||!t.tmp.just_looking){t.parallel.StartVariable(this.variables[0]),"locator"===this.variables[0]?t.parallel.AppendToVariable(e.section):t.parallel.AppendToVariable(e[this.variables[0]]);var c=new RegExp("(?:&|, | and |"+t.getTerm("page-range-delimiter")+")");"collection-number"===l&&"legal_case"===e.type&&(t.tmp.renders_collection_number=!0);var h=e[this.variables[0]],p="long";if(this.strings.label_form_override&&(p=this.strings.label_form_override),"locator"===l&&i.locator)if(i.locator=i.locator.replace(/([^\\])\s*-\s*/,"$1"+t.getTerm("page-range-delimiter")),u=i.locator.match(s.STATUTE_SUBDIV_GROUPED_REGEX)){for(a=i.locator.split(s.STATUTE_SUBDIV_PLAIN_REGEX),n=0,r=a.length;r>n;n+=1)a[n]=t.fun.page_mangler(a[n]);for(o=[a[0]],!this.strings.label_form_override&&t.tmp.group_context.value()[5]&&(p=t.tmp.group_context.value()[5]),n=1,r=a.length;r>n;n+=1){var d=0;a[n].match(c)&&(d=1);var f=s.STATUTE_SUBDIV_STRINGS[u[n-1].replace(/^\s*/,"")],m=p;i.section_label_count>n&&i.section_form_override&&(m=i.section_form_override),o.push(t.getTerm(f,m,d)),o.push(a[n].replace(/^\s*/,""))}h=o.join(" "),h=h.replace(/\\/,"","g"),t.output.append(h,this)}else h=t.fun.page_mangler(i.locator),h=h.replace(/\\/,"","g"),t.output.append(h,this);else{var g=this;(!t.tmp.shadow_numbers[l]||t.tmp.shadow_numbers[l].values.length&&t.tmp.shadow_numbers[l].values[0][2]===!1)&&("locator"===l?t.processNumber(g,i,l,e.type):t.processNumber(g,e,l,e.type));var b,y=t.tmp.shadow_numbers[l].values,v="",_="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(e.type)>-1&&"collection-number"===l&&(_="year"),("number"===l&&["bill","gazette","legislation","treaty"].indexOf(e.type)>-1||t.opt[_+"-range-format"])&&!this.strings.prefix&&!this.strings.suffix&&!this.strings.form)for(n=0,r=y.length;r>n;n+=1)v+=y[n][1];if(v&&!v.match(/^[\-.\u20130-9]+$/)){if("number"===l&&["bill","gazette","legislation","treaty"].indexOf(e.type)>-1){var x=v.split(/\s/)[0];if(x&&(o=[],u=v.match(s.STATUTE_SUBDIV_GROUPED_REGEX))){for(a=v.split(s.STATUTE_SUBDIV_PLAIN_REGEX),n=1,r=a.length;r>n;n+=1)o.push(t.getTerm(s.STATUTE_SUBDIV_STRINGS[u[n-1].replace(/^\s+/,"")],this.strings.label_form_override)),o.push(a[n].replace(/^\s+/,""));v=o.join(" ")}}t.output.append(v,this)}else if(y.length){for(t.output.openLevel("empty"),n=0,r=y.length;r>n;n+=1)b=new s[y[n][0]](y[n][1],y[n][2],e.id),n>0&&(b.strings.prefix=b.strings.prefix.replace(/^\s*/,"")),n<y.length-1&&(b.strings.suffix=b.strings.suffix.replace(/\s*$/,"")),"undefined"==typeof b.gender&&(b.gender=t.locale[t.opt.lang]["noun-genders"][l]),t.output.append(b,"literal",!1,!1,!0);t.output.closeLevel("empty")}}"locator"===l&&t.tmp.done_vars.push("locator"),t.parallel.CloseVariable("number")}}},this.execs.push(i),e.push(this),s.Util.substituteEnd.call(this,t,e)}},s.Node.sort={build:function(t,e){if(e=t[t.build.root+"_sort"].tokens,this.tokentype===s.START){"citation"===t.build.area&&(t.parallel.use_parallels=!1,t.opt.sort_citations=!0),t.build.area=t.build.root+"_sort",t.build.extension="_sort";var i=function(t,e){if(t.opt.has_layout_locale){for(var i,n=s.localeResolve(e.language,t.opt["default-locale"][0]),r=t[t.tmp.area.slice(0,-5)].opt.sort_locales,o=0,a=r.length;a>o&&(i=r[o][n.bare],i||(i=r[o][n.best]),!i);o+=1);i||(i=t.opt["default-locale"][0]),t.tmp.lang_sort_hold=t.opt.lang,t.opt.lang=i}};this.execs.push(i)}if(this.tokentype===s.END){t.build.area=t.build.root,t.build.extension="";var i=function(t,e){t.opt.has_layout_locale&&(t.opt.lang=t.tmp.lang_sort_hold,delete t.tmp.lang_sort_hold)};this.execs.push(i)}e.push(this)}},s.Node.substitute={build:function(t,e){var i;this.tokentype===s.START&&(i=function(t,e){t.tmp.can_block_substitute=!0,t.tmp.value.length&&t.tmp.can_substitute.replace(!1,s.LITERAL)},this.execs.push(i)),e.push(this)}},s.Node.text={build:function(t,e){var i,n,r,o,a,l,u,c,h,p,d,f,m,g,b;if(this.postponed_macro)return s.expandMacro.call(t,this);if(s.Util.substituteStart.call(this,t,e),this.variables_real||(this.variables_real=[]),this.variables||(this.variables=[]),n="long",r=0,this.strings.form&&(n=this.strings.form),this.strings.plural&&(r=this.strings.plural),"citation-number"===this.variables_real[0]||"year-suffix"===this.variables_real[0]||"citation-label"===this.variables_real[0])"citation-number"===this.variables_real[0]?("citation"===t.build.root&&(t.opt.update_mode=s.NUMERIC),"bibliography"===t.build.root&&(t.opt.bib_mode=s.NUMERIC),"bibliography_sort"===t.build.area&&(t.opt.citation_number_sort_used=!0),"citation-number"===t[t.tmp.area].opt.collapse&&(this.range_prefix=t.getTerm("citation-range-delimiter")),this.successor_prefix=t[t.build.area].opt.layout_delimiter,this.splice_prefix=t[t.build.area].opt.layout_delimiter,i=function(t,e,i){if(o=""+e.id,!t.tmp.just_looking){if(i&&i["author-only"]){t.tmp.element_trace.replace("do-not-suppress-me");var n=t.getTerm("reference","long","singular");"undefined"==typeof n&&(n="reference"),f=s.Output.Formatters["capitalize-first"](t,n),t.output.append(f+" "),t.tmp.last_element_trace=!0}i&&i["suppress-author"]&&(t.tmp.last_element_trace&&t.tmp.element_trace.replace("suppress-me"),t.tmp.last_element_trace=!1),a=t.registry.registry[o].seq,t.opt.citation_number_slug?t.output.append(t.opt.citation_number_slug,this):(l=new s.NumericBlob(a,this,e.id),t.output.append(l,"literal"))}},this.execs.push(i)):"year-suffix"===this.variables_real[0]?(t.opt.has_year_suffix=!0,"year-suffix-ranged"===t[t.tmp.area].opt.collapse&&(this.range_prefix=t.getTerm("citation-range-delimiter")),this.successor_prefix=t[t.build.area].opt.layout_delimiter,t[t.tmp.area].opt["year-suffix-delimiter"]&&(this.successor_prefix=t[t.build.area].opt["year-suffix-delimiter"]),i=function(t,e){if(t.registry.registry[e.id]&&t.registry.registry[e.id].disambig.year_suffix!==!1&&!t.tmp.just_looking){for(a=parseInt(t.registry.registry[e.id].disambig.year_suffix,10),l=new s.NumericBlob(a,this,e.id),u=new s.Util.Suffixator(s.SUFFIX_CHARS),l.setFormatter(u),t.output.append(l,"literal"),c=!1,m=t.tmp.group_context.mystack.length,g=0;m>g;g+=1)if(b=t.tmp.group_context.mystack[g],!b[2]&&(b[1]||!b[1]&&!b[0])){c=!0;break}h=t[t.tmp.area].opt["year-suffix-delimiter"],c&&h&&!t.tmp.sort_key_flag&&(t.tmp.splice_delimiter=t[t.tmp.area].opt["year-suffix-delimiter"])}},this.execs.push(i)):"citation-label"===this.variables_real[0]&&(t.opt.has_year_suffix=!0,i=function(t,e){p=e["citation-label"],p||(p=t.getCitationLabel(e)),t.tmp.just_looking||(d="",t.registry.registry[e.id]&&t.registry.registry[e.id].disambig.year_suffix!==!1&&(a=parseInt(t.registry.registry[e.id].disambig.year_suffix,10),d=t.fun.suffixator.format(a)),p+=d),t.output.append(p,this)},this.execs.push(i));else if(this.strings.term)i=function(t,e,i){var o=t.opt.gender[e.type],a=this.strings.term;a=t.getTerm(a,n,r,o,!1,"accessed"===a);var l;if(""!==a&&(b=t.tmp.group_context.value(),b[0]=!0,t.tmp.group_context.replace(b)),l=t.tmp.term_predecessor||"in-text"===t.opt["class"]&&"citation"===t.tmp.area?a:s.Output.Formatters["capitalize-first"](t,a),t.tmp.strip_periods)l=l.replace(/\./g,"");else for(var u=0,c=this.decorations.length;c>u;u+=1)if("@strip-periods"===this.decorations[u][0]&&"true"===this.decorations[u][1]){l=l.replace(/\./g,"");break}t.output.append(l,this)},this.execs.push(i),t.build.term=!1,t.build.form=!1,t.build.plural=!1;else if(this.variables_real.length){if(i=function(t,e,i){var s=this.variables[0];"title"!==s||"short"!==n&&!e["title-short"]||(s="title-short"),t.parallel.StartVariable(s),t.parallel.AppendToVariable(e[s],s)},this.execs.push(i),s.MULTI_FIELDS.indexOf(this.variables_real[0])>-1){var y=this.variables[0],v=!1,_=!1,x=!1;"short"===n?"container-title"===this.variables_real[0]?_="journalAbbreviation":"title"===this.variables_real[0]&&(_="title-short"):y=!1,t.build.extension?x=!0:(x=!0,v=!0),i=t.transform.getOutputFunction(this.variables,y,v,_,x)}else i=s.CITE_FIELDS.indexOf(this.variables_real[0])>-1?function(t,e,i){if(i&&i[this.variables[0]]){var n=""+i[this.variables[0]];n=n.replace(/([^\\])--*/g,"$1"+t.getTerm("page-range-delimiter")),n=n.replace(/\\-/g,"-"),t.output.append(n,this,!1,!1,!0),"locator-revision"===this.variables[0]&&t.tmp.done_vars.push("locator-revision")}}:"page-first"===this.variables_real[0]?function(t,e){var i;i=t.getVariable(e,"page-first",n),i&&(i=i.replace("\\",""),t.output.append(i,this,!1,!1,!0))}:"page"===this.variables_real[0]?function(t,e){var i=t.getVariable(e,"page",n);i&&(i=""+i,i=i.replace(/([^\\])--*/g,"$1"+t.getTerm("page-range-delimiter")),i=i.replace(/\\-/g,"-"),i=t.fun.page_mangler(i),t.output.append(i,this,!1,!1,!0))}:"volume"===this.variables_real[0]?function(t,e){if(this.variables[0]){var i=t.getVariable(e,this.variables[0],n);i&&t.output.append(i,this)}}:["URL","DOI"].indexOf(this.variables_real[0])>-1?function(t,e){var i;this.variables[0]&&(i=t.getVariable(e,this.variables[0],n),i&&(t.opt.development_extensions.wrap_url_and_doi?this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0]||(this.decorations=[["@"+this.variables[0],"true"]].concat(this.decorations)):this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0]&&(this.decorations=this.decorations.slice(1)),t.output.append(i,this,!1,!1,!0)))}:"section"===this.variables_real[0]?function(t,e){var i;i=t.getVariable(e,this.variables[0],n),i&&t.output.append(i,this)}:"hereinafter"===this.variables_real[0]?function(t,e){var i=t.transform.abbrevs["default"].hereinafter[e.id];i&&(t.output.append(i,this),t.tmp.group_context.value()[2]=!0)}:function(t,e){var i;this.variables[0]&&(i=t.getVariable(e,this.variables[0],n),i&&(i=""+i,i=i.replace("\\","","g"),t.output.append(i,this)))};this.execs.push(i),i=function(t,e){t.parallel.CloseVariable("text")},this.execs.push(i)}else this.strings.value&&(i=function(t,e){var i;i=t.tmp.group_context.value(),i[0]=!0,t.tmp.group_context.replace(i),t.output.append(this.strings.value,this)},this.execs.push(i));e.push(this),s.Util.substituteEnd.call(this,t,e)}},s.Attributes={},s.Attributes["@genre"]=function(t,e){e=e.replace("-"," ");var i=function(t,i){return e===t.genre?!0:!1};this.tests.push(i)},s.Attributes["@disambiguate"]=function(t,e){if("true"===e){t.opt.has_disambiguate=!0;var i=function(e,i){return t.tmp.disambiguate_maxMax+=1,t.tmp.disambig_settings.disambiguate&&t.tmp.disambiguate_count<t.tmp.disambig_settings.disambiguate?(t.tmp.disambiguate_count+=1,!0):!1};this.tests.push(i)}else if("check-ambiguity-and-backreference"===e){var i=function(e,i){return t.registry.registry[e.id].disambig.disambiguate&&t.registry.registry[e.id]["citation-count"]>1?!0:!1};this.tests.push(i)}},s.Attributes["@is-numeric"]=function(t,e,i){for(var n=e.split(/\s+/),r=function(e){return function(i,n){var r=i;if(["locator","locator-revision"].indexOf(e)>-1&&(r=n),"undefined"==typeof r)return!1;if(s.NUMERIC_VARIABLES.indexOf(e)>-1){if(t.tmp.shadow_numbers[e]||t.processNumber(!1,r,e,i.type),r[e]&&t.tmp.shadow_numbers[e].numeric)return!0}else if(["title","locator-revision","version"].indexOf(e)>-1&&r[e]&&r[e].slice(-1)===""+parseInt(r[e].slice(-1),10))return!0;return!1}},o=0;o<n.length;o+=1)this.tests.push(r(n[o]))},s.Attributes["@is-uncertain-date"]=function(t,e){for(var i=e.split(/\s+/),n=function(t){return function(e,i){return e[t]&&e[t].circa?!0:!1}},s=0,r=i.length;r>s;s+=1)this.tests.push(n(i[s]))},s.Attributes["@locator"]=function(t,e){var i=e.replace("sub verbo","sub-verbo");i=i.split(/\s+/);for(var n=function(t){return function(e,i){var n;return n="undefined"!=typeof i&&i.label?"sub verbo"===i.label?"sub-verbo":i.label:"page",t===n?!0:!1}},s=0,r=i.length;r>s;s+=1)this.tests.push(n(i[s]))},s.Attributes["@position"]=function(t,e){var i;t.opt.update_mode=s.POSITION,t.parallel.use_parallels=!0;for(var n=e.split(/\s+/),r=function(e){return function(i,n){if("bibliography"===t.tmp.area)return!1;if(n&&"undefined"==typeof n.position&&(n.position=0),n&&"number"==typeof n.position){if(0===n.position&&0===e)return!0;if(e>0&&n.position>=e)return!0}else if(0===e)return!0;return!1}},o=0,a=n.length;a>o;o+=1){var i=n[o];"first"===i?i=s.POSITION_FIRST:"subsequent"===i?i=s.POSITION_SUBSEQUENT:"ibid"===i?i=s.POSITION_IBID:"ibid-with-locator"===i&&(i=s.POSITION_IBID_WITH_LOCATOR),"near-note"===i?this.tests.push(function(t,e){return e&&e.position>=s.POSITION_SUBSEQUENT&&e["near-note"]?!0:!1}):this.tests.push(r(i))}},s.Attributes["@type"]=function(t,e){for(var i=e.split(/\s+/),n=function(t){return function(e,i){var n=e.type===t;return n?!0:!1}},s=[],r=0,o=i.length;o>r;r+=1)s.push(n(i[r]));this.tests.push(t.fun.match.any(this,t,s))},s.Attributes["@variable"]=function(t,e){var i,n,r,o;if(this.variables=e.split(/\s+/),this.variables_real=this.variables.slice(),"label"===this.name&&this.variables[0])this.strings.term=this.variables[0];else if(["names","date","text","number"].indexOf(this.name)>-1)i=function(t,e,i){n=this.variables_real.slice();for(var s=this.variables.length-1;s>-1;s+=-1)this.variables.pop();for(r=n.length,o=0;r>o;o+=1)-1!==t.tmp.done_vars.indexOf(n[o])||i&&"legal_case"===e.type&&i["suppress-author"]&&"title"===n[o]||this.variables.push(n[o]),t.tmp.can_block_substitute&&t.tmp.done_vars.push(n[o])},this.execs.push(i),i=function(t,e,i){var n,a;for(n=!1,r=this.variables.length,o=0;r>o;o+=1){if(a=this.variables[o],"authority"===a&&"string"==typeof e[a]&&"names"===this.name){var l={family:e[a],isInstitution:!0,multi:{_key:{}}};if(e.multi&&e.multi._keys&&e.multi._keys[a])for(var u in e.multi._keys[a])creatorChild={family:e.multi._keys[a][u],isInstitution:!0},l.multi._key[u]=creatorChild;e[a]=[l]}if("short"!==this.strings.form||e[a]||("title"===a?a="title-short":"container-title"===a&&(a="journalAbbreviation")),"year-suffix"===a){n=!0;break}if(s.DATE_VARIABLES.indexOf(a)>-1){if(t.opt.development_extensions.locator_date_and_revision&&"locator-date"===a){n=!0;break}if(e[a]){for(var c in e[a])if((-1!==this.dateparts.indexOf(c)||"literal"===c)&&e[a][c]){n=!0;break}if(n)break}}else{if("locator"===a){i&&i.locator&&(n=!0);break}if("locator-revision"===a){i&&i["locator-revision"]&&(n=!0);break}if(["citation-number","citation-label"].indexOf(a)>-1){n=!0;break}if("first-reference-note-number"===a){i&&i["first-reference-note-number"]&&(n=!0);break}if("hereinafter"===a){t.transform.abbrevs["default"].hereinafter[e.id]&&t.sys.getAbbreviation&&e.id&&(n=!0);break}if("object"==typeof e[a]){e[a].length;break}if("string"==typeof e[a]&&e[a]){n=!0;break}if("number"==typeof e[a]){n=!0;break}}if(n)break}var h=t.tmp.group_context.value();n?(("citation-number"!==a||"bibliography"!==t.tmp.area)&&(t.tmp.cite_renders_content=!0),h[2]=!0,t.tmp.group_context.replace(h),t.tmp.can_substitute.value()&&"bibliography"===t.tmp.area&&"string"==typeof e[a]&&t.tmp.rendered_name.push(e[a]),t.tmp.can_substitute.replace(!1,s.LITERAL)):h[1]=!0},this.execs.push(i);else if(["if","else-if","condition"].indexOf(this.name)>-1)for(var a=function(e){return function(i,n){var s=i;if(n&&["locator","locator-revision","first-reference-note-number","locator-date"].indexOf(e)>-1&&(s=n),"hereinafter"===e&&t.sys.getAbbreviation&&s.id){if(t.transform.abbrevs["default"].hereinafter[s.id])return!0}else if(s[e]){if("number"==typeof s[e]||"string"==typeof s[e])return!0;if("object"==typeof s[e])for(key in s[e])if(s[e][key])return!0}return!1}},l=0,u=this.variables.length;u>l;l+=1)this.tests.push(a(this.variables[l]))},s.Attributes["@page"]=function(t,e){var i=e.replace("sub verbo","sub-verbo");i=i.split(/\s+/);for(var n=function(e){return function(i,n){var s;return t.processNumber(!1,i,"page",i.type),s=t.tmp.shadow_numbers.page.label?"sub verbo"===t.tmp.shadow_numbers.page.label?"sub-verbo":t.tmp.shadow_numbers.page.label:"page",e===s?!0:!1}},s=0,r=i.length;r>s;s+=1)this.tests.push(n(i[s]))},s.Attributes["@jurisdiction"]=function(t,e){for(var i=e.split(/\s+/),n=0,s=i.length;s>n;n+=1)i[n]=i[n].split(";");for(var r=function(t){return function(e,i){if(!e.jurisdiction)return!1;for(var n=e.jurisdiction.split(";"),s=0,r=n.length;r>s;s+=1)n[s]=n[s].split(";");for(s=t.length;s>0;s+=-1){var o=t.slice(0,s).join(";"),a=n.slice(0,s).join(";");if(o!==a)return!1}return!0}},n=0,s=i.length;s>n;n+=1){var o=i[n].slice();this.tests.push(r(o))}},s.Attributes["@context"]=function(t,e){var i=function(i,n){var s=t.tmp.area.slice(0,e.length);return s===e?!0:!1};this.tests.push(i)},s.Attributes["@has-year-only"]=function(t,e){for(var i=e.split(/\s+/),n=function(t){return function(e,i){var n=e[t];return!n||n.month||n.season?!1:!0}},s=0,r=i.length;r>s;s+=1)this.tests.push(n(i[s]))},s.Attributes["@has-to-month-or-season"]=function(t,e){for(var i=e.split(/\s+/),n=function(t){return function(e,i){var n=e[t];return!n||!n.month&&!n.season||n.day?!1:!0}},s=0,r=i.length;r>s;s+=1)this.tests.push(n(i[s]))},s.Attributes["@has-day"]=function(t,e){for(var i=e.split(/\s+/),n=function(t){return function(e,i){var n=e[t];return n&&n.day?!0:!1}},s=0,r=i.length;r>s;s+=1)this.tests.push(n(i[s]))},s.Attributes["@subjurisdictions"]=function(t,e){var i=parseInt(e,10),n=function(t,e){var n=0;return t.jurisdiction&&(n=t.jurisdiction.split(";").length),n&&(n+=-1),n>=i?!0:!1};this.tests.push(n)},s.Attributes["@is-plural"]=function(t,e){var i=function(t,i){var n=t[e];if(n&&n.length){for(var s=0,r=0,o=!1,a=0,l=n.length;l>a;a+=1)n[a].isInstitution&&(n[a].literal||n[a].family&&!n[a].given)?(r+=1,o=!1):(s+=1,o=!0);if(s>1)return!0;if(r>1)return!0;if(r&&o)return!0}return!1};this.tests.push(i)},s.Attributes["@locale"]=function(t,e){var i,n,r,o,a,l,u=t.opt["default-locale"][0];if("layout"===this.name){if(this.locale_raw=e,this.tokentype===s.START){var c=e.split(/\s+/),h={},p=s.localeResolve(c[0],u);p.generic?h[p.generic]=p.best:h[p.best]=p.best;for(var a=1,l=c.length;l>a;a+=1){var d=s.localeResolve(c[a],u);d.generic?h[d.generic]=p.best:h[d.best]=p.best}t[t.build.area].opt.sort_locales.push(h)}t.opt.has_layout_locale=!0}else{o=e.split(/\s+/);var f=[];for(a=0,l=o.length;l>a;a+=1)r=o[a],n=s.localeResolve(r,u),2===o[a].length&&f.push(n.bare),t.localeConfigure(n,!0),o[a]=n;var m=o.slice(),g=function(t,e,n){return function(r,o){var u;i=[],u=!1;var c,h=!1;for(c=r.language?r.language:e,h=s.localeResolve(c,e),a=0,l=t.length;l>a;a+=1)if(h.best===t[a].best){u=!0;break}return!u&&n.indexOf(h.bare)>-1&&(u=!0),u}};this.tests.push(g(m,u,f))}},s.Attributes["@locale-internal"]=function(t,e){var i,n,r,o,a,l;for(o=e.split(/\s+/),this.locale_bares=[],a=0,l=o.length;l>a;a+=1)r=o[a],n=s.localeResolve(r,t.opt["default-locale"][0]),2===o[a].length&&this.locale_bares.push(n.bare),t.localeConfigure(n),o[a]=n;this.locale_default=t.opt["default-locale"][0],this.locale=o[0].best,this.locale_list=o.slice();var u=function(e){return function(n,o){var u;i=[],u=!1;var c=!1;if(n.language&&(r=n.language,c=s.localeResolve(r,t.opt["default-locale"][0]),c.best===t.opt["default-locale"][0]&&(c=!1)),c){for(a=0,l=e.locale_list.length;l>a;a+=1)if(c.best===e.locale_list[a].best){t.opt.lang=e.locale,t.tmp.last_cite_locale=e.locale,t.output.openLevel("empty"),t.output.current.value().new_locale=e.locale,u=!0;break}!u&&e.locale_bares.indexOf(c.bare)>-1&&(t.opt.lang=e.locale,t.tmp.last_cite_locale=e.locale,t.output.openLevel("empty"),t.output.current.value().new_locale=e.locale,u=!0)}return u}},c=this;this.tests.push(u(c))},s.Attributes["@is-parallel"]=function(t,e){for(var i=e.split(" "),n=0,s=i.length;s>n;n+=1)"true"===i[n]?i[n]=!0:"false"===i[n]&&(i[n]=!1);this.strings.set_parallel_condition=i},s.Attributes["@gender"]=function(t,e){this.gender=e},s.Attributes["@cslid"]=function(t,e){this.cslid=parseInt(e,10)},s.Attributes["@label-form"]=function(t,e){this.strings.label_form_override=e},s.Attributes["@part-separator"]=function(t,e){this.strings["part-separator"]=e},s.Attributes["@leading-noise-words"]=function(t,e){this["leading-noise-words"]=e},s.Attributes["@name-never-short"]=function(t,e){this["name-never-short"]=e},s.Attributes["@class"]=function(t,e){t.opt["class"]=e},s.Attributes["@version"]=function(t,e){t.opt.version=e},s.Attributes["@value"]=function(t,e){this.strings.value=e},s.Attributes["@name"]=function(t,e){this.strings.name=e},s.Attributes["@form"]=function(t,e){this.strings.form=e},s.Attributes["@date-parts"]=function(t,e){this.strings["date-parts"]=e},s.Attributes["@range-delimiter"]=function(t,e){this.strings["range-delimiter"]=e},s.Attributes["@macro"]=function(t,e){this.postponed_macro=e},s.Attributes["@term"]=function(t,e){"sub verbo"===e?this.strings.term="sub-verbo":this.strings.term=e},s.Attributes["@xmlns"]=function(t,e){},s.Attributes["@lang"]=function(t,e){e&&(t.build.lang=e)},s.Attributes["@lingo"]=function(t,e){},s.Attributes["@macro-has-date"]=function(t,e){this["macro-has-date"]=!0},s.Attributes["@suffix"]=function(t,e){this.strings.suffix=e},s.Attributes["@prefix"]=function(t,e){this.strings.prefix=e},s.Attributes["@delimiter"]=function(t,e){"name"==this.name?this.strings.name_delimiter=e:this.strings.delimiter=e},s.Attributes["@match"]=function(t,e){this.match=e},s.Attributes["@names-min"]=function(t,e){var i=parseInt(e,10);t[t.tmp.area].opt.max_number_of_names<i&&(t[t.tmp.area].opt.max_number_of_names=i),this.strings["et-al-min"]=i},s.Attributes["@names-use-first"]=function(t,e){this.strings["et-al-use-first"]=parseInt(e,10)},s.Attributes["@names-use-last"]=function(t,e){"true"===e?this.strings["et-al-use-last"]=!0:this.strings["et-al-use-last"]=!1},s.Attributes["@sort"]=function(t,e){"descending"===e&&(this.strings.sort_direction=s.DESCENDING)},s.Attributes["@plural"]=function(t,e){"always"===e||"true"===e?this.strings.plural=1:"never"===e||"false"===e?this.strings.plural=0:"contextual"===e&&(this.strings.plural=!1)},s.Attributes["@number"]=function(t,e){var i,n=e.replace("sub verbo","sub-verbo");n=n.split(/\s+/),["if","else-if"].indexOf(this.name)>-1&&(i=function(t,e,i){var s,r=[];t.processNumber(!1,e,"number",e.type),s=t.tmp.shadow_numbers.number.label?"sub verbo"===t.tmp.shadow_numbers.number.label?"sub-verbo":t.tmp.shadow_numbers.number.label:"number";for(var o=0,a=n.length;a>o;o+=1)n[o]===s?r.push(!0):r.push(!1);return r},this.tests.push(i))},s.Attributes["@has-publisher-and-publisher-place"]=function(t,e){this.strings["has-publisher-and-publisher-place"]=!0},s.Attributes["@publisher-delimiter-precedes-last"]=function(t,e){this.strings["publisher-delimiter-precedes-last"]=e},s.Attributes["@publisher-delimiter"]=function(t,e){this.strings["publisher-delimiter"]=e},s.Attributes["@publisher-and"]=function(t,e){this.strings["publisher-and"]=e},s.Attributes["@newdate"]=function(t,e){},s.Attributes["@givenname-disambiguation-rule"]=function(t,e){s.GIVENNAME_DISAMBIGUATION_RULES.indexOf(e)>-1&&(t.citation.opt["givenname-disambiguation-rule"]=e)},s.Attributes["@collapse"]=function(t,e){e&&(t[this.name].opt.collapse=e)},s.Attributes["@cite-group-delimiter"]=function(t,e){e&&(t[t.tmp.area].opt.cite_group_delimiter=e)},s.Attributes["@names-delimiter"]=function(t,e){t.setOpt(this,"names-delimiter",e)},s.Attributes["@name-form"]=function(t,e){t.setOpt(this,"name-form",e)},s.Attributes["@subgroup-delimiter"]=function(t,e){this.strings["subgroup-delimiter"]=e},s.Attributes["@subgroup-delimiter-precedes-last"]=function(t,e){this.strings["subgroup-delimiter-precedes-last"]=e},s.Attributes["@name-delimiter"]=function(t,e){t.setOpt(this,"name-delimiter",e)},s.Attributes["@et-al-min"]=function(t,e){var i=parseInt(e,10);t[t.tmp.area].opt.max_number_of_names<i&&(t[t.tmp.area].opt.max_number_of_names=i),t.setOpt(this,"et-al-min",i)},s.Attributes["@et-al-use-first"]=function(t,e){t.setOpt(this,"et-al-use-first",parseInt(e,10))},s.Attributes["@et-al-use-last"]=function(t,e){"true"===e?t.setOpt(this,"et-al-use-last",!0):t.setOpt(this,"et-al-use-last",!1)},s.Attributes["@et-al-subsequent-min"]=function(t,e){var i=parseInt(e,10);t[t.tmp.area].opt.max_number_of_names<i&&(t[t.tmp.area].opt.max_number_of_names=i),t.setOpt(this,"et-al-subsequent-min",i)},s.Attributes["@et-al-subsequent-use-first"]=function(t,e){t.setOpt(this,"et-al-subsequent-use-first",parseInt(e,10))},s.Attributes["@suppress-min"]=function(t,e){this.strings["suppress-min"]=parseInt(e,10)},s.Attributes["@suppress-max"]=function(t,e){this.strings["suppress-max"]=parseInt(e,10)},s.Attributes["@and"]=function(t,e){t.setOpt(this,"and",e)},s.Attributes["@delimiter-precedes-last"]=function(t,e){t.setOpt(this,"delimiter-precedes-last",e)},s.Attributes["@delimiter-precedes-et-al"]=function(t,e){t.setOpt(this,"delimiter-precedes-et-al",e)},s.Attributes["@initialize-with"]=function(t,e){t.setOpt(this,"initialize-with",e)},s.Attributes["@initialize"]=function(t,e){"false"===e&&t.setOpt(this,"initialize",!1)},s.Attributes["@name-as-reverse-order"]=function(t,e){this["name-as-reverse-order"]=e},s.Attributes["@name-as-sort-order"]=function(t,e){"style-options"===this.name?this["name-as-sort-order"]=e:t.setOpt(this,"name-as-sort-order",e)},s.Attributes["@sort-separator"]=function(t,e){t.setOpt(this,"sort-separator",e)},s.Attributes["@year-suffix-delimiter"]=function(t,e){t[this.name].opt["year-suffix-delimiter"]=e},s.Attributes["@after-collapse-delimiter"]=function(t,e){t[this.name].opt["after-collapse-delimiter"]=e},s.Attributes["@subsequent-author-substitute"]=function(t,e){t[this.name].opt["subsequent-author-substitute"]=e},s.Attributes["@subsequent-author-substitute-rule"]=function(t,e){t[this.name].opt["subsequent-author-substitute-rule"]=e},s.Attributes["@disambiguate-add-names"]=function(t,e){"true"===e&&(t.opt["disambiguate-add-names"]=!0)},s.Attributes["@disambiguate-add-givenname"]=function(t,e){"true"===e&&(t.opt["disambiguate-add-givenname"]=!0)},s.Attributes["@disambiguate-add-year-suffix"]=function(t,e){"true"===e&&"numeric"!==t.opt.xclass&&(t.opt["disambiguate-add-year-suffix"]=!0)},s.Attributes["@second-field-align"]=function(t,e){("flush"===e||"margin"===e)&&(t[this.name].opt["second-field-align"]=e)},s.Attributes["@hanging-indent"]=function(t,e){"true"===e&&(t[this.name].opt.hangingindent=2)},s.Attributes["@line-spacing"]=function(t,e){e&&e.match(/^[.0-9]+$/)&&(t[this.name].opt["line-spacing"]=parseFloat(e,10))},s.Attributes["@entry-spacing"]=function(t,e){e&&e.match(/^[.0-9]+$/)&&(t[this.name].opt["entry-spacing"]=parseFloat(e,10))},s.Attributes["@near-note-distance"]=function(t,e){t[this.name].opt["near-note-distance"]=parseInt(e,10)},s.Attributes["@text-case"]=function(t,e){var i=function(t,i){if("normal"===e)this.text_case_normal=!0;else if(this.strings["text-case"]=e,"title"===e){t.opt["default-locale"][0].slice(0,2);i.jurisdiction&&(this.strings["text-case"]="passthrough")}};this.execs.push(i)},s.Attributes["@page-range-format"]=function(t,e){t.opt["page-range-format"]=e},s.Attributes["@year-range-format"]=function(t,e){t.opt["year-range-format"]=e},s.Attributes["@default-locale"]=function(t,e){var i,n,s,r,o;if(r=e.match(/-x-(sort|translit|translat)-/g))for(s=0,n=r.length;n>s;s+=1)r[s]=r[s].replace(/^-x-/,"").replace(/-$/,"");for(i=e.split(/-x-(?:sort|translit|translat)-/),o=[i[0]],s=1,n=i.length;n>s;s+=1)o.push(r[s-1]),o.push(i[s]);for(i=o.slice(),n=i.length,s=1;n>s;s+=2)t.opt["locale-"+i[s]].push(i[s+1].replace(/^\s*/g,"").replace(/\s*$/g,""));i.length?t.opt["default-locale"]=i.slice(0,1):t.opt["default-locale"]=["en"]},s.Attributes["@default-locale-sort"]=function(t,e){t.opt["default-locale-sort"]=e},s.Attributes["@demote-non-dropping-particle"]=function(t,e){t.opt["demote-non-dropping-particle"]=e},s.Attributes["@initialize-with-hyphen"]=function(t,e){"false"===e&&(t.opt["initialize-with-hyphen"]=!1)},s.Attributes["@institution-parts"]=function(t,e){this.strings["institution-parts"]=e},s.Attributes["@if-short"]=function(t,e){"true"===e&&(this.strings["if-short"]=!0)},s.Attributes["@substitute-use-first"]=function(t,e){this.strings["substitute-use-first"]=parseInt(e,10)},s.Attributes["@use-first"]=function(t,e){this.strings["use-first"]=parseInt(e,10)},s.Attributes["@stop-last"]=function(t,e){this.strings["stop-last"]=-1*parseInt(e,10)},s.Attributes["@oops"]=function(t,e){this.strings.oops=e},s.Attributes["@use-last"]=function(t,e){this.strings["use-last"]=parseInt(e,10)},s.Attributes["@reverse-order"]=function(t,e){"true"===e&&(this.strings["reverse-order"]=!0)},s.Attributes["@display"]=function(t,e){this.strings.cls=e},s.Stack=function(t,e){this.mystack=[],(e||t)&&this.mystack.push(t)},s.Stack.prototype.push=function(t,e){e||t?this.mystack.push(t):this.mystack.push("")},s.Stack.prototype.clear=function(){this.mystack=[]},s.Stack.prototype.replace=function(t,e){if(0===this.mystack.length)throw"Internal CSL processor error: attempt to replace nonexistent stack item with "+t;e||t?this.mystack[this.mystack.length-1]=t:this.mystack[this.mystack.length-1]=""},s.Stack.prototype.pop=function(){return this.mystack.pop()},s.Stack.prototype.value=function(){return this.mystack.slice(-1)[0]},s.Stack.prototype.length=function(){return this.mystack.length},s.Parallel=function(t){this.state=t,this.sets=new s.Stack([]),this.try_cite=!0,this.use_parallels=!1,this.midVars=["section","volume","container-title","collection-number","issue","page-first","page","number"],this.ignoreVarsLawGeneral=["first-reference-note-number","locator","label","page-first","page","genre"],
this.ignoreVarsLawProceduralHistory=["issued","first-reference-note-number","locator","label","page-first","page","genre","jurisdiction"],this.ignoreVarsOrders=["first-reference-note-number"],this.ignoreVarsOther=["first-reference-note-number","locator","label","section","page-first","page"]},s.Parallel.prototype.isMid=function(t){return this.midVars.indexOf(t)>-1},s.Parallel.prototype.StartCitation=function(t,e){this.parallel_conditional_blobs_list=[],this.use_parallels&&(this.sortedItems=t,this.sortedItemsPos=-1,this.sets.clear(),this.sets.push([]),this.in_series=!0,this.delim_counter=0,this.delim_pointers=[],e?this.out=e:this.out=this.state.output.queue,this.master_was_neutral_cite=!0)},s.Parallel.prototype.StartCite=function(t,e,i){var n,r,o,a,l,u,c,h;if(this.use_parallels){this.sets.value().length&&this.sets.value()[0].itemId==t.id&&this.ComposeSet(),this.sortedItemsPos+=1,e&&(n=e.position),this.try_cite=!0;for(var p=!1,d=0,f=s.PARALLEL_MATCH_VARS.length;f>d;d+=1)if(t[s.PARALLEL_MATCH_VARS[d]]){p=!0;break}var m=!0,g=this.sets.value().slice(-1)[0];if(g&&g.Item&&(g.Item.title!==t.title?m=!1:g.Item.type!==t.type?m=!1:["article-journal","article-magazine"].indexOf(t.type)>-1&&(this.state.opt.development_extensions.handle_parallel_articles&&g.Item["container-title"]===t["container-title"]||(m=!1))),m&&p&&-1!==s.PARALLEL_TYPES.indexOf(t.type)||(this.try_cite=!0,this.in_series&&(this.in_series=!1)),this.cite={},this.cite.front=[],this.cite.mid=[],this.cite.back=[],this.cite.front_collapse={},this.cite.back_forceme=[],this.cite.position=n,this.cite.Item=t,this.cite.itemId=""+t.id,this.cite.prevItemID=""+i,this.target="front",["treaty"].indexOf(t.type)>-1)this.ignoreVars=this.ignoreVarsOrders;else if(["article-journal","article-magazine"].indexOf(t.type)>-1)this.ignoreVars=this.ignoreVarsOther;else if(e&&e.prefix){this.ignoreVars=this.ignoreVarsLawProceduralHistory,this.cite.useProceduralHistory=!0;var b=this.sets.value()[this.sets.value().length-1];if(b&&b.back)for(var d=b.back.length-1;d>-1;d+=-1)b.back[d]&&b[b.back[d]]&&delete b[b.back[d]]}else this.ignoreVars=this.ignoreVarsLawGeneral;if(this.sortedItems&&this.sortedItemsPos>0&&this.sortedItemsPos<this.sortedItems.length){if(a=this.sortedItems[this.sortedItemsPos][1],u=""+this.sortedItems[this.sortedItemsPos-1][1].id,l=this.state.registry.registry[u].parallel,c=!1,l==a.id){for(r=this.sortedItemsPos-1,o=r;o>-1;o+=-1)if(this.sortedItems[o][1].id==t.id){c=this.sortedItems[o][1].locator;break}h=this.sortedItems[this.sortedItemsPos][1].locator,!c&&h?a.position=s.POSITION_IBID_WITH_LOCATOR:h===c?a.position=s.POSITION_IBID:a.position=s.POSITION_IBID_WITH_LOCATOR}}else{if(!this.state.registry.registry[t.id])return this.try_cite=!1,void(this.force_collapse=!1);this.state.registry.registry[t.id].parallel=!1}this.force_collapse=!1,this.state.registry.registry[t.id].parallel&&(this.force_collapse=!0)}},s.Parallel.prototype.StartVariable=function(t,e){if(this.use_parallels&&(this.try_cite||this.force_collapse)){if("names"===t?this.variable=t+":"+this.target:this.variable=t,this.ignoreVars.indexOf(t)>-1)return;"container-title"===t&&0===this.sets.value().length&&(this.master_was_neutral_cite=!1),this.data={},this.data.value="",this.data.blobs=[];var i=this.isMid(t);"authority"===e&&"names:front"===this.variable?(this.try_cite=!0,this.in_series=!1):"front"===this.target&&i?this.target="mid":"mid"===this.target&&!i&&this.cite.Item.title&&"names"!==t?this.target="back":"back"===this.target&&i&&(this.try_cite=!0,this.in_series=!1),"number"===t?this.cite.front.push(this.variable):s.PARALLEL_COLLAPSING_MID_VARSET.indexOf(t)>-1?["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1?this.cite.mid.push(this.variable):this.cite.front.push(this.variable):this.cite[this.target].push(this.variable)}},s.Parallel.prototype.AppendBlobPointer=function(t){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if(this.use_parallels&&(this.force_collapse||this.try_cite)){if(["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1){if(["volume","page","page-first","issue"].indexOf(this.variable)>-1)return;if("container-title"===this.variable&&this.cite.mid.length>1)return}this.variable&&(this.try_cite||this.force_collapse)&&t&&t.blobs&&(this.cite.useProceduralHistory&&"back"===this.target||this.data.blobs.push([t,t.blobs.length]))}}},s.Parallel.prototype.AppendToVariable=function(t,e){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if(this.try_cite||this.force_collapse)if("back"!==this.target,0){var i=this.sets.value()[this.sets.value().length-1];i&&i[this.variable]&&i[this.variable].value&&(this.data.value+="::"+t)}else this.data.value+="::"+t}},s.Parallel.prototype.CloseVariable=function(){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if((this.try_cite||this.force_collapse)&&(this.cite[this.variable]=this.data,this.sets.value().length>0)){var t=this.sets.value()[this.sets.value().length-1];"front"===this.target&&"issued"===this.variable&&this.data.value&&this.master_was_neutral_cite&&(this.target="mid"),"front"===this.target?!t[this.variable]&&!this.data.value||t[this.variable]&&this.data.value===t[this.variable].value||"issued"!==this.variable&&(this.in_series=!1):"mid"===this.target?s.PARALLEL_COLLAPSING_MID_VARSET.indexOf(this.variable)>-1&&(t[this.variable]&&t[this.variable].value===this.data.value?this.cite.front_collapse[this.variable]=!0:this.cite.front_collapse[this.variable]=!1):"back"===this.target&&t[this.variable]&&this.data.value!==t[this.variable].value&&-1===this.sets.value().slice(-1)[0].back_forceme.indexOf(this.variable)&&(this.in_series=!1)}this.variable=!1}},s.Parallel.prototype.CloseCite=function(){var t,e,i,n,s,r,o;if(this.use_parallels&&(this.force_collapse||this.try_cite)){if(n=!1,this.cite.front_collapse["container-title"]||(n=!0),this.cite.front_collapse.volume===!1&&(n=!0),this.cite.front_collapse["collection-number"]===!1&&(n=!0),this.cite.front_collapse.section===!1&&(n=!0),n&&(this.cite.use_journal_info=!0,o=this.cite.front.indexOf("section"),o>-1&&(this.cite.front=this.cite.front.slice(0,o).concat(this.cite.front.slice(o+1))),s=this.cite.front.indexOf("volume"),s>-1&&(this.cite.front=this.cite.front.slice(0,s).concat(this.cite.front.slice(s+1))),r=this.cite.front.indexOf("container-title"),r>-1&&(this.cite.front=this.cite.front.slice(0,r).concat(this.cite.front.slice(r+1))),collection_number_pos=this.cite.front.indexOf("collection-number"),collection_number_pos>-1&&(this.cite.front=this.cite.front.slice(0,collection_number_pos).concat(this.cite.front.slice(collection_number_pos+1)))),this.in_series||this.force_collapse||this.ComposeSet(!0),0===this.sets.value().length){for(has_date=!1,e=0,i=this.cite.back.length;i>e;e+=1)if(t=this.cite.back[e],"issued"===t&&this.cite.issued&&this.cite.issued.value){has_date=!0;break}has_date||this.cite.back_forceme.push("issued")}else{var a=this.cite.front.indexOf("issued");if((-1===a||this.master_was_neutral_cite)&&(this.cite.back_forceme=this.sets.value().slice(-1)[0].back_forceme),a>-1){var l=this.sets.value()[this.sets.value().length-1];l.issued||(this.cite.front=this.cite.front.slice(0,a).concat(this.cite.front.slice(a+1)))}this.master_was_neutral_cite&&this.cite.mid.indexOf("names:mid")>-1&&this.cite.front.push("names:mid")}this.sets.value().push(this.cite)}},s.Parallel.prototype.ComposeSet=function(t){var e,i,n;if(this.use_parallels&&(this.force_collapse||this.try_cite)){var r=this.sets.value().length;if(1===this.sets.value().length)this.in_series||(this.sets.value().pop(),this.delim_counter+=1);else{for(n=this.sets.value().length,i=0;n>i;i+=1)e=this.sets.value()[i],0===i?this.delim_counter+=1:(!e.Item.title&&e.use_journal_info?this.delim_pointers.push(!1):this.delim_pointers.push(this.delim_counter),this.delim_counter+=1),s.POSITION_FIRST===e.position&&(0===i?(this.state.registry.registry[e.itemId].master=!0,this.state.registry.registry[e.itemId].siblings=[],this.state.registry.registry[e.itemId].parallel=!1):e.prevItemID&&(this.state.registry.registry[e.prevItemID].parallel?this.state.registry.registry[e.itemId].parallel=this.state.registry.registry[e.prevItemID].parallel:this.state.registry.registry[e.itemId].parallel=e.prevItemID,this.state.registry.registry[e.itemId].siblings=this.state.registry.registry[e.prevItemID].siblings,this.state.registry.registry[e.itemId].siblings||(this.state.registry.registry[e.itemId].siblings=[],s.debug("WARNING: adding missing siblings array to registry object")),this.state.registry.registry[e.itemId].siblings.push(e.itemId)));this.sets.push([])}2>r?this.purgeGroupsIfParallel(!1):this.purgeGroupsIfParallel(!0),this.in_series=!0}},s.Parallel.prototype.PruneOutputQueue=function(){var t,e,i,n,s,r;if(this.use_parallels)for(t=this.sets.mystack.length,e=0;t>e;e+=1)if(i=this.sets.mystack[e],i.length>1)for(s=i.length,n=0;s>n;n+=1)r=i[n],0===n?this.purgeVariableBlobs(r,r.back):n===i.length-1?this.purgeVariableBlobs(r,r.front.concat(r.back_forceme)):this.purgeVariableBlobs(r,r.front.concat(r.back))},s.Parallel.prototype.purgeVariableBlobs=function(t,e){var i,n,s,r,o,a,l;if(this.use_parallels){for(l=this.state.output.current.value(),"undefined"==typeof l.length&&(l=l.blobs),n=0,i=this.delim_pointers.length;i>n;n+=1)a=this.delim_pointers[n],a!==!1&&(l[a].parallel_delimiter=", ");for(i=e.length-1,n=i;n>-1;n+=-1)if(s=e[n],t[s])for(o=t[s].blobs.length-1,a=o;a>-1;a+=-1)r=t[s].blobs[a],r[0].blobs=r[0].blobs.slice(0,r[1]).concat(r[0].blobs.slice(r[1]+1)),this.state.tmp.has_purged_parallel=!0,r[0]&&r[0].strings&&"string"==typeof r[0].strings.oops&&r[0].parent&&r[0].parent&&(r[0].parent.parent.strings.delimiter=r[0].strings.oops)}},s.Parallel.prototype.purgeGroupsIfParallel=function(t){for(var e=this.parallel_conditional_blobs_list.length-1;e>-1;e+=-1){for(var i=this.parallel_conditional_blobs_list[e],n=!0,s=0,r=i.conditions.length;r>s;s+=1)if(!i.conditions[s]!=!!t&&("master"!==i.conditions[s]||this.state.registry.registry[i.id].master)&&("servant"!==i.conditions[s]||this.state.registry.registry[i.id].parallel)){var n=!1;break}if(n){for(var o=[];i.blobs.length>i.pos;)o.push(i.blobs.pop());for(o.length&&o.pop();o.length;)i.blobs.push(o.pop())}this.parallel_conditional_blobs_list.pop()}},s.Util={},s.Util.Match=function(){this.any=function(t,e,i){return function(t,e){for(var n=0,s=i.length;s>n;n+=1)if(result=i[n](t,e),result)return!0;return!1}},this.none=function(t,e,i){return function(t,e){for(var n=0,s=i.length;s>n;n+=1)if(result=i[n](t,e),result)return!1;return!0}},this.all=function(t,e,i){return function(t,e){for(var n=0,s=i.length;s>n;n+=1)if(result=i[n](t,e),!result)return!1;return!0}},this[void 0]=this.all,this.nand=function(t,e,i){return function(t,e){for(var n=0,s=i.length;s>n;n+=1)if(result=i[n](t,e),!result)return!0;return!1}}},s.Transform=function(t){function e(t,e,i,n,r,o){var a;if(!r)return n;var l=r,u=!1;if(["title","title-short"].indexOf(l)>-1&&!e.jurisdiction&&(u=!0),s.NUMERIC_VARIABLES.indexOf(r)>-1&&(r="number"),["publisher-place","event-place","jurisdiction","archive-place"].indexOf(r)>-1&&(r="place"),["publisher","authority"].indexOf(r)>-1&&(r="institution-part"),["genre","event","medium","title-short"].indexOf(r)>-1&&(r="title"),["archive"].indexOf(r)>-1&&(r="collection-title"),a="",t.sys.getAbbreviation){var c=t.transform.loadAbbreviation(e.jurisdiction,r,n,e.type,u);t.transform.abbrevs[c][r]&&n&&t.sys.getAbbreviation&&t.transform.abbrevs[c][r][n]&&(a=t.transform.abbrevs[c][r][n].replace("{stet}",n))}return a||t.opt.development_extensions.require_explicit_legal_case_title_short&&"legal_case"===e.type||!i||!e[i]||!o||(a=e[i]),a||(a=n),a&&"!here>>>"===a.slice(0,10)&&(a="jurisdiction"===l&&["treaty","patent"].indexOf(l)>-1?a.slice(10):!1),a}function i(e,i){var n,s=t.opt["default-locale"][0].slice(0,2);return n=t.opt.development_extensions.strict_text_case_locales?new RegExp("^([a-zA-Z]{2})(?:$|-.*| .*)"):new RegExp("^([a-zA-Z]{2})(?:$|-.*|.*)"),e.language&&(m=(""+e.language).match(n),s=m?m[1]:"tlh"),e.multi&&e.multi&&e.multi.main&&e.multi.main[i]&&(s=e.multi.main[i]),(!t.opt.development_extensions.strict_text_case_locales||t.opt.development_extensions.normalize_lang_keys_to_lowercase)&&(s=s.toLowerCase()),s}function n(e,n,s,r,o){var a,l,u,c;if(!e[n])return{name:"",usedOrig:o};if(u={name:"",usedOrig:o,locale:i(e,n)},c=t.opt[s],"locale-orig"===s)return u=o?{name:"",usedOrig:o}:{name:e[n],usedOrig:!1,locale:i(e,n)};if(r&&("undefined"==typeof c||0===c.length))return{name:e[n],usedOrig:!0,locale:i(e,n)};for(var h=0,p=c.length;p>h;h+=1){if(a=c[h],l=a.split(/[\-_]/)[0],a&&e.multi&&e.multi._keys[n]&&e.multi._keys[n][a]){u.name=e.multi._keys[n][a],u.locale=l;break}if(l&&e.multi&&e.multi._keys[n]&&e.multi._keys[n][l]){u.name=e.multi._keys[n][l],u.locale=l;break}}return!u.name&&r&&(u={name:e[n],usedOrig:!0,locale:i(e,n)}),u}function r(e,i,n,s,r){if(e||(e="default"),!n)return t.transform.abbrevs[e]||(t.transform.abbrevs[e]=new t.sys.AbbreviationSegments),e;if(t.sys.getAbbreviation){var o=["default"];if("default"!==e)for(var a=e.split(/\s*;\s*/),l=0,u=a.length;u>l;l+=1)o.push(a.slice(0,l+1).join(";"));for(var l=o.length-1;l>-1;l+=-1)if(t.transform.abbrevs[o[l]]||(t.transform.abbrevs[o[l]]=new t.sys.AbbreviationSegments),t.transform.abbrevs[o[l]][i][n]||t.sys.getAbbreviation(t.opt.styleID,t.transform.abbrevs,o[l],i,n,s,r),t.transform.abbrevs[o[l]][i][n]){l<o.length&&(t.transform.abbrevs[e][i][n]=t.transform.abbrevs[o[l]][i][n]);break}}return e}function o(i,n,s,r){var o=i.variables[0];if(t.publisherOutput&&s){if(-1===["publisher","publisher-place"].indexOf(o))return!1;t.publisherOutput[o+"-token"]=i,t.publisherOutput.varlist.push(o);var a=s.split(/;\s*/);a.length===t.publisherOutput[o+"-list"].length&&(t.publisherOutput[o+"-list"]=a);for(var l=0,u=a.length;u>l;l+=1)a[l]=e(t,n,!1,a[l],r,!0);return t.tmp[o+"-token"]=i,!0}return!1}function a(i,r,a,u,c){var h,p=s.LangPrefsMap[i[0]];return h=p?t.opt["cite-lang-prefs"][p]:!1,function(t,a,c,d){var f,m,g,b,y,v,_;if(!i[0]||!a[i[0]]&&!a[u])return null;if(t.opt.suppressJurisdictions&&"jurisdiction"===i[0]&&t.opt.suppressJurisdictions[a.jurisdiction]&&["legal_case","gazette","regulation","legislation"].indexOf(a.type)>-1)return null;var x={primary:!1,secondary:!1,tertiary:!1};if("_sort"===t.tmp.area.slice(-5))x.primary="locale-sort";else if(h)for(var C=["primary","secondary","tertiary"],w=0,S=C.length;S>w&&!(h.length-1<w);w+=1)h[w]&&(x[C[w]]="locale-"+h[w]);else x.primary="locale-orig";if("bibliography"===t.tmp.area||"citation"===t.tmp.area&&"note"===t.opt.xclass&&c&&!c.position||(x.secondary=!1,x.tertiary=!1),t.tmp["publisher-list"])return"publisher"===i[0]?t.tmp["publisher-token"]=this:"publisher-place"===i[0]&&(t.tmp["publisher-place-token"]=this),null;var T=n(a,i[0],x.primary,!0);f=T.name,m=T.locale;var E=T.usedOrig;if(o(this,a,f,r))return null;g=!1,y=!1,x.secondary&&(T=n(a,i[0],x.secondary,!1,T.usedOrig),g=T.name,b=T.locale),x.tertiary&&(T=n(a,i[0],x.tertiary,!1,T.usedOrig),y=T.name,v=T.locale),r&&(f=e(t,a,u,f,r,!0),f&&(f=l(f)),g=e(t,a,!1,g,r,!0),y=e(t,a,!1,y,r,!0));var I,A=s.Util.cloneToken(this),_=s.Util.cloneToken(this);if("locale-translit"===x.primary&&(I=t.opt.citeAffixes[p][x.primary].prefix),"<i>"===I&&"title"===i[0]&&!E){for(var O=!1,w=0,S=_.decorations.length;S>w;w+=1)"@font-style"===_.decorations[w][0]&&"italic"===_.decorations[w][1]&&(O=!0);O||_.decorations.push(["@font-style","italic"])}if("en"!==m&&"title"===_.strings["text-case"]&&(_.strings["text-case"]="passthrough"),"title"===i[0]&&(f=s.demoteNoiseWords(t,f,this["leading-noise-words"])),g||y){if(t.output.openLevel("empty"),_.strings.suffix=_.strings.suffix.replace(/[ .,]+$/,""),t.output.append(f,_),g){secondary_tok=s.Util.cloneToken(A),secondary_tok.strings.prefix=t.opt.citeAffixes[p][x.secondary].prefix,secondary_tok.strings.suffix=t.opt.citeAffixes[p][x.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ");for(var w=secondary_tok.decorations.length-1;w>-1;w+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(secondary_tok.decorations[w].join("/"))>-1&&(secondary_tok.decorations=secondary_tok.decorations.slice(0,w).concat(secondary_tok.decorations.slice(w+1)));"en"!==b&&"title"===secondary_tok.strings["text-case"]&&(secondary_tok.strings["text-case"]="passthrough"),t.output.append(g,secondary_tok);var N=t.output.current.value(),k=t.output.current.value().blobs.length-1;t.parallel.use_parallels&&(t.parallel.cite.front.push(i[0]+":secondary"),t.parallel.cite[i[0]+":secondary"]={blobs:[[N,k]]})}if(y){tertiary_tok=s.Util.cloneToken(A),tertiary_tok.strings.prefix=t.opt.citeAffixes[p][x.tertiary].prefix,tertiary_tok.strings.suffix=t.opt.citeAffixes[p][x.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ");for(var w=tertiary_tok.decorations.length-1;w>-1;w+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(tertiary_tok.decorations[w].join("/"))>-1&&(tertiary_tok.decorations=tertiary_tok.decorations.slice(0,w).concat(tertiary_tok.decorations.slice(w+1)));"en"!==v&&"title"===tertiary_tok.strings["text-case"]&&(tertiary_tok.strings["text-case"]="passthrough"),t.output.append(y,tertiary_tok);var N=t.output.current.value(),k=t.output.current.value().blobs.length-1;t.parallel.use_parallels&&(t.parallel.cite.front.push(i[0]+":tertiary"),t.parallel.cite[i[0]+":tertiary"]={blobs:[[N,k]]})}t.output.closeLevel()}else t.output.append(f,_);return null}}function l(e){var i=e.match(/^!([-,_a-z]+)>>>/);if(i){var n=i[1].split(",");e=e.slice(i[0].length);for(var s=0,r=n.length;r>s;s+=1)-1===t.tmp.done_vars.indexOf(n[s])&&t.tmp.done_vars.push(n[s])}return e}this.abbrevs={},this.abbrevs["default"]=new t.sys.AbbreviationSegments,this.getTextSubField=n,this.loadAbbreviation=r,this.getOutputFunction=a,this.quashCheck=l},s.Token=function(t,e){this.name=t,this.strings={},this.strings.delimiter=void 0,this.strings.prefix="",this.strings.suffix="",this.decorations=[],this.variables=[],this.execs=[],this.tokentype=e,this.evaluator=!1,this.tests=[],this.rawtests=[],this.succeed=!1,this.fail=!1,this.next=!1},s.Util.cloneToken=function(t){var e,i,n,r;if("string"==typeof t)return t;e=new s.Token(t.name,t.tokentype);for(i in t.strings)t.strings.hasOwnProperty(i)&&(e.strings[i]=t.strings[i]);if(t.decorations)for(e.decorations=[],n=0,r=t.decorations.length;r>n;n+=1)e.decorations.push(t.decorations[n].slice());return t.variables&&(e.variables=t.variables.slice()),t.execs&&(e.execs=t.execs.slice(),e.tests=t.tests.slice(),e.rawtests=t.tests.slice()),e},s.AmbigConfig=function(){this.maxvals=[],this.minval=1,this.names=[],this.givens=[],this.year_suffix=!1,this.disambiguate=0},s.Blob=function(t,e,i){var n,s,r;if(this.levelname=i,e){this.strings={prefix:"",suffix:""};for(r in e.strings)e.strings.hasOwnProperty(r)&&(this.strings[r]=e.strings[r]);for(this.decorations=[],n=void 0===e.decorations?0:e.decorations.length,s=0;n>s;s+=1)this.decorations.push(e.decorations[s].slice())}else this.strings={},this.strings.prefix="",this.strings.suffix="",this.strings.delimiter="",this.decorations=[];"string"==typeof t?this.blobs=t:t?this.blobs=[t]:this.blobs=[],this.alldecor=[this.decorations]},s.Blob.prototype.push=function(t){if("string"==typeof this.blobs)throw"Attempt to push blob onto string object";!1!==t&&(t.alldecor=t.alldecor.concat(this.alldecor),this.blobs.push(t))},s.NumericBlob=function(t,e,i){this.id=i,this.alldecor=[],this.num=t,this.blobs=t.toString(),this.status=s.START,this.strings={},e?(this.gender=e.gender,this.decorations=e.decorations,this.strings.prefix=e.strings.prefix,this.strings.suffix=e.strings.suffix,this.strings["text-case"]=e.strings["text-case"],this.successor_prefix=e.successor_prefix,this.range_prefix=e.range_prefix,this.splice_prefix=e.splice_prefix,this.formatter=e.formatter,this.formatter||(this.formatter=new s.Output.DefaultFormatter),this.formatter&&(this.type=this.formatter.format(1))):(this.decorations=[],this.strings.prefix="",this.strings.suffix="",this.successor_prefix="",this.range_prefix="",this.splice_prefix="",this.formatter=new s.Output.DefaultFormatter)},s.NumericBlob.prototype.setFormatter=function(t){this.formatter=t,this.type=this.formatter.format(1)},s.Output.DefaultFormatter=function(){},s.Output.DefaultFormatter.prototype.format=function(t){return t.toString()},s.NumericBlob.prototype.checkNext=function(t,e){e?(this.status=s.START,"object"==typeof t&&(t.num===this.num+1?t.status=s.SUCCESSOR:t.status=s.SEEN)):t&&t.num&&this.type===t.type&&t.num===this.num+1?this.status===s.START||this.status===s.SEEN?t.status=s.SUCCESSOR:(this.status===s.SUCCESSOR||this.status===s.SUCCESSOR_OF_SUCCESSOR)&&(this.range_prefix?(t.status=s.SUCCESSOR_OF_SUCCESSOR,this.status=s.SUPPRESS):t.status=s.SUCCESSOR):(this.status===s.SUCCESSOR_OF_SUCCESSOR&&(this.status=s.END),"object"==typeof t&&(t.status=s.SEEN))},s.NumericBlob.prototype.checkLast=function(t){return this.status===s.SEEN||t.num!==this.num-1&&this.status===s.SUCCESSOR?(this.status=s.SUCCESSOR,!0):!1},s.Util.fixDateNode=function(t,e,i){var n,s,r,o,a,l,u,c,h,p,d,f,m,g;this.build.date_key=!0,n=this.sys.xml.getAttributeValue(i,"form");var b;if(b="accessed"===this.sys.xml.getAttributeValue(i,"variable")?this.opt["default-locale"][0]:this.sys.xml.getAttributeValue(i,"lingo"),!this.getDate(n))return t;var y=this.sys.xml.getAttributeValue(i,"date-parts");s=this.sys.xml.getAttributeValue(i,"variable"),c=this.sys.xml.getAttributeValue(i,"prefix"),h=this.sys.xml.getAttributeValue(i,"suffix"),m=this.sys.xml.getAttributeValue(i,"display"),g=this.sys.xml.getAttributeValue(i,"cslid"),r=this.sys.xml.nodeCopy(this.getDate(n,"accessed"===s)),this.sys.xml.setAttribute(r,"lingo",this.opt.lang),this.sys.xml.setAttribute(r,"form",n),this.sys.xml.setAttribute(r,"date-parts",y),this.sys.xml.setAttribute(r,"cslid",g),this.sys.xml.setAttribute(r,"variable",s),c&&this.sys.xml.setAttribute(r,"prefix",c),h&&this.sys.xml.setAttribute(r,"suffix",h),m&&this.sys.xml.setAttribute(r,"display",m),p=this.sys.xml.children(i);for(d in p)if(o=p[d],"date-part"===this.sys.xml.nodename(o)){a=this.sys.xml.getAttributeValue(o,"name"),f=this.sys.xml.attributes(o);for(l in f)if(f.hasOwnProperty(l)){if("@name"===l)continue;if(b&&b!==this.opt.lang&&["@suffix","@prefix","@form"].indexOf(l)>-1)continue;u=f[l],this.sys.xml.setAttributeOnNodeIdentifiedByNameAttribute(r,"date-part",a,l,u)}}return"year"===this.sys.xml.getAttributeValue(i,"date-parts")?(this.sys.xml.deleteNodeByNameAttribute(r,"month"),this.sys.xml.deleteNodeByNameAttribute(r,"day")):"year-month"===this.sys.xml.getAttributeValue(i,"date-parts")&&this.sys.xml.deleteNodeByNameAttribute(r,"day"),this.sys.xml.insertChildNodeAfter(t,i,e,r)},s.dateMacroAsSortKey=function(t,e){s.dateAsSortKey.call(this,t,e,!0)},s.dateAsSortKey=function(t,e,i){var n,r,o,a,l,u,c,h,p=this.variables[0],d="empty";for(i&&(d="macro-with-date"),n=e[p],"undefined"==typeof n&&(n={"date-parts":[[0]]},n.year||(t.tmp.empty_date=!0)),"undefined"==typeof this.dateparts&&(this.dateparts=["year","month","day"]),n.raw?n=t.fun.dateparser.parse(n.raw):n["date-parts"]&&(n=t.dateParseArray(n)),"undefined"==typeof n&&(n={}),c=0,h=s.DATE_PARTS_INTERNAL.length;h>c;c+=1)r=s.DATE_PARTS_INTERNAL[c],o=0,a=r,"_end"===a.slice(-4)&&(a=a.slice(0,-4)),n[r]&&this.dateparts.indexOf(a)>-1&&(o=n[r]),"year"===r.slice(0,4)?(l=s.Util.Dates[a].numeric(t,o),u="Y","-"===l[0]&&(u="X",l=l.slice(1),l=9999-parseInt(l,10)),t.output.append(s.Util.Dates[r.slice(0,4)].numeric(t,u+l),d)):(o=s.Util.Dates[a]["numeric-leading-zeros"](t,o),o||(o="00"),t.output.append(o,d))},s.Engine.prototype.dateParseArray=function(t){var e,i,n,r;e={};for(i in t)if("date-parts"===i){n=t["date-parts"],n.length>1&&n[0].length!==n[1].length&&s.error("CSL data error: element mismatch in date range input."),r=["","_end"];for(var o=0,a=n.length;a>o;o+=1)for(var l=0,u=s.DATE_PARTS.length;u>l;l+=1)"undefined"==typeof n[o][l]?e[s.DATE_PARTS[l]+r[o]]=n[o][l]:e[s.DATE_PARTS[l]+r[o]]=parseInt(n[o][l],10)}else t.hasOwnProperty(i)&&("literal"===i&&"object"==typeof t.literal&&"string"==typeof t.literal.part?(s.debug("Warning: fixing up weird literal date value"),e.literal=t.literal.part):e[i]=t[i]);return e},s.Util.Names={},s.Util.Names.compareNamesets=s.NameOutput.prototype._compareNamesets,s.Util.Names.unInitialize=function(t,e){var i,n,r,o,a;if(!e)return"";for(r=e.split(/(?:\-|\s+)/),o=e.match(/(\-|\s+)/g),a="",i=0,n=r.length;n>i;i+=1)s.ALL_ROMANESQUE_REGEXP.exec(r[i].slice(0,-1))&&r[i]&&r[i]!==r[i].toUpperCase()&&(r[i]=r[i].slice(0,1)+r[i].slice(1,2).toLowerCase()+r[i].slice(2)),a+=r[i],n-1>i&&(a+=o[i]);return a},s.Util.Names.initializeWith=function(t,e,i,n){var r,o,a,l,u,c,h;if(!e)return"";if(["Lord","Lady"].indexOf(e)>-1||!e.match(s.STARTSWITH_ROMANESQUE_REGEXP)&&!i.match("%s"))return e;i||(i="");var p=e;if(t.opt["initialize-with-hyphen"]===!1&&(p=p.replace(/\-/g," ")),p=p.replace(/\s*\-\s*/g,"-").replace(/\s+/g," "),p=p.replace(/-([a-z])/g,"$1"),u=p.match(/[\-\s]+/g),c=p.split(/[\-\s]+/),0===c.length)p=u;else for(p=[c[0]],r=1,o=c.length;o>r;r+=1)p.push(u[r-1]),p.push(c[r]);for(c=p,r=c.length-1;r>-1;r+=-1)if(c[r]&&c[r].slice(0,-1).indexOf(".")>-1){var d=c.slice(r+1),f=c[r].slice(0,-1).split(".");for(c=c.slice(0,r),a=0,l=f.length;l>a;a+=1)c.push(f[a]+"."),a<f.length-1&&c.push(" ");c=c.concat(d)}return h=n?s.Util.Names.doNormalize(t,c,i):s.Util.Names.doInitialize(t,c,i),h=h.replace(/\u2013([a-z])/g,"-$1")},s.Util.Names.doNormalize=function(t,e,i,n){var r,o,a=[];for(r=0,o=e.length;o>r;r+=1)e[r].length>1&&"."===e[r].slice(-1)?(e[r]=e[r].slice(0,-1),a.push(!0)):1===e[r].length&&e[r].toUpperCase()===e[r]?a.push(!0):a.push(!1);for(r=0,o=e.length;o>r;r+=2)a[r]&&(r<e.length-2&&(e[r+1]="",(!i||i.slice(-1)&&" "!==i.slice(-1))&&e[r].length&&e[r].match(s.ALL_ROMANESQUE_REGEXP)&&(e[r].length>1||e[r+2].length>1)&&(e[r+1]=" "),e[r]=e[r]+i),r===e.length-1&&(e[r]=e[r]+i));return e.join("").replace(/\s+$/,"")},s.Util.Names.doInitialize=function(t,e,i,n){var r,o,a,l,u,c,h;for(r=0,o=e.length;o>r;r+=2)if(h=e[r])if(a=h.match(s.NAME_INITIAL_REGEXP),!a&&!h.match(s.STARTSWITH_ROMANESQUE_REGEXP)&&h.length>1&&i.match("%s")&&(a=h.match(/(.)(.*)/)),a&&a[1]===a[1].toUpperCase()){var p="";if(a[2]){var d="";for(c=a[2].split(""),l=0,u=c.length;u>l;l+=1){var f=c[l];if(f!==f.toUpperCase())break;d+=f}d.length<a[2].length&&(p=d.toLocaleLowerCase())}e[r]=a[1].toLocaleUpperCase()+p,o-1>r?i.match("%s")?e[r]=i.replace("%s",e[r]):e[r+1].indexOf("-")>-1?e[r+1]=i+e[r+1]:e[r+1]=i:i.match("%s")?e[r]=i.replace("%s",e[r]):e.push(i)}else h.match(s.ROMANESQUE_REGEXP)&&(e[r]=" "+h);var m=e.join("");return m=m.replace(/\s+$/,"").replace(/\s*\-\s*/g,"-").replace(/\s+/g," ")},s.Util.Names.getRawName=function(t){var e=[];return t.given&&e.push(t.given),t.family&&e.push(t.family),e.join(" ")},s.Util.Dates={},s.Util.Dates.year={},s.Util.Dates.year["long"]=function(t,e){return e||(e="boolean"==typeof e?"":0),e.toString()},s.Util.Dates.year.imperial=function(t,e,i,n){e||(e="boolean"==typeof e?"":0),i=i?"_end":"";var s=t.tmp.date_object["month"+i];for(s=s?""+s:"1";s.length<2;)s="0"+s;var r=t.tmp.date_object["day"+i];for(r=r?""+r:"1";r.length<2;)r="0"+r;var o,a,l=parseInt(e+s+r,10);return l>=18680908&&19120730>l?(o="",a=1867):l>=19120730&&19261225>l?(o="",a=1911):l>=19261225&&19890108>l?(o="",a=1925):l>=19890108&&(o="",a=1988),o&&a&&(t.transform.abbrevs["default"].number[o]||t.transform.loadAbbreviation("default","number",o),t.transform.abbrevs["default"].number[o]&&(o=t.transform.abbrevs["default"].number[o]),year=o+(e-a)),year},s.Util.Dates.year["short"]=function(t,e){return e=e.toString(),e&&4===e.length?e.substr(2):void 0},s.Util.Dates.year.numeric=function(t,e){var i,n;for(e=""+e,i=e.match(/([0-9]*)$/),i?(n=e.slice(0,-1*i[1].length),e=i[1]):(n=e,e="");e.length<4;)e="0"+e;return n+e},s.Util.Dates.normalizeMonth=function(t,e){var i;if(t||(t=0),t=""+t,t.match(/^[0-9]+$/)||(t=0),t=parseInt(t,10),e){var n={stub:"month-",num:t};n.num<1||n.num>20?n.num=0:n.num>16?(n.stub="season-",n.num=n.num-16):n.num>12&&(n.stub="season-",n.num=n.num-12),i=n}else(1>t||t>12)&&(t=0),i=t;return i},s.Util.Dates.month={},s.Util.Dates.month.numeric=function(t,e){var e=s.Util.Dates.normalizeMonth(e);return e||(e=""),e},s.Util.Dates.month["numeric-leading-zeros"]=function(t,e){var e=s.Util.Dates.normalizeMonth(e);if(e)for(e=""+e;e.length<2;)e="0"+e;else e="";return e},s.Util.Dates.month["long"]=function(t,e,i,n){var r=s.Util.Dates.normalizeMonth(e,!0),e=r.num;if(e){for(e=""+e;e.length<2;)e="0"+e;e=t.getTerm(r.stub+e,"long",0,0,!1,n)}else e="";return e},s.Util.Dates.month["short"]=function(t,e,i,n){var r=s.Util.Dates.normalizeMonth(e,!0),e=r.num;if(e){for(e=""+e;e.length<2;)e="0"+e;e=t.getTerm(r.stub+e,"short",0,0,!1,n)}else e="";return e},s.Util.Dates.day={},s.Util.Dates.day.numeric=function(t,e){return e.toString()},s.Util.Dates.day["long"]=s.Util.Dates.day.numeric,s.Util.Dates.day["numeric-leading-zeros"]=function(t,e){for(e||(e=0),e=e.toString();e.length<2;)e="0"+e;return e.toString()},s.Util.Dates.day.ordinal=function(t,e,i){return t.fun.ordinalizer.format(e,i)},s.Util.Sort={},s.Util.Sort.strip_prepositions=function(t){var e;return"string"==typeof t&&(e=t.toLocaleLowerCase(),e=t.match(/^((a|an|the)\s+)/)),e&&(t=t.substr(e[1].length)),t},s.Util.substituteStart=function(t,e){var i,n,r,o,a,l,u;o=function(t,e){for(var i=0,n=this.decorations.length;n>i;i+=1)if("@strip-periods"===this.decorations[i][0]&&"true"===this.decorations[i][1]){t.tmp.strip_periods+=1;break}},this.execs.push(o),this.decorations&&(t.opt.development_extensions.csl_reverse_lookup_support||t.sys.csl_reverse_lookup_support)&&(this.decorations.reverse(),this.decorations.push(["@showid","true",this.cslid]),this.decorations.reverse()),u=["number","date","names"],("text"===this.name&&!this.postponed_macro||u.indexOf(this.name)>-1)&&(i=function(t,e,i){"author"===t.tmp.element_trace.value()||"names"===this.name?i&&i["author-only"]?t.tmp.element_trace.push("do-not-suppress-me"):i&&i["suppress-author"]:i&&i["author-only"]?t.tmp.element_trace.push("suppress-me"):i&&i["suppress-author"]&&t.tmp.element_trace.push("do-not-suppress-me")},this.execs.push(i)),n=this.strings.cls,this.strings.cls=!1,0===t.build.render_nesting_level&&("bibliography"===t.build.area&&t.bibliography.opt["second-field-align"]?(r=new s.Token("group",s.START),r.decorations=[["@display","left-margin"]],o=function(t,e){t.tmp.render_seen||(r.strings.first_blob=e.id,t.output.startTag("bib_first",r))},r.execs.push(o),e.push(r)):s.DISPLAY_CLASSES.indexOf(n)>-1&&(r=new s.Token("group",s.START),r.decorations=[["@display",n]],o=function(t,e){r.strings.first_blob=e.id,t.output.startTag("bib_first",r)},r.execs.push(o),e.push(r)),t.build.cls=n),t.build.render_nesting_level+=1,1===t.build.substitute_level.value()&&(a=new s.Token("choose",s.START),s.Node.choose.build.call(a,t,e),l=new s.Token("if",s.START),o=function(e,i){return t.tmp.can_substitute.value()?!0:!1},l.tests.push(o),l.test=t.fun.match.any(this,t,l.tests),e.push(l)),t.sys.variableWrapper&&this.variables_real&&this.variables_real.length&&(o=function(t,e,i){if(!t.tmp.just_looking&&!t.tmp.suppress_decorations){variable_entry=new s.Token("text",s.START),variable_entry.decorations=[["@showid","true"]],t.output.startTag("variable_entry",variable_entry);var n=null;i&&(n=i.position),n||(n=0);var r=["first","subsequent","ibid","ibid-with-locator"],o=0;i&&i.noteIndex&&(o=i.noteIndex);var a=0;i&&i["first-reference-note-number"]&&(a=i["first-reference-note-number"]);var l=0;i&&i["citation-number"]&&(l=i["citation-number"]);var u=0;i&&i.index&&(u=i.index);var c={itemData:e,variableNames:this.variables,context:t.tmp.area,xclass:t.opt.xclass,position:r[n],"note-number":o,"first-reference-note-number":a,"citation-number":l,index:u,mode:t.opt.mode};t.output.current.value().params=c}},this.execs.push(o))},s.Util.substituteEnd=function(t,e){var i,n,r,o,a,l,u,c,h;t.sys.variableWrapper&&(this.hasVariable||this.variables_real&&this.variables_real.length)&&(i=function(t,e){
t.tmp.just_looking||t.tmp.suppress_decorations||t.output.endTag("variable_entry")},this.execs.push(i)),i=function(t,e){for(var i=0,n=this.decorations.length;n>i;i+=1)if("@strip-periods"===this.decorations[i][0]&&"true"===this.decorations[i][1]){t.tmp.strip_periods+=-1;break}},this.execs.push(i),t.build.render_nesting_level+=-1,0===t.build.render_nesting_level&&(t.build.cls?(i=function(t,e){t.output.endTag("bib_first")},this.execs.push(i),t.build.cls=!1):"bibliography"===t.build.area&&t.bibliography.opt["second-field-align"]&&(n=new s.Token("group",s.END),i=function(t,e){t.tmp.render_seen||t.output.endTag()},n.execs.push(i),e.push(n),r=new s.Token("group",s.START),r.decorations=[["@display","right-inline"]],i=function(t,e){t.tmp.render_seen||(t.tmp.render_seen=!0,t.output.startTag("bib_other",r))},r.execs.push(i),e.push(r))),1===t.build.substitute_level.value()&&(o=new s.Token("if",s.END),e.push(o),a=new s.Token("choose",s.END),s.Node.choose.build.call(a,t,e)),l="names"===this.name&&0===t.build.substitute_level.value(),u="string"==typeof t[t.build.area].opt["subsequent-author-substitute"];var p=t[t.build.area].opt["subsequent-author-substitute-rule"];l&&u&&(c=new s.Token("text",s.SINGLETON),i=function(t,e){var i,n,r=!t.tmp.suppress_decorations;if(r&&"bibliography"===t.tmp.area&&t.tmp.subsequent_author_substitute_ok&&t.tmp.rendered_name)if("partial-each"===p||"partial-first"===p){var o=!0,a=[];for(i=0,n=t.tmp.name_node.children.length;n>i;i+=1){var l=t.tmp.rendered_name[i];o&&t.tmp.last_rendered_name&&t.tmp.last_rendered_name.length>i-1&&l&&!l.localeCompare(t.tmp.last_rendered_name[i])?(h=new s.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]),t.tmp.name_node.children[i].blobs=[h],"partial-first"===p&&(o=!1)):o=!1,a.push(l)}t.tmp.last_rendered_name=a}else if("complete-each"===p){var a=t.tmp.rendered_name.join(",");if(a){if(!a.localeCompare(t.tmp.last_rendered_name))for(i=0,n=t.tmp.name_node.children.length;n>i;i+=1)h=new s.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]),t.tmp.name_node.children[i].blobs=[h];t.tmp.last_rendered_name=a}}else{var a=t.tmp.rendered_name.join(",");a&&(a.localeCompare(t.tmp.last_rendered_name)||(h=new s.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]),t.tmp.label_blob?t.tmp.name_node.top.blobs=[h,t.tmp.label_blob]:t.tmp.name_node.top.blobs=[h]),t.tmp.last_rendered_name=a)}},c.execs.push(i),e.push(c)),("text"===this.name&&!this.postponed_macro||["number","date","names"].indexOf(this.name)>-1)&&(i=function(t,e){t.tmp.element_trace.pop()},this.execs.push(i))},s.Util.padding=function(t){var e=t.match(/\s*(-{0,1}[0-9]+)/);if(e)for(t=parseInt(e[1],10),0>t&&(t=1e20+t),t=""+t;t.length<20;)t="0"+t;return t},s.Util.LongOrdinalizer=function(){},s.Util.LongOrdinalizer.prototype.init=function(t){this.state=t},s.Util.LongOrdinalizer.prototype.format=function(t,e){10>t&&(t="0"+t);var i=s.Engine.getField(s.LOOSE,this.state.locale[this.state.opt.lang].terms,"long-ordinal-"+t,"long",0,e);return i||(i=this.state.fun.ordinalizer.format(t,e)),this.state.tmp.cite_renders_content=!0,i},s.Util.Ordinalizer=function(t){this.state=t,this.suffixes={}},s.Util.Ordinalizer.prototype.init=function(){if(!this.suffixes[this.state.opt.lang]){this.suffixes[this.state.opt.lang]={};for(var t=0,e=3;e>t;t+=1){var i=[void 0,"masculine","feminine"][t];this.suffixes[this.state.opt.lang][i]=[];for(var n=1;5>n;n+=1){var s=this.state.getTerm("ordinal-0"+n,"long",!1,i);if("undefined"==typeof s){delete this.suffixes[this.state.opt.lang][i];break}this.suffixes[this.state.opt.lang][i].push(s)}}}},s.Util.Ordinalizer.prototype.format=function(t,e){var i;t=parseInt(t,10),i=""+t;var n="",s=[];if(e&&s.push(e),s.push("neuter"),this.state.locale[this.state.opt.lang].ord["1.0.1"]){n=this.state.getTerm("ordinal",!1,0,e);for(var r,o=0,a=s.length;a>o;o+=1){r=s[o];var l=this.state.locale[this.state.opt.lang].ord["1.0.1"];if(l["whole-number"][i]&&l["whole-number"][i][r]?n=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["whole-number"][i][r],!1,0,e):l["last-two-digits"][i.slice(i.length-2)]&&l["last-two-digits"][i.slice(i.length-2)][r]?n=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-two-digits"][i.slice(i.length-2)][r],!1,0,e):l["last-digit"][i.slice(i.length-1)]&&l["last-digit"][i.slice(i.length-1)][r]&&(n=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-digit"][i.slice(i.length-1)][r],!1,0,e)),n)break}}else e||(e=void 0),this.state.fun.ordinalizer.init(),n=t/10%10===1||t>10&&20>t?this.suffixes[this.state.opt.lang][e][3]:t%10===1&&t%100!==11?this.suffixes[this.state.opt.lang][e][0]:t%10===2&&t%100!==12?this.suffixes[this.state.opt.lang][e][1]:t%10===3&&t%100!==13?this.suffixes[this.state.opt.lang][e][2]:this.suffixes[this.state.opt.lang][e][3];return i=i+=n},s.Util.Romanizer=function(){},s.Util.Romanizer.prototype.format=function(t){var e,i,n,r,o;if(e="",6e3>t)for(r=t.toString().split(""),r.reverse(),i=0,n=0,o=r.length,i=0;o>i;i+=1)n=parseInt(r[i],10),e=s.ROMAN_NUMERALS[i][n]+e;return e},s.Util.Suffixator=function(t){t||(t=s.SUFFIX_CHARS),this.slist=t.split(",")},s.Util.Suffixator.prototype.format=function(t){var e;t+=1;var i="";do e=t%26===0?26:t%26,i=this.slist[e-1]+i,t=(t-e)/26;while(0!==t);return i},s.Engine.prototype.processNumber=function(t,e,i,n){var r,o,a,l,u,c;if(this.tmp.shadow_numbers[i]){if(this.tmp.shadow_numbers[i].numeric)for(var a=0,l=this.tmp.shadow_numbers[i].values.length;l>a;a+=2)this.tmp.shadow_numbers[i].values[a][2]=t}else if(this.tmp.shadow_numbers[i]={},this.tmp.shadow_numbers[i].values=[],this.tmp.shadow_numbers[i].plural=0,this.tmp.shadow_numbers[i].numeric=!1,this.tmp.shadow_numbers[i].label=!1,e){var h=s.LangPrefsMap[i];if(h){var p=this.opt["cite-lang-prefs"][h][0];r=this.transform.getTextSubField(e,i,"locale-"+p,!0),r=r.name}else r=e[i];if(r&&this.sys.getAbbreviation){r=(""+r).replace(/^\"/,"").replace(/\"$/,"");var d=this.transform.loadAbbreviation(e.jurisdiction,"number",r);this.transform.abbrevs[d].number[r]?r=this.transform.abbrevs[d].number[r]:"undefined"!=typeof this.transform.abbrevs[d].number[r]&&delete this.transform.abbrevs[d].number[r]}if("undefined"!=typeof r){if("number"==typeof r&&(r=""+r),this.tmp.shadow_numbers[i].label=i,'"'===r.slice(0,1)&&'"'===r.slice(-1)&&(r=r.slice(1,-1)),r&&["number-of-volumes","number-of-pages"].indexOf(i)>-1){var o=r.match(/[^0-9]*([0-9]+).*/);o&&(this.tmp.shadow_numbers[i].numeric=!0,"1"!==o[1]&&(this.tmp.shadow_numbers[i].plural=1))}"locator"===i&&["bill","gazette","legislation","treaty"].indexOf(n)>-1&&(r=r.split(s.STATUTE_SUBDIV_PLAIN_REGEX)[0]);var f="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(n)>-1&&"collection-number"===i&&(f="year"),["page","page-first"].indexOf(i)>-1){var o=r.split(" ")[0].match(s.STATUTE_SUBDIV_GROUPED_REGEX);if(o){this.opt.development_extensions.static_statute_locator&&(this.tmp.shadow_numbers[i].label=s.STATUTE_SUBDIV_STRINGS[o[0]]);var m=r.match(/[^ ]+\s+(.*)/);m&&(r=m[1])}}for(var g=r.split(/(?:,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/),o=r.match(/(,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/g),b=[],a=0,l=g.length-1;l>a;a+=1)b.push(g[a]),b.push(o[a]);b.push(g[g.length-1]);for(var y=0,v=!0,a=0,l=b.length;l>a;a+=1){var _=a%2===0;if(_){if(b[a]){if(b[a].match(/(?:[0-9]|[xivcmlXIVCML])/))if(b[a-1]&&b[a-1].match(/^\s*\\*[\-\u2013]+\s*$/)){var x=this.tmp.shadow_numbers[i].values.slice(-1);if(-1==x[0][1].indexOf("\\")){if(b[a-2]&&(""+b[a-2]).match(/(:?[a-zA-Z]*[0-9]+$|^[ivxlcmIVXLCM]+$)/)&&b[a].match(/(?:^[a-zA-Z]*[0-9]+|^[ivxlcmIVXLCM]+$)/)){var C=this.tmp.shadow_numbers[i].values.slice(-2);if(x[0][1]=this.getTerm(f+"-range-delimiter"),this.opt[f+"-range-format"]){var w=this.fun[f+"_mangler"](C[0][1]+"-"+b[a]);w=w.split(this.getTerm(f+"-range-delimiter")),b[a]=w[1]}y+=1}x[0][1].indexOf("--")>-1&&(x[0][1]=x[0][1].replace(/--*/,""))}else x[0][1]=x[0][1].replace(/\\/,"","g")}else-1===b[a].indexOf(" ")&&(y+=1);for(var S=b[a].split(/\s+/),u=0,c=S.length;c>u;u+=1)this.opt.development_extensions.strict_page_numbers&&"page"===i&&!S[u].match(/^-*[0-9]/)?v=!1:S[u].match(/[-0-9]/)||(v=!1);if(b[a].match(/^[1-9][0-9]*$/))b[a]=parseInt(b[a],10),t&&"undefined"==typeof t.gender&&(t.gender=this.locale[this.opt.lang]["noun-genders"][i],t.gender||(t.gender="")),this.tmp.shadow_numbers[i].values.push(["NumericBlob",b[a],t]);else{var T=b[a];this.tmp.shadow_numbers[i].values.push(["Blob",T,t])}}}else b[a]&&this.tmp.shadow_numbers[i].values.push(["Blob",b[a],void 0])}this.opt.development_extensions.strict_page_numbers&&"page"===i?-1===r.indexOf(" ")&&r.match(/^-*[0-9]/)?this.tmp.shadow_numbers[i].numeric=!0:this.tmp.shadow_numbers[i].numeric=v:-1===r.indexOf(" ")&&r.match(/[0-9]/)?this.tmp.shadow_numbers[i].numeric=!0:this.tmp.shadow_numbers[i].numeric=v,this.tmp.shadow_numbers[i].numeric||this.transform.loadAbbreviation(e.jurisdiction,"number",r),y>1&&(this.tmp.shadow_numbers[i].plural=1),1===e.force_pluralism?this.tmp.shadow_numbers[i].plural=1:0===e.force_pluralism&&(this.tmp.shadow_numbers[i].plural=0)}}},s.Util.PageRangeMangler={},s.Util.PageRangeMangler.getFunction=function(t,e){var i,n,s,r,o,a,l,u,c,h,p,d,f,m,g,b,y,v=t.getTerm(e+"-range-delimiter");i=/([a-zA-Z]*)([0-9]+)\s*(?:\u2013|-)\s*([a-zA-Z]*)([0-9]+)/,r=function(i){for(s=i.length,n=1;s>n;n+=2)"object"==typeof i[n]&&(i[n]=i[n].join(""));var r=i.join("");return r=r.replace(/([^\\])\-/g,"$1"+t.getTerm(e+"-range-delimiter"))},o=function(t){var e,i,r,o="\\s+\\-\\s+",a=new RegExp("([^\\\\])["+v+"\\u2013]","g");t=t.replace(a,"$1 - ").replace(/\s+-\s+/g," - ");var l=new RegExp("([a-zA-Z]*[0-9]+"+o+"[a-zA-Z]*[0-9]+)","g"),u=new RegExp("[a-zA-Z]*[0-9]+"+o+"[a-zA-Z]*[0-9]+");if(e=t.match(l),i=t.split(u),0===i.length)r=e;else for(r=[i[0]],n=1,s=i.length;s>n;n+=1)r.push(e[n-1].replace(/\s*\-\s*/,"-","g")),r.push(i[n]);return r},a=function(t){for(t=""+t,h=o(t),s=h.length,n=1;s>n;n+=2)p=h[n].match(i),p&&(p[3]&&p[1]!==p[3]||(p[4].length<p[2].length&&(p[4]=p[2].slice(0,p[2].length-p[4].length)+p[4]),parseInt(p[2],10)<parseInt(p[4],10)&&(p[3]=v+p[1],h[n]=p.slice(1)))),"string"==typeof h[n]&&(h[n]=h[n].replace("-",v,"g"));return h},l=function(t,e,i){s=t.length;for(var n=1,o=t.length;o>n;n+=2)t[n][3]=u(t[n][1],t[n][3],e,i),t[n][2].slice(1)===t[n][0]&&(t[n][2]=v);return r(t)},u=function(t,e,i,n){if(i||(i=0),d=(""+t).split(""),f=(""+e).split(""),m=f.slice(),m.reverse(),d.length===f.length)for(var s=0,r=d.length;r>s;s+=1){if(!(d[s]===f[s]&&m.length>i)){if(i&&n&&3===m.length){var o=d.slice(0,s);o.reverse(),m=m.concat(o)}break}m.pop()}return m.reverse(),m.join("")},c=function(t){for(s=t.length,n=1;s>n;n+=2)"object"==typeof t[n]&&(p=t[n],g=parseInt(p[1],10),b=parseInt(p[3],10),g>100&&g%100&&parseInt(g/100,10)===parseInt(b/100,10)?p[3]=""+b%100:g>=1e4&&(p[3]=""+b%1e3)),p[2].slice(1)===p[0]&&(p[2]=v);return r(t)};var _=function(t,e,i,n){var s;t=""+t;var r=a(t),s=e(r,i,n);return s};return t.opt[e+"-range-format"]?"expanded"===t.opt[e+"-range-format"]?y=function(t){return _(t,r)}:"minimal"===t.opt[e+"-range-format"]?y=function(t){return _(t,l)}:"minimal-two"===t.opt[e+"-range-format"]?y=function(t,e){return _(t,l,2,e)}:"chicago"===t.opt[e+"-range-format"]&&(y=function(t){return _(t,c)}):y=function(t){return t},y},s.Util.FlipFlopper=function(t){var e,i,n,s,r,o,a,l,u,c,h,p,d,f,m,g,b,y;for(this.state=t,this.blob=!1,this.quotechars=['"',"'"],e=[["<i>","</i>","italics","@font-style",["italic","normal","normal"],!0],["<b>","</b>","bold","@font-weight",["bold","normal","normal"],!0],["<sup>","</sup>","superscript","@vertical-align",["sup","sup","baseline"],!0],["<sub>","</sub>","subscript","@vertical-align",["sub","sub","baseline"],!0],["<sc>","</sc>","smallcaps","@font-variant",["small-caps","small-caps","normal"],!0],['<span style="font-variant:small-caps;">',"</span>","smallcaps","@font-variant",["small-caps","normal","normal"],!0],['<span class="nocase">',"</span>","passthrough","@passthrough",["true","true","true"],!0],['<span class="nodecor">',"</span>","passthrough","@passthrough",["true","true","true"],!0],['"','"',"quotes","@quotes",["true","inner","true"],"'"],[" '","'","quotes","@quotes",["inner","true","true"],'"']],i=0;2>i;i+=1){s=["-","-inner-"][i],r=[];var v=t.getTerm("open"+s+"quote");r.push(v),this.quotechars.push(v);var _=t.getTerm("close"+s+"quote");r.push(_),this.quotechars.push(_),r.push("quotes"),r.push("@quotes"),"-"===s?r.push(["true","inner"]):r.push(["inner","true"]),r.push(!0),"-"===s?r.push(t.getTerm("close-inner-quote")):r.push(t.getTerm("close-quote")),e.push(r)}for(o=function(t){for(a=[],n=t.length,i=0;n>i;i+=1)l=t[i],-1===a.indexOf(l[0])&&(u="",["(",")","[","]"].indexOf(l[0])>-1&&(u="\\"),a.push(u+l[0])),-1===a.indexOf(l[1])&&(u="",["(",")","[","]"].indexOf(l[1])>-1&&(u="\\"),a.push(u+l[1]));return a},b=o(e),y=[],i=0,n=b.length;n>i;i+=1)b[i]&&y.push(b[i]);b=y.slice(),this.allTagsRexMatch=new RegExp("("+b.join("|")+")","g"),this.allTagsRexSplit=new RegExp("(?:"+b.join("|")+")"),c=function(t){for(h={},p={},d={},f={},m={},n=t.length,i=0;n>i;i+=1)h[t[i][1]]=!0,p[t[i][1]]=t[i][5],d[t[i][0]]=t[i][1],f[t[i][0]]=[t[i][3],t[i][4]],m[t[i][3]]=[t[i][3],[t[i][4][2],t[i][1]]];return[h,p,d,f,m]},g=c(e),this.closeTagsHash=g[0],this.flipTagsHash=g[1],this.openToCloseHash=g[2],this.openToDecorations=g[3],this.okReverseHash=g[4]},s.Util.FlipFlopper.prototype.init=function(t,e){this.txt_esc=s.getSafeEscape(this.state),e?(this.blob=e,this.strs=this.getSplitStrings(this.blob.blobs),this.blob.blobs=[]):(this.strs=this.getSplitStrings(t),this.blob=new s.Blob),this.blobstack=new s.Stack(this.blob)},s.Util.FlipFlopper.prototype._normalizeString=function(t){var e,i;if(t=t.replace(/\s+'\s+/,"  ","g"),t.indexOf(this.quotechars[0])>-1)for(e=0,i=2;i>e;e+=1)this.quotechars[e+2]&&(t=t.replace(this.quotechars[e+2],this.quotechars[0]));if(t.indexOf(this.quotechars[1])>-1)for(e=0,i=2;i>e;e+=1)this.quotechars[e+4]&&(t=0===e?t.replace(this.quotechars[e+4]," "+this.quotechars[1]):t.replace(this.quotechars[e+4],this.quotechars[1]));return t},s.Util.FlipFlopper.prototype.getSplitStrings=function(t){var e,i,n,s,r,o,a,l,u,c,h,p,d,f,m,g,b,y,v,_,x,C,w,S,T,E,I,A,O;for(t=this._normalizeString(t),A=t.match(this.allTagsRexMatch),e=t.split(this.allTagsRexSplit),O=[e[0]],i=1,n=e.length;n>i;i+=1)O.push(A[i-1]),O.push(e[i]);for(e=O.slice(),n=e.length-2,i=n;i>0;i+=-2)"\\"===e[i-1].slice(e[i-1].length-1)&&(s=e[i-1].slice(0,e[i-1].length-1)+e[i]+e[i+1],r=e.slice(0,i-1),o=e.slice(i+2),r.push(s),e=r.concat(o));for(a=[],l=[],u=[],c=[],h=[],S=e.length-1,p=1;S>p;p+=2)if(g=e[p],this.closeTagsHash[g]&&(a.reverse(),d=this.openToCloseHash[g],f=a.indexOf(g),m=u.indexOf(g),a.reverse(),!d||f>-1&&(m>f||-1===m))){for(b=!1,T=a.length-1,y=T;y>-1;y+=-1){if(b=!0,v=a[y],g===v){a.pop(),l.pop(),u.pop(),c.pop();break}h.push(p)}b||h.push(p)}else this.openToCloseHash[g]&&(a.push(this.openToCloseHash[g]),l.push(g),u.push(this.flipTagsHash[g]),c.push(p));for(E=a.length-1,_=E;_>-1;_+=-1)a.pop(),u.pop(),l.pop(),h.push(c.pop());for(h.sort(function(t,e){return e>t?1:t>e?-1:0}),n=h.length,i=0;n>i;i+=1)I=h[i],r=e.slice(0,I-1),o=e.slice(I+2),x=e[I],x.length&&"<"!==x[0]&&this.openToDecorations[x]&&-1===this.quotechars.indexOf(x.replace(/\s+/g,""))&&(w=this.openToDecorations[x],x=this.state.fun.decorate[w[0]][w[1][0]](this.state)),C=e[I-1]+x+e[I+1],r.push(C),e=r.concat(o);for(n=e.length,i=0;n>i;i+=2)e[i]=e[i].replace("'","","g"),e[i]=e[i].replace("  "," ","g");return e},s.Util.FlipFlopper.prototype.processTags=function(){var t,e,i,n,r,o,a,l,u,c,h,p,d,f,m,g,b,y,v,_,x,C,w,S;if(t=[],e=[],i=[],n=[],r="",1===this.strs.length)this.blob.blobs=this.strs[0];else if(this.strs.length>2){for(x=this.strs.length-1,o=1;x>o;o+=2)if(a=this.strs[o],l=this.strs[o-1],l&&(u=new s.Blob(l),c=this.blobstack.value(),c.push(u)),this.closeTagsHash[a]&&(t.reverse(),h=this.openToCloseHash[a],p=t.indexOf(a),d=i.indexOf(a),t.reverse(),!h||p>-1&&(d>p||-1===d))){for(C=t.length,f=C;f>-1;f+=-1)if(m=t[f],a===m){t.pop(),e.pop(),i.pop(),n.pop(),this.blobstack.pop();break}}else if(this.openToCloseHash[a]){if(t.push(this.openToCloseHash[a]),e.push(a),i.push(this.flipTagsHash[a]),c=this.blobstack.value(),g=new s.Blob,c.push(g),b=this.addFlipFlop(g,this.openToDecorations[a]),'<span class="nodecor">'===a)for(y=this.state[this.state.tmp.area].opt.topdecor.concat(this.blob.alldecor).concat([[["@quotes","inner"]]]),C=y.length,f=0;C>f;f+=1)for(v=y[f],S=v.length,w=0;S>w;w+=1)_=v[w],["@font-style","@font-weight","@font-variant"].indexOf(_[0])>-1&&(b=this.addFlipFlop(g,this.okReverseHash[_[0]]));n.push(this.state.fun.decorate[b[0]][b[1]](this.state)),this.blobstack.push(g)}this.strs.length>2&&(r=this.strs[this.strs.length-1],r&&(c=this.blobstack.value(),u=new s.Blob(r),c.push(u)))}return this.blob},s.Util.FlipFlopper.prototype.addFlipFlop=function(t,e){var i,n,s,r,o,a,l,u,c,h;for(n=0,s=this.state[this.state.tmp.area].opt.topdecor.concat(t.alldecor).concat([[["@quotes","inner"]]]),r=s.length,i=0;r>i;i+=1){for(o=s[i],a=!1,h=o.length-1,u=h;u>-1;u+=-1)if(l=o[u],l[0]===e[0]){l[1]===e[1][0]&&(n=1),a=!0;break}if(a)break}return c=[e[0],e[1][n]],t.decorations.reverse(),t.decorations.push(c),t.decorations.reverse(),c},s.Output.Formatters={},s.getSafeEscape=function(t){if(["bibliography","citation"].indexOf(t.tmp.area)>-1){var e=[];return t.opt.development_extensions.thin_non_breaking_space_html_hack&&"html"===t.opt.mode&&e.push(function(t){return t.replace(/\u202f/g,'<span style="white-space:nowrap">&thinsp;</span>')}),e.length?function(i){for(var n=0,r=e.length;r>n;n+=1)i=e[n](i);return s.Output.Formats[t.opt.mode].text_escape(i)}:s.Output.Formats[t.opt.mode].text_escape}return function(t){return t}},s.Output.Formatters.passthrough=function(t,e){return e},s.Output.Formatters.lowercase=function(t,e){var i=s.Output.Formatters.doppelString(e,s.TAG_USEALL);return i.string=i.string.toLowerCase(),s.Output.Formatters.undoppelString(i)},s.Output.Formatters.uppercase=function(t,e){var i=s.Output.Formatters.doppelString(e,s.TAG_USEALL);return i.string=i.string.toUpperCase(),s.Output.Formatters.undoppelString(i)},s.Output.Formatters["capitalize-first"]=function(t,e){var i=s.Output.Formatters.doppelString(e,s.TAG_ESCAPE);return i.string.length?(i.string=i.string.slice(0,1).toUpperCase()+i.string.substr(1),s.Output.Formatters.undoppelString(i)):""},s.Output.Formatters.sentence=function(t,e){var i=s.Output.Formatters.doppelString(e,s.TAG_ESCAPE);return i.string=i.string.slice(0,1).toUpperCase()+i.string.substr(1).toLowerCase(),s.Output.Formatters.undoppelString(i)},s.Output.Formatters["capitalize-all"]=function(t,e){for(var i=s.Output.Formatters.doppelString(e,s.TAG_ESCAPE),n=i.string.split(" "),r=0,o=n.length;o>r;r+=1)n[r].length>1?t.opt.development_extensions.allow_force_lowercase?n[r]=n[r].slice(0,1).toUpperCase()+n[r].substr(1).toLowerCase():n[r]=n[r].slice(0,1).toUpperCase()+n[r].substr(1):1===n[r].length&&(n[r]=n[r].toUpperCase());return i.string=n.join(" "),s.Output.Formatters.undoppelString(i)},s.Output.Formatters.title=function(t,e){function i(t){var e=t.match(/([:?!]+\s+|-|^)(.)(.*)/);return e?e[1]+e[2].toUpperCase()+e[3]:t}var n,r,o,a,l;t.locale[t.opt.lang].opts["skip-words"];if(!e)return"";var u=s.Output.Formatters.doppelString(e,s.TAG_ESCAPE),n=u.string,l=n.split(t.locale[t.opt.lang].opts["skip-words-regexp"]);for(c=1,h=l.length;h>c;c+=2)l[c].match(/^[:?!]/)&&(l[c]=i(l[c]));l[0]||(l[1]=i(l[1])),l.length>2&&!l[l.length-1]&&(l[l.length-2]=i(l[l.length-2]));for(var c=0,h=l.length;h>c;c+=2){for(var r=l[c].split(/([:?!]*\s+|-)/),p=0,d=r.length;d>p;p+=2)if(0!==r[p].length){if(o=r[p].toUpperCase(),a=r[p].toLowerCase(),r[p].match(/[0-9]/))continue;r[p]===a&&(r[p]=i(r[p]))}l[c]=r.join("")}u.string=l.join("");var f=s.Output.Formatters.undoppelString(u);return f},s.Output.Formatters.doppelString=function(t,e){var i;i={},i.array=e(t),i.string="";for(var n=0,s=i.array.length;s>n;n+=2)"-"===i.array[n-1],i.string+=i.array[n];return i},s.Output.Formatters.undoppelString=function(t){var e;e="";for(var i=0,n=t.array.length;n>i;i+=1)i%2?e+=t.array[i]:("-"===t.array[i-1],e+=t.string.slice(0,t.array[i].length),t.string=t.string.slice(t.array[i].length));return e},s.Output.Formatters.serializeItemAsRdf=function(t){return""},s.Output.Formatters.serializeItemAsRdfA=function(t){return""},s.demoteNoiseWords=function(t,e,i){var n=t.locale[t.opt.lang].opts["leading-noise-words"];if(e&&i){e=e.split(/\s+/),e.reverse();for(var s=[],r=e.length-1;r>-1&&n.indexOf(e[r].toLowerCase())>-1;r+=-1)s.push(e.pop());e.reverse();var o=e.join(" "),a=s.join(" ");"drop"!==i&&a?"demote"===i&&(e=[o,a].join(", ")):e=o}return e},s.Output.Formats=function(){},s.Output.Formats.prototype.html={text_escape:function(t){return t||(t=""),t.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace("  ","&#160; ","g").replace(s.SUPERSCRIPTS_REGEXP,function(t){return"<sup>"+s.SUPERSCRIPTS[t]+"</sup>"})},bibstart:'<div class="csl-bib-body">\n',bibend:"</div>","@font-style/italic":"<i>%%STRING%%</i>","@font-style/oblique":"<em>%%STRING%%</em>","@font-style/normal":'<span style="font-style:normal;">%%STRING%%</span>',"@font-variant/small-caps":'<span style="font-variant:small-caps;">%%STRING%%</span>',"@passthrough/true":s.Output.Formatters.passthrough,"@font-variant/normal":'<span style="font-variant:normal;">%%STRING%%</span>',"@font-weight/bold":"<b>%%STRING%%</b>","@font-weight/normal":'<span style="font-weight:normal;">%%STRING%%</span>',"@font-weight/light":!1,"@text-decoration/none":'<span style="text-decoration:none;">%%STRING%%</span>',"@text-decoration/underline":'<span style="text-decoration:underline;">%%STRING%%</span>',"@vertical-align/sup":"<sup>%%STRING%%</sup>","@vertical-align/sub":"<sub>%%STRING%%</sub>","@vertical-align/baseline":'<span style="baseline">%%STRING%%</span>',"@strip-periods/true":s.Output.Formatters.passthrough,"@strip-periods/false":s.Output.Formatters.passthrough,"@quotes/true":function(t,e){return"undefined"==typeof e?t.getTerm("open-quote"):t.getTerm("open-quote")+e+t.getTerm("close-quote")},"@quotes/inner":function(t,e){return"undefined"==typeof e?"":t.getTerm("open-inner-quote")+e+t.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){var i="";return t.sys.embedBibliographyEntry&&(i=t.sys.embedBibliographyEntry(this.item_id)+"\n"),'  <div class="csl-entry">'+e+"</div>\n"+i},"@display/block":function(t,e){return'\n\n    <div class="csl-block">'+e+"</div>\n"},"@display/left-margin":function(t,e){return'\n    <div class="csl-left-margin">'+e+"</div>"},"@display/right-inline":function(t,e){return'<div class="csl-right-inline">'+e+"</div>\n  "},"@display/indent":function(t,e){return'<div class="csl-indent">'+e+"</div>\n  "},"@showid/true":function(t,e,i){if(t.tmp.just_looking||t.tmp.suppress_decorations)return e;if(i)return'<span class="'+t.opt.nodenames[i]+'" cslid="'+i+'">'+e+"</span>";if("string"==typeof e){var n="";if(e){var r=e.match(s.VARIABLE_WRAPPER_PREPUNCT_REX);n=r[1],e=r[2]}var o="";return e&&s.SWAPPING_PUNCTUATION.indexOf(e.slice(-1))>-1&&(o=e.slice(-1),e=e.slice(0,-1)),t.sys.variableWrapper(this.params,n,e,o)}return e},"@URL/true":function(t,e){return'<a href="'+e+'">'+e+"</a>"},"@DOI/true":function(t,e){return'<a href="http://dx.doi.org/'+e+'">'+e+"</a>"}},s.Output.Formats.prototype.text={text_escape:function(t){return t||(t=""),t},bibstart:"",bibend:"","@font-style/italic":!1,"@font-style/oblique":!1,"@font-style/normal":!1,"@font-variant/small-caps":!1,"@passthrough/true":s.Output.Formatters.passthrough,"@font-variant/normal":!1,"@font-weight/bold":!1,"@font-weight/normal":!1,"@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":!1,"@vertical-align/baseline":!1,"@vertical-align/sup":!1,"@vertical-align/sub":!1,"@strip-periods/true":s.Output.Formatters.passthrough,"@strip-periods/false":s.Output.Formatters.passthrough,"@quotes/true":function(t,e){return"undefined"==typeof e?t.getTerm("open-quote"):t.getTerm("open-quote")+e+t.getTerm("close-quote")},"@quotes/inner":function(t,e){return"undefined"==typeof e?"":t.getTerm("open-inner-quote")+e+t.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){return e+"\n"},"@display/block":function(t,e){return"\n"+e},"@display/left-margin":function(t,e){return e},"@display/right-inline":function(t,e){return e},"@display/indent":function(t,e){return"\n    "+e},"@showid/true":function(t,e,i){return e},"@URL/true":function(t,e){return e},"@DOI/true":function(t,e){return e}},s.Output.Formats.prototype.rtf={text_escape:function(t){return t||(t=""),t.replace(/([\\{}])/g,"\\$1","g").replace(s.SUPERSCRIPTS_REGEXP,function(t){return"\\super "+s.SUPERSCRIPTS[t]+"\\nosupersub{}"}).replace(/[\u007F-\uFFFF]/g,function(t){return"\\uc0\\u"+t.charCodeAt(0).toString()+"{}"}).replace("	","\\tab{}","g")},"@passthrough/true":s.Output.Formatters.passthrough,"@font-style/italic":"\\i %%STRING%%\\i0{}","@font-style/normal":"\\i0{}%%STRING%%\\i{}","@font-style/oblique":"\\i %%STRING%%\\i0{}","@font-variant/small-caps":"\\scaps %%STRING%%\\scaps0{}","@font-variant/normal":"\\scaps0{}%%STRING%%\\scaps{}","@font-weight/bold":"\\b %%STRING%%\\b0{}","@font-weight/normal":"\\b0{}%%STRING%%\\b{}","@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":"\\ul %%STRING%%\\ul0{}","@vertical-align/baseline":!1,"@vertical-align/sup":"\\super %%STRING%%\\nosupersub{}","@vertical-align/sub":"\\sub %%STRING%%\\nosupersub{}","@strip-periods/true":s.Output.Formatters.passthrough,"@strip-periods/false":s.Output.Formatters.passthrough,"@quotes/true":function(t,e){return"undefined"==typeof e?s.Output.Formats.rtf.text_escape(t.getTerm("open-quote")):s.Output.Formats.rtf.text_escape(t.getTerm("open-quote"))+e+s.Output.Formats.rtf.text_escape(t.getTerm("close-quote"))},"@quotes/inner":function(t,e){return"undefined"==typeof e?s.Output.Formats.rtf.text_escape(""):s.Output.Formats.rtf.text_escape(t.getTerm("open-inner-quote"))+e+s.Output.Formats.rtf.text_escape(t.getTerm("close-inner-quote"))},"@quotes/false":!1,bibstart:"{\\rtf ",bibend:"}","@display/block":"\\line{}%%STRING%%\\line\r\n","@cite/entry":function(t,e){return e},"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){return e},"@display/left-margin":function(t,e){return e+"\\tab "},"@display/right-inline":function(t,e){return e+"\n"},"@display/indent":function(t,e){return"\n\\tab "+e},"@showid/true":function(t,e,i){if(t.tmp.just_looking||t.tmp.suppress_decorations)return e;var n="";if(e){var r=e.match(s.VARIABLE_WRAPPER_PREPUNCT_REX);n=r[1],e=r[2]}var o="";return e&&s.SWAPPING_PUNCTUATION.indexOf(e.slice(-1))>-1&&(o=e.slice(-1),e=e.slice(0,-1)),t.sys.variableWrapper(this.params,n,e,o)},"@URL/true":function(t,e){return e},"@DOI/true":function(t,e){return e}},s.Output.Formats=new s.Output.Formats,s.Registry=function(t){var e,i,n;this.debug=!1,this.state=t,this.registry={},this.reflist=[],this.namereg=new s.Registry.NameReg(t),this.citationreg=new s.Registry.CitationReg(t),this.authorstrings={},this.mylist=[],this.myhash={},this.deletes=[],this.inserts=[],this.uncited={},this.refreshes={},this.akeys={},this.oldseq={},this.return_data={},this.ambigcites={},this.ambigresets={},this.sorter=new s.Registry.Comparifier(t,"bibliography_sort"),this.getSortedIds=function(){for(e=[],i=0,n=this.reflist.length;n>i;i+=1)e.push(""+this.reflist[i].id);return e},this.getSortedRegistryItems=function(){for(e=[],i=0,n=this.reflist.length;n>i;i+=1)e.push(this.reflist[i]);return e}},s.Registry.prototype.init=function(t,e){var i,n;if(this.oldseq={},e){this.uncited={};for(var i=0,n=t.length;n>i;i+=1)this.myhash[t[i]]||this.mylist.push(""+t[i]),this.uncited[t[i]]=!0,this.myhash[t[i]]=!0}else{for(var s in this.uncited)t.push(s);var r={};for(i=t.length-1;i>-1;i+=-1)r[t[i]]?t=t.slice(0,i).concat(t.slice(i+1)):r[t[i]]=!0;this.mylist=[];for(var i=0,n=t.length;n>i;i+=1)this.mylist.push(""+t[i]);this.myhash=r}this.refreshes={},this.touched={},this.ambigsTouched={},this.ambigresets={}},s.Registry.prototype.dopurge=function(t){for(var e=this.mylist.length-1;e>-1;e+=-1)this.citationreg.citationsByItemId&&(this.citationreg.citationsByItemId[this.mylist[e]]||t[this.mylist[e]]||(delete this.myhash[this.mylist[e]],this.mylist=this.mylist.slice(0,e).concat(this.mylist.slice(e+1))));this.dodeletes(this.myhash)},s.Registry.prototype.dodeletes=function(t){var e,i,n,s,r,o,a,l,u;"string"==typeof t&&(t={},t[t]=!0);for(i in this.registry)if(!t[i]){if(this.uncited[i])continue;e=this.namereg.delitems(i);for(a in e)this.refreshes[a]=!0;for(n=this.registry[i].ambig,l=this.ambigcites[n].indexOf(i),l>-1&&(o=this.ambigcites[n].slice(),this.ambigcites[n]=o.slice(0,l).concat(o.slice(l+1,o.length)),this.ambigresets[n]=this.ambigcites[n].length),r=this.ambigcites[n].length,s=0;r>s;s+=1)u=""+this.ambigcites[n][s],this.refreshes[u]=!0;if(this.registry[i].siblings)if(1==this.registry[i].siblings.length){var c=this.registry[i].siblings[0];this.registry[c].master=!0,this.registry[c].siblings.pop(),this.registry[c].parallel=!1}else if(this.registry[i].siblings.length>1){var h=[i];if(this.registry[i].master){var p=this.registry[i].siblings[0],d=this.registry[p];d.master=!0,d.parallel=!1,h.push(p);for(var f=0,m=this.registry[i].siblings.length;m>f;f+=1)this.registry[this.registry[i].siblings[f]].parallel=p}for(var g=[],f=this.registry[i].siblings.length-1;f>-1;f+=-1){var b=this.registry[i].siblings.pop();-1===h.indexOf(b)&&g.push(b)}for(var f=g.length-1;f>-1;f+=-1)this.registry[i].siblings.push(g[f])}delete this.registry[i],this.return_data.bibchange=!0}},s.Registry.prototype.doinserts=function(t){var e,i,n,r,o,a,l;for("string"==typeof t&&(t=[t]),a=0,l=t.length;l>a;a+=1)e=t[a],this.registry[e]||(i=this.state.retrieveItem(e),n=s.getAmbiguousCite.call(this.state,i),this.ambigsTouched[n]=!0,i.legislation_id||(this.akeys[n]=!0),r={id:""+e,seq:0,offset:0,sortkeys:!1,ambig:!1,rendered:!1,disambig:!1,ref:i},this.registry[e]=r,this.citationreg.citationsByItemId&&this.citationreg.citationsByItemId[e]&&(this.registry[e]["first-reference-note-number"]=this.citationreg.citationsByItemId[e][0].properties.noteIndex),o=s.getAmbigConfig.call(this.state),this.registerAmbigToken(n,e,o),this.touched[e]=!0,this.return_data.bibchange=!0)},s.Registry.prototype.rebuildlist=function(){var t,e,i;for(this.reflist=[],this.state.opt.citation_number_sort_direction===s.DESCENDING&&this.state.opt.citation_number_sort_used,t=this.mylist.length,e=0;t>e;e+=1)i=this.mylist[e],this.reflist.push(this.registry[i]),this.oldseq[i]=this.registry[i].seq,this.registry[i].seq=e+1;this.state.opt.citation_number_sort_direction===s.DESCENDING&&this.state.opt.citation_number_sort_used},s.Registry.prototype.dorefreshes=function(){var t,e,i,n,r;for(t in this.refreshes)if(e=this.registry[t]){e.sortkeys=void 0,i=this.state.retrieveItem(t);var n=e.ambig;"undefined"==typeof n&&(this.state.tmp.disambig_settings=!1,n=s.getAmbiguousCite.call(this.state,i),r=s.getAmbigConfig.call(this.state),this.registerAmbigToken(n,t,r));for(var o in this.ambigresets)if(1===this.ambigresets[o]){var a=this.ambigcites[n][0],i=this.state.retrieveItem(a);this.registry[a].disambig=new s.AmbigConfig,this.state.tmp.disambig_settings=!1;var n=s.getAmbiguousCite.call(this.state,i),r=s.getAmbigConfig.call(this.state);this.registerAmbigToken(n,a,r)}this.state.tmp.taintedItemIDs[t]=!0,this.ambigsTouched[n]=!0,i.legislation_id||(this.akeys[n]=!0),this.touched[t]=!0}},s.Registry.prototype.setdisambigs=function(){var t;this.leftovers=[];for(t in this.ambigsTouched)this.state.disambiguate.run(t);this.ambigsTouched={},this.akeys={}},s.Registry.prototype.renumber=function(){var t,e,i;for(this.state.opt.citation_number_sort_direction===s.DESCENDING&&this.state.opt.citation_number_sort_used,t=this.reflist.length,
e=0;t>e;e+=1)i=this.reflist[e],i.seq=e+1,this.state.opt.update_mode===s.NUMERIC&&i.seq!=this.oldseq[i.id]&&(this.state.tmp.taintedItemIDs[i.id]=!0),this.state.opt.bib_mode===s.NUMERIC&&i.seq!=this.oldseq[i.id]&&(this.return_data.bibchange=!0);this.state.opt.citation_number_sort_direction===s.DESCENDING&&this.state.opt.citation_number_sort_used&&this.reflist.reverse()},s.Registry.prototype.setsortkeys=function(){for(var t,e=0,i=this.mylist.length;i>e;e+=1){var t=this.mylist[e];(this.touched[t]||this.state.tmp.taintedItemIDs[t]||!this.registry[t].sortkeys)&&(this.registry[t].sortkeys=s.getSortKeys.call(this.state,this.state.retrieveItem(t),"bibliography_sort"))}},s.Registry.prototype.sorttokens=function(){this.reflist.sort(this.sorter.compareKeys)},s.Registry.Comparifier=function(t,e){var i,n,r,o,a=s.getSortCompare(t.opt["default-locale-sort"]);i=t[e].opt.sort_directions,this.compareKeys=function(t,e){for(n=t.sortkeys?t.sortkeys.length:0,r=0;n>r;r+=1){var s=0;if(s=t.sortkeys[r]===e.sortkeys[r]?0:"undefined"==typeof t.sortkeys[r]?i[r][1]:"undefined"==typeof e.sortkeys[r]?i[r][0]:a(t.sortkeys[r],e.sortkeys[r]),s>0)return i[r][1];if(0>s)return i[r][0]}return t.seq>e.seq?1:t.seq<e.seq?-1:0},o=this.compareKeys,this.compareCompositeKeys=function(t,e){return o(t[1],e[1])}},s.Registry.prototype.compareRegistryTokens=function(t,e){return t.seq>e.seq?1:t.seq<e.seq?-1:0},s.Registry.prototype.registerAmbigToken=function(t,e,i){if(this.registry[e]&&this.registry[e].disambig&&this.registry[e].disambig.names)for(var n=0,r=i.names.length;r>n;n+=1){var o=i.names[n],a=this.registry[e].disambig.names[n];if(o!==a)this.state.tmp.taintedItemIDs[e]=!0;else if(i.givens[n])for(var l=0,u=i.givens[n].length;u>l;l+=1){var c=i.givens[n][l],h=this.registry[e].disambig.givens[n][l];c!==h&&(this.state.tmp.taintedItemIDs[e]=!0)}}this.ambigcites[t]||(this.ambigcites[t]=[]),-1===this.ambigcites[t].indexOf(""+e)&&this.ambigcites[t].push(""+e),this.registry[e].ambig=t;this.registry[e].disambig=s.cloneAmbigConfig(i)},s.getSortKeys=function(t,e){var i,n,r,o,a,l;for(i=this.tmp.area,n=this.tmp.extension,r=s.Util.Sort.strip_prepositions,this.tmp.area=e,this.tmp.extension="_sort",this.tmp.disambig_override=!0,this.tmp.disambig_request=!1,o=this.parallel.use_parallels,this.parallel.use_parallels=!1,this.tmp.suppress_decorations=!0,s.getCite.call(this,t),this.tmp.suppress_decorations=!1,this.parallel.use_parallels=o,this.tmp.disambig_override=!1,a=this[e].keys.length,l=0;a>l;l+=1)this[e].keys[l]=r(this[e].keys[l]);return this.tmp.area=i,this.tmp.extension=n,this[e].keys},s.Registry.NameReg=function(t){var e,i,n,r,o,a,l,u,c,h,p,d,f,m,g,b;this.state=t,this.namereg={},this.nameind={},this.nameindpkeys={},this.itemkeyreg={},u=function(t){return t||(t=""),t.replace("."," ","g").replace(/\s+/g," ").replace(/\s+$/,"")},c=function(t,r,o){e=u(o.family),n=u(o.given);var a=n.match(/[,\!]* ([^,]+)$/);a&&a[1]===a[1].toLowerCase()&&(n=n.replace(/[,\!]* [^,]+$/,"")),i=s.Util.Names.initializeWith(t,n,"%s"),"by-cite"===t.citation.opt["givenname-disambiguation-rule"]&&(e=""+r+e)},h=function(n,s,a,l,u,h){var p;if("bibliography"===t.tmp.area.slice(0,12)&&!u)return"string"==typeof h?1:2;var d=t.nameOutput.getName(s,"locale-translit",!0);s=d.name,c(this.state,""+n,s),p=2,r=t.opt["disambiguate-add-givenname"],o=t.citation.opt["givenname-disambiguation-rule"];var f=o;return"by-cite"===o&&(o="all-names"),"short"===u?p=0:"string"==typeof h&&(p=1),"undefined"==typeof this.namereg[e]||"undefined"==typeof this.namereg[e].ikey[i]?p:"by-cite"===f&&l>=p?l:r?"string"==typeof o&&"primary-name"===o.slice(0,12)&&a>0?p:(o&&"all-names"!==o&&"primary-name"!==o?("all-names-with-initials"===o||"primary-name-with-initials"===o)&&(p=this.namereg[e].count>1?1:0):(this.namereg[e].count>1&&(p=1),(this.namereg[e].ikey&&this.namereg[e].ikey[i].count>1||this.namereg[e].count>1&&"string"!=typeof h)&&(p=2)),t.registry.registry[n]?p:"short"==u?0:"string"==typeof h?1:void 0):p},p=function(s){var r,o,u,c,h;for(("string"==typeof s||"number"==typeof s)&&(s=[""+s]),a={},o=s.length,r=0;o>r;r+=1)if(c=""+s[r],this.nameind[c]){for(h in this.nameind[c])if(this.nameind[c].hasOwnProperty(h)){if(f=h.split("::"),e=f[0],i=f[1],n=f[2],"undefined"==typeof this.namereg[e])continue;if(l=this.namereg[e].items,n&&this.namereg[e].ikey[i]&&this.namereg[e].ikey[i].skey[n]&&(m=this.namereg[e].ikey[i].skey[n].items,u=m.indexOf(""+c),u>-1&&(this.namereg[e].ikey[i].skey[n].items=m.slice(0,u).concat(m.slice([u+1]))),0===this.namereg[e].ikey[i].skey[n].items.length&&(delete this.namereg[e].ikey[i].skey[n],this.namereg[e].ikey[i].count+=-1,this.namereg[e].ikey[i].count<2)))for(g=0,b=this.namereg[e].ikey[i].items.length;b>g;g+=1)t.tmp.taintedItemIDs[this.namereg[e].ikey[i].items[g]]=!0;if(i&&this.namereg[e].ikey[i]&&(u=this.namereg[e].ikey[i].items.indexOf(""+c),u>-1&&(l=this.namereg[e].ikey[i].items.slice(),this.namereg[e].ikey[i].items=l.slice(0,u).concat(l.slice([u+1]))),0===this.namereg[e].ikey[i].items.length&&(delete this.namereg[e].ikey[i],this.namereg[e].count+=-1,this.namereg[e].count<2)))for(g=0,b=this.namereg[e].items.length;b>g;g+=1)t.tmp.taintedItemIDs[this.namereg[e].items[g]]=!0;e&&(u=this.namereg[e].items.indexOf(""+c),u>-1&&(l=this.namereg[e].items.slice(),this.namereg[e].items=l.slice(0,u).concat(l.slice([u+1],l.length))),this.namereg[e].items.length<2&&delete this.namereg[e]),delete this.nameind[c][h]}delete this.nameind[c],delete this.nameindpkeys[c]}return a},d=function(s,r,o){var a,l,u=t.nameOutput.getName(r,"locale-translit",!0);if(r=u.name,!t.citation.opt["givenname-disambiguation-rule"]||"primary-"!==t.citation.opt["givenname-disambiguation-rule"].slice(0,8)||0===o){if(c(this.state,""+s,r),e&&("undefined"==typeof this.namereg[e]?(this.namereg[e]={},this.namereg[e].count=0,this.namereg[e].ikey={},this.namereg[e].items=[s]):-1===this.namereg[e].items.indexOf(s)&&this.namereg[e].items.push(s)),e&&i)if("undefined"==typeof this.namereg[e].ikey[i]){if(this.namereg[e].ikey[i]={},this.namereg[e].ikey[i].count=0,this.namereg[e].ikey[i].skey={},this.namereg[e].ikey[i].items=[s],this.namereg[e].count+=1,2===this.namereg[e].count)for(a=0,l=this.namereg[e].items.length;l>a;a+=1)t.tmp.taintedItemIDs[this.namereg[e].items[a]]=!0}else-1===this.namereg[e].ikey[i].items.indexOf(s)&&this.namereg[e].ikey[i].items.push(s);if(e&&i&&n)if("undefined"==typeof this.namereg[e].ikey[i].skey[n]){if(this.namereg[e].ikey[i].skey[n]={},this.namereg[e].ikey[i].skey[n].items=[s],this.namereg[e].ikey[i].count+=1,2===this.namereg[e].ikey[i].count)for(a=0,l=this.namereg[e].ikey[i].items.length;l>a;a+=1)t.tmp.taintedItemIDs[this.namereg[e].ikey[i].items[a]]=!0}else-1===this.namereg[e].ikey[i].skey[n].items.indexOf(s)&&this.namereg[e].ikey[i].skey[n].items.push(s);"undefined"==typeof this.nameind[s]&&(this.nameind[s]={},this.nameindpkeys[s]={}),e&&(this.nameind[s][e+"::"+i+"::"+n]=!0,this.nameindpkeys[s][e]=this.namereg[e])}},this.addname=d,this.delitems=p,this.evalname=h},s.Registry.CitationReg=function(t){this.citationById={},this.citationByIndex=[]},s.Disambiguation=function(t){this.state=t,this.sys=this.state.sys,this.registry=t.registry.registry,this.ambigcites=t.registry.ambigcites,this.configModes(),this.debug=!1},s.Disambiguation.prototype.run=function(t){this.modes.length&&(this.akey=t,this.initVars(t)&&this.runDisambig())},s.Disambiguation.prototype.runDisambig=function(){var t;for(this.initGivens=!0;this.lists.length;){for(this.gnameset=0,this.gname=0,this.clashes=[1,0];this.lists[0][1].length;){this.listpos=0,this.base||(this.base=this.lists[0][0]);t=this.incrementDisambig(),this.scanItems(this.lists[0]),this.evalScan(t)}this.lists=this.lists.slice(1)}},s.Disambiguation.prototype.scanItems=function(t){var e,i,n;this.Item=t[1][0],this.ItemCite=s.getAmbiguousCite.call(this.state,this.Item,this.base,!0),this.scanlist=t[1],this.partners=[],this.partners.push(this.Item),this.nonpartners=[];var r=0;for(e=1,i=t[1].length;i>e;e+=1){n=t[1][e];var o=s.getAmbiguousCite.call(this.state,n,this.base,!0);this.ItemCite===o?(r+=1,this.partners.push(n)):this.nonpartners.push(n)}this.clashes[0]=this.clashes[1],this.clashes[1]=r},s.Disambiguation.prototype.evalScan=function(t){this[this.modes[this.modeindex]](t),t&&(this.modeindex<this.modes.length-1?this.modeindex+=1:this.lists[this.listpos+1]=[this.base,[]])},s.Disambiguation.prototype.disNames=function(t){var e,i;if(0===this.clashes[1]&&1===this.nonpartners.length)this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,[]];else if(0===this.clashes[1])this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.nonpartners.length&&(this.initGivens=!0);else if(1===this.nonpartners.length)this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.partners];else if(this.clashes[1]<this.clashes[0])this.captureStepToBase(),this.lists[this.listpos]=[this.betterbase,this.partners],this.lists.push([this.betterbase,this.nonpartners]);else if(t&&(this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.lists.push([this.betterbase,this.partners]),this.modeindex===this.modes.length-1)){for(e=0,i=this.partners.length;i>e;e+=1)this.state.registry.registerAmbigToken(this.akey,""+this.partners[e].id,this.betterbase);this.lists[this.listpos]=[this.betterbase,[]]}},s.Disambiguation.prototype.disExtraText=function(){var t=!1;if(0===this.clashes[1]&&this.nonpartners.length<2&&(t=!0),t||this.base.disambiguate&&this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax){if(t||this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax)if(t||this.modeindex===this.modes.length-1){for(var e=this.lists[this.listpos][0],i=0,n=this.lists[this.listpos][1].length;n>i;i+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][i].id,e);this.lists[this.listpos]=[this.betterbase,[]]}else{this.modeindex=this.modes.length-1;var e=this.lists[this.listpos][0];e.disambiguate=!0;for(var i=0,n=this.lists[this.listpos][1].length;n>i;i+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][i].id,e)}}else if(this.modeindex=0,this.base.disambiguate=this.state.tmp.disambiguate_count,this.betterbase.disambiguate=this.state.tmp.disambiguate_count,this.base.disambiguate)this.disNames();else{this.initGivens=!0,this.base.disambiguate=1;for(var i=0,n=this.lists[this.listpos][1].length;n>i;i+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id]=!0}},s.Disambiguation.prototype.disYears=function(){var t,e,i,n;i=[];var r=this.lists[this.listpos][0];if(this.clashes[1])for(var o=0,a=this.state.registry.mylist.length;a>o;o+=1)for(var l=this.state.registry.mylist[o],u=0,c=this.lists[this.listpos][1].length;c>u;u+=1){var n=this.lists[this.listpos][1][u];if(n.id==l){i.push(this.registry[n.id]);break}}for(i.sort(this.state.registry.sorter.compareKeys),t=0,e=i.length;e>t;t+=1){r.year_suffix=""+t;var h=this.state.registry.registry[i[t].id].disambig;this.state.registry.registerAmbigToken(this.akey,""+i[t].id,r),s.ambigConfigDiff(h,r)&&(this.state.tmp.taintedItemIDs[i[t].id]=!0)}this.lists[this.listpos]=[this.betterbase,[]]},s.Disambiguation.prototype.incrementDisambig=function(){if(this.initGivens)return this.initGivens=!1,!1;var t=!1,e=!0;if("disNames"===this.modes[this.modeindex]){e=!1,"number"!=typeof this.givensMax&&(e=!0);var i=!1;if("number"!=typeof this.namesMax&&(i=!0),"number"==typeof this.givensMax&&(this.base.givens.length&&this.base.givens[this.gnameset][this.gname]<this.givensMax?this.base.givens[this.gnameset][this.gname]+=1:e=!0),"number"==typeof this.namesMax&&e&&(this.state.opt["disambiguate-add-names"]?(i=!1,this.gname<this.namesMax?(this.base.names[this.gnameset]+=1,this.gname+=1):i=!0):i=!0),"number"==typeof this.namesetsMax&&i)if(this.gnameset<this.namesetsMax)this.gnameset+=1,this.base.names[this.gnameset]=1,this.gname=0;else;"number"==typeof this.namesetsMax&&-1!==this.namesetsMax&&this.gnameset!==this.namesetsMax||this.state.opt["disambiguate-add-names"]&&"number"==typeof this.namesMax&&this.gname!==this.namesMax||"number"==typeof this.givensMax&&"undefined"!=typeof this.base.givens[this.gnameset]&&"undefined"!=typeof this.base.givens[this.gnameset][this.gname]&&this.base.givens[this.gnameset][this.gname]!==this.givensMax||(t=!0)}else"disExtraText"===this.modes[this.modeindex]&&(this.base.disambiguate+=1,this.betterbase.disambiguate+=1);return t},s.Disambiguation.prototype.initVars=function(t){var e,i,n,r,o;if(this.lists=[],this.base=!1,this.betterbase=!1,this.akey=t,this.maxNamesByItemId={},r=[],n=this.ambigcites[t],!n||!n.length)return!1;var a=this.state.retrieveItem(""+n[0]);if(this.getCiteData(a),this.base=s.getAmbigConfig.call(this.state),n&&n.length>1){for(r.push([this.maxNamesByItemId[a.id],a]),e=1,i=n.length;i>e;e+=1)a=this.state.retrieveItem(""+n[e]),this.getCiteData(a,this.base),r.push([this.maxNamesByItemId[a.id],a]);for(r.sort(function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:t[1].id>e[1].id?1:t[1].id<e[1].id?-1:0}),o=[],e=0,i=r.length;i>e;e+=1)o.push(r[e][1]);this.lists.push([this.base,o]),this.Item=this.lists[0][1][0]}else this.Item=this.state.retrieveItem(""+n[0]);if(this.modeindex=0,this.state.citation.opt["disambiguate-add-names"],0)for(var l=this.base.names[0],e=1,i=this.base.names.length;i>e;e+=1)l=Math.max(l,this.base.names.names[e]);else this.namesMax=this.maxNamesByItemId[this.Item.id][0];return this.padBase(this.base),this.padBase(this.betterbase),this.base.year_suffix=!1,this.base.disambiguate=!1,this.betterbase.year_suffix=!1,this.betterbase.disambiguate=!1,"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.state.opt["disambiguate-add-givenname"]&&(this.givensMax=2),!0},s.Disambiguation.prototype.padBase=function(t){for(var e=0,i=t.names.length;i>e;e+=1){t.givens[e]||(t.givens[e]=[]);for(var n=0,s=t.names[e];s>n;n+=1)t.givens[e][n]||(t.givens[e][n]=0)}},s.Disambiguation.prototype.configModes=function(){var t,e;this.modes=[],t=this.state.opt["disambiguate-add-givenname"],e=this.state.citation.opt["givenname-disambiguation-rule"],(this.state.opt["disambiguate-add-names"]||t&&"by-cite"===e)&&this.modes.push("disNames"),this.state.opt.has_disambiguate&&this.modes.push("disExtraText"),this.state.opt["disambiguate-add-year-suffix"]&&this.modes.push("disYears")},s.Disambiguation.prototype.getCiteData=function(t,e){if(!this.maxNamesByItemId[t.id]){s.getAmbiguousCite.call(this.state,t,e),e=s.getAmbigConfig.call(this.state),this.maxNamesByItemId[t.id]=s.getMaxVals.call(this.state),this.state.registry.registry[t.id].disambig.givens=this.state.tmp.disambig_settings.givens.slice();for(var i=0,n=this.state.registry.registry[t.id].disambig.givens.length;n>i;i+=1)this.state.registry.registry[t.id].disambig.givens[i]=this.state.tmp.disambig_settings.givens[i].slice();this.namesetsMax=this.state.registry.registry[t.id].disambig.names.length-1,this.base||(this.base=e,this.betterbase=s.cloneAmbigConfig(e)),e.names.length<this.base.names.length&&(this.base=e);for(var i=0,n=e.names.length;n>i;i+=1)e.names[i]>this.base.names[i]&&(this.base.givens[i]=e.givens[i].slice(),this.base.names[i]=e.names[i],this.betterbase.names=this.base.names.slice(),this.betterbase.givens=this.base.givens.slice(),this.padBase(this.base),this.padBase(this.betterbase));this.betterbase.givens=this.base.givens.slice();for(var r=0,o=this.base.givens.length;o>r;r+=1)this.betterbase.givens[r]=this.base.givens[r].slice()}},s.Disambiguation.prototype.captureStepToBase=function(){"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.base.givens&&this.base.givens.length&&"undefined"!=typeof this.base.givens[this.gnameset][this.gname]&&(this.betterbase.givens[this.gnameset][this.gname]=this.base.givens[this.gnameset][this.gname]),this.betterbase.names[this.gnameset]=this.base.names[this.gnameset]}},{"./csl_nodejs_jsdom":435}],434:[function(t,e,i){var n="undefined"!=typeof window,s=function(){this.institutionStr='<institution institution-parts="long" delimiter=", " substitute-use-first="1" use-last="1"><institution-part name="long"/></institution>',this.ns="http://purl.org/net/xbiblio/csl"};s.prototype._parseDoc=function(t){if(n){var e=new window.DOMParser;return e.parseFromString(t,"text/xml")}return $(t)},s.prototype.importNode=function(t,e){return n?t.importNode(e,!0):(e._root=t._root,e)},s.prototype._hasAttributes=function(t){return t.attributes&&t.attributes.length>0},s.prototype._isElementNode=function(t){return n?t.nodeType===window.Node.ELEMENT_NODE:"tag"===t.type},s.prototype._getTagName=function(t){return t.tagName?t.tagName.toLowerCase():""},s.prototype.clean=function(t){return t=t.replace(/<\?[^?]+\?>/g,""),t=t.replace(/<![^>]+>/g,""),t=t.replace(/^\s+/,""),t=t.replace(/\s+$/,""),t=t.replace(/^\n*/,"")},s.prototype.getStyleId=function(t,e){var i=e?"title":"id",n=$(t).find(i);return n.length&&(n=n[0]),$(n).text()},s.prototype.children=function(t){return $(t).children()},s.prototype.nodename=function(t){return this._getTagName(t)},s.prototype.attributes=function(t){var e,i,s={};if(t){if(n){if(this._hasAttributes(t)){e=t.attributes;for(var r=0,o=e.length;o>r;r+=1)i=e[r],s["@"+i.name]=i.value}}else if(t.attribs){e=t.attribs;for(var a in e)e.hasOwnProperty(a)&&(s["@"+a]=e[a])}}else;return s},s.prototype.content=function(t){return $(t).text()},s.prototype.namespace={xml:"http://www.w3.org/XML/1998/namespace"},s.prototype.numberofnodes=function(t){return t?t.length:0},s.prototype.getAttributeName=function(t){return t.name},s.prototype.getAttributeValue=function(t,e,i){return i&&(e=i+":"+e),$(t).attr(e)},s.prototype.getNodeValue=function(t,e){if(!e)return $(t).text();var i=$(t).find(e);return i.length?i.text():void 0},s.prototype.setAttributeOnNodeIdentifiedByNameAttribute=function(t,e,i,n,s){"@"===n.slice(0,1)&&(n=n.slice(1)),$(t).find(e).each(function(){var t=$(this);t.attr("name")===i&&t.attr(n,s)})},s.prototype.deleteNodeByNameAttribute=function(t,e){$(t).find("*[name="+e+"]").remove()},s.prototype.deleteAttribute=function(t,e){$(t).removeAttr(e)},s.prototype.setAttribute=function(t,e,i){return $(t).attr(e,i),!1},s.prototype.nodeCopy=function(t){return $(t).clone()},s.prototype.getNodesByName=function(t,e,i){return $(t).find(e+"[name="+i+"]")},s.prototype.nodeNameIs=function(t,e){return this._getTagName(t)===e},s.prototype.makeXml=function(t){t||(t="<docco><bogus/></docco>"),t=t.replace(/\s*<\?[^>]*\?>\s*\n*/g,"");var e,i=this._parseDoc(t);return e=n?i.firstChild:i._root},s.prototype.insertChildNodeAfter=function(t,e,i,n){var s=this.importNode(e.ownerDocument,n);return $(s).insertAfter(e),t},s.prototype.insertPublisherAndPlace=function(t){for(var e=$(t).find("group"),i=0,n=e.length;n>i;i+=1){var s=$(e[i]),r=s.find("[variable=publisher]"),o=s.find("[variable=publisher-place]");r.length&&o.length&&s.attr("has-publisher-and-publisher-place",!0)}},s.prototype.addMissingNameNodes=function(t){$(t).find("names").each(function(){var t=$(this),e=t.find("name");0!==e.length||t.parent("substitute")||t.append($("<name>"))})},s.prototype.addInstitutionNodes=function(t){function e(t,e){for(var i=0,n=CSL.INSTITUTION_KEYS.length;n>i;i+=1){var s=CSL.INSTITUTION_KEYS[i],r=e.attr(s);r&&t.attr(s,r)}}$(t).find("names").each(function(){var t=$(this).find("name"),i=$(this).find("institution");if(t.length&&!i.length){i=$(this.institutionStr);var n=i.find("institution-part");e(n,t),t.find("name-part[name=family]").each(function(){e(n,$(this))}),i.insertBefore(t)}})},s.prototype.flagDateMacros=function(t){$(t).find("macro").each(function(){var t=$(this),e=t.find("data");e.length&&t.attr("macro-has-date","true")})},e.exports=s},{}],435:[function(t,e,i){var n;n=t("undefined"==typeof window?"./csl_jquery":"./xmldom"),e.exports={CSL_NODEJS_JSDOM:n}},{"./csl_jquery":434,"./xmldom":436}],436:[function(t,e,i){var n,s=function(){"undefined"==typeof DOMParser||n?(n=!0,DOMParser=function(){},DOMParser.prototype.parseFromString=function(t,e){if("undefined"!=typeof ActiveXObject){var i=new ActiveXObject("MSXML.DomDocument");return i.async=!1,i.loadXML(t),i}if("undefined"!=typeof XMLHttpRequest){var i=new XMLHttpRequest;return e||(e="text/xml"),i.open("GET","data:"+e+";charset=utf-8,"+encodeURIComponent(t),!1),i.overrideMimeType&&i.overrideMimeType(e),i.send(null),i.responseXML}},this.hasAttributes=function(t){var e;return e=t.attributes&&t.attributes.length?!0:!1}):this.hasAttributes=function(t){var e;return e=t.attributes&&t.attributes.length?!0:!1},this.importNode=function(t,e){if("undefined"==typeof t.importNode)var i=this._importNode(t,e,!0);else var i=t.importNode(e,!0);return i},this._importNode=function(t,e,i){switch(e.nodeType){case 1:var n=t.createElement(e.nodeName);if(e.attributes&&e.attributes.length>0)for(var s=0,r=e.attributes.length;r>s;)n.setAttribute(e.attributes[s].nodeName,e.getAttribute(e.attributes[s++].nodeName));if(i&&e.childNodes&&e.childNodes.length>0)for(var s=0,r=e.childNodes.length;r>s;)n.appendChild(this._importNode(t,e.childNodes[s++],i));return n;case 3:case 4:case 8:}},this.parser=new DOMParser;var t='<docco><institution institution-parts="long" delimiter=", " substitute-use-first="1" use-last="1"><institution-part name="long"/></institution></docco>',e=this.parser.parseFromString(t,"text/xml"),i=e.getElementsByTagName("institution");this.institution=i.item(0);var s=e.getElementsByTagName("institution-part");this.institutionpart=s.item(0),this.ns="http://purl.org/net/xbiblio/csl"};s.prototype.clean=function(t){return t=t.replace(/<\?[^?]+\?>/g,""),t=t.replace(/<![^>]+>/g,""),t=t.replace(/^\s+/,""),t=t.replace(/\s+$/,""),t=t.replace(/^\n*/,"")},s.prototype.getStyleId=function(t){var e="",i=t.getElementsByTagName("id");return i&&i.length&&(i=i.item(0)),i&&(e=i.textContent),e||(e=i.innerText),e||(e=i.innerHTML),e},s.prototype.children=function(t){var e,i,n,s;if(t){for(s=[],e=t.childNodes,i=0,n=e.length;n>i;i+=1)"#text"!=e[i].nodeName&&s.push(e[i]);return s}return[]},s.prototype.nodename=function(t){var e=t.nodeName;return e},s.prototype.attributes=function(t){var e,i,n,s,r;if(e=new Object,t&&this.hasAttributes(t))for(i=t.attributes,s=0,r=i.length;r>s;s+=1)n=i[s],e["@"+n.name]=n.value;return e},s.prototype.content=function(t){var e;return e="undefined"!=typeof t.textContent?t.textContent:"undefined"!=typeof t.innerText?t.innerText:t.txt},s.prototype.namespace={xml:"http://www.w3.org/XML/1998/namespace"},s.prototype.numberofnodes=function(t){return t?t.length:0},s.prototype.getAttributeName=function(t){var e=t.name;return e},s.prototype.getAttributeValue=function(t,e,i){var n="";return t&&this.hasAttributes(t)&&t.getAttribute(e)&&(n=t.getAttribute(e)),n},s.prototype.getNodeValue=function(t,e){var i="";if(e){var n=t.getElementsByTagName(e);n.length>0&&(i="undefined"!=typeof n[0].textContent?n[0].textContent:"undefined"!=typeof n[0].innerText?n[0].innerText:n[0].text)}else i=t;return i&&i.childNodes&&(0==i.childNodes.length||1==i.childNodes.length&&"#text"==i.firstChild.nodeName)&&(i="undefined"!=typeof i.textContent?i.textContent:"undefined"!=typeof i.innerText?i.innerText:i.text),i},s.prototype.setAttributeOnNodeIdentifiedByNameAttribute=function(t,e,i,n,s){var r,o,a,l;for("@"===n.slice(0,1)&&(n=n.slice(1)),a=t.getElementsByTagName(e),r=0,o=a.length;o>r;r+=1)l=a[r],l.getAttribute("name")==i&&l.setAttribute(n,s)},s.prototype.deleteNodeByNameAttribute=function(t,e){var i,n,s,r;for(r=t.childNodes,i=0,n=r.length;n>i;i+=1)s=r[i],s&&s.nodeType!=s.TEXT_NODE&&this.hasAttributes(s)&&s.getAttribute("name")==e&&t.removeChild(r[i])},s.prototype.deleteAttribute=function(t,e){t.removeAttribute(e)},s.prototype.setAttribute=function(t,e,i){return t.ownerDocument||(t=t.firstChild),["function","unknown"].indexOf(typeof t.setAttribute)>-1&&t.setAttribute(e,i),!1},s.prototype.nodeCopy=function(t){var e=t.cloneNode(!0);return e},s.prototype.getNodesByName=function(t,e,i){var n,s,r,o,a;for(n=[],s=t.getElementsByTagName(e),o=0,a=s.length;a>o;o+=1)r=s.item(o),(!i||this.hasAttributes(r)&&r.getAttribute("name")==i)&&n.push(r);return n},s.prototype.nodeNameIs=function(t,e){return e==t.nodeName?!0:!1},s.prototype.makeXml=function(t){t||(t="<docco><bogus/></docco>"),t=t.replace(/\s*<\?[^>]*\?>\s*\n*/g,"");var e=this.parser.parseFromString(t,"application/xml");return e.firstChild},s.prototype.insertChildNodeAfter=function(t,e,i,n){var s;return s=this.importNode(e.ownerDocument,n),t.replaceChild(s,e),t},s.prototype.insertPublisherAndPlace=function(t){for(var e=t.getElementsByTagName("group"),i=0,n=e.length;n>i;i+=1){for(var s=e.item(i),r=[],o=0,a=s.childNodes.length;a>o;o+=1)1!==s.childNodes.item(o).nodeType&&r.push(o);if(s.childNodes.length-r.length===2){for(var l=[],o=0,a=2;a>o;o+=1)if(!(r.indexOf(o)>-1)){for(var u=s.childNodes.item(o),c=[],h=0,p=u.childNodes.length;p>h;h+=1)1!==u.childNodes.item(h).nodeType&&c.push(h);if(u.childNodes.length-c.length===0&&(l.push(u.getAttribute("variable")),u.getAttribute("suffix")||u.getAttribute("prefix"))){l=[];break}}l.indexOf("publisher")>-1&&l.indexOf("publisher-place")>-1&&s.setAttribute("has-publisher-and-publisher-place",!0)}}},s.prototype.addMissingNameNodes=function(t){for(var e=t.getElementsByTagName("names"),i=0,n=e.length;n>i;i+=1){var s=e.item(i),r=s.getElementsByTagName("name");if((!r||0===r.length)&&"substitute"!==s.parentNode.tagName.toLowerCase()){var o=s.ownerDocument,a=o.createElement("name");s.appendChild(a)}}};var r={INSTITUTION_KEYS:["font-style","font-variant","font-weight","text-decoration","text-case"]};s.prototype.addInstitutionNodes=function(t){var e,i,n,s,o,a,l,u,c;for(e=t.getElementsByTagName("names"),u=0,c=e.length;c>u;u+=1)if(i=e.item(u),a=i.getElementsByTagName("name"),0!=a.length&&(n=i.getElementsByTagName("institution"),0==n.length)){s=this.importNode(t.ownerDocument,this.institution),o=s.getElementsByTagName("institution-part").item(0),l=a.item(0),i.insertBefore(s,l.nextSibling);for(var h=0,p=r.INSTITUTION_KEYS.length;p>h;h+=1){var d=r.INSTITUTION_KEYS[h],f=l.getAttribute(d);f&&o.setAttribute(d,f)}for(var m=l.getElementsByTagName("name-part"),h=0,p=m.length;p>h;h+=1)if("family"===m[h].getAttribute("name"))for(var g=0,b=r.INSTITUTION_KEYS.length;b>g;g+=1){var d=r.INSTITUTION_KEYS[g],f=m[h].getAttribute(d);f&&o.setAttribute(d,f)}}},s.prototype.flagDateMacros=function(t){var e,i,n,s,r;for(r=t.getElementsByTagName("macro"),e=0,i=r.length;i>e;e+=1)n=r.item(e),s=n.getElementsByTagName("date"),s.length&&n.setAttribute("macro-has-date","true")},e.exports=s},{}],437:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("substance/model/InlineNode");n.Prototype=function(){this.getDefaultProperties=function(){return{targets:[]}},this.setLabel=function(t){this.label!==t&&(this.label=t,this.emit("label:changed"))},this.onTargetChange=function(t,e,i){this.updateCollection(i)}},s.extend(n),n["static"].name="citation",n["static"].defineSchema({targets:["array","id"]}),n["static"].tagName="cite",e.exports=n},{"substance/model/InlineNode":104}],438:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("substance/ui/SurfaceCommand"),r=t("substance/model/transform/createAnnotation"),o=t("substance/model/transform/insertText");n.Prototype=function(){this.getCommandState=function(){var t=this.getSelection(),e={disabled:!0,active:!1};return t&&!t.isNull()&&t.isPropertySelection()&&(e.disabled=!1),e},this.getAnnotationData=function(){return{targets:[]}},this.getAnnotationType=function(){if(this.constructor["static"].annotationType)return this.constructor["static"].annotationType;throw new Error("Contract: CitationCommand.static.annotationType should be associated to a document citation type.")},this.execute=function(){var t,e=this.getCommandState(),i=this.getDocument(),n=this.getSurface();return e.disabled?void 0:(n.transaction(function(e,s){s=o(e,{selection:s.selection,text:"$"});var a=i.createSelection({type:"property",path:s.selection.path,startOffset:s.selection.startOffset-1,endOffset:s.selection.endOffset});return s.annotationType=this.getAnnotationType(),s.annotationData=this.getAnnotationData(),s.selection=a,s.splitContainerSelections=!1,s.containerId=n.getContainerId(),s=r(e,s),t=s.result,s}.bind(this)),{mode:"create",anno:t})}},s.extend(n),e.exports=n},{"substance/model/transform/createAnnotation":134,"substance/model/transform/insertText":142,"substance/ui/SurfaceCommand":388}],439:[function(t,e,i){"use strict";function n(){s.apply(this,arguments),this.props.node.connect(this,{"label:changed":this.onLabelChanged})}var s=t("substance/ui/InlineNodeComponent");n.Prototype=function(){var t=s.prototype;this.dispose=function(){t.dispose.call(this),this.props.node.disconnect(this)},this.render=function(){var e=t.render.call(this);return e.addClass(this.getClassNames()).attr("data-id",this.props.node.id).on("click",this.onClick).on("mousedown",this.onMouseDown).append(this.props.node.label||""),e},this.getClassNames=function(){var t=["sc-citation","sm-"+this.props.node.type];return this.props.node.highlighted&&t.push("sm-highlighted"),t.join(" ")},this.onMouseDown=function(t){t.preventDefault(),t.stopPropagation();var e=this.props.node,i=this.context.surface;i.setSelection(e.getSelection());var n=this.context.controller;n.emit("citation:selected",e)},this.onClick=function(t){t.preventDefault(),t.stopPropagation()},this.onLabelChanged=function(){this.rerender()}},s.extend(n),e.exports=n},{"substance/ui/InlineNodeComponent":377}],440:[function(t,e,i){"use strict";var n=t("lodash/array/compact");e.exports={type:"citation","import":function(t,e){e.id=t.attr("id")||e.id,e.targets=n(t.attr("rid").split(" "))},"export":function(t,e){var i=t.targets.join(" ");e.attr("rid",i)}}},{"lodash/array/compact":12}],441:[function(t,e,i){"use strict";function n(){r.apply(this,arguments),this._initialize(this.props)}var s=t("substance/util/helpers"),r=t("substance/ui/Component"),o=t("substance/ui/ScrollPane"),a=t("substance/ui/DialogHeader"),l=r.$$;n.Prototype=function(){this.render=function(){var t,e=this.context.componentRegistry;return t=this.items.length>0?this.items.map(function(t){var i=e.get(this.props.citationType+"-entry");return l(i,{node:t,active:this.isItemActive(t.id),handleSelection:this.handleSelection.bind(this)}).ref(t.id)}.bind(this)):[l("div").addClass("no-results").append("Nothing to reference.")],l("div").addClass("sc-cite-panel").append(l(a,{label:this.i18n.t("choose_referenced_items")}),l(o).append(t).ref("panelEl"))},this.willReceiveProps=function(t){this._initialize(t)},this._initialize=function(){this.items=this.getItems(this.props.citationType)},this.dispose=function(){this.$el.off("click",".back",this.handleCancel)},this.didMount=function(){this._scrollToTarget()},this.didReceiveProps=function(){this._scrollToTarget()},this._scrollToTarget=function(){var t=this.getFirstCitationTarget();t&&this.refs.panelEl.scrollTo(t)},this.getFirstCitationTarget=function(){var t=this.props.doc,e=t.get(this.props.citationId);return e?e.targets[0]:null},this.isItemActive=function(t){if(!this.props.citationId)return!1;var e=this.props.doc,i=e.get(this.props.citationId);return i?s.includes(i.targets,t):!1},this.handleCancel=function(t){t.preventDefault(),this.send("switchContext","toc")},this.getItems=function(t){var e=this.props.doc,i=e.getCollection(t);return i.getItems()},this.handleSelection=function(t){var e=this.props.citationId,i=this.props.doc,n=i.get(e),r=n.targets.slice();s.includes(r,t)?r=s.without(r,t):r.push(t);var o=this.context.controller;o.transaction(function(t,e){return t.set([n.id,"targets"],r),
e}),this.rerender()}},r.extend(n),e.exports=n},{"substance/ui/Component":365,"substance/ui/DialogHeader":374,"substance/ui/ScrollPane":383,"substance/util/helpers":410}],442:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("substance/packages/figure/Figure");s.extend(n),n["static"].name="image-figure",n["static"].citationType="image-figure-citation",n["static"].isBlock=!0,e.exports=n},{"substance/packages/figure/Figure":310}],443:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../citations/Citation");n.Prototype=function(){this.getItemType=function(){return"image-figure"}},s.extend(n),n["static"].name="image-figure-citation",e.exports=n},{"../citations/Citation":437}],444:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("../citations/CitationCommand");s.extend(n),n["static"].name="imageFigureCitation",n["static"].annotationType="image-figure-citation",e.exports=n},{"../citations/CitationCommand":438}],445:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("substance/ui/AnnotationTool");s.extend(n),n["static"].name="imageFigureCitation",n["static"].command="imageFigureCitation",e.exports=n},{"substance/ui/AnnotationTool":360}],446:[function(t,e,i){"use strict";var n=t("../citations/CitationXMLConverter");e.exports={type:"image-figure-citation",tagName:"cite",matchElement:function(t){return t.is("cite")&&"image-figure"===t.attr("rtype")},"import":function(t,e){n["import"](t,e)},"export":function(t,e){n["export"](t,e),e.attr("rtype","image-figure")}}},{"../citations/CitationXMLConverter":440}],447:[function(t,e,i){"use strict";function n(){s.apply(this,arguments)}var s=t("substance/ui/Component"),r=s.$$;n.Prototype=function(){this.render=function(){var t=r("div").addClass("figure border-bottom item pad clearfix small").attr("data-id",this.props.node.id).on("click",this.onClick).on("mousedown",this.onMouseDown);return this.props.active&&t.addClass("active"),t.append(r("img").addClass("image").attr("src",this.props.node.getContentNode().src)),t.append(r("div").addClass("title").append([this.props.node.label,this.props.node.title].join(" "))),t.append(r("div").addClass("caption truncate").append(this.props.node.caption)),t},this.onClick=function(t){t.preventDefault(),t.stopPropagation()},this.onMouseDown=function(t){t.preventDefault(),this.props.handleSelection(this.props.node.id)}},s.extend(n),e.exports=n},{"substance/ui/Component":365}],448:[function(t,e,i){"use strict";var n=t("substance/packages/figure/FigureXMLConverter");e.exports={type:"image-figure",tagName:"image-figure","import":function(t,e,i){n["import"](t,e,i);var s,r=t.find("image"),o=t.find("embed");r?s=i.convertElement(r):o&&(s=i.convertElement(o)),e.content=s.id},"export":function(t,e,i){n["export"](t,e,i)}}},{"substance/packages/figure/FigureXMLConverter":312}],449:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("substance/model/DocumentNode");s.extend(n),n["static"].name="article-meta",n["static"].defineSchema({title:"string",authors:["array","string"],"abstract":"string"}),e.exports=n},{"substance/model/DocumentNode":96}],450:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("substance/model/DocumentNode");s.extend(n),n["static"].name="author",n["static"].defineSchema({name:"string"}),e.exports=n},{"substance/model/DocumentNode":96}],451:[function(t,e,i){"use strict";e.exports={type:"article-meta",tagName:"meta","import":function(t,e,i){e.id="article-meta";var n=t.find("title");n?e.title=i.annotatedText(n,[e.id,"title"]):(console.warn("ArticleMeta: no title found."),e.title="");var s=t.find("abstract");s?e["abstract"]=i.annotatedText(s,[e.id,"abstract"]):(console.warn("ArticleMeta: no abstract found."),e["abstract"]=""),e.authors=[]},"export":function(t,e,i){e.setId(null);var n=i.$$;return e.append(n("title").append(i.annotatedText([t.id,"title"])),n("abstract").append(i.annotatedText([t.id,"abstract"])))}}},{}],452:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("substance/ui/Component"),r=t("substance/ui/TextPropertyAnnotator"),o=t("substance/ui/Component").$$;n.Prototype=function(){this.render=function(){var t=this.context.controller.getDocument(),e=t.getDocumentMeta();return o("div").addClass("document-cover").append(o(r,{name:"title",tagName:"div",path:[e.id,"title"]}).addClass("title"),o("div").addClass("abstract").append(o(r,{name:"abstract",tagName:"div",path:[e.id,"abstract"]}).addClass("abstract")))}},s.extend(n),e.exports=n},{"substance/ui/Component":365,"substance/ui/TextPropertyAnnotator":394}],453:[function(t,e,i){"use strict";var n=t("substance/ui/Component"),s=t("substance/ui/Component").$$,r=t("substance/ui/TextPropertyEditor"),o=function(){o["super"].apply(this,arguments)};o.Prototype=function(){this.render=function(){var t=this.context.controller.getDocument(),e=this.context.config,i=t.getDocumentMeta();return s("div").addClass("document-cover").append(s(r,{name:"title",tagName:"div",commands:e.title.commands,path:[i.id,"title"]}).addClass("title"),s("div").addClass("abstract").append(s(r,{name:"abstract",tagName:"div",commands:e["abstract"].commands,path:[i.id,"abstract"]}).addClass("abstract")))}},n.extend(o),e.exports=o},{"substance/ui/Component":365,"substance/ui/TextPropertyEditor":396}],454:[function(t,e,i){"use strict";function n(){n["super"].apply(this,arguments)}var s=t("substance/ui/Toolbar"),r=t("substance/ui/Component"),o=r.$$,a=t("substance/packages/text/SwitchTextTypeTool"),l=t("substance/ui/UndoTool"),u=t("substance/ui/RedoTool"),c=t("substance/ui/SaveTool"),h=t("substance/packages/strong/StrongTool"),p=t("substance/packages/subscript/SubscriptTool"),d=t("substance/packages/superscript/SuperscriptTool"),f=t("substance/packages/code/CodeTool"),m=t("substance/packages/emphasis/EmphasisTool"),g=t("substance/ui/FontAwesomeIcon"),b=t("substance/packages/embed/EmbedTool"),y=t("substance/packages/link/LinkTool"),v=t("substance/packages/figure/InsertFigureTool"),_=t("../figures/ImageFigureCitationTool"),x=t("../bibliography/BibItemCitationTool");n.Prototype=function(){this.render=function(){return o("div").append(o(s.Group).append(o(a)),o(s.Group).append(o(l).append(o(g,{icon:"fa-undo"})),o(u).append(o(g,{icon:"fa-repeat"})),o(c).append(o(g,{icon:"fa-save"}))),o(s.Dropdown,{label:o(g,{icon:"fa-image"})}).append(o(v).removeClass("tool").addClass("option").append(this.i18n.t("insert")),o(_).append(this.i18n.t("cite"))),o(s.Dropdown,{label:o(g,{icon:"fa-book"})}).append(o(x).append(this.i18n.t("cite"))),o(s.Group).append(o(b).append(o(g,{icon:"fa-file-code-o"}))),o(s.Group).addClass("float-right").append(o(h).append(o(g,{icon:"fa-bold"})),o(m).append(o(g,{icon:"fa-italic"})),o(y).append(o(g,{icon:"fa-link"})),o(p).append(o(g,{icon:"fa-subscript"})),o(d).append(o(g,{icon:"fa-superscript"})),o(f).append(o(g,{icon:"fa-code"}))))}},r.extend(n),e.exports=n},{"../bibliography/BibItemCitationTool":421,"../figures/ImageFigureCitationTool":445,"substance/packages/code/CodeTool":298,"substance/packages/embed/EmbedTool":305,"substance/packages/emphasis/EmphasisTool":309,"substance/packages/figure/InsertFigureTool":314,"substance/packages/link/LinkTool":324,"substance/packages/strong/StrongTool":335,"substance/packages/subscript/SubscriptTool":339,"substance/packages/superscript/SuperscriptTool":343,"substance/packages/text/SwitchTextTypeTool":356,"substance/ui/Component":365,"substance/ui/FontAwesomeIcon":375,"substance/ui/RedoTool":379,"substance/ui/SaveTool":382,"substance/ui/Toolbar":399,"substance/ui/UndoTool":401}]},{},[4]);